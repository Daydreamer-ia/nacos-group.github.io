<!doctype html>
<html lang="zh-CN" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Blog | Nacos</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://nacos.io/zh-cn/img/nacos_colorful.png"><meta data-rh="true" name="twitter:image" content="https://nacos.io/zh-cn/img/nacos_colorful.png"><meta data-rh="true" property="og:url" content="https://nacos.io/zh-cn/blog/page/5"><meta data-rh="true" name="docusaurus_locale" content="zh-cn"><meta data-rh="true" name="docsearch:language" content="zh-cn"><meta data-rh="true" name="keywords" content="Nacos"><meta data-rh="true" property="og:title" content="Blog | Nacos"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="https://img.alicdn.com/tfs/TB1hgJpHAPoK1RjSZKbXXX1IXXa-64-64.png"><link data-rh="true" rel="canonical" href="https://nacos.io/zh-cn/blog/page/5"><link data-rh="true" rel="alternate" href="https://nacos.io/en/blog/page/5" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://nacos.io/zh-cn/blog/page/5" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://nacos.io/blog/page/5" hreflang="default"><link data-rh="true" rel="alternate" href="https://nacos.io/blog/page/5" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/zh-cn/blog/rss.xml" title="Nacos RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-cn/blog/atom.xml" title="Nacos Atom Feed">




<link rel="stylesheet" href="//g.alicdn.com/mamba/assets/0.0.19/mse-arc-ui.min.css">
<script src="//g.alicdn.com/mamba/assets/0.0.19/mse-arc-ui.min.js"></script>
<script src="//g.alicdn.com/alilog/mlog/aplus_v2.js" id="beacon-aplus" exparams="clog=o&amp;aplus&amp;sidx=aplusSidx&amp;ckx=aplusCkx"></script>
<script src="//g.alicdn.com/aes/??tracker/1.0.34/index.js,tracker-plugin-pv/2.4.5/index.js,tracker-plugin-event/1.2.5/index.js,tracker-plugin-jserror/1.0.13/index.js,tracker-plugin-api/1.1.14/index.js,tracker-plugin-perf/1.1.8/index.js,tracker-plugin-eventTiming/1.0.4/index.js"></script>
<script src="https://www.googletagmanager.com/gtag/js?id=G-YHS75WKFBR" async></script><link rel="stylesheet" href="/zh-cn/assets/css/styles.45670f1e.css">
<link rel="preload" href="/zh-cn/assets/js/runtime~main.799a6c4f.js" as="script">
<link rel="preload" href="/zh-cn/assets/js/main.99abaf7c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-cn/"><div class="navbar__logo"><img src="/zh-cn/img/nacos_colorful.png" alt="Nacos Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh-cn/img/nacos_colorful.png" alt="Nacos Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/zh-cn/">首页</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" docid="/what-is-nacos" href="/zh-cn/docs/v2/what-is-nacos">2.X（推荐）</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-cn/docs/next/v2/what-is-nacos">用户文档</a></li><li><a class="dropdown__link" href="/zh-cn/docs/v2/what-is-nacos">2.X（推荐）</a></li><li><a class="dropdown__link" href="/zh-cn/docs/1.X/v2/what-is-nacos">1.X</a></li></ul></div><a href="https://cn.aliyun.com/product/aliware/mse?spm=nacos-website.topbar.0.0.0" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">企业版NACOS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://developer.aliyun.com/ebook/36?spm=a2c6h.20345107.ebook-index.18.152c2984fsi5ST" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">NACOS架构与原理<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-cn/blog">博客</a><a class="navbar__item navbar__link" href="/zh-cn/community">社区</a><a href="http://console.nacos.io/nacos/index.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">控制台样例<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_DSK9"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中</a><ul class="dropdown__menu"><li><a href="/en/blog/page/5" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-US">En</a></li><li><a href="/zh-cn/blog/page/5" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-CN">中</a></li></ul></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">所有文章</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/1.4.0-release">双十一购物节，Nacos 1.4.0 + Go SDK 1.0.1发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/2.0.1-release">Nacos 2.0.1 + 1.4.2 Release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/2.0.3-release">Nacos 2.0.3版本发布，继续提升集群稳定性及升级稳定性</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/2.1.0-release">Nacos 2.1.0版本发布，支持鉴权及加解密插件</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/2.1.1-release">Nacos 四周年，2.1.1 及 1.4.4 版本同时发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/2.2.0-release">Nacos 2.2.0 版本发布，新增多种插件支持</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/2.2.1-release">Nacos 多个新版本发布，rust-sdk完全适配完成</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/2.2.2-release">Nacos 2.2.2发布，优化启动体验和鉴权提示</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/212-and-220beta-release">Nacos 2.1.2、2.2.0-BETA及go-sdk 2.1.1 版本同时发布，多语言生态再添大将</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/5w1h-what">Nacos 帮我们解决什么问题？—— 配置管理篇</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/5w1h-where">Nacos 有哪些典型的应用场景？—— 配置管理篇</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/access control design">Nacos权限控制设计方案</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/address-server">Nacos环境隔离</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/alibaba-configserver">阿里巴巴服务注册中心产品ConfigServer 10年技术发展回顾</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/announcement-token-secret-key">关于Nacos默认token.secret.key及server.identity风险说明及解决方案公告</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/apisix">Apache APISIX 基于 Nacos 实现服务发现</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/chengdu-dubbo">Nacos 计划发布v0.2版本，进一步融合Dubbo和SpringCloud生态</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/cmdb">Nacos打通CMDB实现就近访问</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/cncf">Nacos 进入CNCF landscape</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/consul-k8s">Consul与kubernetes整合公告[翻译]</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/csharp-0.5.0">Nacos-sdk-csharp 0.5.0正式发布，功能与Java版本对齐！</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/discovery-console">Nacos服务发现控制台预览</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/dns-sd">微服务架构中基于DNS的服务注册与发现</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/download">下载页</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/dynamic-route-zuul-nacos">使用Nacos实现Spring Cloud Zuul的动态路由</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/eureka2">Eureka 2.0 开源工作宣告停止？别担心，ANS 即将 C位强势出道！</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/feeling-of-ASoC-2019">参与开源，Offer拿到手软 -- 来自一名2019阿里巴巴编程之夏同学的亲述</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/huya-nacos">虎牙直播共建Nacos生态</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/huya-practice">虎牙直播在微服务改造方面的实践和总结</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/iscas2021">Nacos 开源之夏2021活动 报名正式开启</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/iscas2022">Nacos开源之夏2022，贡献社区赢取12000奖金</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/iscas2023">Nacos开源之夏2023，贡献社区赢取12000奖金</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/nacos 1.1.0">Nacos 1.1.0发布，支持灰度配置和地址服务器模式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/nacos 1.1.4">Nacos 1.1.4发布，业界率先支持Istio MCP协议</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/nacos 1.2.0 guide">Nacos 1.2.0 权限控制介绍和使用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/nacos-1.3.0-design">Nacos 1.3.0 全新内核构建过程</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/nacos-2nd-anniversary">Nacos 两周年献礼，Nacos 1.3.2 + Go SDK 1.0.0发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/nacos-confd">nacos-confd</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/nacos-distro-mechanism">Nacos 的 Distro 一致性协议</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/nacos-is-coming">支持Dubbo生态发展，阿里巴巴启动新的开源项目 Nacos</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/nacos-reigster-mechanism">Nacos 的一条注册请求会经历什么？</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/nacos-roadmap">Nacos Roadmap：Nacos GA后会有哪些大动作？</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/nacos">Nacos 0.1.0 版本Review 活动设计</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/nacos0.5">Nacos0.5发布，支持DNS-based Service Discovery，JAVA 11</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/nacos0.6">Nacos 0.6版本发布，支持Dubbo生态并且支持Docker部署</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/nacos0.8">Nacos 0.8.0版本进行发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/nacos0.9-intro">Nacos 0.9.0版本进行发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/nacos0.9.0">Nacos 0.9.0版本进行发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/nacos1.0.0">Nacos 发布 1.0.0 版本，可大规模投入到生产环境中</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/nacos3.0-is-coming">我们总结了3大使用建议，并首次公开 Nacos3.0 规划图 | Nacos 开源4周年</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/namespace-endpoint-best-practices">Namespace,endpoint 最佳实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/performance-compare">Nacos 2.0 升级前后性能对比压测</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/pilot mcp">Pilot MCP协议介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/springboot-0.2.10">Nacos-spring-boot0.2.10发布，全面支持Nacos2.0</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/up-to-2w-star">双十一献礼 | Nacos Star破两万的回顾与展望</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/use-nacos-with-rainbond">在 Rainbond 中一键安装高可用 Nacos 集群</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/xiaomi-scale">小米Nacos2.0扩缩容最佳实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/higress">Higress + Nacos 微服务网关最佳实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/2021/08/01/mdx-blog-post">mdx-blog-post</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/2019/05/29/long-blog-post">long-blog-post</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh-cn/blog/2019/05/28/first-blog-post">first-blog-post</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="详解 Nacos 的一条注册请求会经历什么？"><meta itemprop="keywords" content="Nacos,注册"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-cn/blog/nacos-reigster-mechanism">Nacos 的一条注册请求会经历什么？</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T11:47:41.000Z" itemprop="datePublished">2023年10月10日</time> · <!-- -->阅读需 15 分钟</div></header><div class="markdown" itemprop="articleBody"><p>转载且编辑自<a href="http://www.passjava.cn/#/13.SpringCloud%E6%9E%B6%E6%9E%84%E5%89%96%E6%9E%90/07.Nacos%E9%85%8D%E7%BD%AE%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/02.Nacos%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E2%91%A0%EF%BC%9A%E4%B8%80%E6%9D%A1%E6%B3%A8%E5%86%8C%E8%AF%B7%E6%B1%82%E4%BC%9A%E7%BB%8F%E5%8E%86%E4%BB%80%E4%B9%88%EF%BC%9F" target="_blank" rel="noopener noreferrer">Nacos 的一条注册请求会经历什么?</a></p><h1>Nacos 的一条注册请求会经历什么？</h1><h1>前言</h1><p>Nacos 作为注册中心，用来接收客户端（服务实例）发起的注册请求，并将注册信息存放到注册中心进行管理。</p><blockquote><p>那么一条注册请求到底会经历哪些步骤呢？</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="知识点预告">知识点预告<a href="#知识点预告" class="hash-link" aria-label="知识点预告的直接链接" title="知识点预告的直接链接">​</a></h3><p>先上一张整体的流程图：</p><p><img loading="lazy" src="/zh-cn/assets/images/image-20220413171451070bFSgRzW3Rx0S-cf97e1427caabd564d6fad0274a46ea5.png" width="1964" height="1636" class="img_ev3q"></p><ul><li><strong>集群环境</strong>：如果是 Nacos 集群环境，那么拓扑结构是什么样的。</li><li><strong>组装请求</strong>：客户端组装注册请求，下一步对 Nacos 服务发起远程调用。</li><li><strong>随机节点</strong>：客户端随机选择集群中的一个 Nacos 节点发起注册，实现负载均衡。</li><li><strong>路由转发</strong>：Nacos 节点收到注册请求后，看下是不是属于自己的，不是的话，就进行路由转发。</li><li><strong>处理请求</strong>：转发给指定的节点后，该节点就会将注册请求中的实例信息解析出来，存到自定义的内存结构中。</li><li><strong>最终一致性</strong>：通过 Nacos 自研的 Distro 协议执行<code>延迟异步任务</code>，将注册信息同步给集群中的其他节点，保证了数据的最终一致性。</li><li><strong>异步重试</strong>：如果注册失败，客户端将会切换 Nacos 节点，再次发起注册请求，保证高可用性。</li></ul><p>这些知识点里面还有很多细节，我会通过画图 + 源码剖析的方式给大家解答。如果遇到源码看不太懂的地方，可以多看下我画的图，然后翻下源码，对照着一起看。</p><p>小 Tip：本文使用的 Nacos 版本： 2.0.4。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一源头发起注册">一、源头：发起注册<a href="#一源头发起注册" class="hash-link" aria-label="一、源头：发起注册的直接链接" title="一、源头：发起注册的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-阅读源码的小技巧">1.1 阅读源码的小技巧<a href="#11-阅读源码的小技巧" class="hash-link" aria-label="1.1 阅读源码的小技巧的直接链接" title="1.1 阅读源码的小技巧的直接链接">​</a></h3><p>在使用 Nacos 组件的的时候，我们加上一个注解 <code>@EnableDiscoveryClient</code> 就可以使服务自动注册到 Nacos。</p><blockquote><p>那么这个发起注册的地方到底在哪呢？注册信息又是长什么样的呢？</p></blockquote><p>告诉大家一个看源码的小技巧，拿到源码后，不是直接各个文件都看一篇，而是先看源码中带的 example 文件夹。如下图所示，找到 example 的 App 类，里面就有发起注册的实例代码。如下图所示：</p><p><img loading="lazy" src="/zh-cn/assets/images/image-20220412071138017zxK9mw-afe9812f13ff074bc352b592aa61e87d.png" width="2564" height="844" class="img_ev3q"></p><p>当然，我们也可以通过官网给的 curl 命令发起 HTTP 请求：</p><div class="language-SH codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SH codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X POST &#x27;http://127.0.0.1:8848/nacos/v1/ns/instance?serviceName=nacos.naming.serviceName&amp;ip=20.18.7.11&amp;port=8080&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>留个问题</strong>：我们都是加一个 Nacos 注解 <code>@EnableDiscoveryClient</code>，就会自动把服务实例注册到 Nacos，这个是怎么做到的？</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-发起注册的流程图">1.2 发起注册的流程图<a href="#12-发起注册的流程图" class="hash-link" aria-label="1.2 发起注册的流程图的直接链接" title="1.2 发起注册的流程图的直接链接">​</a></h3><p>先来看一下代码的流程图：</p><p><img loading="lazy" src="/zh-cn/assets/images/image-20220412071400192DVNL4d-9665cc994a215398c3c0349099baee79.png" width="2062" height="980" class="img_ev3q"></p><p>跟着这个流程图，我们 debug 来看下。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-组装注册的实例信息">1.3 组装注册的实例信息<a href="#13-组装注册的实例信息" class="hash-link" aria-label="1.3 组装注册的实例信息的直接链接" title="1.3 组装注册的实例信息的直接链接">​</a></h3><p>入口的核心代码如下图所示，它会组装注册的<code>实例信息</code>，放到一个 instance 变量里面：</p><p><img loading="lazy" src="/zh-cn/assets/images/image-202204111612410590Vmd01-615e535bd8410d9277bd4ec8842914f2.png" width="1332" height="548" class="img_ev3q"></p><p>通过代码调试，我们可以看到里面的实例信息长这样：</p><p><img loading="lazy" src="/zh-cn/assets/images/image-20220411160413112vLIk1i-5d4ff2f5c2841480d4251c57257a7abc.png" width="990" height="554" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="14-组装注册请求-request">1.4 组装注册请求 request<a href="#14-组装注册请求-request" class="hash-link" aria-label="1.4 组装注册请求 request的直接链接" title="1.4 组装注册请求 request的直接链接">​</a></h3><p>发起注册的核心方法是 doRegisterService()，组装的 request 如下图所示，里面有之前组装的实例信息 instance，还有指定的  namespace（Nacos 的命名空间）、serviceName（服务名），groupName（Nacos 的分组）。</p><p><img loading="lazy" alt="image-20220411162322668" src="/zh-cn/assets/images/image-202204111623226683NnG6U-e4eacabd0ad633c9a9a720a3a7cdb813.png" width="1424" height="876" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="15-发起远程调用">1.5 发起远程调用<a href="#15-发起远程调用" class="hash-link" aria-label="1.5 发起远程调用的直接链接" title="1.5 发起远程调用的直接链接">​</a></h3><p>requestToServer() 方法里面会调用 RpcClient 的 request() 方法：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">response = this.currentConnection.request(request, timeoutMills);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>就是向 Nacos 发起远程调用，如果是 Nacos 集群，则是向集群中的某个 Nacos 节点发起远程调用。</p><p>接下来我们看下客户端是如何选择一个 Nacos 节点进行注册的。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二集群环境分布式的前提">二、集群环境：分布式的前提<a href="#二集群环境分布式的前提" class="hash-link" aria-label="二、集群环境：分布式的前提的直接链接" title="二、集群环境：分布式的前提的直接链接">​</a></h2><p>如果是 Nacos 集群环境，客户端会随机选择一个 Nacos 节点发起注册。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-搭建好一套nacos-集群环境">2.1 搭建好一套Nacos 集群环境<a href="#21-搭建好一套nacos-集群环境" class="hash-link" aria-label="2.1 搭建好一套Nacos 集群环境的直接链接" title="2.1 搭建好一套Nacos 集群环境的直接链接">​</a></h3><p>为了讲解客户端是如何注册到 Nacos 集群环境的底层原理，我在本地搭建了一个 Nacos 集群环境，有 3 个 Nacos 服务，它们的 IP 相同，端口号不同。</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">192.168.10.197:8848</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.10.197:8858</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.10.197:8868</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/zh-cn/assets/images/image-20220408100844549MpxWbbx40la1-8ba0634d0f1ed91ae21e24204e4a5cad.png" width="1422" height="976" class="img_ev3q"></p><p>然后<strong>服务 A 和服务 B 都是配置了 Nacos 集群</strong>的 IP 和 端口号的，配置如下所示</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring.cloud.nacos.discovery.server-addr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  =192.168.10.197:8848,192.168.10.197:8858,192.168.10.197:8868</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>整体的结构如下图所示，服务 A 和 服务 B 都往 Nacos 集群进行注册。</p><p><img loading="lazy" src="/zh-cn/assets/images/image-20220408101723181kPWAUaDBK5jL-e96872194b8a82097957172cc89dd6c3.png" width="1596" height="1436" class="img_ev3q"></p><p><strong>但是里面有一个问题</strong>：服务 A 注册时，是向所有 Nacos 节点发起注册呢？还是只向其中一个节点发起注册？如果只向一个节点注册，要向哪个节点注册呢？</p><blockquote><p>答案：在 Client 发起注册之前，会有一个后台线程随机拿到 Nacos 集群服务列表中的一个地址。</p></blockquote><p><strong>Nacos 为什么会这样设计？</strong></p><ul><li>这其实就是一个负载均衡的思想在里面，每个节点都均匀的分摊请求。</li><li>保证高可用，当某个节点宕机后，重新拿到其他的 Nacos 节点来建立连接。</li></ul><p>接下来我们看下服务 A 是怎么随机拿到一个 Nacos 节点的。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="三随机节点平等的世界">三、随机节点：平等的世界<a href="#三随机节点平等的世界" class="hash-link" aria-label="三、随机节点：平等的世界的直接链接" title="三、随机节点：平等的世界的直接链接">​</a></h2><p>我们来看下客户端是如何随机选择一个节点的，流程图如下：</p><p><img loading="lazy" src="/zh-cn/assets/images/image-20220412085821355AZgLcJ-676a1d38dfb9a298ef355d3b096c6733.png" width="1166" height="1256" class="img_ev3q"></p><p>那么如何找到这些代码逻辑呢？思路是怎么样的？</p><p>我们之前讲过，RpcClient 会发起 request 请求，用的是和 Nacos 建立 <code>currentConnection</code> 连接来发起调用，代码如下：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 发起调用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">response = this.currentConnection.request(request, timeoutMills);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个 <code>currentConnection</code> 是客户端和 Nacos 集群中的某个节点建立的连接，我们找下它在哪里赋值的。代码如下：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 拿到 Nacos 节点信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serverInfo = recommendServer.get() == null ? nextRpcServer() : recommendServer.get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 连接 Nacos 节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">connectToServer = connectToServer(serverInfo);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 赋值 currentConnection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">this.currentConnection = connectToServer;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>而连接的信息是通过参数 serverInfo 传进去的，所以我们再看下 serverInfo 在哪里赋值的。</p><p>这个 nextRpcServer() 方法里面会<strong>拿到一个随机的 Nacos 地址</strong>：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 一个 int 随机数，范围 [0 ~ Nacos 个数)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">currentIndex.set(new Random().nextInt(serverList.size()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// index 自增 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int index = currentIndex.incrementAndGet() % getServerList().size();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 返回 Nacos 地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return getServerList().get(index);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>小结</strong>：客户端生成一个随机数，然后通过这个随机数从 Nacos 服务列表中拿到一个 Nacos 服务地址返回给客户端，然后客户端通过这个地址和 Nacos 服务建立连接。Nacos 服务列表中的节点都是平等的，随机拿到的任何一个节点都是可以用来发起调用的。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="四路由转发不是我的菜">四、路由转发：不是我的菜<a href="#四路由转发不是我的菜" class="hash-link" aria-label="四、路由转发：不是我的菜的直接链接" title="四、路由转发：不是我的菜的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-发起和转发请求的流程">4.1 发起和转发请求的流程<a href="#41-发起和转发请求的流程" class="hash-link" aria-label="4.1 发起和转发请求的流程的直接链接" title="4.1 发起和转发请求的流程的直接链接">​</a></h3><p>为了演示发起注册的流程，我在这里模拟了一个注册请求。</p><p>用的是 curl 命令，对 Nacos 节点（127.0.0.1:8848）发起注册请求：</p><div class="language-SH codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SH codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X POST &#x27;http://127.0.0.1:8848/nacos/v1/ns/instance?serviceName=nacos.naming.serviceName&amp;ip=20.18.7.11&amp;port=8080&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>请求 URL</strong>：/nacos/v1/ns/instance</p><p><strong>请求参数</strong>：</p><ul><li>serviceName=nacos.naming.serviceName</li><li>ip=20.18.7.11</li><li>port=8080&#x27;</li></ul><p>之前我们讲到，Nacos 的有多个节点可以分别处理请求，当节点发现这个请求不是属于自己的，就会进行转发。</p><p>如下图所示：</p><p>服务 A 随机选择一个 Nacos 节点（图中为 Nacos1）发起注册请求，请求参数中包含了实例信息，Nacos 1 根据实例信息 hash + 取模拿到正确的节点，如果不属于自己，则将请求转发给其他节点（图中为 Nacos2）</p><p><img loading="lazy" src="/zh-cn/assets/images/image-20220412215250738gU1BYV-6144fe920ac12a2264f5126c937d37ea.png" width="1450" height="1336" class="img_ev3q"></p><p>那么路由转发的细节是怎么样的？这个就涉及到 Distro 协议了，我们接着往下看。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-路由转发的逻辑">4.1 路由转发的逻辑<a href="#41-路由转发的逻辑" class="hash-link" aria-label="4.1 路由转发的逻辑的直接链接" title="4.1 路由转发的逻辑的直接链接">​</a></h3><p>其实 Nacos 节点的路由转发逻辑比较简单，先来看下流程图：</p><p><img loading="lazy" src="/zh-cn/assets/images/image-20220412184102530MvbD7W-03d5f24c06c1d778ca0100fbc81b6497.png" width="1226" height="1374" class="img_ev3q"></p><p>步骤如下：</p><ul><li>①  Nacos 节点从客户端发起的 request 中拿到客户端的实例信息生成 distroTag，如 IP + port 或 service name。</li><li>②  Nacos 根据 distroTag 生成 hash 值。</li><li>③  用 hash 值对 Nacos 节点数进行<code>取余</code>，拿到余数，比如 0、1、2、3。</li><li>④ 根据余数从 Nacos 节点列表中拿到指定的节点地址。</li></ul><p><strong>我没看懂的点</strong>：我这里启动了三个 Nacos 节点，如下图所示的 三个 Running 节点。但是为什么 Nacos 的 ServersList 会多了一个 192.168.10.197:8848的节点？</p><blockquote><p>开发者回答：
nacos-server存在一个机制，在启动的时候会检查cluster.conf中配置的member内容，如果发现自身不在member列表中，就会将自身地址加入到member列表中。
图中member显示有127.0.0.1的3个节点和一个192.168.10.197节点，说明nacos-server获取到的ip是192.168.10.197，但是cluster.conf中配置的ip是127.0.0.1。
需要解决的话有两种方法，一种是严格按照上文中的配置，配置ip为192.168.10.197，另一种方式是在启动服务是设置JVM参数-Dnacos.server.ip=127.0.0.1
这个配置错误同样常见于使用K8S搭建Nacos集群，域名和hostname互相混用时出现。</p></blockquote><p><img loading="lazy" alt="IDEA 启动了三个 nacos 节点" src="/zh-cn/assets/images/image-202204122033417675s0J4F-d1e08a906f3afbf3285b330f56afe9a9.png" width="792" height="356" class="img_ev3q"></p><p><img loading="lazy" alt="nacos 控制台有四个节点" src="/zh-cn/assets/images/image-20220413153431838s2Wj4W-c33f05c6a2798639dbf30617d7c6afb3.png" width="1828" height="998" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-路由转发源码分析">4.2 路由转发源码分析<a href="#42-路由转发源码分析" class="hash-link" aria-label="4.2 路由转发源码分析的直接链接" title="4.2 路由转发源码分析的直接链接">​</a></h3><p>入口文件是 DistroFilter.java：</p><div class="language-SH codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SH codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">naming/src/main/java/com/alibaba/nacos/naming/web/DistroFilter.java</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>请求会先到 DistroFilter 类的 doFilter() 方法，拿到正确的节点地址后，将请求转发出去。</p><p>获取需要转发节点地址的代码如下：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 找到 Nacos 集群中的目标节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">final String targetServer = distroMapper.mapSrv(distroTag);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// mapSrv 方法会先 hash，然后再取模，responsibleTag的值类似这样：&quot;20.18.7.11:8080&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int index = distroHash(responsibleTag) % servers.size();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// distroHash 方法里面会对 客户端的 ip+port 字符串或者服务名字符串 进行 hash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Math.abs(responsibleTag.hashCode() % Integer.MAX_VALUE);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>不论是自己处理注册请求还是转发给其他节点来处理，都会把实例信息存储起来，那么是如何进行存储的？</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="五处理请求快到碗里来">五、处理请求：快到碗里来<a href="#五处理请求快到碗里来" class="hash-link" aria-label="五、处理请求：快到碗里来的直接链接" title="五、处理请求：快到碗里来的直接链接">​</a></h2><p>Nacos 目前有两个版本，v1 和 v2，如果是 v1，则是 instanceController 来处理注册请求，否则用 instanceControllerV2。本篇我们只讲解 v1 版本是怎么处理请求的。</p><p>先上流程图：</p><p><img loading="lazy" alt="添加实例信息的流程" src="/zh-cn/assets/images/image-20220413164932907KHTvVM-1ea8de71447055276f1afbae22199828.png" width="1366" height="1360" class="img_ev3q"></p><p>测试用的发起注册的命令：</p><div class="language-SH codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-SH codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X POST &#x27;http://127.0.0.1:8858/nacos/v1/ns/instance?serviceName=nacos.naming.serviceName&amp;ip=20.18.7.11&amp;port=8080&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>核心代码就是这个：</p><p><img loading="lazy" alt="服务端注册实例的方法" src="/zh-cn/assets/images/image-20220413160148289ylcS1n-5f60cb502dbe3dd369cd47497e22476a.png" width="1624" height="768" class="img_ev3q"></p><p>有一个 synchronized 锁，将临时的实例信息存放起来，所以重点看下 这个 consistencyService.put() 方法做了什么事情。</p><p>先看下源码：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">onPut(key, value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 开启 1s 的延迟任务，将数据同步给其他 Nacos 节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">distroProtocol.sync(new      DistroKey(key,KeyBuilder.INSTANCE_LIST_KEY_PREFIX),DataOperation.CHANGE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                DistroConfig.getInstance().getSyncDelayMillis());</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里面做了三件事情：</p><ul><li>① 将实例信息存放到内存缓存 concurrentHashMap 里面。</li><li>② 添加一个任务到 BlockingQueue 里面，这个任务就是将最新的实例列表通过 UDP 的方式推送给所有客户端（服务实例），这样客户端就拿到了最新的服务实例列表。</li><li>③ 开启 1s 的延迟任务，将数据通过给其他 Nacos 节点。</li></ul><p><strong>注意</strong>：针对第二点和第三点，属于 Distro 一致性协议的一部分，里面的内容还比较多，我们放到下一讲专门来讲。</p><p><strong>知识点预告</strong>：</p><ul><li><p>这里的存储实例和同步的方式和 Eureka 有什么区别？Eureka 用的三层缓存架构，Nacos 用的 CopyOnWrite 技术。</p></li><li><p>如何推送给所有客户端的？UDP 方式。</p></li><li><p>如何同步给 Nacos 其他节点的？Distro 一致性协议。</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="六总结">六、总结<a href="#六总结" class="hash-link" aria-label="六、总结的直接链接" title="六、总结的直接链接">​</a></h2><p>本文通过发起一条注册请求，讲解了 Nacos 客户端如何随机选择节点、Nacos Server 如何路由、Nacos Server 如何存储注册实例。</p><p><strong>核心流程</strong>：</p><p><img loading="lazy" src="/zh-cn/assets/images/image-20220413171451070bFSgRz-20220530201153679-cf97e1427caabd564d6fad0274a46ea5.png" width="1964" height="1636" class="img_ev3q"></p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Nacos是阿里巴巴2018年开源的服务发现和配置管理项目，并于今年的4月10号GA，距今已经过去了快两个月时间了。Nacos GA代表着用户可以在生产环境上大规模使用，目前也已经有众多用户登记使用。在GA之后，Nacos并未停下前进的脚步，不断的开发新的功能和优化用户体验。与此同时，Nacos倾听社区的声音，每一次迭代和发布都会包含用户关心的功能点。根据Nacos既定的演进方向，以及在与社区进行充分的讨论后，Nacos接下来的版本计划也浮出水面。Nacos在今年还将发布6到7个大版本，每个版本包含的重要特性如下："><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-cn/blog/nacos-roadmap">Nacos Roadmap：Nacos GA后会有哪些大动作？</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T11:47:41.000Z" itemprop="datePublished">2023年10月10日</time> · <!-- -->阅读需 7 分钟</div></header><div class="markdown" itemprop="articleBody"><p>Nacos是阿里巴巴2018年开源的服务发现和配置管理项目，并于今年的4月10号GA，距今已经过去了快两个月时间了。Nacos GA代表着用户可以在生产环境上大规模使用，目前也已经有众多用户<a href="https://github.com/alibaba/nacos/issues/273" target="_blank" rel="noopener noreferrer">登记</a>使用。在GA之后，Nacos并未停下前进的脚步，不断的开发新的功能和优化用户体验。与此同时，Nacos倾听社区的声音，每一次迭代和发布都会包含用户关心的功能点。根据Nacos既定的演进方向，以及在与社区进行充分的<a href="https://github.com/alibaba/nacos/issues/1433" target="_blank" rel="noopener noreferrer">讨论</a>后，Nacos接下来的版本计划也浮出水面。Nacos在今年还将发布6到7个大版本，每个版本包含的重要特性如下：</p><a name="aq5sL"></a>#### 1.1.0<ul><li><strong>Go SDK发布：</strong> Go语言SDK</li><li><strong>地址服务器：</strong> 使用地址服务器模式进行Nacos服务端集群寻址</li><li><strong>灰度配置：</strong> 设置灰度的机器IP来进行配置的灰度发布<a name="MxxeU"></a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="120">1.2.0<a href="#120" class="hash-link" aria-label="1.2.0的直接链接" title="1.2.0的直接链接">​</a></h4><ul><li><strong>配置权限控制：</strong> 对配置的读写进行权限的控制，支持对接三方权限系统</li><li><strong>DNS协议，支持K8S服务域名解析：</strong> 通过支持DNS协议访问，无侵入的解决服务发现问题，并支持K8S域名解析</li><li><strong>Service Mesh打通：</strong> 对接开源流行的Service Mesh组件，支持作为服务发现后端和配置管理后端<a name="eqoii"></a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="130">1.3.0<a href="#130" class="hash-link" aria-label="1.3.0的直接链接" title="1.3.0的直接链接">​</a></h4><ul><li><strong>服务权限控制：</strong> 对服务的注册注销及查询进行权限的控制，支持对接三方权限系统</li><li><strong>Mysql依赖可替换为其他存储：</strong> 支持将MySQL依赖替换为Oracle等常见数据库系统依赖</li><li><strong>gRPC服务发现支持：</strong> 通过Go SDK和Java SDK支持gRPC和gRPC-java的服务注册与发现<a name="Czkv8"></a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="140">1.4.0<a href="#140" class="hash-link" aria-label="1.4.0的直接链接" title="1.4.0的直接链接">​</a></h4><ul><li><strong>配置加密：</strong> 敏感配置加密存储和传输，保证数据安全</li><li><strong>confd模式模板渲染：</strong> 支持将配置或者服务数据渲染到文件模板，适配异构系统</li><li><strong>健康检查SPI化，可以使用K8S健康检查：</strong> 支持使用Kubernetes自带的健康检查方式来检查服务实例的健康状态<a name="RFUj5"></a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="150">1.5.0<a href="#150" class="hash-link" aria-label="1.5.0的直接链接" title="1.5.0的直接链接">​</a></h4><ul><li><strong>配置发布审批：</strong> 配置发布管控体系，减少人为失误引起的故障</li><li><strong>IPv6支持：</strong> 支持在IPv6网络环境下进行服务的注册与发现和配置的管理</li><li><strong>长连接推送通道重构：</strong> 重构推送通道，提升SLA</li><li><strong>configMap对接：</strong> 和Kubernetes的配置进行打通<a name="lykZW"></a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="160">1.6.0<a href="#160" class="hash-link" aria-label="1.6.0的直接链接" title="1.6.0的直接链接">​</a></h4><ul><li><strong>Thrift服务发现：</strong> 支Thrift服务框架服务注册于发现</li><li><strong>支持Region、AZ等类似信息存储：</strong> 支持进行环境信息的注册，根据环境进行自定义访问策略</li><li><strong>运维命令行：</strong> 使用更简洁的方式，进行集群的运维</li><li><strong>打标支持，对接K8S label：</strong> 能够打自定义标签，能够理由Kubernetes的label进行负载均衡及灰度配置等<a name="qK0hH"></a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="170">1.7.0<a href="#170" class="hash-link" aria-label="1.7.0的直接链接" title="1.7.0的直接链接">​</a></h4><ul><li><strong>无状态化：</strong> 存储和计算分离，让系统本身无状态</li><li><strong>一致性协议抽象及Raft协议替换：</strong> 全新的Raft协议，支持替换</li></ul><a name="dbaJf"></a>### 增强现有功能，提供更多生产环境需求特性 目前用户集中反馈的需求有灰度配置、权限控制、发布审批等功能，这些特性我们都会在接下来的版本以最高优先级实现。这些特性基本上用户在以往的生产经验中都有所接触，这里不再做详细的介绍。<p>同时，为了最大化降低用户的部署运维成本，我们会先支持多种数据库的依赖，包括Oracle等数据库，这样可以让用户不需要为了使用Nacos再单独搭建一套MySQL集群。后面我们会更进一步，将外部数据库依赖彻底去除，支持Nacos完全使用本地存储。包括无状态化，也会在未来的版本支持，争取让用户以最低成本的方式运行Nacos。</p><a name="DHiVd"></a>### 与更多生态进行对接，形成联动优势，提升用户效率 一个产品的成功，往往是因为一个生态的成功。Nacos目前架构的优势之一，就是可以比较平滑的支持多个生态。目前已经支持的有Dubbo生态、Spring Cloud生态，而正在打通的有gRPC和Kubernetes，未来还计划支持Thrift等服务框架。我们的目标是用户无论在哪种生态下，都不需要为注册中心或者配置中心的选型烦恼。<a name="KyZiP"></a>### 云原生领域布局和组件打通 云原生是当前非常火热的一个概念。在CNCF、Pivotal等机构相继定义和大力推动云原生的背景下，用户对整个软件的生命周期管理都有了全新的认知。云原生是一个极具潜力的理念，Nacos也会在接下来的演进中对云原生做重点支持。<a name="fPVms"></a>### 内核升级，提升性能和稳定性 Nacos目前的内核，包括自建Raft、MySQL依赖，长轮询及UDP推送等，都会在接下来进行重新设计，目标是优化到最合理的架构，提升整体的性能和稳定性。</div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Nacos 0.1.0 版本Review 活动设计"><meta itemprop="keywords" content="nacos 0.1.0"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-cn/blog/nacos">Nacos 0.1.0 版本Review 活动设计</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T11:47:41.000Z" itemprop="datePublished">2023年10月10日</time> · <!-- -->阅读需 3 分钟</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="i-活动任务列表">I. 活动任务列表<a href="#i-活动任务列表" class="hash-link" aria-label="I. 活动任务列表的直接链接" title="I. 活动任务列表的直接链接">​</a></h2><ul><li>阅读官网文案，找官网bug, 给中、英文官网提建设性建议</li><li>阅读中英文档，找文档bug, 给中、英文档改善提建议（尤其是关注英文翻译不好的地方，因为英文都是我们程序员自己撸的）</li><li>尝试下代码 -&gt;编译打包 -&gt; 启动Nacos server -&gt; 停止Nacos server流程，提出改进意见</li><li>尝试配置以及启动多节点 Nacos 集群模式任务，提改进意见</li><li>尝试使用Nacos Java SDK, 给Java SDK提改进建议</li><li>尝试使用Nacos Open API，给OpenAPI提改进建议</li><li>尝试根据《如何贡献Nacos文档 TODO》试一下 贡献流程，给贡献者流程提建议</li><li>给Nacos提需求、发展计划、想法和要求等</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ii-活动参与方式">II. 活动参与方式<a href="#ii-活动参与方式" class="hash-link" aria-label="II. 活动参与方式的直接链接" title="II. 活动参与方式的直接链接">​</a></h2><ul><li><p>扫描 “超哥” 微信2微码，让超哥帮助加入 “Nacos社区交流群”</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/11189/1532004866850-5e03b901-6d76-4380-b7bf-66e227808bdc.png" alt="微信二维码" class="img_ev3q"> </p></li><li><p>选择I 中的一个或者多个体验任务</p></li><li><p>发现问题或者BUG之后，按照III中的《问题Report方式》，发一个相应的 github issue, 并指派给 @ github账号<a href="https://github.com/xuechaos" target="_blank" rel="noopener noreferrer">xuechaos</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="iii-问题report方式">III. 问题Report方式<a href="#iii-问题report方式" class="hash-link" aria-label="III. 问题Report方式的直接链接" title="III. 问题Report方式的直接链接">​</a></h2><ul><li>流程说明 TODO</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="iv-奖励方式">IV. 奖励方式<a href="#iv-奖励方式" class="hash-link" aria-label="IV. 奖励方式的直接链接" title="IV. 奖励方式的直接链接">​</a></h2><ul><li>我们正在为参与并作出突出贡献的小伙伴定制一些小礼品，会考虑快递给过程中有突出贡献的小伙伴</li><li>礼物虽轻，但希望能表达对你们的帮助的感激之情的万一</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="v-其它说明">V. 其它说明<a href="#v-其它说明" class="hash-link" aria-label="V. 其它说明的直接链接" title="V. 其它说明的直接链接">​</a></h2><ul><li>我们不确定每个建议最后都会被采用，但是我们尽量会跟您沟通我们基于何种考虑，您的建议我们最后没有采用</li><li>尽量通过邮件列表或者report issue的方式，而不是在微信群里report问题，以便将我们的沟通过程文档化和更容易沉淀</li></ul></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Nacos0.5发布，支持DNS-based Service Discovery，JAVA 11"><meta itemprop="keywords" content="nacos0.5,DNS-based Service Discovery,JAVA 11"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-cn/blog/nacos0.5">Nacos0.5发布，支持DNS-based Service Discovery，JAVA 11</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T11:47:41.000Z" itemprop="datePublished">2023年10月10日</time> · <!-- -->阅读需 24 分钟</div></header><div class="markdown" itemprop="articleBody"><blockquote><p>Authors: 坤宇，敦谷</p></blockquote><p>阿里巴巴微服务开源项目<a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Dubbo Nacos</a>于本周发布 <strong>v0.5.0</strong> 版本，该版本主要在 DNS-based Service Discovery，支持 TTL，支持 Java 11，优化Nacos产品用户体验，与Spring Cloud Gateway的集成等方面做了演进。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="发布-dns-f支持-dns-based-service-discovery">发布 DNS-F，支持 DNS-based Service Discovery<a href="#发布-dns-f支持-dns-based-service-discovery" class="hash-link" aria-label="发布 DNS-F，支持 DNS-based Service Discovery的直接链接" title="发布 DNS-F，支持 DNS-based Service Discovery的直接链接">​</a></h2><p>为了进一步降低微服务多语言生态、异构系统、Kubernetes体系的服务注册与发现的实现成本，Nacos v0.5.0 发布了一款基于CoreDNS的 <strong>DNS-F</strong>客户端，通过 <strong>DNS-F</strong> 支持将注册在Nacos上的服务以DNS域名的方式暴露出接入点，让三方应用方便的查阅、发现与集成。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1542705469700-1e4ffc48-9632-4495-a8dd-c3dc8647b345.png" alt="屏幕快照 2018-11-20 17.17.38.png" class="img_ev3q"> </p><p><strong>DNS-F</strong> 不同于Nacos的 Client SDK/API 服务发现模式，<strong>DNS-F</strong> 提供独立于应用进程的Agent, 通过拦截并代理主机应用的域名解析请求，让Nacos处理服务发现对应域名的数据动态推送更新、健康检查、异常节点下线等、同时Nacos UI提供统一的服务发现域名管理视图 (UI域名管理部分，v0.5.0暂未开放)。</p><p>在Nacos的立项之初，提供动态的基于 DNS 协议的服务发现能力就是其核心的三大功能之一，之所以Nacos要提供DNS-SD，主要旨在帮助用户解决三个方面的问题:</p><ul><li><strong>为Kubernetes以及应用的服务发现提供统一解决方案</strong></li></ul><p>应用微服务体系（如Spring Cloud）+ Kubernetes已经逐渐成为新的组合，通过前者解决应用架构问题，通过后者解决微服务部署及运维的成本问题，但是在服务发现这一块，毫无疑问，Kubernetes体系内的服务发现方案无论是SkyDNS，KubeDNS还是CoreDNS，一直都是基于DNS的，但是像Spring Cloud则是基于像Eureka,zookeeper这样的服务发现方案，这种方案的异化和沟鸿给用户统一服务发现和服务管理方案带来了巨大的挑战。</p><p>Nacos DNS-F 目前开源提供的版本，是在CoreDNS的基础上提供了Nacos的plugin <a href="https://github.com/nacos-group/nacos-coredns-plugin" target="_blank" rel="noopener noreferrer">nacos-coredns-plugin</a>, 这样初步打通了CoreDNS与Nacos服务, 这种实现方式为未来Nacos进一步打通Kubernetes集群内部的服务发现与应用服务发现（如Spring Cloud)提供了通路，为Nacos在未来帮助应用以统一的视图管理Kubernetes内部及应用自身的服务及域名提供了基础，从而帮助用户简化基于kubernetes体系的微服务平台的构建与管理。</p><ul><li><strong>帮助用户消除耦合到厂商私有服务发现API上的风险</strong></li></ul><p>很不幸的说，到目前为止，服务发现迄今仍然没有标准协议，市面上的服务发现的解决方案有很多，仅在Java Spring生态中，就有zookeeper，consul，eureka，nacos等解决方案可以用，更不用说在其它的语言和框架中了，Nacos通过提供 <strong>DNS-F</strong>，可以让用户更容易地实现以DNS协议为基础的服务发现（即<strong>DNS-SD</strong>），而DNS协议是一个成熟的标准协议，基于DNS做服务发现，不仅可以有效的帮助用户消除耦合到厂商私有服务发现API上的风险，方便未来的迁移，也有利于服务提供方以更标准的和易理解的方式暴露自己的服务，从而更易于被不同的应用方发现和集成。</p><ul><li><strong>支持异构系统及多语言生态的服务发现</strong></li></ul><p>在一个中大型企业中，传统企业架构要升级为云原生微服务架构，遗留系统和异构系统的服务注册与发现无疑是必须首要解决的问题。另外采用微服务架构的一大承诺收益点也在于每个微服务本身可以独立选择更合适的语言栈，但是到目前为止没有个一个服务发现产品能提供各种语言客户端SDK的100%的完全覆盖，以zookeeper为例子，zookeeper质量比较好的客户端仅有java和c的客户端，那么非java和c两个语言体系的服务和系统就很难通过zookeeper来注册与发现，而DNS天然是各种语言都支持的，一般使用DNS做服务发现对应用的侵入非常的小，非常适合遗留应用或者异构应用往新的微服务平台上的迁移。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="阿里巴巴基于dns-f的dns-sd生产实践">阿里巴巴基于DNS-F的DNS-SD生产实践<a href="#阿里巴巴基于dns-f的dns-sd生产实践" class="hash-link" aria-label="阿里巴巴基于DNS-F的DNS-SD生产实践的直接链接" title="阿里巴巴基于DNS-F的DNS-SD生产实践的直接链接">​</a></h3><p>以阿里巴巴为例，基于<strong>DNS-F</strong>模式的服务发现已经是阿里巴巴生产环境中的最重要服务发现方式之一，不同于外界对于阿里巴巴的印象，在像阿里妈妈，高德，优酷，搜索等这样的业务中，存在大量的重要的非Java语言体系的业务系统提供的服务，而基于DNS-F的DNS-SD解决方案，则在发现，打通和勾连这些异构服务的过程中起到了举足轻重的作用。</p><p>距离阿里巴巴内部发布的第一个python版本的<strong>DNS-F</strong>客户端已经过去<strong>5</strong>个年头，python版本的<strong>DNS-F</strong>客户端在生产上的整体装机使用量，对所有VIPServer各语言客户端的占比已经超过 <strong>1/3</strong>,可见其在内部应用之广泛，而不用绑定在私有的VIPServer API上, 业务从LVS/VIP，SLB等网关式(Server-based SD)服务发现方案迁移过来时对业务侵入小，也是众多业务线愿意优先考虑<strong>DNS-F</strong>客户端的首要原因。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dns-协议需要继续演进">DNS 协议需要继续演进<a href="#dns-协议需要继续演进" class="hash-link" aria-label="DNS 协议需要继续演进的直接链接" title="DNS 协议需要继续演进的直接链接">​</a></h3><p>DNS协议本身是为www而生，并非为服务发现而生，所以在协议上，用在服务发现场景下DNS依然有不少的小瑕疵需要在未来从协议层面解决，比如DNS缓存TTL收敛的问题，比如操作系统以及各语言对SRV Record字段的支持问题,DNS包大小限制的问题等等，但随着Kubernetes以及微服务体系在各行业的深入应用，可以说DNS协议已经有为服务发现场景做进一步向前演进的必要，这方面阿里巴巴&amp;<strong>Nacos</strong>会做持续的探索和推进。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="支持-java-11">支持 Java 11<a href="#支持-java-11" class="hash-link" aria-label="支持 Java 11的直接链接" title="支持 Java 11的直接链接">​</a></h2><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1542708832647-def4c40d-273c-4515-8ee9-27fd9add5b03.png" alt="屏幕快照 2018-11-20 18.13.36.png" class="img_ev3q"> </p><p>9月25日，Oracle 官方宣布 Java 11正式发布，不同于Java 9以及10，这是继 Java 8 之后的首个长期支持版本，Java 11 在诸如 ZGC，TLS 1.3，新的算法密钥协议，Lambda局部变量语法支持，Standardize HTTP Client API等不少方面做了改进，确实值得关注。</p><p>关于 Nacos 支持 Java 11, 这里有一个有趣的花絮,本来Nacos没有计划在近期的版本支持Java 11,因为Nacos团队考虑到 Java 8 依然是生产上的主流(参见<a href="https://res.cloudinary.com/snyk/image/upload/v1539774333/blog/jvm-ecosystem-report-2018.pdf" target="_blank" rel="noopener noreferrer">JVM生态报告</a>, 报告显示 <strong>79%</strong> 的 Java 开发者使用 Java 8 作为生产环境的主要平台), 但是Spring Cloud 大神 <strong>@Josh Long</strong> 在准备尝试和给全世界演示 Nacos 的时候，居然在 Java 11 上跑不起来，于是他毅然的给Nacos提了个 issue <a href="https://github.com/alibaba/nacos/issues/214" target="_blank" rel="noopener noreferrer">Please support Java 11</a>.</p><blockquote><p>划重点~ <strong>github上给Nacos提issue是实现你的需求和想法的最佳手段!</strong></p></blockquote><p>Nacos支持Java 11, 主要是指2个方面的支持</p><ul><li>Nacos 支持运行在Java 11上</li><li>将Nacos源码开发及构建环境升级到Java 11</li></ul><p>现在Nacos的状态是2方面都已经支持 Java 11。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用nacos实现spring-cloud-gateway的动态路由">使用Nacos实现Spring Cloud Gateway的动态路由<a href="#使用nacos实现spring-cloud-gateway的动态路由" class="hash-link" aria-label="使用Nacos实现Spring Cloud Gateway的动态路由的直接链接" title="使用Nacos实现Spring Cloud Gateway的动态路由的直接链接">​</a></h2><p>要实现微服务架构，微服务网关必不可少，Nacos 社区目前正在努力跟 Spring Cloud 的微服务网关做更多的打通与集成，Spring Cloud 中文社区创建者,《重新定义Spring Cloud实战》的作者 <strong>@许进</strong> 与近期贡献了如何基于Spring Cloud Gateway与Nacos实现动态路由能力的示例，<a href="https://github.com/SpringCloud/spring-cloud-gateway-nacos" target="_blank" rel="noopener noreferrer">github 地址在这里</a>，毫无疑问，Spring Cloud Gateway作为所有请求流量的入口，在实际生产环境中为了保证高可靠和高可用，尽量避免重启,需要实现Spring Cloud Gateway 动态路由配置，等到这块足够成熟，会将其包含在Nacos的官方推荐实现中。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ttl--health-status-aggregation">TTL &amp; Health Status Aggregation<a href="#ttl--health-status-aggregation" class="hash-link" aria-label="TTL &amp; Health Status Aggregation的直接链接" title="TTL &amp; Health Status Aggregation的直接链接">​</a></h2><p>在Nacos之前的几个版本中，用户往往会在使用过程中产生疑惑，为什么注册的实例已经下线(宕掉)了，但是依然可以在Nacos控制台上看到实例的信息。这源于SpringCloud以及Dubbo等服务体系中，Eureka或者Zookeeper都有自动注销实例的能力，而且将自动注销作为注册中心的默认行为。但其实当服务的实例下线(宕掉)之后，注册中心有两种可能的行为，一个是将这个实例从服务下的实例列表中剔除出去，一个是保留该实例，只将实例状态置为不健康。Eureka和Zookeeper等注册中心，其实也支持持久化的实例注册，而Nacos只是将这种持久化的注册设成了默认的行为。</p><p>Nacos的服务发现模块，是基于内部的VIPServer演化而来。在VIPServer的主要场景中，服务是以域名的方式通过控制台注册到VIPServer的，并且VIPServer非常注重服务级别的元数据信息的定义带来的灵活“软负载”流量调度的能力，所以首要选择的是服务及实例的元数据的持久性存储，弱化了服务的提供端持续向VIPServer服务端发送心跳的能力，所以前期并没有将VIPServer 上报和汇聚实例健康状态的功能放出来。之前版本的服务实例的健康检查，必须由VIPServer服务端来主动发起来完成。但是如Nacos开源之初规划的那样，Nacos会同时支持两种模式</p><blockquote><p>对于复杂的云环境和网络拓扑环境中（如 VPC、边缘网络等）服务的健康检查，Nacos 提供了心跳上报模式和服务端主动探测2种健康检查模式。</p></blockquote><p>所以随着Nacos 0.5.0 版本的发布，我们很高兴的宣布，Nacos已经正式支持基于TTL的服务实例自动注销功能。这个功能一部分是响应社区关于TTL功能的需求，更重要的一部分，这也是Nacos服务发现自然演进的一个方向。</p><p>从 0.5.0 版本开始，用户通过客户端SDK注册的实例，将默认开启TTL功能，实例会默认每5秒向服务端发送一次心跳，如果Nacos服务端15秒内没有收到实例的心跳，则会将实例置为不健康，如果30秒没有收到心跳，则会将直接将实例删除。Nacos的TTL功能，补充了Nacos作为注册中心在处理实例下线的另一种行为，通过灵活可动态配置的参数，用户还可以根据实际的应用场景任意切换使用这两种行为中的一种。</p><p>Nacos的TTL功能虽然还处在实验性质，主要有以下特色：</p><ul><li><strong>进一步无缝融入SpringCloud生态和Dubbo生态</strong></li></ul><p>Nacos在最初的规划中，就已经计划能够帮助存量用户做无缝平滑迁移。而无缝平滑迁移除了注册中心的功能的完整性，体验、性能、一些重要的认知也能够从老注册中心接续过来。例如Eureka作为Spring Cloud里的主流注册中心，其默认行为就是会在没有收到实例心跳90秒后，将实例自动注销。而 Dubbo 里用的比较多的Zookeeper，也会使用临时节点，依托于Session超时时间来实现TTL功能。这这两种场景中，服务实例的注册基本都是通过服务提供端(Provider)使用注册中心客户端来完成的。Nacos目前已经提供了Spring Cloud体系的服务发现的完整解决方案，同时对Dubbo的适配和支持也会在最近的版本中释放出来。</p><ul><li><strong>服务级别&quot;元数据(metadata)&quot;不会自动注销</strong></li></ul><p>Nacos支持服务、集群和实例多级别的元数据信息，与服务实例可以被自动注销相对的，服务本身的元数据信息不能随着服务的下线而丢失,因为这些元数据通常是在创建服务时有人为设定上去的（例如负载均衡策略，权重规则，保护阈值等）。这意味着同一个服务的实例的上上下下，再注册上来的时候，应该依然保有服务原来设定的相关的元数据信息。</p><p>在Eureka或者Consul中，由于并不支持服务级别设定任何元信息，因此当实例都临时下线时，整个服务也就查询不到任何存在过的痕迹了。而服务级别的元信息作为Nacos的一个非常重要的特色功能，未来会基于此开放一系列流量控制类的特色功能，都决定了Nacos服务本身的元数据信息不能随着服务的下线而丢失，另一方面，在客户端注册实例时，不允许提交服务级别的元信息，这样也保证了单个实例的注册或者注销不会影响服务级别的配置。我们提供了控制台来对服务元数据进行便捷的创建和编辑。</p><ul><li><strong>将HSF的注册中心ConfigServer融入Nacos</strong></li></ul><p>在阿里巴巴集团内部，著名的HSF的注册中心ConfigServer支持的就是长连接注册模式(renew&amp;TTL)，因此当长连接断开时，自然而然的就会将实例注销掉。为了支持未来将HSF一些优秀的特性迁移和输出到Dubbo上，Nacos会逐渐将ConfigServer的核心能力融入到Nacos当中，而TTL则也是这个事情的基础。</p><p>而同时，Nacos非常看中产品在云上的适用性，在公有云上，因为用户往往注册到注册中心的IP是一个VPC的外部IP，因为公有云安全策略的限制，注册中心一般是不允许主动发起到VPC内的连接来做健康检查的，只能通过客户端上报心跳的模式来检查健康状态，也只有在客户端上报的模式下，才能启用自动注销功能。Nacos此次的TTL功能，很好的衔接了公有云和内部ConfigServer输出的需求，为后续的融合做好了初步的准备。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="spring-cloud-for-alibaba-with-nacos">Spring Cloud for Alibaba with Nacos<a href="#spring-cloud-for-alibaba-with-nacos" class="hash-link" aria-label="Spring Cloud for Alibaba with Nacos的直接链接" title="Spring Cloud for Alibaba with Nacos的直接链接">​</a></h2><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1542704490654-b70dcbb2-7bfe-433a-9497-303ba817f860.png" alt="屏幕快照 2018-11-20 16.19.27.png" class="img_ev3q"> </p><p>就像 SpringOne Platform 2018 大会上 Spring 开发者 @Roy Clarkson 和 @Ollie Hughes 在 <strong>《Cloud-Native Java with Spring Cloud Services》</strong> (<a href="https://www.youtube.com/watch?v=0Yh-cebFkN4&amp;index=108&amp;list=PLAdzTan_eSPQsR_aqYBQxpYTEQZnjhTN6" target="_blank" rel="noopener noreferrer">YouTube视频地址</a>) 演讲中阐述的那样，采用微服务设计模式，首要的就是选择 “External Configuration” “Service Registry” “Circuite Breaker” 的实现，而 Spring Cloud for Alibaba 这个项目则旨在通过将阿里巴巴在服务化以及阿里云上基于Aliware支撑各行业的微服务产品打包在一个stack里，给你提供开发支撑大规模微服务应用系统的一站式解决方案, 正如项目所述:</p><blockquote><p>“The Spring Cloud Alibaba project, consisting of Alibaba’s open-source components and several Alibaba Cloud products, aims to implement and expose well known Spring Framework patterns and abstractions to bring the benefits of Spring Boot and Spring Cloud to Java developers using Alibaba products.”</p></blockquote><p>随着 <a href="https://spring.io/blog/2018/10/30/spring-cloud-for-alibaba-0-2-0-released" target="_blank" rel="noopener noreferrer">Spring Cloud for Alibaba 0.2.0 的发布</a>，Nacos Configuration, Nacos Service Discovery 和 Sentinel Circuite Breaker 都已一网而聚之。</p><p>想了解如何在Spring Cloud中快速开始使用 Nacos 做配置中心和服务发现，可以点击<a href="https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html" target="_blank" rel="noopener noreferrer">这里</a>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="持续优化用户体验">持续优化用户体验<a href="#持续优化用户体验" class="hash-link" aria-label="持续优化用户体验的直接链接" title="持续优化用户体验的直接链接">​</a></h2><p>正如Nacos团队在开源立项之初发下的宏愿，Nacos希望通过未来团队的持续努力，能给Nacos贴上希望的标签，而追求产品的<strong>极致易用性</strong>永远是Nacos团队的核心关注点之一，Nacos 0.5.0 版本就社区近期反馈较多的的一些体验问题做了积极的修复和优化，这其中包括前端UI的优化，启动状态信息展示的优化,性能调优等等，</p><p><a href="https://github.com/alibaba/nacos/issues/177" target="_blank" rel="noopener noreferrer">#177</a> Console supports registering new empty service and delete empty service.
<a href="https://github.com/alibaba/nacos/issues/222" target="_blank" rel="noopener noreferrer">#222</a> print more nacos server start status info in start.log.
<a href="https://github.com/alibaba/nacos/issues/251" target="_blank" rel="noopener noreferrer">#251</a> Console Editor Optimization.
<a href="https://github.com/alibaba/nacos/issues/254" target="_blank" rel="noopener noreferrer">#254</a> DataId and group are required in historical version and listener query.
<a href="https://github.com/alibaba/nacos/issues/258" target="_blank" rel="noopener noreferrer">#258</a> Remove the Balloon of DataId/Group.</p><p>更多的优化和release信息见 <a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">nacos github</a></p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1542708581826-76439cb4-9cb8-49d1-af0d-790bdd2249bd.png" alt="屏幕快照 2018-11-20 18.09.08.png" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="蓬勃发展的-nacos-社区">蓬勃发展的 Nacos 社区<a href="#蓬勃发展的-nacos-社区" class="hash-link" aria-label="蓬勃发展的 Nacos 社区的直接链接" title="蓬勃发展的 Nacos 社区的直接链接">​</a></h2><blockquote><p>DISS is cheap, show me your hand
比吐槽更重要的是搭把手，参与社区一起发展Nacos</p></blockquote><ul><li>作为用户关注和加入 Nacos 社区</li></ul><p>Nacos 社区正在蓬勃发展，截止到发文为止，Nacos 短短几个月已经有5个微信群，其中4个已满员，1个QQ群，1个钉钉群，关注 Nacos 的社区人数已经近3000人，在 Nacos 群里跟 “道（基）友” 切磋技术，交流经验，招聘交友，抢抢红包...不亦乐乎。</p><p>要加入 Nacos 微信社区，你可以通过扫下面的<strong>“超哥”</strong>的微信二维码，让<strong>“超哥”</strong> 帮你拉入 “Nacos社区微信交流群”</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077965587-8f4e3100-bdd4-469a-9ea0-7af7061bc9ef.png" alt="Screen Shot 2018-06-27 at 13.39.09.png | left" class="img_ev3q"></p><ul><li>作为代码贡献者加入 Nacos 社区</li></ul><p>从Nacos用户发展而成贡献者顺理成章，而Nacos开发团队也确实在日趋壮大，从开始的只有4个代码contributor发展到目前的24个，随着<strong>阿里巴巴</strong>其他团队成员如 <strong>@小马哥</strong> 等人，<strong>虎牙直播</strong>的 <strong>@张波</strong> <strong>@周健</strong> 团队等人，<a href="https://github.com/nacos-group/nacos-docker" target="_blank" rel="noopener noreferrer">nacos-docker-k8s</a> 贡献者 <strong>@张龙</strong>，前端的主要贡献者饿了么 <strong>@王彦民</strong>，Spring Cloud中文社区创立者 <strong>@许进</strong> 等的陆续加入，相信未来Nacos社区的力量未来会越来越强大。</p><p>而社区也正在计划在合适的时机上，将在Nacos官网 <a href="http://nacos.io" target="_blank" rel="noopener noreferrer">nacos.io</a> 中添加团队介绍页，将大家正式公布于众，欢迎大家加入Nacos社区，贡献社区。用Apache的话说，<strong>“社区高于代码”!</strong> </p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1542704700864-a9d54856-9bf6-4176-b449-c13fa02c5800.png" alt="屏幕快照 2018-11-20 17.04.45.png" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="新人时刻---什么是nacos">新人时刻 - &quot;什么是Nacos？&quot;<a href="#新人时刻---什么是nacos" class="hash-link" aria-label="新人时刻 - &quot;什么是Nacos？&quot;的直接链接" title="新人时刻 - &quot;什么是Nacos？&quot;的直接链接">​</a></h2><blockquote><p>还不知道什么是Nacos? 没关系，在github上star一下跟程序猿兄弟打个招呼吧!!</p></blockquote><p><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a> 是阿里巴巴于7月份新开源的项目，Nacos的主要愿景是期望通过提供易用的 <code>动态服务发现</code>、<code>服务配置管理</code>、<code>服务共享与管理</code> 的基础设施，帮助用户在云原生时代更好的构建、交付、管理自己的微服务平台。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1532436633419-08a42307-7fb7-4d51-9062-fecc3868613b.png" alt="Screen Shot 2018-07-24 at 19.27.28.png" class="img_ev3q"> </p><p>github项目地址在 <a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">这里</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="更多与-nacos-相关的开源项目信息">更多与 Nacos 相关的开源项目信息<a href="#更多与-nacos-相关的开源项目信息" class="hash-link" aria-label="更多与 Nacos 相关的开源项目信息的直接链接" title="更多与 Nacos 相关的开源项目信息的直接链接">​</a></h2><ul><li><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a></li><li><a href="https://github.com/nacos-group/nacos-coredns-plugin" target="_blank" rel="noopener noreferrer">Nacos DNS-F</a></li><li><a href="https://github.com/nacos-group/nacos-docker" target="_blank" rel="noopener noreferrer">Nacos Docker</a></li><li><a href="https://github.com/nacos-group/nacos-spring-project" target="_blank" rel="noopener noreferrer">Nacos Spring Project</a></li><li><a href="https://github.com/nacos-group/nacos-spring-boot-project" target="_blank" rel="noopener noreferrer">Nacos Spring Boot</a></li><li><a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba</a></li><li><a href="http://dubbo.io" target="_blank" rel="noopener noreferrer">Dubbo</a></li><li><a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">Sentinel</a></li><li><a href="https://projects.spring.io/spring-cloud/" target="_blank" rel="noopener noreferrer">Spring Cloud</a></li><li><a href="https://github.com/Nepxion/Discovery" target="_blank" rel="noopener noreferrer">Nepxion Discovery</a></li><li><a href="https://github.com/SpringCloud/spring-cloud-gateway-nacos" target="_blank" rel="noopener noreferrer">Spring Cloud Gateway Nacos</a></li></ul></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Nacos 0.6版本发布，支持Dubbo生态并且支持Docker部署"><meta itemprop="keywords" content="nacos0.6,dubbo,docker"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-cn/blog/nacos0.6">Nacos 0.6版本发布，支持Dubbo生态并且支持Docker部署</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T11:47:41.000Z" itemprop="datePublished">2023年10月10日</time> · <!-- -->阅读需 10 分钟</div></header><div class="markdown" itemprop="articleBody"><blockquote><p>Authors: 马昕曦、张龙、邢学超</p></blockquote><p>阿里巴巴微服务开源项目<a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Dubbo Nacos</a>于本周发布 <strong>v0.6</strong>版本，该版本主要在支持了 Dubbo的服务注册与发现和配置管理、支持docker 部署提供了官方的docker镜像、优化Nacos 控制台的国际化框架并且Nacos的集成测试效率也大大优化。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/11189/1544689744102-fd00fec6-ca80-4c0c-9b0d-538f17279963.png" alt="image.png | left | 747x290" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="千呼万唤始出来dubbo的注册中心和配置中心">千呼万唤始出来，Dubbo的注册中心和配置中心<a href="#千呼万唤始出来dubbo的注册中心和配置中心" class="hash-link" aria-label="千呼万唤始出来，Dubbo的注册中心和配置中心的直接链接" title="千呼万唤始出来，Dubbo的注册中心和配置中心的直接链接">​</a></h2><p><strong>Nacos</strong> 从 <strong>v0.6</strong> 版本开始，支持 <strong>Dubbo</strong> 注册中心和配置中心，同样作为阿里巴巴开源的重量级别产品，两个产品在阿里巴巴集团的内部内部实现就有千丝万缕的联系。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dubbo服务框架">Dubbo服务框架<a href="#dubbo服务框架" class="hash-link" aria-label="Dubbo服务框架的直接链接" title="Dubbo服务框架的直接链接">​</a></h3><p>作为rpc服务框架，一方面注重的是极其短的时延rt，保证整体的调用高效，并且另一方面保证良好的用户体验，保证用户使用舒适并且有良好的扩展性。Dubbo在这两方面做的都非常的优秀，也因为良好的拓展性，被业内广泛使用。Dubbo的普及度以及欢迎程度之高，通过2w+的github仓库star关注度就可见一斑。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-和-dubbo-一脉相承的基因">Nacos 和 Dubbo 一脉相承的基因<a href="#nacos-和-dubbo-一脉相承的基因" class="hash-link" aria-label="Nacos 和 Dubbo 一脉相承的基因的直接链接" title="Nacos 和 Dubbo 一脉相承的基因的直接链接">​</a></h3><p>但阿里巴巴技术体系下有如此高效的rpc服务框架，但到底是什么支撑了阿里巴巴庞大的服务集群呢。众所周知阿里巴巴集团有着恐怖的集群规模，每年阿里巴巴集团的天猫双11全球购物狂欢节都会有人瞎掉下巴的交易规模，2018年的双11当天承载了2135亿的销售额。但作为技术人员，最关心的是峰值。如果细心的从业者应该看到了一个指标，2018年天猫承载了交易创建峰值达49.1万笔/秒。举个例子，北京鸟巢体育馆最大承载用户量9万1千人，49.1w交易每秒交易，意味着5个鸟巢体育馆的满座的观众推着购物车，同时在一秒冲过天猫淘宝的结算台，这种压力可想而知。但背后的承载这么大规模的服务集群的，和阿里巴巴Dubbo的内部使用框架HSF，对应的ConfigServer，而这正是Nacos的前身之一。Nacos 发布的0.6版本正是宣布和Dubbo完美集成，也就宣布阿里巴巴在大规模集群的经验将随着Nacos、Dubbo、Sentinel等分享出来，贡献给开源社区。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/11189/1544696219150-b786e8fe-af7d-4e29-9c32-03b051c6db3d.png" alt="image.png | left | 747x413" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dubbo融合nacos">Dubbo融合Nacos<a href="#dubbo融合nacos" class="hash-link" aria-label="Dubbo融合Nacos的直接链接" title="Dubbo融合Nacos的直接链接">​</a></h3><p>Nacos 作为 Dubbo 生态系统中重要的注册中心基础设施，其中 <a href="https://github.com/dubbo/dubbo-registry-nacos" target="_blank" rel="noopener noreferrer">dubbo-registry-nacos</a> 是 Dubbo 融合 Nacos 注册中心的桥梁，它基于 Dubbo 强大的<a href="http://dubbo.apache.org/zh-cn/docs/dev/impls/registry.html" target="_blank" rel="noopener noreferrer">注册中心 SPI </a> 以及 Nacos Naming 服务，提供实时的服务注册和发现。目前 <a href="https://github.com/dubbo/dubbo-registry-nacos" target="_blank" rel="noopener noreferrer">dubbo-registry-nacos</a>  处于 preview 阶段，最新的发布版本为 <code>0.0.2</code>，已测试最新的 Dubbo 以及 Dubbo OPS，推荐开发人员使用最新的 Dubbo <code>2.6.5</code> 以及 Nacos <code>0.6.1</code> ，确保享受最佳体验。如果您现在正在使用 Zookeeper 或者 Redis 作为注册中心的话，迁移到 Nacos 的部分也非常简单，以 Zookeeper 为例：</p><ul><li>场景一：外部化配置</li></ul><p>调整前的配置：</p><div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Zookeeper registry address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo.registry.address = zookeeper://127.0.0.1:2181</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>调整后的配置：</p><div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Nacos registry address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dubbo.registry.address = nacos://127.0.0.1:8848</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>场景二：XML 配置驱动</li></ul><p>调整前的配置：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 使用 Zookeeper 注册中心 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">dubbo:</span><span class="token tag" style="color:#00009f">registry</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">address</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">zookeeper://127.0.0.1:2181</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>调整后的配置：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- 使用 Nacos 注册中心 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">dubbo:</span><span class="token tag" style="color:#00009f">registry</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">address</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">nacos://127.0.0.1:8848</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>调整完毕后，先确保 Nacos Server 已启动，再重启您的 Dubbo 应用，随后您在 Nacos 控制台 “服务列表” 中就能看到注册信息：</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/11189/1544694815618-d316c463-701a-4095-a7d4-30bb0ec941b6.png" alt="image-20181213174408269-4694248.png | left | 747x132" class="img_ev3q"></p><p>如果您对 Dubbo 与 Nacos 整合敢兴趣，不妨访问项目主页了解更多详情，地址为：</p><ul><li>Dubbo Nacos Registry：<a href="https://github.com/dubbo/dubbo-registry-nacos" target="_blank" rel="noopener noreferrer">https://github.com/dubbo/dubbo-registry-nacos</a></li><li>Apache Dubbo：<a href="https://github.com/apache/incubator-dubbo" target="_blank" rel="noopener noreferrer">https://github.com/apache/incubator-dubbo</a></li></ul><p>如果您在使用的过程中遇到了任何问题和有任何建言，请将在 <a href="https://github.com/dubbo/dubbo-registry-nacos/issues" target="_blank" rel="noopener noreferrer">https://github.com/dubbo/dubbo-registry-nacos/issues</a> 中进行讨论。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="容器大行其道nacos-支持-docker-容器化">容器大行其道，Nacos 支持 Docker 容器化<a href="#容器大行其道nacos-支持-docker-容器化" class="hash-link" aria-label="容器大行其道，Nacos 支持 Docker 容器化的直接链接" title="容器大行其道，Nacos 支持 Docker 容器化的直接链接">​</a></h2><p>在容器大行其道的今天，支持容器化已经成为必然，Docker作为容器化大多数人的选择，Nacos 在v0.6 版本宣布
支持Docker化部署，并且提供出官方镜像，并且会在预计在下几个版本中支持k8s部署。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/11189/1544696801216-88a41d17-d101-4546-acfd-0aba38c6fa81.png" alt="image.png | left | 747x285" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="如何通过docker部署">如何通过Docker部署<a href="#如何通过docker部署" class="hash-link" aria-label="如何通过Docker部署的直接链接" title="如何通过Docker部署的直接链接">​</a></h3><p>本地需要确定已经按照了Docker，如果没有安装，请参考 <a href="https://docs.docker.com/install/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/install/</a>。安装之后这时就可以快速的从远程拉去镜像，拽起一个单机版本的Nacos，体验一下。
简单粗暴，运行以下命令：</p><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run --name nacos-standalone -e MODE=standalone -p 8848:8848 nacos/nacos-server:latest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>操作试例如下：</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/gif/11189/1544701054438-de9785c4-b9ab-46dc-a162-d22e1419a172.gif" alt="Peek 2018-12-13 11-43.gif | left | 747x407" class="img_ev3q"></p><p>另一种应用方式，<a href="https://docs.docker.com/compose/" target="_blank" rel="noopener noreferrer">docker-compose</a>编排方式，可以参照以下命令：</p><ol><li>git clone 项目 并且进入项目根目录</li></ol><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/nacos-group/nacos-docker.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd nacos-docker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>启动</li></ol><ul><li>单机启动</li></ul><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose -f example/standalone.yaml up</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>集群启动</li></ul><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose -f example/cluster-hostname.yaml up </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这时你的Nacos就已经启动起来，你就可以访问<a href="http://localhost:8848/nacos/index.html" target="_blank" rel="noopener noreferrer">http://localhost:8848/nacos/index.html</a>体验Nacos的功能了。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="配置管理功能体验">配置管理功能体验<a href="#配置管理功能体验" class="hash-link" aria-label="配置管理功能体验的直接链接" title="配置管理功能体验的直接链接">​</a></h4><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/gif/11189/1544496461571-69f38431-6452-4ddd-8211-c2da28f2ebcf.gif" alt="Peek 2018-12-11 10-11.gif | left | 747x351" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="服务发现功能体验">服务发现功能体验<a href="#服务发现功能体验" class="hash-link" aria-label="服务发现功能体验的直接链接" title="服务发现功能体验的直接链接">​</a></h4><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/gif/11189/1544521437636-674de542-1873-426b-a2dd-da8265bc267f.gif" alt="Peek 2018-12-11 11-11.gif | left | 747x351" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="蓬勃发展的-nacos-社区">蓬勃发展的 Nacos 社区<a href="#蓬勃发展的-nacos-社区" class="hash-link" aria-label="蓬勃发展的 Nacos 社区的直接链接" title="蓬勃发展的 Nacos 社区的直接链接">​</a></h2><blockquote><p>DISS is cheap, show me your hand
比吐槽更重要的是搭把手，参与社区一起发展Nacos</p></blockquote><ul><li>作为用户关注和加入 Nacos 社区</li></ul><p>Nacos 社区正在蓬勃发展，截止到发文为止，Nacos 短短几个月已经有5个微信群，其中4个已满员，1个QQ群，1个钉钉群，关注 Nacos 的社区人数已经近3000人，在 Nacos 群里跟 “道（基）友” 切磋技术，交流经验，招聘交友，抢抢红包...不亦乐乎。</p><p>要加入 Nacos 微信社区，你可以通过扫下面的<strong>“超哥”</strong>的微信二维码，让<strong>“超哥”</strong> 帮你拉入 “Nacos社区微信交流群”</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077965587-8f4e3100-bdd4-469a-9ea0-7af7061bc9ef.png" alt="Screen Shot 2018-06-27 at 13.39.09.png | left" class="img_ev3q"></p><ul><li>作为代码贡献者加入 Nacos 社区</li></ul><p>从Nacos用户发展而成贡献者顺理成章，而Nacos开发团队也确实在日趋壮大，从开始的只有4个代码contributor发展到目前的24个，随着<strong>阿里巴巴</strong>其他团队成员如 <strong>@小马哥</strong> 等人，<strong>虎牙直播</strong>的 <strong>@张波</strong> <strong>@周健</strong> 团队等人，<a href="https://github.com/nacos-group/nacos-docker" target="_blank" rel="noopener noreferrer">nacos-docker-k8s</a> 贡献者 <strong>@张龙</strong>，前端的主要贡献者饿了么 <strong>@王彦民</strong>，Spring Cloud中文社区创立者 <strong>@许进</strong> 等的陆续加入，相信未来Nacos社区的力量未来会越来越强大。</p><p>而社区也正在计划在合适的时机上，将在Nacos官网 <a href="http://nacos.io" target="_blank" rel="noopener noreferrer">nacos.io</a> 中添加团队介绍页，将大家正式公布于众，欢迎大家加入Nacos社区，贡献社区。用Apache的话说，<strong>“社区高于代码”!</strong></p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1542704700864-a9d54856-9bf6-4176-b449-c13fa02c5800.png" alt="屏幕快照 2018-11-20 17.04.45.png | left" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="新人时刻---什么是nacos">新人时刻 - &quot;什么是Nacos？&quot;<a href="#新人时刻---什么是nacos" class="hash-link" aria-label="新人时刻 - &quot;什么是Nacos？&quot;的直接链接" title="新人时刻 - &quot;什么是Nacos？&quot;的直接链接">​</a></h2><blockquote><p>还不知道什么是Nacos? 没关系，在github上star一下跟程序猿兄弟打个招呼吧!!</p></blockquote><p><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a> 是阿里巴巴于7月份新开源的项目，Nacos的主要愿景是期望通过提供易用的 <code>动态服务发现</code>、<code>服务配置管理</code>、<code>服务共享与管理</code> 的基础设施，帮助用户在云原生时代更好的构建、交付、管理自己的微服务平台。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1532436633419-08a42307-7fb7-4d51-9062-fecc3868613b.png" alt="Screen Shot 2018-07-24 at 19.27.28.png | left" class="img_ev3q"></p><p>github项目地址在 <a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">这里</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="更多与-nacos-相关的开源项目信息">更多与 Nacos 相关的开源项目信息<a href="#更多与-nacos-相关的开源项目信息" class="hash-link" aria-label="更多与 Nacos 相关的开源项目信息的直接链接" title="更多与 Nacos 相关的开源项目信息的直接链接">​</a></h2><ul><li><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a></li><li><a href="https://github.com/dubbo/dubbo-registry-nacos" target="_blank" rel="noopener noreferrer">Dubbo Registry Nacos</a></li><li><a href="https://github.com/nacos-group/nacos-coredns-plugin" target="_blank" rel="noopener noreferrer">Nacos DNS-F</a></li><li><a href="https://github.com/nacos-group/nacos-docker" target="_blank" rel="noopener noreferrer">Nacos Docker</a></li><li><a href="https://github.com/nacos-group/nacos-spring-project" target="_blank" rel="noopener noreferrer">Nacos Spring Project</a></li><li><a href="https://github.com/nacos-group/nacos-spring-boot-project" target="_blank" rel="noopener noreferrer">Nacos Spring Boot</a></li><li><a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba</a></li><li><a href="http://dubbo.io" target="_blank" rel="noopener noreferrer">Dubbo</a></li><li><a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">Sentinel</a></li><li><a href="https://projects.spring.io/spring-cloud/" target="_blank" rel="noopener noreferrer">Spring Cloud</a></li><li><a href="https://github.com/Nepxion/Discovery" target="_blank" rel="noopener noreferrer">Nepxion Discovery</a></li><li><a href="https://github.com/SpringCloud/spring-cloud-gateway-nacos" target="_blank" rel="noopener noreferrer">Spring Cloud Gateway Nacos</a></li></ul></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Nacos 0.8.0版本进行发布"><meta itemprop="keywords" content="nacos0.8,nacos0.8.0,nacos 发布"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-cn/blog/nacos0.8">Nacos 0.8.0版本进行发布</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T11:47:41.000Z" itemprop="datePublished">2023年10月10日</time> · <!-- -->阅读需 8 分钟</div></header><div class="markdown" itemprop="articleBody"><p>阿里巴巴微服务开源项目?<a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Dubbo Nacos</a>? 于本周发布?<strong>v0.8.0</strong>?<strong>PRE-GA</strong>版本，终于初步完成了Road Map一个重要的里程碑版本（第一个可安全上生产的版本，特别感谢在前期勇于在生产上尝试Nacos的客户，社区会尽快寄出小礼品，表达对大家的感激之情），V0.8.0 版本主要在支持了登录、命名空间、Metrics监控（对接Prometheus）、通过Nacos-Sync 组件支持从传统的注册中心平滑的往Nacos服务数据迁移等特性，以更稳定和更高可用的姿态让用户在生产环境中支撑大家的微服务平台。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-登录">Nacos 登录<a href="#nacos-登录" class="hash-link" aria-label="Nacos 登录的直接链接" title="Nacos 登录的直接链接">​</a></h3><p>Nacos控制台支持登录、登出特性，以便更安全的上生产使用。<br><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2019/png/9687/1548047848570-c92c232f-13eb-41e3-a8af-0660e3a58912.png#align=left&amp;display=inline&amp;height=894&amp;linkTarget=_blank&amp;name=image.png&amp;originHeight=1430&amp;originWidth=2876&amp;size=195009&amp;width=1797" alt="image.png" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="命名空间">命名空间<a href="#命名空间" class="hash-link" aria-label="命名空间的直接链接" title="命名空间的直接链接">​</a></h3><p>Nacos自0.5.0版本支持命名空间以来，配置服务先支持了命名空间，服务发现模块则在这个0.8.0版本支持了多命名空间，使用服务发现的命名空间可以实现服务数据的逻辑隔离。使用服务发现模块的多命名空间与配置模块基本相同，在Nacos控制台上查看想要使用的命名空间ID，在客户构造时传入该命名空间ID：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Properties properties = new Properties();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">properties.put(PropertyKeyConst.NAMESPACE, &quot;74a3dbb9-36cb-43f5-8d31-006acfd61caa&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">properties.put(PropertyKeyConst.SERVER_ADDR, &quot;127.0.0.1:8848&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NamingService naming = NamingFactory.createNamingService(properties);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样通过这个NamingService实例读写的就都是命名空间74a3dbb9-36cb-43f5-8d31-006acfd61caa下的数据了。当然您也可以不指定命名空间ID，这样将会默认分配到public命名空间。发布完服务可以到Nacos控制台上查询服务信息：<br><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2019/png/9687/1548312345294-d4bd95df-7e6d-4a36-8827-6a7ac0a00985.png#align=left&amp;display=inline&amp;height=553&amp;linkTarget=_blank&amp;name=image.png&amp;originHeight=830&amp;originWidth=1904&amp;size=131287&amp;width=1269" alt="image.png" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="metrics监控">Metrics监控<a href="#metrics监控" class="hash-link" aria-label="Metrics监控的直接链接" title="Metrics监控的直接链接">​</a></h3><p>通过Metrics信息暴露，对接Prometheus加强Nacos实时监控，以便让用户对产品更有控制力。</p><p>Nacos 通过micrometer统计了运行时的核心指标：</p><ul><li>系统指标包括cpu load jvm等</li><li>业务指标包括配置数，域名数，长连接，QPS，RT等</li><li>异常指标记录了Nacos运行的内部异常micrometer提供了转化器能转化成多种metrics格式，Nacos目前支持常用的prometheus、elastic search和influxdb，后续可以根据具体情况进行调整。</li></ul><br><br>grafana具备强大的的数据可视化能力，能将采集的数据展示出来，支持多种数据源。同时可对重要指标配置告警规则，数据达到阈值时可以通知相关负责人。<br>Nacos官网提供了结合prometheus和grafana实现metrics监控<br><br><br>![](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/53357/1548122164953-6011a9ee-a521-447c-a871-7ebcf10c2ce4.png#align=left&amp;display=inline&amp;height=417&amp;linkTarget=_blank&amp;originHeight=1584&amp;originWidth=2832&amp;size=0&amp;width=746)<p>具体的详情可以参考官网<a href="https://nacos.io/zh-cn/docs/monitor-guide.html" target="_blank" rel="noopener noreferrer">监控文档</a>。</p><h3></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-sync-支持服务平滑迁移">Nacos-Sync 支持服务平滑迁移<a href="#nacos-sync-支持服务平滑迁移" class="hash-link" aria-label="Nacos-Sync 支持服务平滑迁移的直接链接" title="Nacos-Sync 支持服务平滑迁移的直接链接">​</a></h3><p>提供Nacos-Sync同步工具支持用户做服务数据的平滑迁移迁移，支持用户从其他注册中心平滑迁移到Nacos上来，同时支持多个Region独立Nacos服务同步，目前Nacos-Sync支持的源注册中心主要包括ZooKeeper,Eureka等。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="使用场景">使用场景<a href="#使用场景" class="hash-link" aria-label="使用场景的直接链接" title="使用场景的直接链接">​</a></h4><ul><li>双向同步功能,支持Dubbo+Zookeeper服务平滑迁移到Dubbo+Nacos,享受Nacos更加优质的服务</li></ul><p><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2019/png/4232/1548136490076-13655b30-b0e4-4363-95dc-72b79a080fc0.png#align=left&amp;display=inline&amp;height=246&amp;linkTarget=_blank&amp;name=image.png&amp;originHeight=838&amp;originWidth=1728&amp;size=171454&amp;width=508" alt="image.png" class="img_ev3q"></p><ul><li>多个网络互通的Region之间服务共享,打破Region之间的服务调用限制</li></ul><p><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2019/png/4232/1548136895122-ba2be529-d959-4c9d-9fa4-74059bce1d18.png#align=left&amp;display=inline&amp;height=399&amp;linkTarget=_blank&amp;name=image.png&amp;originHeight=798&amp;originWidth=1136&amp;size=64731&amp;width=568" alt="image.png" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="支持的范围">支持的范围<a href="#支持的范围" class="hash-link" aria-label="支持的范围的直接链接" title="支持的范围的直接链接">​</a></h4><p>Nacos-Sync支持用户扩展不同注册中心服务同步，目前已支持的同步类型如下:</p><ul><li>Nacos数据同步到Nacos</li><li>Zookeeper数据同步到Nacos</li><li>Nacos数据同步到Zookeeper</li><li>Eureka数据同步到Nacos</li><li>Consul数据同步到Nacos</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="配置同步服务">配置同步服务<a href="#配置同步服务" class="hash-link" aria-label="配置同步服务的直接链接" title="配置同步服务的直接链接">​</a></h4><p>Nacos-Sync提供了控制台方便你配置同步的服务数据:</p><ul><li>同步任务管理页面</li></ul><p><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2019/png/4232/1548129423366-e1a37af4-3eb6-48f0-af76-84ec1f310ee2.png#align=left&amp;display=inline&amp;height=277&amp;linkTarget=_blank&amp;originHeight=1064&amp;originWidth=2866&amp;width=746" class="img_ev3q"></p><ul><li>注册中心管理页面</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="imagepng"><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2019/png/4232/1548129453620-f480a696-931b-4db4-b4c7-298ae7da029e.png#align=left&amp;display=inline&amp;height=562&amp;linkTarget=_blank&amp;name=image.png&amp;originHeight=1124&amp;originWidth=2876&amp;size=190668&amp;width=1438" alt="image.png" class="img_ev3q"><a href="#imagepng" class="hash-link" aria-label="imagepng的直接链接" title="imagepng的直接链接">​</a></h2><p>具体项目信息请参考<a href="https://github.com/nacos-group/nacos-sync" target="_blank" rel="noopener noreferrer">Nacos-Sync产品页</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="蓬勃发展的-nacos-社区">蓬勃发展的 Nacos 社区<a href="#蓬勃发展的-nacos-社区" class="hash-link" aria-label="蓬勃发展的 Nacos 社区的直接链接" title="蓬勃发展的 Nacos 社区的直接链接">​</a></h2><blockquote><p>DISS is cheap, show me your hand
比吐槽更重要的是搭把手，参与社区一起发展Nacos</p></blockquote><ul><li>作为用户关注和加入 Nacos 社区</li></ul><p>Nacos 社区正在蓬勃发展，截止到发文为止，Nacos 短短几个月已经有 9 个微信群，其中 7 个已满员，1个QQ群，1个钉钉群，关注 Nacos 的社区人数已经近5000人，在 Nacos 群里跟 “道（基）友” 切磋技术，交流经验，招聘交友，抢抢红包...不亦乐乎。</p><p>要加入 Nacos 微信社区，你可以通过扫下面的<strong>“超哥”</strong>“超哥”** 帮你拉入 “Nacos社区微信交流群”</p><p><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2019/png/9687/1548047927520-89c34af8-899a-41b6-887c-9319461db519.png#align=left&amp;display=inline&amp;height=424&amp;linkTarget=_blank&amp;originHeight=1124&amp;originWidth=1984&amp;size=0&amp;width=748" class="img_ev3q"></p><ul><li>作为代码贡献者加入 Nacos 社区</li></ul><p>从Nacos用户发展而成贡献者顺理成章，而Nacos开发团队也确实在日趋壮大，从开始的只有4个代码contributor发展到目前的34个，在0.8.0 版本的开发中，社区同学贡献了很大的力量，在此特别感谢戚月同学设计登录UI，黄清昊同学贡献登录代码，王彦民同学贡献命名空间代码，张龙同学贡献nacos-sync代码，李晨同学贡献配置管理代码，明亦同学保证这个关键版本的测试质量，相信后续有跟多同学参与到Nacos社区的共建中。</p><p>而社区也正在计划在合适的时机上，将在Nacos官网 <a href="http://nacos.io/" target="_blank" rel="noopener noreferrer">nacos.io</a> 中添加团队介绍页，将大家正式公布于众，欢迎大家加入Nacos社区，贡献社区。用Apache的话说，<strong>“社区高于代码”!</strong></p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1542704700864-a9d54856-9bf6-4176-b449-c13fa02c5800.png#align=left&amp;display=inline&amp;height=387&amp;linkTarget=_blank&amp;originHeight=888&amp;originWidth=1716&amp;width=748" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="新人时刻---什么是nacos"><a href="https://yuque.alibaba-inc.com/nacos/opensource/dawygn#6gw6hq" target="_blank" rel="noopener noreferrer"></a>新人时刻 - &quot;什么是Nacos？&quot;<a href="#新人时刻---什么是nacos" class="hash-link" aria-label="新人时刻---什么是nacos的直接链接" title="新人时刻---什么是nacos的直接链接">​</a></h2><blockquote><p>还不知道什么是Nacos? 没关系，在github上star一下跟程序猿兄弟打个招呼吧!!</p></blockquote><p><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a> 是阿里巴巴于7月份新开源的项目，Nacos的主要愿景是期望通过提供易用的 <code>动态服务发现</code>、<code>服务配置管理</code>、<code>服务共享与管理</code> 的基础设施，帮助用户在云原生时代更好的构建、交付、管理自己的微服务平台。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1532436633419-08a42307-7fb7-4d51-9062-fecc3868613b.png#align=left&amp;display=inline&amp;height=355&amp;linkTarget=_blank&amp;originHeight=1014&amp;originWidth=2138&amp;width=748" class="img_ev3q"></p><p>github项目地址在 <a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">这里</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="更多与-nacos-相关的开源项目信息"><a href="https://yuque.alibaba-inc.com/nacos/opensource/dawygn#kn9iog" target="_blank" rel="noopener noreferrer"></a>更多与 Nacos 相关的开源项目信息<a href="#更多与-nacos-相关的开源项目信息" class="hash-link" aria-label="更多与-nacos-相关的开源项目信息的直接链接" title="更多与-nacos-相关的开源项目信息的直接链接">​</a></h2><ul><li><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a></li><li><a href="https://github.com/dubbo/dubbo-registry-nacos" target="_blank" rel="noopener noreferrer">Dubbo Registry Nacos</a></li><li><a href="https://github.com/nacos-group/nacos-coredns-plugin" target="_blank" rel="noopener noreferrer">Nacos DNS-F</a></li><li><a href="https://github.com/nacos-group/nacos-docker" target="_blank" rel="noopener noreferrer">Nacos Docker</a></li><li><a href="https://github.com/nacos-group/nacos-spring-project" target="_blank" rel="noopener noreferrer">Nacos Spring Project</a></li><li><a href="https://github.com/nacos-group/nacos-spring-boot-project" target="_blank" rel="noopener noreferrer">Nacos Spring Boot</a></li><li><a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba</a></li><li><a href="http://dubbo.io/" target="_blank" rel="noopener noreferrer">Dubbo</a></li><li><a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">Sentinel</a></li><li><a href="https://projects.spring.io/spring-cloud/" target="_blank" rel="noopener noreferrer">Spring Cloud</a></li><li><a href="https://github.com/Nepxion/Discovery" target="_blank" rel="noopener noreferrer">Nepxion Discovery</a></li><li><a href="https://github.com/SpringCloud/spring-cloud-gateway-nacos" target="_blank" rel="noopener noreferrer">Spring Cloud Gateway Nacos</a></li></ul></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Nacos 0.9.0版本进行发布"><meta itemprop="keywords" content="nacos0.9,nacos0.9.0,nacos 发布"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-cn/blog/nacos0.9-intro">Nacos 0.9.0版本进行发布</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T11:47:41.000Z" itemprop="datePublished">2023年10月10日</time> · <!-- -->阅读需 1 分钟</div></header><div class="markdown" itemprop="articleBody"><p>Nacos 发布 0.9.0 版本，该版本加强了 Nacos-Sync 稳定性，增加了监控体系，完善了测试用例，并且支持 Naming 和 Config 的分模块启动，此外还修复了社区提出的一些 issues：</p><ul><li>[#412]<!-- --> Nacos can support Dubbo service registration discovery and configuration management</li><li>[#388]<!-- --> Cluster name should be provided in the Instance</li><li>[#377]<!-- --> Clean up messy code in Naming module</li><li>[#369]<!-- --> Support instance list persisted on disk</li><li>[#366]<!-- --> Findbugs-maven-plugin version</li><li>[#362]<!-- --> The metadata will lost when online or offline instance through web ui</li><li>[#352]<!-- --> Refactoring internationalization Nacos console</li><li>[#278]<!-- --> Nacos docker img</li><li>[#243]<!-- --> Optimize the efficiency of integration testing, it’s taking too long now</li></ul><p>感谢以下 Contributors 对 Nacos 0.9.0版本的贡献，他们是：</p><p>@paderlol、@jifengnan、@loadchange、@nkorange、@hxy1991、@huangyunbin、@darkness463、@luoxn28、@TsingLiang、@xuechaos、@nanamikon、@systp、@jameslcj、@pader.zhang</p><p>详情参考：<a href="https://github.com/alibaba/nacos/releases/tag/0.9.0" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos/releases/tag/0.9.0</a></p><p>Nacos team 介绍 ：<a href="https://nacos.io/en-us/docs/nacos-dev.html" target="_blank" rel="noopener noreferrer">https://nacos.io/en-us/docs/nacos-dev.html</a> （持续扩展中，欢迎加入）</p><p>如何加入 Nacos team：<a href="https://nacos.io/en-us/docs/contributing-dev.html" target="_blank" rel="noopener noreferrer">https://nacos.io/en-us/docs/contributing-dev.html</a></p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Nacos 0.9.0版本进行发布"><meta itemprop="keywords" content="nacos0.9，nacos0.9.0，nacos"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-cn/blog/nacos0.9.0">Nacos 0.9.0版本进行发布</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T11:47:41.000Z" itemprop="datePublished">2023年10月10日</time> · <!-- -->阅读需 10 分钟</div></header><div class="markdown" itemprop="articleBody"><p>天下武功，唯快不破，Nacos一直秉承着稳定性和快速迭代，Nacos 0.9.0版本于上周正式发布release，功能围绕着，Nacos-Sync的稳定性、Server功能拆分部署、Nacos python语言体系的支持，并且在此基础之上，Nacos首次发布核心团队人员，并在持续招募中。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-sync稳定性提升">Nacos-Sync稳定性提升<a href="#nacos-sync稳定性提升" class="hash-link" aria-label="Nacos-Sync稳定性提升的直接链接" title="Nacos-Sync稳定性提升的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-sync简介">Nacos-Sync简介<a href="#nacos-sync简介" class="hash-link" aria-label="Nacos-Sync简介的直接链接" title="Nacos-Sync简介的直接链接">​</a></h3><p><a href="https://github.com/nacos-group/nacos-sync" target="_blank" rel="noopener noreferrer">Nacos-Sync</a>是Nacos的核心组件，作用是多注册中心数据同步的功能工具，目前支持的同步注册中心包括 Nacos、Zookeeper、Eureka和Consul，主要场景，包括多注册中心数据互相同步，注册中心升级过程的数据迁移，官网提供<a href="https://nacos.io/en-us/docs/nacos-sync-use.html" target="_blank" rel="noopener noreferrer">迁移操作手册</a>。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="090-增强稳定性">0.9.0 增强稳定性<a href="#090-增强稳定性" class="hash-link" aria-label="0.9.0 增强稳定性的直接链接" title="0.9.0 增强稳定性的直接链接">​</a></h3><p>Nacos 0.9的主线功能加强<a href="https://nacos.io/en-us/docs/nacos-sync.html" target="_blank" rel="noopener noreferrer">Nacos-Sync</a>的稳定性，一方面增强Nacos-Sync的基础测试用例覆盖面，保证Nacos-Sync以后的快速迭代过程中主线功能稳定性，另一方面通过监控体系的完善，对接了Prometheus通过metrics暴露数据，并且天然集成grafana监控，保证了Nacos-Sync生产级别稳定性。
随着Nacos 0.9.0版本发布，Nacos-Sync 0.3版本支持了metrics监控，能通过metrics数据观察Nacos-Sync服务的运行状态，提升了Nacos-Sync的在生产环境的监控能力。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用prometheus采集nacos-sync-metrics数据">使用Prometheus采集Nacos-Sync metrics数据<a href="#使用prometheus采集nacos-sync-metrics数据" class="hash-link" aria-label="使用Prometheus采集Nacos-Sync metrics数据的直接链接" title="使用Prometheus采集Nacos-Sync metrics数据的直接链接">​</a></h3><p>继 Kubernetes 之后，Prometheus成为第二个正式从 CNCF 毕业的开源项目。Nacos及Nacos-Sync支持Prometheus metrics也是Nacos拥抱云原生的第一步。Prometheus作为新一代的云原生监控系统，除了能对Kubernetes容器集群进行监控之外，也能对容器中的应用进行监控。不过Prometheus的数据展示能力比较差，一般会借助第三方数据监控平台。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="grafana监控nacos-sync">grafana监控Nacos-Sync<a href="#grafana监控nacos-sync" class="hash-link" aria-label="grafana监控Nacos-Sync的直接链接" title="grafana监控Nacos-Sync的直接链接">​</a></h3><p>Grafana是一款强大的数据可视化开源软件，能通过非常漂亮的图表和曲线展示监控数据，支持多种数据源，包括Prometheus。</p><p>和Nacos监控一样，官网给Nacos-Sync也提供了监控模版，简单的几步就可以很方便地在Grafana上监控Nacos-Sync</p><p>Nacos-Sync监控同样也分为三个模块:</p><ul><li>nacos-sync monitor展示核心监控项
<img loading="lazy" src="https://img.alicdn.com/tfs/TB1GeNWKmzqK1RjSZFHXXb3CpXa-2834-1588.png" alt="monitor" class="img_ev3q"></li><li>nacos-sync detail和alert两个模块的展示监控曲线和告警
<img loading="lazy" src="https://img.alicdn.com/tfs/TB1kP8UKbvpK1RjSZPiXXbmwXXa-2834-1570.png" alt="detail" class="img_ev3q"></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-server功能拆分部署">Nacos Server功能拆分部署<a href="#nacos-server功能拆分部署" class="hash-link" aria-label="Nacos Server功能拆分部署的直接链接" title="Nacos Server功能拆分部署的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="为什么要拆分部署">为什么要拆分部署<a href="#为什么要拆分部署" class="hash-link" aria-label="为什么要拆分部署的直接链接" title="为什么要拆分部署的直接链接">​</a></h3><p>一般公司随着业务规模的不断膨胀，我们建议业务对注册中心和配置中心进行拆分部署，在Nacos 0.9.0版本以后，支持注册中心模块和配置中心模块的拆分部署，在启动命令进行加入参数，来指定启动指定Nacos 功能模块，默认全部功能启用，目前支持指定配置中心模块和注册中心模块。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用方法">使用方法<a href="#使用方法" class="hash-link" aria-label="使用方法的直接链接" title="使用方法的直接链接">​</a></h3><p>启动Nacos server时候，增加<code>-f</code>参数，意思是function mode，和对应模块标示来进行启动，如果不传，或者传入有误，都将启动全部功能。
配置中心参数对应<code>config</code>，注册中心参数对应<code>naming</code>。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="启动命令">启动命令<a href="#启动命令" class="hash-link" aria-label="启动命令的直接链接" title="启动命令的直接链接">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sh startup.sh -m standalone -f naming</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>启动之后，你可以通过启动日志头看到是否正确启动了功能模块，并且Nacos console将只展现启动的对应模块。</p><ul><li>Nacos启动日志头信息
<img loading="lazy" src="https://img.alicdn.com/tfs/TB1ADCrKAvoK1RjSZFDXXXY3pXa-1552-522.jpg" class="img_ev3q"></li><li>单独启动配置中心的控制台示例
<img loading="lazy" src="https://img.alicdn.com/tfs/TB1sXyoKpzqK1RjSZFCXXbbxVXa-2674-940.png" class="img_ev3q"></li><li>单独启动注册中心的控制台示例
<img loading="lazy" src="https://img.alicdn.com/tfs/TB1yKyiKCzqK1RjSZFLXXcn2XXa-2680-738.png" class="img_ev3q"></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-python语言体系的支持">Nacos python语言体系的支持<a href="#nacos-python语言体系的支持" class="hash-link" aria-label="Nacos python语言体系的支持的直接链接" title="Nacos python语言体系的支持的直接链接">​</a></h2><p>Nacos开始支持python语言体系，兼容Nacos0.8.0版本，<a href="https://github.com/nacos-group/nacos-sdk-python" target="_blank" rel="noopener noreferrer">Nacos-sdk—Python</a>在github上的<a href="https://github.com/nacos-group" target="_blank" rel="noopener noreferrer">Nacos-Group</a>中,支持的Python版本包括 2.7、3.6和3.7，操作简单，一行命令安装，可以在仓库中看到详细的<a href="https://github.com/nacos-group/nacos-sdk-python/blob/master/README.md" target="_blank" rel="noopener noreferrer">使用说明</a>，感谢周文同学的贡献。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-团队页悄悄上线">Nacos 团队页悄悄上线<a href="#nacos-团队页悄悄上线" class="hash-link" aria-label="Nacos 团队页悄悄上线的直接链接" title="Nacos 团队页悄悄上线的直接链接">​</a></h2><p>在Nacos 0.9.0的版本中，Nacos官网 <a href="http://nacos.io/" target="_blank" rel="noopener noreferrer">nacos.io</a>上线了Nacos社区的核心Committer团队首次和大家见面，<a href="https://nacos.io/en-us/docs/nacos-dev.html" target="_blank" rel="noopener noreferrer">Nacos 核心团队页</a>，并且社区团队在持续扩大中，<a href="https://nacos.io/en-us/docs/contributing-dev.html" target="_blank" rel="noopener noreferrer">Nacos的社区有着自己的社区共建规范</a>，并且在吸收新人上，不仅仅是需要开发者，还需要测试大牛、文档贡献者和社区管理者。我们鼓励大家积极参与Nacos社区，社区有一套机制可以使您，从用户角色到提交者角色，甚至是PMC角色。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="如何共建">如何共建<a href="#如何共建" class="hash-link" aria-label="如何共建的直接链接" title="如何共建的直接链接">​</a></h3><p>为了实现这一目标，你需要积极参与Nacos社区。如果您在文档中发现拼写错误，在代码中发现错误，或想要新功能或想要提供建议，您可以<a href="https://github.com/alibaba/Nacos/issues/new" target="_blank" rel="noopener noreferrer">在GitHub上创建一个issues</a>。</p><p>如果您想开始着手，可以选择github仓库中有以下标签的issues。</p><ul><li><a href="https://github.com/alibaba/nacos/labels/good%20first%20issue" target="_blank" rel="noopener noreferrer">good first issue</a>：对于新手来说是非常好的入门issues。</li><li><a href="https://github.com/alibaba/nacos/labels/contribution%20%E6%AC%A2%E8%BF%8E" target="_blank" rel="noopener noreferrer">contribution welcome</a>：非常需要解决的问题和非常重要的模块，但目前缺少贡献者，欢迎贡献者来贡献。</li></ul><p>除了以上的通用标签，还可以关注Nacos目前重点关注的多语言共建招募，<a href="https://github.com/alibaba/nacos/issues?utf8=%E2%9C%93&amp;q=is%3Aissue+is%3Aopen+recruit+client" target="_blank" rel="noopener noreferrer">C++、PHP的多语言核心贡献者招募</a>，和并且还有<a href="https://github.com/alibaba/nacos/issues/787" target="_blank" rel="noopener noreferrer">社区群组负责人招募</a>，欢迎大家加入Nacos社区，贡献社区。用Apache的话说，<strong>“社区高于代码”!</strong>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="蓬勃发展的-nacos-社区">蓬勃发展的 Nacos 社区<a href="#蓬勃发展的-nacos-社区" class="hash-link" aria-label="蓬勃发展的 Nacos 社区的直接链接" title="蓬勃发展的 Nacos 社区的直接链接">​</a></h2><blockquote><p>DISS is cheap, show me your hand
比吐槽更重要的是搭把手，参与社区一起发展Nacos</p></blockquote><ul><li>作为用户关注和加入 Nacos 社区</li></ul><p>Nacos 社区正在蓬勃发展，截止到发文为止，Nacos 短短几个月已经有 9 个微信群，其中 7 个已满员，1个QQ群，1个钉钉群，关注 Nacos 的社区人数已经近5000人，在 Nacos 群里跟 “道（基）友” 切磋技术，交流经验，招聘交友，抢抢红包...不亦乐乎。</p><p>要加入 Nacos 微信社区，你可以通过扫下面的<strong>“超哥”</strong>“超哥”** 帮你拉入 “Nacos社区微信交流群”</p><p><img loading="lazy" src="https://img.alicdn.com/tfs/TB1q6SBKq6qK1RjSZFmXXX0PFXa-1984-1124.png" class="img_ev3q"></p><ul><li>作为代码贡献者加入 Nacos 社区</li></ul><p>从Nacos用户发展而成贡献者顺理成章，而Nacos开发团队也确实在日趋壮大，从开始的只有4个代码contributor发展到目前的39个，在0.9.0 版本的开发中，社区同学贡献了很大的力量，在此特别感谢，他们的githubId是（注：不分先后） paderlol、jifengnan、loadchange、nkorange、hxy1991、huangyunbin、darkness463、luoxn28、TsingLiang、xuechaos、nanamikon、systp、jameslcj、pader.zhang，相信后续有跟多同学参与到Nacos社区的共建中。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1542704700864-a9d54856-9bf6-4176-b449-c13fa02c5800.png#align=left&amp;display=inline&amp;height=387&amp;linkTarget=_blank&amp;originHeight=888&amp;originWidth=1716&amp;width=748" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="新人时刻---什么是nacos"><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer"></a>新人时刻 - &quot;什么是Nacos？&quot;<a href="#新人时刻---什么是nacos" class="hash-link" aria-label="新人时刻---什么是nacos的直接链接" title="新人时刻---什么是nacos的直接链接">​</a></h2><blockquote><p>还不知道什么是Nacos? 没关系，在github上star一下跟程序猿兄弟打个招呼吧!!</p></blockquote><p><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a> 是阿里巴巴于7月份新开源的项目，Nacos的主要愿景是期望通过提供易用的 <code>动态服务发现</code>、<code>服务配置管理</code>、<code>服务共享与管理</code> 的基础设施，帮助用户在云原生时代更好的构建、交付、管理自己的微服务平台。</p><p><img loading="lazy" src="https://img.alicdn.com/tfs/TB1pCyAKpzqK1RjSZSgXXcpAVXa-1910-894.png" class="img_ev3q"></p><p>github项目地址在 <a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">这里</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="更多与-nacos-相关的开源项目信息"><a href="https://yuque.alibaba-inc.com/nacos/opensource/dawygn#kn9iog" target="_blank" rel="noopener noreferrer"></a>更多与 Nacos 相关的开源项目信息<a href="#更多与-nacos-相关的开源项目信息" class="hash-link" aria-label="更多与-nacos-相关的开源项目信息的直接链接" title="更多与-nacos-相关的开源项目信息的直接链接">​</a></h2><ul><li><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a></li><li><a href="https://github.com/dubbo/dubbo-registry-nacos" target="_blank" rel="noopener noreferrer">Dubbo Registry Nacos</a></li><li><a href="https://github.com/nacos-group/nacos-coredns-plugin" target="_blank" rel="noopener noreferrer">Nacos DNS-F</a></li><li><a href="https://github.com/nacos-group/nacos-docker" target="_blank" rel="noopener noreferrer">Nacos Docker</a></li><li><a href="https://github.com/nacos-group/nacos-spring-project" target="_blank" rel="noopener noreferrer">Nacos Spring Project</a></li><li><a href="https://github.com/nacos-group/nacos-spring-boot-project" target="_blank" rel="noopener noreferrer">Nacos Spring Boot</a></li><li><a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba</a></li><li><a href="http://dubbo.io/" target="_blank" rel="noopener noreferrer">Dubbo</a></li><li><a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">Sentinel</a></li><li><a href="https://projects.spring.io/spring-cloud/" target="_blank" rel="noopener noreferrer">Spring Cloud</a></li><li><a href="https://github.com/Nepxion/Discovery" target="_blank" rel="noopener noreferrer">Nepxion Discovery</a></li><li><a href="https://github.com/SpringCloud/spring-cloud-gateway-nacos" target="_blank" rel="noopener noreferrer">Spring Cloud Gateway Nacos</a></li></ul></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="经过 3 个 RC 版本的社区体验之后，Nacos 正式发布 1.0.0 GA 版本，在架构、功能和 API 设计上进行了全方位的重构和升级。"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-cn/blog/nacos1.0.0">Nacos 发布 1.0.0 版本，可大规模投入到生产环境中</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T11:47:41.000Z" itemprop="datePublished">2023年10月10日</time> · <!-- -->阅读需 14 分钟</div></header><div class="markdown" itemprop="articleBody"><p>经过 3 个 RC 版本的社区体验之后，Nacos 正式发布 1.0.0 GA 版本，在架构、功能和 API 设计上进行了全方位的重构和升级。</p><p>1.0.0 版本的发布标志着 Nacos 已经可以大规模地生产环境中使用，新版本不仅针对社区的需求和集群的稳定性相应地增加了一些新特性，而且还发布了服务发现模块的性能测试报告，以及完整的 API 列表和架构设计文档。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-演进历程">Nacos 演进历程<a href="#nacos-演进历程" class="hash-link" aria-label="Nacos 演进历程的直接链接" title="Nacos 演进历程的直接链接">​</a></h2><p>Nacos 自 2018 年 7 月份开源以来，有赖于社区的大力关注和参与，在不到一年的时间里，已经演进了 10+ 个版本。同时也有很多企业客户一直都使用 Nacos 作为生产环境的注册中心和配置中心。</p><p>Nacos 源于阿里巴巴内部近十年的生产环境打磨的核心中间件，在开源之前就支撑着双十一等大型业务场景。Nacos 开源不仅是为了丰富整个微服务生态，也是为了打造一款真正能够应对大规模、高并发和复杂环境下复杂需求的生产级服务注册中心和配置管理平台。在 1.0.0  GA 版本发布之际，在此回顾一下 Nacos 的演进历程：</p><ul><li><p>2018.07.20 - Nacos 0.1.0：支持基本的服务发现功能和配置管理功能。</p></li><li><p>2018.09.15 - Nacos 0.2.0：正式支持 SpringCloud 生态。</p></li><li><p>2018.10.26 - Nacos 0.3.0：提供控制台界面。</p></li><li><p>2018.11.19 - Nacos 0.5.0：开源 DNS-F，支持 DNS 协议服务发现。</p></li><li><p>2018.12.06 - Nacos 0.6.0：正式支持 Dubbo 客户端注册服务，支持 K8S 部署。</p></li><li><p>2018.12.18 - Nacos 0.7.0：支持 CMDB 元数据管理，支持 Node.js 客户端。</p></li><li><p>2019.01.22 - Nacos 0.8.0：PRE-GA 支持控制台账号登录，支持命名空间，Nacos-Sync 打通 Eureka 和 Zookeeper。</p></li><li><p>2019.04.10 - Nacos 1.0.0 GA ：同时支持 AP 和 CP 一致性，发布压测报告，稳定性加强和体验优化。</p></li></ul><h1><strong>Nacos 1.0.0 新增的特性</strong></h1><h3 class="anchor anchorWithStickyNavbar_LWe7" id="注册实例支持ephemeral字段">注册实例支持ephemeral字段<a href="#注册实例支持ephemeral字段" class="hash-link" aria-label="注册实例支持ephemeral字段的直接链接" title="注册实例支持ephemeral字段的直接链接">​</a></h3><p>Nacos 1.0.0 版本在 instance 级别上增加了一个ephemeral字段，该字段表示注册的实例是临时实例还是持久化实例。如果是临时实例，则不会在Nacos服务端持久化存储，需要通过上报心跳的方式进行保活，如果一段时间内没有上报心跳，则会被Nacos服务端摘除。在被摘除后如果又开始上报心跳，则会重新将这个实例注册。持久化实例则会持久化到Nacos服务端，此时即使注册实例的客户端进程不在，这个实例也不会从服务端删除，只会将健康状态设为不健康。</p><p><img loading="lazy" src="https://img.alicdn.com/tfs/TB1Yq_2RNjaK1RjSZFAXXbdLFXa-525-595.png" class="img_ev3q"></p><p>同一个服务下可以同时有临时实例和持久化实例，这意味着当这服务的所有实例进程不在时，会有部分实例从服务上摘除，剩下的实例则会保留在服务下。</p><p>由于老版本客户端注册实例时不会上传 ephemeral 字段，需要在 Nacos 服务端设置一个默认的 ephemeral 值。Nacos 1.0.0 里 ephemeral 的默认值为 true，即老版本客户端默认注册的是临时实例。如果需要让老客户端注册的实例类型是持久化实例，可以设置开关：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X PUT &#x27;$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=defaultInstanceEphemeral&amp;value=false&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意事项：当从老版本Nacos升级到Nacos 1.0.0时，从磁盘加载的实例数据会被置为持久化实例。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="注册实例支持-groupname-字段">注册实例支持 groupName 字段<a href="#注册实例支持-groupname-字段" class="hash-link" aria-label="注册实例支持 groupName 字段的直接链接" title="注册实例支持 groupName 字段的直接链接">​</a></h3><p>客户端注册实例时，可以在方法级别指定要注册的分组名，这个分组名和服务名是对服务的一个二维的标识，二者共同定位一个服务。一个典型的使用分组的例子如下：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namingService.registerInstance(&quot;nacos.test.1&quot;, &quot;group1&quot;, instance);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>不指定分组的接口依然是支持的，此时会在服务端为这个服务分配一个默认的分组：DEFAULT_GROUP。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="增加了server状态的设置">增加了Server状态的设置<a href="#增加了server状态的设置" class="hash-link" aria-label="增加了Server状态的设置的直接链接" title="增加了Server状态的设置的直接链接">​</a></h3><p>Nacos 增加了对 Server 状态的控制，所有的状态都定义在 com.alibaba.nacos.naming.cluster.ServerStatus</p><p>类里。</p><p><img loading="lazy" src="https://img.alicdn.com/tfs/TB13uYWRMHqK1RjSZJnXXbNLpXa-596-408.png" class="img_ev3q"></p><p>各个状态的含义介绍如下：</p><ul><li>UP：Server 一切正常，读写请求都会被接受；</li><li>DOWN：Server 异常，所有请求会返回 HTTP 503 错误；</li><li>STARTING：Server 还在启动中，所有请求返回 HTTP 503 错误；</li><li>PAUSED：Server 被人工暂停，区别于 DOWN 可能是系统自己检测到异常然后设置 DOWN 状态，PAUSED 状态表示当前 Server 可能是没问题的，只是人工进行了干预；</li><li>WRITE_ONLY：只有非 GET 请求会被接受；</li><li>READ_ONLY：只有 GET 请求会被接受；</li></ul><p>用户可以使用如下接口来修改集群所有机器的状态，如果再加上 debug=true 参数，则只修改当前机器的状态。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X PUT &#x27;$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=overriddenServerStatus&amp;value=READ_ONLY&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>同时这个状态是会自适应进行修改的，比如启动时这个状态为 STARTING，等到数据装载完毕，则会自动将状态置为 UP，在运行过程中，如果检测到系统异常如磁盘满，则又会将状态置为 DOWN。不过自适应的状态值优先级要低于使用接口设置的状态值，因此当你想恢复自适应的状态调节的时候，记得将接口 overriddenServerStatus 设置为空。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="增加全局推送开关">增加全局推送开关<a href="#增加全局推送开关" class="hash-link" aria-label="增加全局推送开关的直接链接" title="增加全局推送开关的直接链接">​</a></h3><p>支持了全局推送开关，可以打开或者关闭服务变更的推送，调用接口如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X PUT &#x27;$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=pushEnabled&amp;value=false&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>关闭推送后，客户端依然会通过轮询的方式来更新到数据，只是更新的速度没有推送那么快。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="支持启动时数据预热">支持启动时数据预热<a href="#支持启动时数据预热" class="hash-link" aria-label="支持启动时数据预热的直接链接" title="支持启动时数据预热的直接链接">​</a></h3><p>在老版本的 Nacos 中，只要 Server 启动成功就会开始对外提供服务，此时服务的数据并不一定完全加载完成，这样可能会导致客户端接收到的数据并不完整。1.0.0 版本增加了数据预热的逻辑，对于持久化数据，则会等待所有数据从磁盘加载完成；对于临时实例这样的非持久化数据，则会等待从其他Server拉取到完整数据。所有数据都准备好之后，才会将 Server 状态置为 UP。</p><p>注意事项：</p><p>对于临时实例的预热，实现机制是 Server 在启动时会从其他Server节点拉取数据，拉取成功则启动成功。但是当从老版本 Server 升级到 1.0.0 时，由于这个拉取全量数据的接口在老版本 Server 中不存在，那么第一个升级的机器将无法拉到任何数据，从而后面升级的机器也无法从第一个升级的机器拉取到数据。此时建议使用调用 API 将 Server 的运行状态设置为 WRITE_ONLY，允许客户端数据逐步汇聚补偿上来，但是要阻止任何查询的流量，直到集群数据准备好以后，再将这个运行状态清空，集群自动调整运行状态，最后就会提供完整服务。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="元数据编辑框优化">元数据编辑框优化<a href="#元数据编辑框优化" class="hash-link" aria-label="元数据编辑框优化的直接链接" title="元数据编辑框优化的直接链接">​</a></h3><p>此前的元数据编辑框需要用户按照指定格式来编辑，容易出错，如下图所示：</p><p><img loading="lazy" src="https://img.alicdn.com/tfs/TB1VgDQRNTpK1RjSZFMXXbG_VXa-602-392.png" class="img_ev3q"></p><p>1.0.0 版本对服务页面的元数据编辑框进行了优化，在调整编辑框大小的同时，增加语法高亮，方便用户进行编辑和识别格式问题，编辑框预览图如下：<img loading="lazy" src="https://img.alicdn.com/tfs/TB1nwL3RIfpK1RjSZFOXXa6nFXa-552-149.png" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="支持-mysql-80">支持 MySQL 8.0<a href="#支持-mysql-80" class="hash-link" aria-label="支持 MySQL 8.0的直接链接" title="支持 MySQL 8.0的直接链接">​</a></h3><p>Nacos 1.0.0 支持了 MySQL 8.0 驱动。您只需要将8.0版本的驱动jar包放置在{nacos.home}/plugins/mysql/下即可，不需要其他改动。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-100-实现大规模生产可用">Nacos 1.0.0 实现大规模生产可用<a href="#nacos-100-实现大规模生产可用" class="hash-link" aria-label="Nacos 1.0.0 实现大规模生产可用的直接链接" title="Nacos 1.0.0 实现大规模生产可用的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="api-完整列表开放模型和架构设计文档更新">API 完整列表开放，模型和架构设计文档更新<a href="#api-完整列表开放模型和架构设计文档更新" class="hash-link" aria-label="API 完整列表开放，模型和架构设计文档更新的直接链接" title="API 完整列表开放，模型和架构设计文档更新的直接链接">​</a></h3><p>服务发现和配置管理的完整 API 列表会发布到官网</p><p><em>地址：<a href="https://nacos.io/zh-cn/docs/open-API.html" target="_blank" rel="noopener noreferrer">https://nacos.io/zh-cn/docs/open-API.html</a></em></p><p>除了核心功能外，也包含部分运维接口，方便开发者进行集成。同时对于 Nacos 的数据模型、集群模型、架构设计及模块设计文档进行了更新</p><p><em>地址：<a href="https://nacos.io/zh-cn/docs/architecture.html" target="_blank" rel="noopener noreferrer">https://nacos.io/zh-cn/docs/architecture.html</a></em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="性能测试报告发布">性能测试报告发布<a href="#性能测试报告发布" class="hash-link" aria-label="性能测试报告发布的直接链接" title="性能测试报告发布的直接链接">​</a></h3><p>Nacos 1.0.0 进行了性能测试，针对服务发现和配置管理的读写能力进行了大规模场景的压力测试。目前得到的测试数据是：</p><ul><li><p>容量：服务实例数 100 万+，配置数 100 万+，支持客户端连接 100 万+；</p></li><li><p>读写TPS：1 万+；</p></li><li><p>节点扩展能力：100 节点+；</p></li><li><p>推送能力：1 万客户端订阅同一配置/服务，3 秒内收到变更通知比例 99.9%；</p></li></ul><p>目前压测报告已经更新到官网：</p><p><em>https:**//nacos.io/zh-cn/docs/nacos-naming-benchmark.html</em></p><p><em>https:**//nacos.io/zh-cn/docs/nacos-config-benchmark.html</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="100-企业用户已经上线生产环境">100+ 企业用户已经上线生产环境<a href="#100-企业用户已经上线生产环境" class="hash-link" aria-label="100+ 企业用户已经上线生产环境的直接链接" title="100+ 企业用户已经上线生产环境的直接链接">​</a></h3><p>目前 Nacos 作为服务发现和配置中心已经有 100 多个用户的生产环境中服役，包含阿里巴巴、<em>虎牙</em> 等企业已经将 Nacos 大规模应用在核心业务场景中。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="升级建议">升级建议<a href="#升级建议" class="hash-link" aria-label="升级建议的直接链接" title="升级建议的直接链接">​</a></h3><p>Nacos 1.0.0 服务端个别接口与 0.8.0 以前的版本不兼容，0.8.0之前版本需要先升级到0.8.0，再升级到1.0.0。对客户端而言，Nacos 1.0.0 兼容 0.5.0 及以上的版本的客户端访问。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="如何共建"><strong>如何共建</strong><a href="#如何共建" class="hash-link" aria-label="如何共建的直接链接" title="如何共建的直接链接">​</a></h3><hr><ol><li><p>如果您在文档中发现拼写错误，在代码中发现错误，想要新功能或想要提供建议，您可以在GitHub上创建一个 issues</p><p><em>地址：<a href="https://github.com/alibaba/Nacos/issues/new" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/Nacos/issues/new</a></em></p></li><li><p>或者可以选择 GitHub 仓库中有以下标签的 issues 入手：</p></li></ol><ul><li>good first issue：对于新手来说是非常好的入门 issues。</li><li>contribution welcome：亟待解决的问题和非常重要的模块，但目前缺少贡献者，欢迎贡献者来贡献。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="img-感谢贡献者们"><strong><img loading="lazy" src="https://res.wx.qq.com/mpres/htmledition/images/icon/common/emotion_panel/smiley/smiley_66.png?tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img" class="img_ev3q"> 感谢贡献者们</strong><a href="#img-感谢贡献者们" class="hash-link" aria-label="img-感谢贡献者们的直接链接" title="img-感谢贡献者们的直接链接">​</a></h2><p>Nacos 开发团队正在日益壮大，从最开始的只有 4 个代码 Contributor，发展到目前的 40 多个。在 1.0.0 版本的开发中，社区同学贡献了很大的力量，在此表示感谢，他们是（排序不分先后）：</p><p><em>yanlinly、xuechaos、hxy1991、jifengnan、nkorange、neatlife、loadchange、TsingLiang、jameslcj、duansheli、pbting、mingyixu、paderlol、nanamikon</em> 等。</p><p><img loading="lazy" src="https://img.alicdn.com/tfs/TB1vmOsQb2pK1RjSZFsXXaNlXXa-1716-888.png" alt="img" class="img_ev3q"></p><blockquote><p>DISS is cheap, show me your hand 比吐槽更重要的是搭把手，参与社区一起发展Nacos</p></blockquote><p>扫码进群，现在就加入我们。<img loading="lazy" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img" class="img_ev3q"></p><p><img loading="lazy" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img" class="img_ev3q"></p><p><strong>新人时刻 - 什么是 Nacos ？</strong></p><hr><p><strong>Nacos</strong> 是阿里巴巴于 2018 年 7 月份新开源的项目，Nacos 的主要愿景是期望通过提供易用的 动态服务发现、 服务配置管理、 服务共享与管理的基础设施，帮助用户在云原生时代更好的构建、交付、管理自己的微服务平台。</p><p><img loading="lazy" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img" class="img_ev3q"></p><p><strong>与 Nacos 相关的开源项目</strong></p><p><strong><em>Nacos（点击“阅读原文”可进入）</em></strong></p><p><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos</a></p><p><strong><em>Dubbo Registry Nacos</em></strong></p><p><a href="https://github.com/dubbo/dubbo-registry-nacos" target="_blank" rel="noopener noreferrer">https://github.com/dubbo/dubbo-registry-nacos</a></p><p><strong><em>Nacos DNS-F</em></strong></p><p><a href="https://github.com/nacos-group/nacos-coredns-plugin" target="_blank" rel="noopener noreferrer">https://github.com/nacos-group/nacos-coredns-plugin</a></p><p><strong><em>Nacos Spring Project</em></strong></p><p><a href="https://github.com/nacos-group/nacos-spring-project" target="_blank" rel="noopener noreferrer">https://github.com/nacos-group/nacos-spring-project</a></p><p><strong><em>Nacos Spring Boot</em></strong></p><p><a href="https://github.com/nacos-group/nacos-spring-boot-project" target="_blank" rel="noopener noreferrer">https://github.com/nacos-group/nacos-spring-boot-project</a></p><p><strong><em>Spring Cloud Alibaba</em></strong></p><p><a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba" target="_blank" rel="noopener noreferrer">https://github.com/spring-cloud-incubator/spring-cloud-alibaba</a></p><p><strong><em>Dubbo</em></strong></p><p><a href="http://dubbo.apache.org/en-us/" target="_blank" rel="noopener noreferrer">http://dubbo.apache.org/en-us/</a></p><p><strong><em>Sentinel</em></strong></p><p><a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/Sentinel</a></p><p><strong><em>Spring Cloud</em></strong></p><p><a href="https://spring.io/projects/spring-cloud" target="_blank" rel="noopener noreferrer">https://spring.io/projects/spring-cloud</a></p><p><strong><em>Nepxion Discovery</em></strong></p><p><a href="https://github.com/Nepxion/Discovery" target="_blank" rel="noopener noreferrer">https://github.com/Nepxion/Discovery</a></p><p><strong><em>Spring Cloud Gateway Nacos</em></strong></p><p><a href="https://github.com/SpringCloud/spring-cloud-gateway-nacoshttps://github.com/SpringCloud/spring-cloud-gateway-nacos" target="_blank" rel="noopener noreferrer">https://github.com/SpringCloud/spring-cloud-gateway-nacoshttps://github.com/SpringCloud/spring-cloud-gateway-nacos</a>)</p><p><em>本文作者：</em></p><p>朱鹏飞（花名：敦谷）</p><p>Github ID: nkorange，阿里巴巴中间件高级开发工程师，Nacos 开源项目负责人，Nacos 注册中心等模块主要贡献者。</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="我们总结了3大使用建议，并首次公开 Nacos3.0 规划图 | Nacos 开源4周年"><meta itemprop="keywords" content="nacos3.0,nacos最佳实践"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/zh-cn/blog/nacos3.0-is-coming">我们总结了3大使用建议，并首次公开 Nacos3.0 规划图 | Nacos 开源4周年</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T11:47:41.000Z" itemprop="datePublished">2023年10月10日</time> · <!-- -->阅读需 18 分钟</div></header><div class="markdown" itemprop="articleBody"><h1>Nacos 是什么？</h1><p><strong>Nacos </strong>/nɑ:kəʊs/ 是 Dynamic <strong>Na</strong>ming and <strong>Co</strong>nfiguration <strong>S</strong>ervice的首字母简称，定位于一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。从 2018 年 7 月开始宣布开源以来，已经走过了第四个年头，在这四年里，备受广大开源用户欢迎，共收获<strong>23.3K的star</strong>数，<strong>10.3K的Fork</strong>数，在开源中国发布的 2021 年度 OSC 中国开源项目评选中，Nacos 被评为<strong>云原生领域人气指数 Top5 </strong>的项目，发布电子书《Nacos 架构与原理》<strong>6w+阅读，2w下载量</strong>，发布半年的时间里在阿里云藏经阁历史下载榜前十。Nacos 在社区共同的建设下不断成长，逐步的开始帮助用户解决实际问题，助力企业数字化转型，目前已经广泛的使用在国内的公司中，根据微服务领域调查问卷，Nacos 在注册配置中心领域已经成为国内首选，<strong>占有50%+国内市场份额</strong>，被头部企业广泛使用！</p><p><em>《2022中国开源发展蓝皮书》由中国开源软件推进联盟（COPU）牵头，联合中国开发者网络（CSDN）、北京开源创新委员会、开放原子开源基金会、中国电子信息产业发展研究院、中科院软件研究所等 85 家企业及行业机构、120 多位开源专家和志愿者共同协作编撰完成，旨在全面展现当前中国开源发展的全景图，为国家政府相关管理部门、科研院所、科技企业以及开源从业者提供更多的理论参考和数据支撑，进一步助力我国开源生态的蓬勃发展。</em></p><p>根据最近刚发布的《2022中国开源发展蓝皮书》报告中 <strong>Github中国项目活跃度TOP 20</strong>，<strong>Nacos 排名全国第六</strong>，作为基础类型云原生中间件，能有如此活跃度是非常不容易的，在上一年度《2021中国开源发展蓝皮书》中，Nacos 排名全国第十，也表现 Nacos 不仅仅维持高的项目活跃度，而且项目关注度和活跃度还在逐步提高。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128326734-77c2a094-ec94-4af1-a75b-a0a53fdc6ec4.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=535&amp;id=u47f643c7&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1178&amp;originWidth=1518&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=236968&amp;status=done&amp;style=none&amp;taskId=u4d6df18d-be84-4d38-93f2-2a962f874c9&amp;title=&amp;width=689.999985044653" alt="image.png" class="img_ev3q">
<img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128326737-122b53b1-ccb8-44f2-b065-30f17f8ef7d3.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=300&amp;id=ueacbdce0&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=660&amp;originWidth=1506&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=137871&amp;status=done&amp;style=none&amp;taskId=u7d71e0c9-9383-4cbf-961a-10e20121db0&amp;title=&amp;width=684.5454397083317" alt="image.png" class="img_ev3q">
同时<strong>阿里巴巴在国内企业中开源影响力排行第一</strong>，在《2022中国开源发展蓝皮书》中介绍：“阿里巴巴是国内参与开源技术生态建设的企业典范。自2011年至今，阿里累计开源项目超过3000个，代表性的项目包括龙蜥操作系统、Apache RocketMQ、Apache Dubbo、Spring Cloud Alibaba、 Nacos、Seata、PolarDB-X、PolarDB for PostgreSQL等”。
<strong>Nacos 是阿里巴巴微服务领域开源你项目活跃度排行第一</strong>，也得益于开源协作模式，并且在Nacos中有大量国内外知名公司的核心贡献者，其中也包含就职在腾讯、华为、小米等等知名企业的同学，也正是社区整体的贡献者和用户在帮助 Nacos 成长，让 Nacos 逐步完善生态，支持几乎所有主流语言，整合更多开源生态，也正是用户和社区贡献者让Nacos为企业数字化转型首选产品。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128326897-7ed32372-ee24-49b3-9d04-0dc212286f15.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=502&amp;id=ubd55857f&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1104&amp;originWidth=2408&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=1103472&amp;status=done&amp;style=none&amp;taskId=u311192a3-cae9-43e6-825c-b7e317f32f8&amp;title=&amp;width=1094.5454308218211" alt="image.png" class="img_ev3q"></p><h1>Nacos 使用上的3点重要建议</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-版本选择">Nacos 版本选择<a href="#nacos-版本选择" class="hash-link" aria-label="Nacos 版本选择的直接链接" title="Nacos 版本选择的直接链接">​</a></h2><p>Nacos 经过4年的发展，目前在大版本演进上已经到了第二代 Nacos 架构，即 Nacos 2.x 版本，Nacos 2.x 版本是基于 Nacos 1.x 中用户反馈使用习惯以及产品演进方向而构建的产品能力，中间包含了比如一致性算法升级，对性能的 10 倍提升，以及支持插件化来满足社区的定制诉求。并且保障了很好的兼容性，在服务能力上 Nacos 2.x 是完全兼容 Nacos 1.x 的协议，也就是 Nacos 2.x 服务端是完全兼容Nacos 1.x的客户端。
<img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128326915-21ee9085-b47d-4126-a9e6-2b29642d3040.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=685&amp;id=u1b918043&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1506&amp;originWidth=3510&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=653185&amp;status=done&amp;style=none&amp;taskId=u3d05de1e-ca37-460e-b2c3-493ce845509&amp;title=&amp;width=1595.4545108740003" alt="image.png" class="img_ev3q"></p><p>在基本能力上，Nacos 2.x 一致性协议复用了阿里在该领域最佳实践，以长连接为基础，减低通信损耗，基于Distro协议原有协议进行升级，在存储模型、保活模型上进行了重构，并且用推送机制代替了之前的轮训机制，进一步提升了产品的高可用以及稳定性，整体也复用了阿里百万实例的基础模型，在CAP理论基础上，根据场景来去选择最适合的协议，贴合场景来平衡一致性、高可用以及分区容灾，做到服务发现以及配置管理每个场景下，都做到稳定性、高可用、高性能的保障。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128326737-0bcc637d-fb28-4d50-831d-0efe3bf2baa5.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=702&amp;id=uc4858e76&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1544&amp;originWidth=3414&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=1949611&amp;status=done&amp;style=none&amp;taskId=u417b5c89-ea5d-4a63-a81b-e1830bae1ae&amp;title=&amp;width=1551.8181481834292" alt="image.png" class="img_ev3q">
在拓展能力上，Nacos 2.x版本开始支持插件化能力，基于插件化是更方便的支持用户各种场景，很多用户公司内部有完善的体系基于Nacos可以简单的改造就可以融合进入，在鉴权、配置加解密场景都可以做到按照用户需求进行定制，并且给出默认的开源实现供用户选择，加解密为例，开源给出的默认实现是基于AES，用户也可以进行自定义。并且目前数据库的插件已经在路上，后续还会在安全等更多方面支持可插拔的插件化能力。
<img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128329396-ed838e7b-23b3-4641-8d83-339621f3e7f6.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=725&amp;id=u49cc077c&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1594&amp;originWidth=3516&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=765234&amp;status=done&amp;style=none&amp;taskId=uebe8a7d1-a137-49e9-a2c1-b43d15e84d1&amp;title=&amp;width=1598.181783542161" alt="image.png" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-支持还能支持那些场景">Nacos 支持还能支持那些场景<a href="#nacos-支持还能支持那些场景" class="hash-link" aria-label="Nacos 支持还能支持那些场景的直接链接" title="Nacos 支持还能支持那些场景的直接链接">​</a></h2><p>Nacos基本核心能力是面向于整体分布式的服务注册与发现，以及分布式节点配置管理，使用领域可以说是非常广泛的，比较常用的包含，微服务领域、高可用领域、内容领域以及数据库领域等，目前在微服务领域Nacos基本能力使用最广，微服务领域定位在一站式解决了用户应用的寻址、流量、配置场景服务平台，在高可用领域Nacos积累了大量的经验，可以实现大量降级、容灾、多活的高可用场景，也可以支持内容分发以及数据库分库分表、主备切换等场景的基础能力，可以说分布式的场景下，基本都可以跟Nacos进行构建，也帮助业务后续拓展留足了准备。
<img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128329276-3018d13a-b48c-40c7-b849-91f8457b8150.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=635&amp;id=ue5613a5e&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1398&amp;originWidth=3350&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=552128&amp;status=done&amp;style=none&amp;taskId=u4e44c983-d5f2-46f0-b0c8-81aff9737c1&amp;title=&amp;width=1522.7272397230486" alt="image.png" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-排查问题最佳实践">Nacos 排查问题最佳实践<a href="#nacos-排查问题最佳实践" class="hash-link" aria-label="Nacos 排查问题最佳实践的直接链接" title="Nacos 排查问题最佳实践的直接链接">​</a></h2><p>注册配置中心在分布式节点交互中起着重要的作用，在业务分布式场景出现问题的时候需要快速进行诊断，判断是否是注册配置中心出现了问题，还是业务层的问题。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128330096-e0464b56-d248-4882-b6b0-7dfc97ef2d12.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=637&amp;id=u044898a4&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1402&amp;originWidth=3288&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=586155&amp;status=done&amp;style=none&amp;taskId=udfffd8de-9024-48b2-9632-d3892d254b3&amp;title=&amp;width=1494.545422152055" alt="image.png" class="img_ev3q">
在注册中心中，服务发现是业务排查问题第一优先级需要定位的，服务发现具体对应的就是服务地址数据是否同步到了业务节点上，那在Nacos场景上，推送记录就是最关键的一个特性能力，这部分能力可以通过Nacos日志查询到，目前Nacos社区已经开始计划设计事件中心来支撑这部分能力，为了更好的演示，这里也通过阿里云微服务引擎MSE展现一下白屏化的推送轨迹能力，用户可以通过服务名称或者客户端IP，进行查询变更的时间以及变更的内容，就可以快速明确当前注册中心是否存在问题，并且能帮住业务进一步定位具体原因。
<img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128329802-c9b74139-1a26-4f5e-a87f-f7984eefd7dc.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=672&amp;id=u2a11e04a&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1478&amp;originWidth=3444&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=1298759&amp;status=done&amp;style=none&amp;taskId=uc0445f1b-5b12-4665-8ddb-3af553555a5&amp;title=&amp;width=1565.4545115242327" alt="image.png" class="img_ev3q">
在配置中心链路，同样存在第一时间定位的问题，这里也通过阿里云微服务引擎MSE的最佳实践，推送轨迹能力展现排查的思路，可以通过配置名称或者订阅者客户端IP进行查询配置的变更时间，以及推送时间，以及推送内容MD5值进行匹配。
<img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128330232-5db3bdda-ff5d-4f33-81b8-f7380fda69f4.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=565&amp;id=u66cb46ed&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1244&amp;originWidth=3442&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=898613&amp;status=done&amp;style=none&amp;taskId=u238152f1-f7bb-4ff7-bd9c-6abf9fbf49d&amp;title=&amp;width=1564.5454206348459" alt="image.png" class="img_ev3q">
并且在分布式配置管理领域，通过补全推送轨迹能力，加上已经支持的历史版本查询能力，可以帮助业务全流程的观测配置的生命周期。
<img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128330919-a9cd7ce7-71c6-4df5-b24d-e952787f31a8.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=148&amp;id=ub13903d9&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=326&amp;originWidth=3452&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=109098&amp;status=done&amp;style=none&amp;taskId=ubf8f4f18-2f42-43bc-b309-8b3af2e9263&amp;title=&amp;width=1569.0908750817803" alt="image.png" class="img_ev3q">
关于注册配置中心排查问题的思路上，总结是两个重点，一是数据变更确认，二是快速确定关系并且进行恢复。大多数场景如果是业务变更引起的，一定要第一时间进行回顾变更，避免给业务带来问题。在稳定性要求比较高的领域，建议业务体系上面向1-5-10（故障1分钟发现，5分钟上线处理，10分钟恢复）建设稳定性，这部分也是比较通用的能力建设，这里就不进行详细拓展，后续有机会可以单独聊一下。</p><h1>Nacos 规划</h1><p>Nacos 已经经历了两个重要阶段，初创期和高速发展期，目前正处于被大规模使用的 Nacos 的第三阶段是成为基础设施，需要面向于基础设施进行演进，帮助企业数字化转型，深度的拥抱各个领域内的场景，并且更深度的帮助企业解决问题。Nacos 社区目前面向于第三阶段，开始筹备 Nacos 3.0 架构设计进行规划讨论，并且逐步开始进行落地。
目前针对 Nacos 3.0 的建设规划大图主要包含三部分，第一部分是开源品牌和社区的升级，主要是面向于社区建立更紧密的联系。第二部分是面向更多生态进行深度融合，包含K8S数据整合、以及多生态数据打通，第三部分是最基础的部分，产品能力升级，基于 Nacos2.x 的协议进行增强，并且支持统一控制面、多数据中心等基础能力，用于支撑 Nacos 3.0 生态建设以及品牌升级。
目前 Nacos 3.0 部分已经随着社区核心贡献者开展中，大多数还在规划阶段，后续会通过Github issues进行开放，随之会打上Nacos 3.0的标签，欢迎大家进行领取一起参与到Nacos 3.0的贡献。
<img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128331989-00a0bd06-65a9-45c9-9cbd-54f1c30a7f2b.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=713&amp;id=ueaab6b3a&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1568&amp;originWidth=3260&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=541963&amp;status=done&amp;style=none&amp;taskId=u8e3272fe-5488-46b2-8489-54c8fd9074a&amp;title=&amp;width=1481.8181497006383" alt="image.png" class="img_ev3q"></p><h1>参与开源建议</h1><p>最后部分整合我个人意见，向没有参与过开源的同学给出一些参与开源的建议，首先我认为开源对于开发者以及社区贡献都是非常有益的，如果你有时间并且也想参与开源，那我建议你从以下四个步骤进行深入：
第一步找到自己感兴趣的方向，这个点比较重要，会影响你后续贡献的持久程度，当然这个也是在逐步摸索中的，不过如果对于方向确认好后，应对的产品列表选择就会比较明朗了，在这个步骤考虑兴趣是我首要建议的，其次我建议，也可以考虑当前项目一些详细信息，重点考虑是否能帮助个人把价值的放大，使用范围越广的项目就越能让你的贡献在社会价值放大，也正向会提高成就感。
第二步是熟悉项目和产品，找到了方向和项目之后，就可以开始着手熟悉当前产品的细节，熟悉当前项目的运营机制，以及面向于产品开始接触对应领域问题，领域问题最后会沉淀成为你对这个领域的经验。
第三步其实就可以贡献开源了，这一个步骤其实面向于前两步骤是可以适当提前并行做，关键是从小问题入手做起，这样可以帮助你在前两个步骤中更快的找到感觉，也能从小问题开始帮助他人，在社区中建立个人影响力。
第四步其实是水到渠成的，面向于活跃的社区，当你足够熟悉该领域该产品之后，有了足够的贡献，就会在开源中逐步主导社区的决策，也能在社区中帮助更多的人发展共建。
<img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128332043-0226d126-4ed8-4881-a36b-a9e3cffba02d.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=642&amp;id=u502fa610&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1412&amp;originWidth=3312&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=588596&amp;status=done&amp;style=none&amp;taskId=u2afc3cd2-dd40-4145-a6e4-cc1ec7289de&amp;title=&amp;width=1505.4545128246978" alt="image.png" class="img_ev3q">
上边是对个人贡献开源产品流程建议，适用于大多数开源项目的贡献。额外在开源上我觉得Nacos是不错的选择，首先产品定位是比较基础，能帮助开发者沉淀更通用的领域能力，社区活跃度能保持全国第六，并且在微服务领域已经被广泛使用，能帮助个人很好的放大价值。
再就是Nacos的熟悉产品也会比较简单，Nacos.io 官网可以帮助你快速入门，也有Nacos电子书免费下载帮助你深度了解Nacos架构设计。贡献开源上可以从Nacos社区仓库中 good first issues开始，跟着产品演进的方向，从小事开始在社区中发声，最后在Nacos社区有很多核心模块需要主导者，并且在社区中成为核心贡献者有社区投票权利，主导未来Nacos发展方向，并且作为社区核心成员，会有很多线上线下分享的机会，帮助个人以及企业建立更多社会影响力。总之在开源领域其实只要你愿意熟悉，一定会有所收获，祝愿每一位开发者在自己喜欢的领域能做出你想要的产品。最后感谢Nacos开源社区每一位同学！</p></div></article><nav class="pagination-nav" aria-label="博文列表分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh-cn/blog/page/4"><div class="pagination-nav__label">较新的博文</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh-cn/blog/page/6"><div class="pagination-nav__label">较旧的博文</div></a></nav></main></div></div></div></div>
<script src="/zh-cn/assets/js/runtime~main.799a6c4f.js"></script>
<script src="/zh-cn/assets/js/main.99abaf7c.js"></script>
</body>
</html>