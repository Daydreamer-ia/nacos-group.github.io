"use strict";(self.webpackChunkNacos=self.webpackChunkNacos||[]).push([[6465],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>g});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),c=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=c(e.components);return a.createElement(s.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=c(t),m=r,g=u["".concat(s,".").concat(m)]||u[m]||d[m]||o;return t?a.createElement(g,l(l({ref:n},p),{},{components:t})):a.createElement(g,l({ref:n},p))}));function g(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,l=new Array(o);l[0]=m;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i[u]="string"==typeof e?e:r,l[1]=i;for(var c=2;c<o;c++)l[c]=t[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},42365:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>c});var a=t(87462),r=(t(67294),t(3905));const o={title:"Nacos 1.3.0 \u5168\u65b0\u5185\u6838\u6784\u5efa\u8fc7\u7a0b",keywords:["nacos1.3.0","\u5185\u6838"],description:"Nacos 1.3.0 \u5168\u65b0\u5185\u6838\u6784\u5efa\u8fc7\u7a0b"},l="Nacos 1.3.0 \u7279\u6027\u4ee5\u53ca\u529f\u80fd\u4f7f\u7528\u6587\u6863",i={permalink:"/zh-cn/blog/nacos-1.3.0-design",source:"@site/i18n/zh-cn/docusaurus-plugin-content-blog/nacos-1.3.0-design.md",title:"Nacos 1.3.0 \u5168\u65b0\u5185\u6838\u6784\u5efa\u8fc7\u7a0b",description:"Nacos 1.3.0 \u5168\u65b0\u5185\u6838\u6784\u5efa\u8fc7\u7a0b",date:"2023-10-10T08:15:08.000Z",formattedDate:"2023\u5e7410\u670810\u65e5",tags:[],readingTime:34.69,hasTruncateMarker:!1,authors:[],frontMatter:{title:"Nacos 1.3.0 \u5168\u65b0\u5185\u6838\u6784\u5efa\u8fc7\u7a0b",keywords:["nacos1.3.0","\u5185\u6838"],description:"Nacos 1.3.0 \u5168\u65b0\u5185\u6838\u6784\u5efa\u8fc7\u7a0b"},prevItem:{title:"Nacos 1.2.0 \u6743\u9650\u63a7\u5236\u4ecb\u7ecd\u548c\u4f7f\u7528",permalink:"/zh-cn/blog/nacos 1.2.0 guide"},nextItem:{title:"Nacos \u4e24\u5468\u5e74\u732e\u793c\uff0cNacos 1.3.2 + Go SDK 1.0.0\u53d1\u5e03",permalink:"/zh-cn/blog/nacos-2nd-anniversary"}},s={authorsImageUrls:[]},c=[{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:2},{value:"\u7cfb\u7edf\u53c2\u6570\u53d8\u5316",id:"\u7cfb\u7edf\u53c2\u6570\u53d8\u5316",level:2},{value:"\u65b0\u589e",id:"\u65b0\u589e",level:3},{value:"Nacos\u7684\u672a\u6765\u6574\u4f53\u903b\u8f91\u67b6\u6784\u53ca\u5176\u7ec4\u4ef6",id:"nacos\u7684\u672a\u6765\u6574\u4f53\u903b\u8f91\u67b6\u6784\u53ca\u5176\u7ec4\u4ef6",level:2},{value:"Nacos\u96c6\u7fa4\u6210\u5458\u8282\u70b9\u5bfb\u5740\u6a21\u5f0f",id:"nacos\u96c6\u7fa4\u6210\u5458\u8282\u70b9\u5bfb\u5740\u6a21\u5f0f",level:2},{value:"FileConfigMemberLookup",id:"fileconfigmemberlookup",level:4},{value:"AddressServerMemberLookup",id:"addressservermemberlookup",level:4},{value:"\u8282\u70b9\u7ba1\u7406\u548c\u5bfb\u5740\u6a21\u5f0f\u5982\u4f55\u7ed3\u5408\u7684",id:"\u8282\u70b9\u7ba1\u7406\u548c\u5bfb\u5740\u6a21\u5f0f\u5982\u4f55\u7ed3\u5408\u7684",level:3},{value:"Nacos\u4e00\u81f4\u6027\u534f\u8bae\u534f\u8bae\u5c42\u62bd\u8c61",id:"nacos\u4e00\u81f4\u6027\u534f\u8bae\u534f\u8bae\u5c42\u62bd\u8c61",level:2},{value:"\u4e00\u81f4\u534f\u8bae\u62bd\u8c61",id:"\u4e00\u81f4\u534f\u8bae\u62bd\u8c61",level:3},{value:"ConsistencyProtocol",id:"consistencyprotocol",level:4},{value:"\u6570\u636e\u64cd\u4f5c\u8bf7\u6c42\u63d0\u4ea4\u5bf9\u8c61\uff1aLog\u3001GetRequest",id:"\u6570\u636e\u64cd\u4f5c\u8bf7\u6c42\u63d0\u4ea4\u5bf9\u8c61loggetrequest",level:4},{value:"\u529f\u80fd\u6a21\u5757\u4f7f\u7528\u4e00\u81f4\u6027\u534f\u8bae\uff1aLogProcessor",id:"\u529f\u80fd\u6a21\u5757\u4f7f\u7528\u4e00\u81f4\u6027\u534f\u8baelogprocessor",level:4},{value:"\u7efc\u8ff0",id:"\u7efc\u8ff0",level:4},{value:"\u4e00\u81f4\u6027\u534f\u8bae\u5c42\u5de5\u4f5c\u6d41\u7a0b",id:"\u4e00\u81f4\u6027\u534f\u8bae\u5c42\u5de5\u4f5c\u6d41\u7a0b",level:3},{value:"Nacos\u4e00\u81f4\u6027\u534f\u8bae\u5c42\u4e4bCP\u534f\u8bae\u7684\u5b9e\u73b0\u9009\u62e9\u2014\u2014JRaft",id:"nacos\u4e00\u81f4\u6027\u534f\u8bae\u5c42\u4e4bcp\u534f\u8bae\u7684\u5b9e\u73b0\u9009\u62e9jraft",level:3},{value:"\u7591\u95ee\u89e3\u7b54\uff1a\u4e3a\u4ec0\u4e48\u8981\u521b\u5efa\u591a\u4e2araft group",id:"\u7591\u95ee\u89e3\u7b54\u4e3a\u4ec0\u4e48\u8981\u521b\u5efa\u591a\u4e2araft-group",level:4},{value:"JRaft\u8fd0\u7ef4\u64cd\u4f5c",id:"jraft\u8fd0\u7ef4\u64cd\u4f5c",level:3},{value:"JRaft\u534f\u8bae\u76f8\u5173\u914d\u7f6e\u53c2\u6570",id:"jraft\u534f\u8bae\u76f8\u5173\u914d\u7f6e\u53c2\u6570",level:3},{value:"\u7ebf\u6027\u8bfb\u53c2\u6570\u89e3\u6790",id:"\u7ebf\u6027\u8bfb\u53c2\u6570\u89e3\u6790",level:4},{value:"Nacos\u5185\u5d4c\u5206\u5e03\u5f0fID",id:"nacos\u5185\u5d4c\u5206\u5e03\u5f0fid",level:2},{value:"Nacos\u5185\u5d4c\u7684\u8f7b\u91cf\u7684\u57fa\u4e8eDerby\u7684\u5206\u5e03\u5f0f\u5173\u7cfb\u578b\u5b58\u50a8",id:"nacos\u5185\u5d4c\u7684\u8f7b\u91cf\u7684\u57fa\u4e8ederby\u7684\u5206\u5e03\u5f0f\u5173\u7cfb\u578b\u5b58\u50a8",level:2},{value:"\u80cc\u666f",id:"\u80cc\u666f",level:3},{value:"\u8bbe\u8ba1\u601d\u8def",id:"\u8bbe\u8ba1\u601d\u8def",level:3},{value:"\u76ee\u6807",id:"\u76ee\u6807",level:4},{value:"\u603b\u4f53",id:"\u603b\u4f53",level:4},{value:"\u8c01\u53ef\u4ee5\u5904\u7406\u8bf7\u6c42",id:"\u8c01\u53ef\u4ee5\u5904\u7406\u8bf7\u6c42",level:4},{value:"\u76f8\u5173\u6570\u636e\u627f\u8f7d\u5bf9\u8c61",id:"\u76f8\u5173\u6570\u636e\u627f\u8f7d\u5bf9\u8c61",level:4},{value:"\u914d\u7f6e\u53d1\u5e03",id:"\u914d\u7f6e\u53d1\u5e03",level:4},{value:"\u5982\u4f55\u4f7f\u7528\u65b0\u7279\u6027",id:"\u5982\u4f55\u4f7f\u7528\u65b0\u7279\u6027",level:3},{value:"\u65b0\u7279\u6027\u7684\u76f8\u5173\u8fd0\u7ef4\u64cd\u4f5c",id:"\u65b0\u7279\u6027\u7684\u76f8\u5173\u8fd0\u7ef4\u64cd\u4f5c",level:3},{value:"\u4e0d\u8db3",id:"\u4e0d\u8db3",level:3},{value:"\u672a\u6765\u6f14\u8fdb",id:"\u672a\u6765\u6f14\u8fdb",level:3}],p={toc:c},u="wrapper";function d(e){let{components:n,...t}=e;return(0,r.kt)(u,(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("a",{name:"0YIG0"}),(0,r.kt)("h2",{id:"\u6982\u8ff0"},"\u6982\u8ff0"),(0,r.kt)("p",null,"\u672c\u6b211.3.0\u7684\u6539\u52a8\u7a0b\u5ea6\u5f88\u5927\uff0c\u6d89\u53ca\u4e24\u5927\u6a21\u5757\u7684\u4fee\u6539\u4ee5\u53ca\u65b0\u589e\u4e00\u4e2a\u6838\u5fc3\u6a21\u5757"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"nacos-core\u6a21\u5757\u4fee\u6539",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"nacos\u96c6\u7fa4\u8282\u70b9\u6210\u5458\u5bfb\u5740\u6a21\u5f0f\u7684\u7edf\u4e00\u7ba1\u7406"),(0,r.kt)("li",{parentName:"ol"},"nacos\u5185\u90e8\u4e8b\u4ef6\u673a\u5236"),(0,r.kt)("li",{parentName:"ol"},"nacos\u4e00\u81f4\u6027\u534f\u8bae\u5c42"))),(0,r.kt)("li",{parentName:"ol"},"nacos-config\u6a21\u5757\u4fee\u6539",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"\u65b0\u589e\u5185\u5d4c\u5206\u5e03\u5f0f\u6570\u636e\u5b58\u50a8\u7ec4\u4ef6"),(0,r.kt)("li",{parentName:"ol"},"\u5185\u5d4c\u5b58\u50a8\u4e0e\u5916\u7f6e\u5b58\u50a8\u7ec6\u5206"),(0,r.kt)("li",{parentName:"ol"},"\u5185\u5d4c\u5b58\u50a8\u7b80\u5355\u8fd0\u7ef4"))),(0,r.kt)("li",{parentName:"ol"},"nacos-consistency\u6a21\u5757\u65b0\u589e",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"\u5bf9\u4e8eAP\u534f\u8bae\u4ee5\u53caCP\u534f\u8bae\u7684\u7edf\u4e00\u62bd\u8c61")))),(0,r.kt)("br",null),(0,r.kt)("a",{name:"rnkDY"}),(0,r.kt)("h2",{id:"\u7cfb\u7edf\u53c2\u6570\u53d8\u5316"},"\u7cfb\u7edf\u53c2\u6570\u53d8\u5316"),(0,r.kt)("a",{name:"1Gmg9"}),(0,r.kt)("h3",{id:"\u65b0\u589e"},"\u65b0\u589e"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"center"},(0,r.kt)("strong",{parentName:"th"},"core\u6a21\u5757")),(0,r.kt)("th",{parentName:"tr",align:null},"nacos.watch-file.max-dirs"),(0,r.kt)("th",{parentName:"tr",align:null},"JVM\u53c2\u6570"),(0,r.kt)("th",{parentName:"tr",align:null},"\u6700\u5927\u53ef\u76d1\u542c\u76ee\u5f55\u6570\u91cf"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"}),(0,r.kt)("td",{parentName:"tr",align:null},"nacos.core.notify.ring-buffer-size"),(0,r.kt)("td",{parentName:"tr",align:null},"JVM\u53c2\u6570"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5feb\u901f\u901a\u77e5\u961f\u5217\u7684\u6700\u5927\u957f\u5ea6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"}),(0,r.kt)("td",{parentName:"tr",align:null},"nacos.core.notify.share-buffer-size"),(0,r.kt)("td",{parentName:"tr",align:null},"JVM\u53c2\u6570"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6162\u901f\u901a\u77e5\u961f\u5217\u7684\u6700\u5927\u957f\u5ea6")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"}),(0,r.kt)("td",{parentName:"tr",align:null},"nacos.core.member.fail-access-cnt"),(0,r.kt)("td",{parentName:"tr",align:null},"JVM\u53c2\u6570\u3001application.properties\u914d\u7f6e"),(0,r.kt)("td",{parentName:"tr",align:null},"\u96c6\u7fa4\u6210\u5458\u8282\u70b9\u6700\u5927\u5931\u8d25\u8bbf\u95ee\u6b21\u6570")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"}),(0,r.kt)("td",{parentName:"tr",align:null},"nacos.core.address-server.retry"),(0,r.kt)("td",{parentName:"tr",align:null},"JVM\u53c2\u6570\u3001application.properties\u914d\u7f6e"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5730\u5740\u670d\u52a1\u5668\u5bfb\u5740\u6a21\u5f0f\uff0c\u9996\u6b21\u542f\u52a8\u8bf7\u6c42\u91cd\u8bd5\u6b21\u6570")))),(0,r.kt)("br",null),(0,r.kt)("a",{name:"kxo8O"}),(0,r.kt)("h2",{id:"nacos\u7684\u672a\u6765\u6574\u4f53\u903b\u8f91\u67b6\u6784\u53ca\u5176\u7ec4\u4ef6"},"Nacos\u7684\u672a\u6765\u6574\u4f53\u903b\u8f91\u67b6\u6784\u53ca\u5176\u7ec4\u4ef6"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2020/png/333972/1587129046320-5a286f38-8db4-4e76-9b42-8bd859f51a60.png#align=left&display=inline&height=1184&margin=%5Bobject%20Object%5D&name=1561217775318-6e408805-18bb-4242-b4e9-83c5b929b469.png&originHeight=1184&originWidth=1608&size=279074&status=done&style=none&width=1608",alt:"1561217775318-6e408805-18bb-4242-b4e9-83c5b929b469.png"})),(0,r.kt)("a",{name:"Hyc6u"}),(0,r.kt)("h2",{id:"nacos\u96c6\u7fa4\u6210\u5458\u8282\u70b9\u5bfb\u5740\u6a21\u5f0f"},"Nacos\u96c6\u7fa4\u6210\u5458\u8282\u70b9\u5bfb\u5740\u6a21\u5f0f"),(0,r.kt)("br",null),"\u57281.3.0\u4e4b\u524d\uff0cnacos\u7684naming\u6a21\u5757\u4ee5\u53caconfig\u6a21\u5757\u5b58\u5728\u5404\u81ea\u7684\u96c6\u7fa4\u6210\u5458\u8282\u70b9\u5217\u8868\u7ba1\u7406\u4efb\u52a1\u3002\u4e3a\u4e86\u7edf\u4e00nacos\u96c6\u7fa4\u4e0b\u6210\u5458\u5217\u8868\u7684\u5bfb\u5740\u6a21\u5f0f\uff0c\u5c06\u96c6\u7fa4\u8282\u70b9\u7ba1\u7406\u7684\u5b9e\u73b0\u4ecenaming\u6a21\u5757\u4ee5\u53caconfig\u6a21\u5757\u5265\u79bb\u51fa\u6765\uff0c\u7edf\u4e00\u4e0b\u6c89\u5230\u4e86core\u6a21\u5757\u7684\u5bfb\u5740\u6a21\uff0c\u540c\u65f6\u65b0\u589e\u547d\u4ee4\u884c\u53c2\u6570\xa0**-Dnacos.member.list\xa0**\u8fdb\u884c\u8bbe\u7f6enacos\u96c6\u7fa4\u8282\u70b9\u5217\u8868\uff0c\u8be5\u53c2\u6570\u53ef\u4ee5\u770b\u4f5c\u662fcluster.conf\u6587\u4ef6\u7684\u4e00\u4e2a\u66ff\u4ee3\u3002\u76ee\u524dnacos\u7684\u5bfb\u5740\u6a21\u5f0f\u7c7b\u522b\u5982\u4e0b",(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5355\u673a\u6a21\u5f0f\u4e0b\uff1aStandaloneMemberLookup"),(0,r.kt)("li",{parentName:"ol"},"\u96c6\u7fa4\u6a21\u5f0f",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"cluster.conf\u6587\u4ef6\u5b58\u5728\uff1aFileConfigMemberLookup"),(0,r.kt)("li",{parentName:"ol"},"cluster.conf\u6587\u4ef6\u4e0d\u5b58\u5728\u6216\u8005 -Dnacos.member.list\u6ca1\u6709\u8bbe\u7f6e\uff1aAddressServerMemberLookup")))),(0,r.kt)("p",null,"\u5982\u679c\u8bf4\u60f3\u6307\u5b9a\u67d0\u4e00\u79cd\u5bfb\u5740\u6a21\u5f0f\uff0c\u5219\u8bbe\u7f6e\u6b64\u53c2\u6570\uff1a",(0,r.kt)("strong",{parentName:"p"},"nacos.core.member.lookup.type=","[file,address-server]")),(0,r.kt)("p",null,"\u903b\u8f91\u56fe\u5982\u4e0b\n",(0,r.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/__puml/e209a677aa8b5ffce23589e987ee5129.svg#lake_card_v2=eyJjb2RlIjoiQHN0YXJ0dW1sXG5cbigqKSAtLT4gXCJMb29rdXBGYWN0b3J5LmluaXQoKVwiXG5cbmlmIFwic3RhbmRhbG9uZSBtb2RlXCIgdGhlblxuICAtLT5bdHJ1ZV0gXCJyZXR1cm4gU3RhbmRhbG9uZU1lbWJlckxvb2t1cFwiXG4gIC0tPiBMb29rdXAucnVuKClcbmVsc2VcbiBpZiBcImNsdXN0ZXIuY29uZiBleGlzdHNcIiB0aGVuXG4gICAgLS0-W3RydWVdIFwicmV0dXJuIEZpbGVDb25maWdNZW1iZXJMb29rdXBcIlxuICAgIC0tPiBMb29rdXAucnVuKClcbiBlbHNlXG4gICAgLT5bZmFsc2VdIFwicmV0dXJuIEFkZHJlc3NTZXJ2ZXJNZW1iZXJMb29rdXBcIlxuICAgIC0tPiBMb29rdXAucnVuKClcbiBlbmRpZlxuZW5kaWZcblxuLS0-ICgqKVxuXG5AZW5kdW1sIiwidHlwZSI6InB1bWwiLCJpZCI6IlplWGtkIiwidXJsIjoiaHR0cHM6Ly9jZG4ubmxhcmsuY29tL3l1cXVlL19fcHVtbC9lMjA5YTY3N2FhOGI1ZmZjZTIzNTg5ZTk4N2VlNTEyOS5zdmciLCJjYXJkIjoiZGlhZ3JhbSJ9",alt:null})),(0,r.kt)("a",{name:"wqkMp"}),"### \u5bfb\u5740\u6a21\u5f0f\u8be6\u7ec6 \u63a5\u4e0b\u6765\u4ecb\u7ecd\u9664\u4e86\u5355\u673a\u6a21\u5f0f\u4e0b\u7684\u5bfb\u5740\u6a21\u5f0f\u7684\u5176\u4ed6\u4e24\u79cd\u5bfb\u5740\u6a21\u5f0f",(0,r.kt)("br",null),(0,r.kt)("a",{name:"egl3H"}),(0,r.kt)("h4",{id:"fileconfigmemberlookup"},"FileConfigMemberLookup"),(0,r.kt)("p",null,"\u8be5\u5bfb\u5740\u6a21\u5f0f\u662f\u57fa\u4e8ecluster.conf\u6587\u4ef6\u8fdb\u884c\u7ba1\u7406\u7684\uff0c\u6bcf\u4e2a\u8282\u70b9\u4f1a\u8bfb\u53d6\u5404\u81ea${nacos.home}/conf\u4e0b\u7684cluster.conf\u6587\u4ef6\u5185\u7684\u6210\u5458\u8282\u70b9\u5217\u8868\uff0c\u7136\u540e\u7ec4\u6210\u4e00\u4e2a\u96c6\u7fa4\u3002\u5e76\u4e14\u5728\u9996\u6b21\u8bfb\u53d6\u5b8c${nacos.home}/conf\u4e0b\u7684cluster.conf\u6587\u4ef6\u540e\uff0c\u4f1a\u81ea\u52a8\u5411\u64cd\u4f5c\u7cfb\u7edf\u7684",(0,r.kt)("em",{parentName:"p"},(0,r.kt)("strong",{parentName:"em"},"inotify")),"\u673a\u5236\u6ce8\u518c\u4e00\u4e2a\u76ee\u5f55\u76d1\u542c\u5668\uff0c\u76d1\u542c${nacos.home}/conf\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u53d8\u52a8\uff08\u6ce8\u610f\uff0c\u8fd9\u91cc\u53ea\u4f1a\u76d1\u542c\u6587\u4ef6\uff0c\u5bf9\u4e8e\u5b50\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u53d8\u52a8\u65e0\u6cd5\u76d1\u542c\uff09",(0,r.kt)("br",null),"\u5f53\u9700\u8981\u8fdb\u884c\u96c6\u7fa4\u8282\u70b9\u6269\u7f29\u5bb9\u65f6\uff0c\u9700\u8981\u624b\u52a8\u53bb\u4fee\u6539\u6bcf\u4e2a\u8282\u70b9\u5404\u81ea${nacos.home}/conf\u4e0b\u7684cluster.conf\u7684\u6210\u5458\u8282\u70b9\u5217\u8868\u5185\u5bb9\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'private FileWatcher watcher = new FileWatcher() {\n        @Override\n        public void onChange(FileChangeEvent event) {\n            readClusterConfFromDisk();\n        }\n\n        @Override\n        public boolean interest(String context) {\n            return StringUtils.contains(context, "cluster.conf");\n        }\n};\n\n@Override\npublic void start() throws NacosException {\n    readClusterConfFromDisk();\n\n    if (memberManager.getServerList().isEmpty()) {\n        throw new NacosException(NacosException.SERVER_ERROR,\n                    "Failed to initialize the member node, is empty");\n    }\n\n    // Use the inotify mechanism to monitor file changes and automatically\n    // trigger the reading of cluster.conf\n    try {\n        WatchFileCenter.registerWatcher(ApplicationUtils.getConfFilePath(), watcher);\n    }\n    catch (Throwable e) {\n        Loggers.CLUSTER.error("An exception occurred in the launch file monitor : {}", e);\n    }\n}\n')),(0,r.kt)("p",null,"\u9996\u6b21\u542f\u52a8\u65f6\u76f4\u63a5\u8bfb\u53d6cluster.conf\u6587\u4ef6\u5185\u7684\u8282\u70b9\u5217\u8868\u4fe1\u606f\uff0c\u7136\u540e\u5411WatchFileCenter\u6ce8\u518c\u4e00\u4e2a\u76ee\u5f55\u76d1\u542c\u5668\uff0c\u5f53cluster.conf\u6587\u4ef6\u53d1\u751f\u53d8\u52a8\u65f6\u81ea\u52a8\u89e6\u53d1",(0,r.kt)("em",{parentName:"p"},(0,r.kt)("strong",{parentName:"em"},"readClusterConfFromDisk()")),"\u91cd\u65b0\u8bfb\u53d6cluster.conf\u6587\u4ef6",(0,r.kt)("br",null),(0,r.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2020/png/333972/1591014354207-49c1e934-2aa5-465a-8a2b-0b09902814f8.png#align=left&display=inline&height=531&margin=%5Bobject%20Object%5D&name=image.png&originHeight=531&originWidth=1169&size=105696&status=done&style=none&width=1169",alt:"image.png"})),(0,r.kt)("a",{name:"yFTCl"}),(0,r.kt)("h4",{id:"addressservermemberlookup"},"AddressServerMemberLookup"),(0,r.kt)("p",null,"\u8be5\u5bfb\u5740\u6a21\u5f0f\u662f\u57fa\u4e8e\u4e00\u4e2a\u989d\u5916\u7684web\u670d\u52a1\u5668\u6765\u7ba1\u7406cluster.conf\uff0c\u6bcf\u4e2a\u8282\u70b9\u5b9a\u671f\u5411\u8be5web\u670d\u52a1\u5668\u8bf7\u6c42cluster.conf\u7684\u6587\u4ef6\u5185\u5bb9\uff0c\u7136\u540e\u5b9e\u73b0\u96c6\u7fa4\u8282\u70b9\u95f4\u7684\u5bfb\u5740\uff0c\u4ee5\u53ca\u6269\u7f29\u5bb9\u3002",(0,r.kt)("br",null),"\u5f53\u9700\u8981\u8fdb\u884c\u96c6\u7fa4\u6269\u7f29\u5bb9\u65f6\uff0c\u53ea\u9700\u8981\u4fee\u6539cluster.conf\u6587\u4ef6\u5373\u53ef\uff0c\u7136\u540e\u6bcf\u4e2a\u8282\u70b9\u5411\u5730\u5740\u670d\u52a1\u5668\u8bf7\u6c42\u65f6\u4f1a\u81ea\u52a8\u7684\u5f97\u5230\u6700\u65b0\u7684cluster.conf\u6587\u4ef6\u5185\u5bb9\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Override\npublic void start() throws NacosException {\n    if (start.compareAndSet(false, true)) {\n        this.maxFailCount = Integer.parseInt(ApplicationUtils.getProperty("maxHealthCheckFailCount", "12"));\n        initAddressSys();\n        run();\n    }\n}\n\nprivate void initAddressSys() {\n    String envDomainName = System.getenv("address_server_domain");\n    if (StringUtils.isBlank(envDomainName)) {\n        domainName = System.getProperty("address.server.domain", "jmenv.tbsite.net");\n    } else {\n        domainName = envDomainName;\n    }\n    String envAddressPort = System.getenv("address_server_port");\n    if (StringUtils.isBlank(envAddressPort)) {\n        addressPort = System.getProperty("address.server.port", "8080");\n    } else {\n        addressPort = envAddressPort;\n    }\n    addressUrl = System.getProperty("address.server.url",\n                ApplicationUtils.getContextPath() + "/" + "serverlist");\n    addressServerUrl = "http://" + domainName + ":" + addressPort + addressUrl;\n    envIdUrl = "http://" + domainName + ":" + addressPort + "/env";\n\n    Loggers.CORE.info("ServerListService address-server port:" + addressPort);\n    Loggers.CORE.info("ADDRESS_SERVER_URL:" + addressServerUrl);\n}\n\n@SuppressWarnings("PMD.UndefineMagicConstantRule")\nprivate void run() throws NacosException {\n    // With the address server, you need to perform a synchronous member node pull at startup\n    // Repeat three times, successfully jump out\n    boolean success = false;\n    Throwable ex = null;\n    int maxRetry = ApplicationUtils.getProperty("nacos.core.address-server.retry", Integer.class, 5);\n    for (int i = 0; i < maxRetry; i ++) {\n        try {\n            syncFromAddressUrl();\n            success = true;\n            break;\n        } catch (Throwable e) {\n            ex = e;\n            Loggers.CLUSTER.error("[serverlist] exception, error : {}", ExceptionUtil.getAllExceptionMsg(ex));\n        }\n    }\n    if (!success) {\n        throw new NacosException(NacosException.SERVER_ERROR, ex);\n    }\n\n    GlobalExecutor.scheduleByCommon(new AddressServerSyncTask(), 5_000L);\n}\n')),(0,r.kt)("p",null,"\u5728\u521d\u59cb\u5316\u65f6\uff0c\u4f1a\u4e3b\u52a8\u53bb\u5411\u5730\u5740\u670d\u52a1\u5668\u540c\u6b65\u5f53\u524d\u7684\u96c6\u7fa4\u6210\u5458\u5217\u8868\u4fe1\u606f\uff0c\u5982\u679c\u5931\u8d25\u5219\u8fdb\u884c\u91cd\u8bd5\uff0c\u5176\u6700\u5927\u91cd\u8bd5\u6b21\u6570\u53ef\u901a\u8fc7\u8bbe\u7f6e",(0,r.kt)("em",{parentName:"p"},(0,r.kt)("strong",{parentName:"em"},"nacos.core.address-server.retry")),"\u6765\u63a7\u5236\uff0c\u9ed8\u8ba4\u662f5\u6b21\uff0c\u7136\u540e\u6210\u529f\u4e4b\u540e\uff0c\u5c06\u521b\u5efa\u5b9a\u65f6\u4efb\u52a1\u53bb\u5411\u5730\u5740\u670d\u52a1\u5668\u540c\u6b65\u96c6\u7fa4\u6210\u5458\u8282\u70b9\u4fe1\u606f",(0,r.kt)("br",null),(0,r.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2020/png/333972/1591014362972-004f5338-af0d-4d0d-b769-4f3d5118c08a.png#align=left&display=inline&height=846&margin=%5Bobject%20Object%5D&name=image.png&originHeight=846&originWidth=1149&size=188886&status=done&style=none&width=1149",alt:"image.png"})),(0,r.kt)("a",{name:"sgOTI"}),(0,r.kt)("h3",{id:"\u8282\u70b9\u7ba1\u7406\u548c\u5bfb\u5740\u6a21\u5f0f\u5982\u4f55\u7ed3\u5408\u7684"},"\u8282\u70b9\u7ba1\u7406\u548c\u5bfb\u5740\u6a21\u5f0f\u5982\u4f55\u7ed3\u5408\u7684"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2020/png/333972/1591014400580-39b83aa0-c548-4241-a49e-0d72abda2a95.png#align=left&display=inline&height=715&margin=%5Bobject%20Object%5D&name=image.png&originHeight=715&originWidth=1189&size=131826&status=done&style=none&width=1189",alt:"image.png"}),(0,r.kt)("br",null),"MemberLookup\u5728\u542f\u52a8\u4e4b\u540e\uff0c\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u5bfb\u5740\u6a21\u5f0f\uff0c\u6267\u884c\u5bfb\u5740\u4efb\u52a1\uff0c\u5c06\u6536\u96c6\u5230\u96c6\u7fa4\u8282\u70b9\u5217\u8868\u4fe1\u606f\uff0c\u8c03\u7528memberChange\uff0c\u89e6\u53d1\u96c6\u7fa4\u8282\u70b9\u53d8\u52a8\uff0c\u7136\u540e\u53d1\u5e03\u8282\u70b9\u53d8\u66f4\u4e8b\u4ef6"),(0,r.kt)("a",{name:"idHpC"}),(0,r.kt)("h2",{id:"nacos\u4e00\u81f4\u6027\u534f\u8bae\u534f\u8bae\u5c42\u62bd\u8c61"},"Nacos\u4e00\u81f4\u6027\u534f\u8bae\u534f\u8bae\u5c42\u62bd\u8c61"),(0,r.kt)("p",null,"\u4ecenacos\u7684\u672a\u6765\u7684\u6574\u4f53\u67b6\u6784\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c\u4e00\u81f4\u6027\u534f\u8bae\u5c42\u5c06\u662f\u4f5c\u4e3anacos\u7684\u6700\u4e3a\u6838\u5fc3\u7684\u6a21\u5757\uff0c\u5c06\u670d\u52a1\u4e8e\u6784\u5efa\u5728core\u6a21\u5757\u4e4b\u4e0a\u7684\u5404\u4e2a\u529f\u80fd\u6a21\u5757\uff0c\u6216\u8005\u670d\u52a1\u4e0ecore\u6a21\u5757\u672c\u8eab\u3002\u800c\u4e00\u81f4\u6027\u534f\u8bae\u56e0\u4e3a\u5206\u533a\u5bb9\u9519\u6027\u7684\u5b58\u5728\uff0c\u9700\u8981\u5728\u53ef\u7528\u6027\u4e0e\u4e00\u81f4\u6027\u4e4b\u95f4\u505a\u9009\u62e9\uff0c\u56e0\u6b64\u5c31\u5b58\u5728\u4e24\u5927\u7c7b\u4e00\u81f4\u6027\uff1a\u6700\u7ec8\u4e00\u81f4\u6027\u548c\u5f3a\u4e00\u81f4\u6027\u3002\u5728nacos\u4e2d\uff0c\u8fd9\u4e24\u7c7b\u4e00\u81f4\u6027\u534f\u8bae\u90fd\u662f\u53ef\u80fd\u7528\u5230\u7684\uff0c\u6bd4\u5982naming\u6a21\u5757\uff0c\u5bf9\u4e8e\u670d\u52a1\u5b9e\u4f8b\u7684\u6570\u636e\u7ba1\u7406\u5206\u522b\u7528\u5230\u4e86AP\u4ee5\u53caCP\uff0c\u800c\u5bf9\u4e8econfig\u6a21\u5757\uff0c\u5c06\u4f1a\u6d89\u53ca\u4f7f\u7528CP\u3002\u540c\u65f6\u8fd8\u6709\u5982\u4e0b\u51e0\u4e2a\u529f\u80fd\u9700\u6c42\u70b9"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u76ee\u524d\u6301\u4e45\u5316\u670d\u52a1\u4f7f\u7528\u7528\u4e86\u53d8\u79cd\u7248\u672c\u7684raft\uff0c\u5e76\u4e14\u4e1a\u52a1\u548craft\u534f\u8bae\u8026\u5408\uff0c\u56e0\u6b64\u9700\u8981\u62bd\u79bb\u89e3\u8026\uff0c\u540c\u65f6\u662f\u9009\u62e9\u4e00\u4e2a\u6807\u51c6\u7684Java\u7248Raft\u5b9e\u73b0"),(0,r.kt)("li",{parentName:"ol"},"\u5bf9\u4e8e\u4e2d\u5c0f\u7528\u6237\uff0c\u914d\u7f6e\u57fa\u672c\u5176\u5b9e\u4e0d\u4f1a\u8d85\u7ea7\u591a\uff0c\u72ec\u7acb\u4e00\u4e2amysql\uff0c\u76f8\u5bf9\u91cd\u4e00\u4e9b\uff0c\u9700\u8981\u4e00\u4e2a\u8f7b\u91cf\u5316\u7684\u5b58\u50a8\u65b9\u6848\uff0c\u5e76\u4e14\u652f\u63012.0\u4e0d\u4f9d\u8d56mysql\u548c3.0\u4f9d\u8d56mysql\u53ef\u914d\u7f6e\u80fd\u529b"),(0,r.kt)("li",{parentName:"ol"},"\u7531\u4e8eCP\u6216\u8005AP\uff0c\u5176\u5b58\u5728\u591a\u79cd\u5b9e\u73b0\uff0c\u5982\u4f55\u5bf9\u4e00\u81f4\u6027\u534f\u8bae\u5c42\u505a\u4e00\u6b21\u5f88\u597d\u7684\u62bd\u8c61\uff0c\u4ee5\u4fbf\u5c06\u6765\u53ef\u4ee5\u5feb\u901f\u7684\u5b9e\u73b0\u5e95\u5c42\u4e00\u81f4\u6027\u534f\u8bae\u5177\u4f53\u5b9e\u73b0\u7684\u66ff\u6362\uff0c\u6bd4\u5982Raft\u534f\u8bae\uff0c\u76ee\u524dnacos\u7684\u9009\u578b\u662fJRaft\uff0c\u4e0d\u6392\u9664\u5c06\u6765nacos\u4f1a\u81ea\u5df1\u5b9e\u73b0\u4e00\u4e2a\u6807\u51c6raft\u534f\u8bae\u6216\u8005\u5b9e\u73b0Paxos\u534f\u8bae"),(0,r.kt)("li",{parentName:"ol"},"\u7531\u4e8eNacos\u5b58\u5728\u591a\u4e2a\u72ec\u7acb\u5de5\u4f5c\u7684\u529f\u80fd\u6a21\u5757\uff0c\u6bcf\u4e2a\u529f\u80fd\u6a21\u5757\u4e4b\u95f4\u4e0d\u80fd\u51fa\u73b0\u5f71\u54cd\uff0c\u6bd4\u5982A\u6a21\u5757\u5904\u7406\u8bf7\u6c42\u8fc7\u6162\u6216\u8005\u51fa\u73b0\u5f02\u5e38\u65f6\uff0c\u4e0d\u80fd\u5f71\u54cdB\u6a21\u5757\u7684\u6b63\u5e38\u5de5\u4f5c\uff0c\u5373\u6bcf\u4e2a\u529f\u80fd\u6a21\u5757\u5728\u4f7f\u7528\u4e00\u81f4\u6027\u534f\u8bae\u65f6\uff0c\u5982\u4f55\u5c06\u6bcf\u4e2a\u6a21\u5757\u7684\u6570\u636e\u5904\u7406\u8fdb\u884c\u9694\u79bb\uff1f")),(0,r.kt)("p",null,"\u6839\u636e\u4e00\u81f4\u534f\u8bae\u4ee5\u53ca\u4e0a\u8ff0\u529f\u80fd\u9700\u6c42\u70b9\uff0c\u672c\u6b21\u505a\u4e86\u4e00\u4e2a\u62bd\u8c61\u7684\u4e00\u81f4\u534f\u8bae\u5c42\u4ee5\u53ca\u76f8\u5173\u7684\u63a5\u53e3"),(0,r.kt)("a",{name:"3w8xM"}),(0,r.kt)("h3",{id:"\u4e00\u81f4\u534f\u8bae\u62bd\u8c61"},"\u4e00\u81f4\u534f\u8bae\u62bd\u8c61"),(0,r.kt)("a",{name:"p7zRo"}),(0,r.kt)("h4",{id:"consistencyprotocol"},"ConsistencyProtocol"),(0,r.kt)("p",null,"\u6240\u8c13\u4e00\u81f4\u6027\uff0c\u5373\u591a\u4e2a\u526f\u672c\u4e4b\u95f4\u662f\u5426\u80fd\u591f\u4fdd\u6301\u4e00\u81f4\u6027\u7684\u7279\u6027\uff0c\u800c\u526f\u672c\u7684\u672c\u8d28\u5c31\u662f\u6570\u636e\uff0c\u5bf9\u6570\u636e\u7684\u64cd\u4f5c\uff0c\u4e0d\u662f\u83b7\u53d6\u5c31\u662f\u4fee\u6539\u3002\u540c\u65f6\uff0c\u4e00\u81f4\u534f\u8bae\u5176\u5b9e\u662f\u9488\u5bf9\u5206\u5e03\u5f0f\u60c5\u51b5\u7684\uff0c\u800c\u8fd9\u5fc5\u7136\u6d89\u53ca\u591a\u4e2a\u8282\u70b9\uff0c\u56e0\u6b64\uff0c\u9700\u8981\u6709\u76f8\u5e94\u7684\u63a5\u53e3\u80fd\u591f\u8c03\u6574\u4e00\u81f4\u6027\u534f\u8bae\u7684\u534f\u540c\u5de5\u4f5c\u8282\u70b9\u3002\u5982\u679c\u6211\u4eec\u8981\u89c2\u5bdf\u4e00\u81f4\u6027\u534f\u8bae\u8fd0\u884c\u7684\u60c5\u51b5\uff0c\u8be5\u600e\u4e48\u529e\uff1f\u6bd4\u5982Raft\u534f\u8bae\uff0c\u6211\u4eec\u5e0c\u671b\u5f97\u77e5\u5f53\u524d\u96c6\u7fa4\u4e2d\u7684Leader\u662f\u8c01\uff0c\u4efb\u671f\u7684\u60c5\u51b5\uff0c\u5f53\u524d\u96c6\u7fa4\u4e2d\u7684\u6210\u5458\u8282\u70b9\u6709\u8c01\uff1f\u56e0\u6b64\uff0c\u8fd8\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u4e00\u81f4\u6027\u534f\u8bae\u5143\u6570\u636e\u83b7\u53d6\u3002",(0,r.kt)("br",null),"\u7efc\u4e0a\u6240\u8ff0\uff0cConsistencyProtcol\u7684\u5927\u81f4\u8bbe\u8ba1\u53ef\u4ee5\u51fa\u6765\u4e86"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public interface ConsistencyProtocol<T extends Config, P extends LogProcessor> extends CommandOperations {\n\n    /**\n     * Consistency protocol initialization: perform initialization operations based on the incoming Config\n     * \u4e00\u81f4\u6027\u534f\u8bae\u521d\u59cb\u5316\uff0c\u6839\u636e Config \u5b9e\u73b0\u7c7b\n     *\n     * @param config {@link Config}\n     */\n    void init(T config);\n\n    /**\n     * Add a log handler\n     *\n     * @param processors {@link LogProcessor}\n     */\n    void addLogProcessors(Collection<P> processors);\n\n    /**\n     * Copy of metadata information for this consensus protocol\n     * \u8be5\u4e00\u81f4\u6027\u534f\u8bae\u7684\u5143\u6570\u636e\u4fe1\u606f\n     *\n     * @return metaData {@link ProtocolMetaData}\n     */\n    ProtocolMetaData protocolMetaData();\n\n    /**\n     * Obtain data according to the request\n     *\n     * @param request request\n     * @return data {@link Response}\n     * @throws Exception\n     */\n    Response getData(GetRequest request) throws Exception;\n\n    /**\n     * Get data asynchronously\n     *\n     * @param request request\n     * @return data {@link CompletableFuture<Response>}\n     */\n    CompletableFuture<Response> aGetData(GetRequest request);\n\n    /**\n     * Data operation, returning submission results synchronously\n     * \u540c\u6b65\u6570\u636e\u63d0\u4ea4\uff0c\u5728 Datum \u4e2d\u5df2\u643a\u5e26\u76f8\u5e94\u7684\u6570\u636e\u64cd\u4f5c\u4fe1\u606f\n     *\n     * @param data {@link Log}\n     * @return submit operation result {@link Response}\n     * @throws Exception\n     */\n    Response submit(Log data) throws Exception;\n\n    /**\n     * Data submission operation, returning submission results asynchronously\n     * \u5f02\u6b65\u6570\u636e\u63d0\u4ea4\uff0c\u5728 Datum \u4e2d\u5df2\u643a\u5e26\u76f8\u5e94\u7684\u6570\u636e\u64cd\u4f5c\u4fe1\u606f\uff0c\u8fd4\u56de\u4e00\u4e2aFuture\uff0c\u81ea\u884c\u64cd\u4f5c\uff0c\u63d0\u4ea4\u53d1\u751f\u7684\u5f02\u5e38\u4f1a\u5728CompleteFuture\u4e2d\n     *\n     * @param data {@link Log}\n     * @return {@link CompletableFuture<Response>} submit result\n     * @throws Exception when submit throw Exception\n     */\n    CompletableFuture<Response> submitAsync(Log data);\n\n    /**\n     * New member list\n     * \u65b0\u7684\u6210\u5458\u8282\u70b9\u5217\u8868\uff0c\u4e00\u81f4\u6027\u534f\u8bae\u81ea\u884c\u5904\u7406\u76f8\u5e94\u7684\u6210\u5458\u8282\u70b9\u662f\u52a0\u5165\u8fd8\u662f\u79bb\u5f00\n     *\n     * @param addresses [ip:port, ip:port, ...]\n     */\n    void memberChange(Set<String> addresses);\n\n    /**\n     * Consistency agreement service shut down\n     * \u4e00\u81f4\u6027\u534f\u8bae\u670d\u52a1\u5173\u95ed\n     */\n    void shutdown();\n\n}\n")),(0,r.kt)("p",null,"\u800c\u9488\u5bf9CP\u534f\u8bae\uff0c\u7531\u4e8e\u5b58\u5728Leader\u7684\u6982\u5ff5\uff0c\u56e0\u6b64\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u65b9\u6cd5\u7528\u4e8e\u83b7\u53d6CP\u534f\u8bae\u5f53\u524d\u7684Leader\u662f\u8c01"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public interface CPProtocol<C extends Config> extends ConsistencyProtocol<C> {\n\n    /**\n     * Returns whether this node is a leader node\n     *\n     * @param group business module info\n     * @return is leader\n     * @throws Exception\n     */\n    boolean isLeader(String group) throws Exception;\n\n}\n")),(0,r.kt)("a",{name:"oJFpB"}),(0,r.kt)("h4",{id:"\u6570\u636e\u64cd\u4f5c\u8bf7\u6c42\u63d0\u4ea4\u5bf9\u8c61loggetrequest"},"\u6570\u636e\u64cd\u4f5c\u8bf7\u6c42\u63d0\u4ea4\u5bf9\u8c61\uff1aLog\u3001GetRequest"),(0,r.kt)("p",null,"\u4e0a\u9762\u8bf4\u5230\uff0c\u4e00\u81f4\u6027\u534f\u8bae\u5176\u5b9e\u662f\u5bf9\u4e8e\u6570\u636e\u64cd\u4f5c\u800c\u8a00\u7684\uff0c\u6570\u636e\u64cd\u4f5c\u57fa\u672c\u5206\u4e3a\u4e24\u5927\u7c7b\uff1a\u6570\u636e\u67e5\u8be2\u4ee5\u53ca\u6570\u636e\u4fee\u6539\uff0c\u540c\u65f6\u8fd8\u8981\u6ee1\u8db3\u4e0d\u540c\u529f\u80fd\u6a21\u5757\u4e4b\u95f4\u7684\u6570\u636e\u8fdb\u884c\u9694\u79bb\u3002\u56e0\u6b64\u8fd9\u91cc\u9488\u5bf9\u6570\u636e\u4fee\u6539\u64cd\u4f5c\u4ee5\u53ca\u6570\u636e\u67e5\u8be2\u64cd\u4f5c\u5206\u522b\u9610\u8ff0\u3002"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u6570\u636e\u4fee\u6539",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"\u6570\u636e\u4fee\u6539\u64cd\u4f5c\uff0c\u4e00\u5b9a\u8981\u77e5\u9053\u672c\u6b21\u8bf7\u6c42\u662f\u5c5e\u4e8e\u54ea\u4e00\u4e2a\u529f\u80fd\u6a21\u5757\u7684"),(0,r.kt)("li",{parentName:"ol"},"\u6570\u636e\u4fee\u6539\u64cd\u4f5c\uff0c\u9996\u5148\u4e00\u5b9a\u8981\u77e5\u9053\u8fd9\u4e2a\u6570\u636e\u7684\u4fee\u6539\u64cd\u4f5c\u5177\u4f53\u662f\u54ea\u4e00\u79cd\u4fee\u6539\u64cd\u4f5c\uff0c\u65b9\u4fbf\u529f\u80fd\u6a21\u5757\u9488\u5bf9\u771f\u6b63\u7684\u6570\u636e\u4fee\u6539\u64cd\u4f5c\u8fdb\u884c\u76f8\u5e94\u7684\u903b\u8f91\u64cd\u4f5c"),(0,r.kt)("li",{parentName:"ol"},"\u6570\u636e\u4fee\u6539\u64cd\u4f5c\uff0c\u4e00\u5b9a\u8981\u77e5\u9053\u4fee\u6539\u7684\u6570\u636e\u662f\u4ec0\u4e48\uff0c\u5373\u8bf7\u6c42\u4f53\uff0c\u4e3a\u4e86\u4f7f\u5f97\u4e00\u81f4\u6027\u534f\u8bae\u5c42\u66f4\u4e3a\u901a\u7528\uff0c\u8fd9\u91cc\u5bf9\u4e8e\u8bf7\u6c42\u4f53\u7684\u6570\u636e\u7ed3\u6784\uff0c\u9009\u62e9\u4e86byte[]\u6570\u7ec4"),(0,r.kt)("li",{parentName:"ol"},"\u6570\u636e\u7684\u7c7b\u578b\uff0c\u7531\u4e8e\u6211\u4eec\u5c06\u771f\u6b63\u7684\u6570\u636e\u5e8f\u5217\u5316\u4e3a\u4e86byte[]\u6570\u7ec4\uff0c\u4e3a\u4e86\u80fd\u591f\u6b63\u5e38\u5e8f\u5217\u5316\uff0c\u6211\u4eec\u53ef\u80fd\u8fd8\u9700\u8981\u8bb0\u5f55\u8fd9\u4e2a\u6570\u636e\u7684\u7c7b\u578b\u662f\u4ec0\u4e48"),(0,r.kt)("li",{parentName:"ol"},"\u672c\u6b21\u8bf7\u6c42\u7684\u4fe1\u606f\u6458\u8981\u6216\u8005\u6807\u8bc6\u4fe1\u606f"),(0,r.kt)("li",{parentName:"ol"},"\u672c\u6b21\u8bf7\u6c42\u7684\u989d\u5916\u4fe1\u606f\uff0c\u7528\u4e8e\u5c06\u6765\u6269\u5c55\u9700\u8981\u4f20\u8f93\u7684\u6570\u636e")))),(0,r.kt)("p",null,"\u7efc\u4e0a\uff0c\u53ef\u4ee5\u5f97\u51faLog\u5bf9\u8c61\u7684\u8bbe\u8ba1\u5982\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-protobuf"},"message Log {\n    // \u529f\u80fd\u6a21\u5757\u5206\u7ec4\u4fe1\u606f\n    string group = 1;\n    // \u6458\u8981\u6216\u8005\u6807\u8bc6\n    string key = 2;\n    // \u5177\u4f53\u8bf7\u6c42\u6570\u636e\n    bytes data = 3;\n    // \u6570\u636e\u7c7b\u578b\n    string type = 4;\n    // \u66f4\u4e3a\u5177\u4f53\u7684\u6570\u636e\u64cd\u4f5c\n    string operation = 5;\n    // \u989d\u5916\u4fe1\u606f\n    map<string, string> extendInfo = 6;\n}\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u6570\u636e\u67e5\u8be2",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"\u6570\u636e\u67e5\u8be2\u64cd\u4f5c\uff0c\u4e00\u5b9a\u8981\u77e5\u9053\u672c\u6b21\u8bf7\u6c42\u662f\u7531\u54ea\u4e00\u4e2a\u529f\u80fd\u6a21\u5757\u53d1\u8d77\u7684"),(0,r.kt)("li",{parentName:"ol"},"\u6570\u636e\u67e5\u8be2\u7684\u6761\u4ef6\u662f\u4ec0\u4e48\uff0c\u4e3a\u4e86\u517c\u5bb9\u5404\u79cd\u5b58\u50a8\u7ed3\u6784\u7684\u6570\u636e\u67e5\u8be2\u64cd\u4f5c\uff0c\u8fd9\u91cc\u7528byte[]\u8fdb\u884c\u5b58\u50a8"),(0,r.kt)("li",{parentName:"ol"},"\u672c\u6b21\u8bf7\u6c42\u7684\u989d\u5916\u4fe1\u606f\uff0c\u7528\u4e8e\u5c06\u6765\u6269\u5c55\u9700\u8981\u4f20\u8f93\u7684\u6570\u636e")))),(0,r.kt)("p",null,"\u7efc\u4e0a\uff0c\u53ef\u4ee5\u5f97\u51faGetRequest\u5bf9\u8c61\u7684\u8bbe\u8ba1\u5982\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-protobuf"},"message GetRequest {\n    // \u529f\u80fd\u6a21\u5757\u5206\u7ec4\u4fe1\u606f\n    string group = 1;\n    // \u5177\u4f53\u8bf7\u6c42\u6570\u636e\n    bytes data = 2;\n    // \u989d\u5916\u4fe1\u606f\n    map<string, string> extendInfo = 3;\n}\n")),(0,r.kt)("a",{name:"vBig4"}),(0,r.kt)("h4",{id:"\u529f\u80fd\u6a21\u5757\u4f7f\u7528\u4e00\u81f4\u6027\u534f\u8baelogprocessor"},"\u529f\u80fd\u6a21\u5757\u4f7f\u7528\u4e00\u81f4\u6027\u534f\u8bae\uff1aLogProcessor"),(0,r.kt)("p",null,"\u5f53\u6570\u636e\u64cd\u4f5c\u901a\u8fc7\u4e00\u81f4\u6027\u534f\u8bae\u8fdb\u884csubmit\u4e4b\u540e\uff0c\u6bcf\u4e2a\u8282\u70b9\u9700\u8981\u53bb\u5904\u7406\u8fd9\u4e2aLog\u6216\u8005GetRequest\u5bf9\u8c61\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u62bd\u8c61\u51fa\u4e00\u4e2aLog\u3001GetRequest\u5bf9\u8c61\u7684Processor\uff0c\u4e0d\u540c\u7684\u529f\u80fd\u6a21\u5757\u901a\u8fc7\u5b9e\u73b0\u8be5\u5904\u7406\u5668\uff0cConsistencyProtocol\u5185\u90e8\u4f1a\u6839\u636eLog\u3001GetRequest\u7684group\u5c5e\u6027\uff0c\u5c06Log\u3001GetRequest\u5bf9\u8c61\u8def\u7531\u5230\u5177\u4f53\u7684Processor\uff0c\u5f53\u7136\uff0cProcessor\u4e5f\u9700\u8981\u8868\u660e\u81ea\u5df1\u662f\u5c5e\u4e8e\u54ea\u4e00\u4e2a\u529f\u80fd\u6a21\u5757\u7684\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public abstract class LogProcessor {\n\n    /**\n     * get data by key\n     *\n     * @param request request {@link GetRequest}\n     * @return target type data\n     */\n    public abstract Response onRequest(GetRequest request);\n\n    /**\n     * Process Submitted Log\n     *\n     * @param log {@link Log}\n     * @return {@link boolean}\n     */\n    public abstract Response onApply(Log log);\n\n    /**\n     * Irremediable errors that need to trigger business price cuts\n     *\n     * @param error {@link Throwable}\n     */\n    public void onError(Throwable error) {\n    }\n\n    /**\n     * In order for the state machine that handles the transaction to be able to route\n     * the Log to the correct LogProcessor, the LogProcessor needs to have an identity\n     * information\n     *\n     * @return Business unique identification name\n     */\n    public abstract String group();\n\n}\n")),(0,r.kt)("p",null,"\u9488\u5bf9CP\u534f\u8bae\uff0c\u6bd4\u5982Raft\u534f\u8bae\uff0c\u5b58\u5728\u5feb\u7167\u7684\u8bbe\u8ba1\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u9488\u5bf9CP\u534f\u8bae\u5355\u72ec\u6269\u5c55\u51fa\u4e00\u4e2a\u65b9\u6cd5"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public abstract class LogProcessor4CP extends LogProcessor {\n\n    /**\n     * Discovery snapshot handler\n     * It is up to LogProcessor to decide which SnapshotOperate should be loaded and saved by itself\n     *\n     * @return {@link List <SnapshotOperate>}\n     */\n    public List<SnapshotOperation> loadSnapshotOperate() {\n        return Collections.emptyList();\n    }\n\n}\n")),(0,r.kt)("a",{name:"zbsAE"}),(0,r.kt)("h4",{id:"\u7efc\u8ff0"},"\u7efc\u8ff0"),(0,r.kt)("p",null,"\u4ece\u4e0a\u9762\u8fd9\u51e0\u70b9\u53ef\u4ee5\u770b\u51fa\u6765\uff0cConsistencyProtocol\u662f\u5bf9\u4e0a\u5c42\u529f\u80fd\u6a21\u5757\u66b4\u9732\u51fa\u6765\u7684\u4f7f\u7528\u63a5\u53e3\uff0c\u6bcf\u4e2aConsistencyProtocol\u540e\u9762\u6709\u5177\u4f53\u7684\u4e00\u81f4\u6027\u534f\u8bae\u5b9e\u73b0\u7684Backend\uff0c\u7531\u4e8eBackend\u65e0\u6cd5\u5f88\u597d\u7684\u517c\u5bb9nacos\u73b0\u6709\u7684\u67b6\u6784\u8bbe\u8ba1\uff0c\u56e0\u6b64\u989d\u5916\u8bbe\u8ba1\u7684LogProcessor\u5c31\u662f\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002",(0,r.kt)("br",null),(0,r.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2020/png/333972/1591015048030-8a4bff4a-20ed-46dd-a7f7-98655b22946f.png#align=left&display=inline&height=591&margin=%5Bobject%20Object%5D&name=image.png&originHeight=591&originWidth=886&size=93327&status=done&style=none&width=886",alt:"image.png"}),(0,r.kt)("br",null),"\u540c\u65f6\uff0c\u7531\u4e8e\u5728\u4e00\u81f4\u6027\u534f\u8bae\u5c42\u5185\u90e8\u7684Backend\u4e2d\u9700\u8981\u5b9e\u73b0\u5bf9\u4e0d\u540c\u4e1a\u52a1\u6a21\u5757\u7684\u6570\u636e\u8fdb\u884c\u9694\u79bb\u5904\u7406\uff0c\u800c\u8fd9\u4e2a\u4e00\u5757\u903b\u8f91\u7531\u8bf7\u6c42\u5bf9\u8c61\u548cLogProcessor\u7684group\u5c5e\u6027\u6765\u5b9e\u73b0",(0,r.kt)("br",null),(0,r.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2020/png/333972/1591015155835-a897262e-8e57-409c-bf94-d57bf765c80b.png#align=left&display=inline&height=591&margin=%5Bobject%20Object%5D&name=image.png&originHeight=591&originWidth=910&size=118083&status=done&style=none&width=910",alt:"image.png"})),(0,r.kt)("a",{name:"C1yU6"}),(0,r.kt)("h3",{id:"\u4e00\u81f4\u6027\u534f\u8bae\u5c42\u5de5\u4f5c\u6d41\u7a0b"},"\u4e00\u81f4\u6027\u534f\u8bae\u5c42\u5de5\u4f5c\u6d41\u7a0b"),(0,r.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u65f6\u5e8f\u56fe\u770b\u770b\uff0c\u4e00\u81f4\u6027\u534f\u8bae\u5c42\u7684\u5927\u81f4\u5de5\u4f5c\u6d41\u7a0b\n",(0,r.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/__puml/30b7e270e7aef8bb63136aaffbe5bfbf.svg#lake_card_v2=eyJjb2RlIjoiQHN0YXJ0dW1sXG5cbnBhcnRpY2lwYW50IFwiTWVtYmVyTWFuYWdlclwiIGFzIE5hY29zQ2x1c3RlclxucGFydGljaXBhbnQgXCJCdXNpbmVzc01vZHVsZVwiIGFzIEJpelxucGFydGljaXBhbnQgXCJDb25zaXN0ZW5jeVByb3RvY29sXCIgYXMgUHJvdG9jb2xcbnBhcnRpY2lwYW50IFwiQ0FQQmFja2VuZFwiIGFzIEJhY2tlbmRcbnBhcnRpY2lwYW50IFwiQ29uZmlnXCIgYXMgQ29uZmlnXG5wYXJ0aWNpcGFudCBcIkxvZ1Byb2Nlc3NvclwiIGFzIFByb2Nlc3NvclxucGFydGljaXBhbnQgXCJMb2dcIiBhcyBMb2dcblxuYWN0aXZhdGUgTmFjb3NDbHVzdGVyXG5OYWNvc0NsdXN0ZXIgLT4gTmFjb3NDbHVzdGVyOiBpbml0KCkg5Yid5aeL5YyWTmFjb3Ppm4bnvqRcblxuTmFjb3NDbHVzdGVyIC0-IENvbmZpZzog6I635Y-WQ29uZmln5a-56LGhXG5hY3RpdmF0ZSBDb25maWdcbkNvbmZpZyAtPiBDb25maWc6IOaUtumbhkxvZ1Byb2Nlc3NvcueahOS_oeaBr1xuQ29uZmlnIC0-IE5hY29zQ2x1c3RlclxuZGVhY3RpdmF0ZSBDb25maWdcblxuXG5OYWNvc0NsdXN0ZXIgLT4gUHJvdG9jb2w6IOiOt-WPluaJgOaciUNvbnNpc3RlbmN5UHJvdG9jb2zlrp7njrBcbmFjdGl2YXRlIFByb3RvY29sXG5cbk5hY29zQ2x1c3RlciAtPiBQcm90b2NvbDogaW5pdChDb25maWcpIOaWueazleaJp-ihjFxuXG5kZWFjdGl2YXRlIFByb3RvY29sXG5kZWFjdGl2YXRlIE5hY29zQ2x1c3RlclxuXG5cbkJpeiAtPiBMb2c6IOWIm-W7uuS4gOS4quS6i-WKoeWvueixoVxuYWN0aXZhdGUgQml6XG5hY3RpdmF0ZSBMb2dcblxuXG5Mb2cgLT4gTG9nOiDorr7nva5kYXRhXG5Mb2cgLT4gTG9nOiDorr7nva5rZXlcbkxvZyAtPiBMb2c6IOiuvue9rmNsYXNzTmFtZVxuTG9nIC0-IExvZzog6K6-572uZXh0ZW5kSW5mb1xuTG9nIC0-IEJpelxuZGVhY3RpdmF0ZSBMb2dcblxuQml6IC0-IFByb3RvY29sOiBzdWJtaXQoTG9nKSDosIPnlKjkuIDoh7TmgKfljY_orq7ov5vooYzkuovliqHmj5DkuqRcbmFjdGl2YXRlIFByb3RvY29sXG5cblByb3RvY29sIC0-IEJhY2tlbmQ6IOWGhemDqOS4gOiHtOaAp-WNj-iuruW3peS9nFxuYWN0aXZhdGUgQmFja2VuZFxuXG5CYWNrZW5kIC0-IFByb3RvY29sOiDov5Tlm57lt6XkvZzlpITnkIbnu5PmnpxcbmRlYWN0aXZhdGUgQmFja2VuZFxuXG5Qcm90b2NvbCAtPiBQcm9jZXNzb3I6IOWwhkxvZ-WIhuWPkeWIsOWvueW6lOeahFByb2Nlc3Nvcu-8jOiwg-eUqCBvbkFwcGx5IOaWueazlVxuYWN0aXZhdGUgUHJvdG9jb2xcbmRlYWN0aXZhdGUgUHJvdG9jb2xcblxuUHJvY2Vzc29yIC0-IEJpejog5LqL5Yqh5o-Q5Lqk57uT5p6cXG5cbmRlYWN0aXZhdGUgUHJvY2Vzc29yXG5kZWFjdGl2YXRlIEJpelxuXG5AZW5kdW1sIiwidHlwZSI6InB1bWwiLCJtYXJnaW4iOnRydWUsImlkIjoiNFZpMkwiLCJ1cmwiOiJodHRwczovL2Nkbi5ubGFyay5jb20veXVxdWUvX19wdW1sLzMwYjdlMjcwZTdhZWY4YmI2MzEzNmFhZmZiZTViZmJmLnN2ZyIsImNhcmQiOiJkaWFncmFtIn0=",alt:null})),(0,r.kt)("a",{name:"xtBNU"}),(0,r.kt)("h3",{id:"nacos\u4e00\u81f4\u6027\u534f\u8bae\u5c42\u4e4bcp\u534f\u8bae\u7684\u5b9e\u73b0\u9009\u62e9jraft"},"Nacos\u4e00\u81f4\u6027\u534f\u8bae\u5c42\u4e4bCP\u534f\u8bae\u7684\u5b9e\u73b0\u9009\u62e9\u2014\u2014JRaft"),(0,r.kt)("p",null,"\u4e00\u81f4\u6027\u534f\u8bae\u5c42\u62bd\u8c61\u597d\u4e4b\u540e\uff0c\u5269\u4e0b\u5c31\u662f\u5177\u4f53\u4e00\u81f4\u6027\u534f\u8bae\u5b9e\u73b0\u7684\u9009\u62e9\u4e86\uff0c\u8fd9\u91cc\u6211\u4eec\u9009\u62e9\u4e86\u8682\u8681\u91d1\u670d\u5f00\u6e90\u7684JRaft\uff0c\u90a3\u4e48\u6211\u4eec\u5982\u4f55\u5c06JRaft\u4f5c\u4e3aCP\u534f\u8bae\u7684\u4e00\u4e2aBackend\u5462\uff1f\u4e0b\u9762\u7684\u7b80\u5355\u6d41\u7a0b\u56fe\u63cf\u8ff0\u4e86\u5f53JRaft\u4f5c\u4e3aCP\u534f\u8bae\u7684\u4e00\u4e2aBackend\u65f6\u7684\u521d\u59cb\u5316\u6d41\u7a0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'/**\n * A concrete implementation of CP protocol: JRaft\n *\n * <pre>\n *                                           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \n *                                           \u2502                      \u2502               \n *            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502                      \u25bc               \n *            \u2502   ProtocolManager    \u2502       \u2502        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \n *            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502        \u2502for p in [LogProcessor4CP] \u2502 \n *                        \u2502                  \u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \n *                        \u25bc                  \u2502                      \u2502               \n *      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502                      \u25bc               \n *      \u2502    discovery LogProcessor4CP     \u2502 \u2502             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \n *      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502             \u2502  get p.group()  \u2502      \n *                        \u2502                  \u2502             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \n *                        \u25bc                  \u2502                      \u2502               \n *                 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502                      \u2502               \n *                 \u2502 RaftConfig  \u2502           \u2502                      \u25bc               \n *                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n *                        \u2502                  \u2502      \u2502  create raft group service   \u2502\n *                        \u25bc                  \u2502      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n *              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502                                      \n *              \u2502  JRaftProtocol   \u2502         \u2502                                      \n *              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502                                      \n *                        \u2502                  \u2502                                      \n *                     init()                \u2502                                      \n *                        \u2502                  \u2502                                      \n *                        \u25bc                  \u2502                                      \n *               \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502                                      \n *               \u2502   JRaftServer   \u2502         \u2502                                      \n *               \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502                                      \n *                        \u2502                  \u2502                                      \n *                        \u2502                  \u2502                                      \n *                        \u25bc                  \u2502                                      \n *             \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502                                      \n *             \u2502JRaftServer.start() \u2502        \u2502                                      \n *             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502                                      \n *                        \u2502                  \u2502                                      \n *                        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                      \n * </pre>\n * \n * @author <a href="mailto:liaochuntao@live.com">liaochuntao</a>\n */\n')),(0,r.kt)("p",null,"JRaftProtocol\u662f\u5f53JRaft\u4f5c\u4e3aCP\u534f\u8bae\u7684Backend\u65f6\u7684\u4e00\u4e2aConsistencyProtocol\u7684\u5177\u4f53\u5b9e\u73b0\uff0c\u5176\u5185\u90e8\u6709\u4e00\u4e2aJRaftServer\u6210\u5458\u5c5e\u6027\uff0cJRaftServer\u5206\u88c5\u4e86JRaft\u7684\u5404\u79cdAPI\u64cd\u4f5c\uff0c\u6bd4\u5982\u6570\u636e\u64cd\u4f5c\u7684\u63d0\u4ea4\uff0c\u6570\u636e\u7684\u67e5\u8be2\uff0c\u6210\u5458\u8282\u70b9\u7684\u53d8\u66f4\uff0cLeader\u8282\u70b9\u7684\u67e5\u8be2\u7b49\u7b49\u3002"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},(0,r.kt)("strong",{parentName:"em"},"\u6ce8\u610f\u4e8b\u9879\uff1aJRaft\u8fd0\u884c\u671f\u95f4\u4ea7\u751f\u7684\u6570\u636e\u5728${nacos.home}/data/protocol/raft\u6587\u4ef6\u76ee\u5f55\u4e0b\u3002\u4e0d\u540c\u7684\u4e1a\u52a1\u6a21\u5757\u6709\u4e0d\u540c\u7684\u6587\u4ef6\u5206\u7ec4\uff0c\u5982\u679c\u5f53\u8282\u70b9\u51fa\u73b0crash\u6216\u8005\u5f02\u5e38\u5173\u95ed\u65f6\uff0c\u6e05\u7a7a\u8be5\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff0c\u91cd\u542f\u8282\u70b9\u5373\u53ef"))),(0,r.kt)("p",null,"\u7531\u4e8eJRaft\u5b9e\u73b0\u4e86raft group\u7684\u6982\u5ff5\uff0c\u56e0\u6b64\uff0c\u5b8c\u5168\u53ef\u4ee5\u5229\u7528raft group\u7684\u8bbe\u8ba1\uff0c\u4e3a\u6bcf\u4e2a\u529f\u80fd\u6a21\u5757\u5355\u72ec\u521b\u5efa\u4e00\u4e2araft group\u3002\u8fd9\u91cc\u7ed9\u51fa\u90e8\u5206\u4ee3\u7801\uff0c\u8be5\u4ee3\u7801\u4f53\u73b0\u4e86\u5982\u4f55\u5c06LogProcessor\u5d4c\u5165\u5230\u72b6\u6001\u673a\u4e2d\u5e76\u4e3a\u6bcf\u4e2aLogPrcessor\u521b\u5efa\u4e00\u4e2aRaft Group"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'synchronized void createMultiRaftGroup(Collection<LogProcessor4CP> processors) {\n    // There is no reason why the LogProcessor cannot be processed because of the synchronization\n    if (!this.isStarted) {\n        this.processors.addAll(processors);\n        return;\n    }\n\n    final String parentPath = Paths\n                .get(ApplicationUtils.getNacosHome(), "data/protocol/raft").toString();\n\n    for (LogProcessor4CP processor : processors) {\n        final String groupName = processor.group();\n        if (multiRaftGroup.containsKey(groupName)) {\n            throw new DuplicateRaftGroupException(groupName);\n        }\n\n        // Ensure that each Raft Group has its own configuration and NodeOptions\n        Configuration configuration = conf.copy();\n        NodeOptions copy = nodeOptions.copy();\n        JRaftUtils.initDirectory(parentPath, groupName, copy);\n\n        // Here, the LogProcessor is passed into StateMachine, and when the StateMachine\n        // triggers onApply, the onApply of the LogProcessor is actually called\n        NacosStateMachine machine = new NacosStateMachine(this, processor);\n\n        copy.setFsm(machine);\n        copy.setInitialConf(configuration);\n\n        // Set snapshot interval, default 1800 seconds\n        int doSnapshotInterval = ConvertUtils.toInt(raftConfig\n                            .getVal(RaftSysConstants.RAFT_SNAPSHOT_INTERVAL_SECS),\n                    RaftSysConstants.DEFAULT_RAFT_SNAPSHOT_INTERVAL_SECS);\n\n        // If the business module does not implement a snapshot processor, cancel the snapshot\n        doSnapshotInterval = CollectionUtils\n                    .isEmpty(processor.loadSnapshotOperate()) ? 0 : doSnapshotInterval;\n\n        copy.setSnapshotIntervalSecs(doSnapshotInterval);\n        Loggers.RAFT.info("create raft group : {}", groupName);\n        RaftGroupService raftGroupService = new RaftGroupService(groupName,\n                    localPeerId, copy, rpcServer, true);\n\n        // Because RpcServer has been started before, it is not allowed to start again here\n        Node node = raftGroupService.start(false);\n        machine.setNode(node);\n        RouteTable.getInstance().updateConfiguration(groupName, configuration);\n        RaftExecutor.executeByCommon(() -> registerSelfToCluster(groupName, localPeerId, configuration));\n\n        // Turn on the leader auto refresh for this group\n        Random random = new Random();\n        long period = nodeOptions.getElectionTimeoutMs() + random.nextInt(5 * 1000);\n        RaftExecutor.scheduleRaftMemberRefreshJob(() -> refreshRouteTable(groupName),\n                    nodeOptions.getElectionTimeoutMs(), period, TimeUnit.MILLISECONDS);\n        multiRaftGroup.put(groupName,\n                    new RaftGroupTuple(node, processor, raftGroupService, machine));\n    }\n}\n')),(0,r.kt)("a",{name:"4czvB"}),(0,r.kt)("h4",{id:"\u7591\u95ee\u89e3\u7b54\u4e3a\u4ec0\u4e48\u8981\u521b\u5efa\u591a\u4e2araft-group"},"\u7591\u95ee\u89e3\u7b54\uff1a\u4e3a\u4ec0\u4e48\u8981\u521b\u5efa\u591a\u4e2araft group"),(0,r.kt)("p",null,"\u6216\u8bb8\u6709\u7684\u4eba\u4f1a\u6709\u7591\u95ee\uff0c\u65e2\u7136\u4e4b\u524d\u5df2\u7ecf\u8bbe\u8ba1\u51fa\u4e86LogProcessor\uff0c\u5b8c\u5168\u53ef\u4ee5\u5229\u7528\u4e00\u4e2aRaft Group\uff0c\u5728\u72b6\u6001\u673aappl\u65f6\uff0c\u6839\u636eLog\u7684group\u5c5e\u6027\u8fdb\u884c\u8def\u7531\u5230\u4e0d\u540c\u7684LogProcessor\u5373\u53ef\uff0c\u6bcf\u4e2a\u529f\u80fd\u6a21\u5757\u5c31\u521b\u5efa\u4e00\u4e2araft group\uff0c\u4e0d\u662f\u4f1a\u6d88\u8017\u5927\u91cf\u7684\u8d44\u6e90\u5417\uff1f",(0,r.kt)("br",null),"\u6b63\u5982\u4e4b\u524d\u6240\u8bf4\uff0c\u6211\u4eec\u5e0c\u671b\u72ec\u7acb\u5de5\u4f5c\u7684\u6a21\u5757\u4e4b\u95f4\u76f8\u4e92\u4e0d\u5b58\u5728\u5f71\u54cd\uff0c\u6bd4\u5982A\u6a21\u5757\u5904\u7406Log\u56e0\u4e3a\u5b58\u5728Block\u64cd\u4f5c\u53ef\u80fd\u4f7f\u5f97apply\u7684\u901f\u5ea6\u7f13\u6162\uff0c\u4ea6\u6216\u8005\u53ef\u80fd\u4e2d\u9014\u53d1\u751f\u5f02\u5e38\uff0c\u5bf9\u4e8eRaft\u534f\u8bae\u6765\u8bf4\uff0c\u5f53\u65e5\u5fd7apply\u5931\u8d25\u65f6\uff0c\u72b6\u6001\u673a\u5c06\u4e0d\u80fd\u591f\u7ee7\u7eed\u5411\u524d\u63a8\u8fdb\uff0c\u56e0\u4e3a\u5982\u679c\u7ee7\u7eed\u5411\u524d\u63a8\u8fdb\u7684\u8bdd\uff0c\u7531\u4e8e\u4e0a\u4e00\u6b65\u7684apply\u5931\u8d25\uff0c\u540e\u9762\u7684\u6240\u6709apply\u90fd\u53ef\u80fd\u5931\u8d25\uff0c\u5c06\u4f1a\u5bfc\u81f4\u8fd9\u4e2a\u8282\u70b9\u7684\u6570\u636e\u4e0e\u5176\u4ed6\u8282\u70b9\u7684\u6570\u636e\u6c38\u8fdc\u4e0d\u4e00\u81f4\u3002\u5982\u679c\u8bf4\u6211\u4eec\u5c06\u6240\u6709\u72ec\u7acb\u5de5\u4f5c\u7684\u6a21\u5757\uff0c\u5bf9\u4e8e\u6570\u636e\u64cd\u4f5c\u7684\u8bf7\u6c42\u5904\u7406\u653e\u5728\u540c\u4e00\u4e2araft group\uff0c\u5373\u4e00\u4e2a\u72b6\u6001\u673a\u4e2d\uff0c\u5c31\u4e0d\u53ef\u907f\u514d\u7684\u4f1a\u51fa\u73b0\u4e0a\u8ff0\u6240\u8bf4\u7684\u95ee\u9898\uff0c\u67d0\u4e2a\u6a21\u5757\u5728apply\u65e5\u5fd7\u53d1\u751f\u4e0d\u53ef\u63a7\u7684\u56e0\u7d20\u65f6\uff0c\u4f1a\u5f71\u54cd\u5176\u4ed6\u6a21\u5757\u7684\u6b63\u5e38\u5de5\u4f5c\u3002"),(0,r.kt)("a",{name:"2GyRw"}),(0,r.kt)("h3",{id:"jraft\u8fd0\u7ef4\u64cd\u4f5c"},"JRaft\u8fd0\u7ef4\u64cd\u4f5c"),(0,r.kt)("p",null,"\u4e3a\u4e86\u4f7f\u7528\u8005\u80fd\u591f\u5bf9JRaft\u8fdb\u884c\u76f8\u5173\u7b80\u5355\u7684\u8fd0\u7ef4\uff0c\u6bd4\u5982Leader\u7684\u5207\u6362\uff0c\u91cd\u7f6e\u5f53\u524dRaft\u96c6\u7fa4\u6210\u5458\uff0c\u89e6\u53d1\u67d0\u4e2a\u8282\u70b9\u8fdb\u884cSnapshot\u64cd\u4f5c\u7b49\u7b49\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7b80\u5355\u7684HTTP\u63a5\u53e3\u8fdb\u884c\u64cd\u4f5c\uff0c\u5e76\u4e14\u8be5\u63a5\u53e3\u6709\u4e00\u5b9a\u7684\u9650\u5236\uff0c\u5373\u6bcf\u6b21\u53ea\u4f1a\u6267\u884c\u4e00\u6761\u8fd0\u7ef4\u6307\u4ee4"),(0,r.kt)("p",null,"1\u3001\u5207\u6362\u67d0\u4e00\u4e2aRaft Group\u7684Leader\u8282\u70b9"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'POST /nacos/v1/core/ops/raft\n{\n    "groupId": "xxx",\n    "command": "transferLeader"\n    "value": "ip:{raft_port} or ip:{raft_port},ip:{raft_port},ip:{raft_port}"\n}\n')),(0,r.kt)("a",{name:"Fs7VE"}),(0,r.kt)("p",null,"2\u3001\u91cd\u7f6e\u67d0\u4e00\u4e2aRaft Group\u7684\u96c6\u7fa4\u6210\u5458"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'POST /nacos/v1/core/ops/raft\n{\n    "groupId": "xxx",\n    "command": "resetRaftCluster",\n    "value": "ip:{raft_port},ip:{raft_port},ip:{raft_port},ip:{raft_port}"\n}\n')),(0,r.kt)("p",null,"\u6ce8\u610f\uff0c\u8be5\u64cd\u4f5c\u662f\u4e00\u4e2a\u9ad8\u5371\u64cd\u4f5c\uff0c\u4ec5\u4ec5\u5f53Raft\u96c6\u7fa4\u7684 n/2 + 1\u8282\u70b9crash\u4e4b\u540e\u65e0\u6cd5\u6ee1\u8db3\u8fc7\u534a\u6295\u7968\u7684\u8981\u6c42\u624d\u53ef\u4ee5\u4f7f\u7528\u8be5\u8fd0\u7ef4\u547d\u4ee4\uff0c\u7528\u4e8e\u5feb\u901f\u8ba9\u5f53\u524d\u5269\u4f59\u7684\u8282\u70b9\u91cd\u7ec4Raft\u96c6\u7fa4\uff0c\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u4f46\u662f\u8fd9\u4e2a\u64cd\u4f5c\u5f88\u5927\u7a0b\u5ea6\u4f1a\u9020\u6210\u6570\u636e\u7684\u4e22\u5931",(0,r.kt)("br",null)),(0,r.kt)("a",{name:"VfG5T"}),(0,r.kt)("p",null,"3\u3001\u89e6\u53d1\u67d0\u4e00\u4e2aRaft Group\u6267\u884c\u5feb\u7167\u64cd\u4f5c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'POST /nacos/v1/core/ops/raft\n{\n    "groupId": "xxx",\n    "command": "doSnapshot",\n    "value": "ip:{raft_port}"\n}\n')),(0,r.kt)("a",{name:"m9LfI"}),(0,r.kt)("p",null,"4\u3001\u79fb\u9664\u67d0\u4e00\u4e2aRaft Group\u4e2d\u7684\u67d0\u4e00\u6210\u5458"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'POST /nacos/v1/core/ops/raft\n{\n    "groupId": "xxx",\n    "command": "removePeer",\n    "value": "ip:{raft_port}"\n}\n')),(0,r.kt)("a",{name:"ev3MW"}),(0,r.kt)("p",null,"5\u3001\u6279\u91cf\u79fb\u9664\u67d0\u4e00\u4e2aRaft Group\u4e2d\u7684\u591a\u4e2a\u6210\u5458"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'POST /nacos/v1/core/ops/raft\n{\n    "groupId": "xxx",\n    "command": "removePeers",\n    "value": "ip:{raft_port},ip:{raft_port},ip:{raft_port},..."\n}\n')),(0,r.kt)("a",{name:"GzMuP"}),(0,r.kt)("h3",{id:"jraft\u534f\u8bae\u76f8\u5173\u914d\u7f6e\u53c2\u6570"},"JRaft\u534f\u8bae\u76f8\u5173\u914d\u7f6e\u53c2\u6570"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"### Sets the Raft cluster election timeout, default value is 5 second\nnacos.core.protocol.raft.data.election_timeout_ms=5000\n### Sets the amount of time the Raft snapshot will execute periodically, default is 30 minute\nnacos.core.protocol.raft.data.snapshot_interval_secs=30\n### Requested retries, default value is 1\nnacos.core.protocol.raft.data.request_failoverRetries=1\n### raft internal worker threads\nnacos.core.protocol.raft.data.core_thread_num=8\n### Number of threads required for raft business request processing\nnacos.core.protocol.raft.data.cli_service_thread_num=4\n### raft linear read strategy, defaults to index\nnacos.core.protocol.raft.data.read_index_type=ReadOnlySafe\n### rpc request timeout, default 5 seconds\nnacos.core.protocol.raft.data.rpc_request_timeout_ms=5000\n")),(0,r.kt)("h4",{id:"\u7ebf\u6027\u8bfb\u53c2\u6570\u89e3\u6790"},"\u7ebf\u6027\u8bfb\u53c2\u6570\u89e3\u6790"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"ReadOnlySafe"),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"\u8be5\u7ebf\u6027\u8bfb\u6a21\u5f0f\uff0c\u6bcf\u6b21Follower\u8fdb\u884c\u8bfb\u8bf7\u6c42\u65f6\uff0c\u9700\u8981\u548cLeader\u540c\u6b65\u65e5\u5fd7\u63d0\u4ea4\u4f4d\u70b9\u4fe1\u606f\uff0c\u800cLeader\uff0c\u9700\u8981\u5411\u8fc7\u534a\u7684Follower\u53d1\u8d77\u8bc1\u660e\u81ea\u5df1\u662fLeader\u7684\u8f7b\u91cf\u7684RPC\u8bf7\u6c42\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2aFollower\u8bfb\uff0c\u81f3\u5c11\u9700\u89811 + \uff08n/2\uff09+ 1 \u6b21\u7684RPC\u8bf7\u6c42\u3002"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"ReadOnlyLeaseBased"),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"\u8be5\u7ebf\u6027\u8bfb\u6a21\u5f0f\uff0c\u6bcf\u6b21Follower\u8fdb\u884c\u8bfb\u8bf7\u6c42\u65f6\uff0cLeader\u53ea\u9700\u8981\u5224\u65ad\u81ea\u5df1\u7684Leader\u79df\u7ea6\u662f\u5426\u8fc7\u671f\u4e86\uff0c\u5982\u679c\u6ca1\u6709\u8fc7\u671f\uff0c\u76f4\u63a5\u53ef\u4ee5\u56de\u590dFollower\u81ea\u5df1\u662fLeader\uff0c\u4f46\u662f\u8be5\u673a\u5236\u5bf9\u4e8e\u673a\u5668\u65f6\u949f\u8981\u6c42\u5f88\u4e25\u683c\uff0c\u5982\u679c\u6709\u505a\u65f6\u949f\u540c\u6b65\u7684\u8bdd\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u8be5\u7ebf\u6027\u8bfb\u6a21\u5f0f\u3002")))),(0,r.kt)("a",{name:"WiLDa"}),(0,r.kt)("h2",{id:"nacos\u5185\u5d4c\u5206\u5e03\u5f0fid"},"Nacos\u5185\u5d4c\u5206\u5e03\u5f0fID"),(0,r.kt)("p",null,"nacos\u5185\u5d4c\u7684\u5206\u5e03\u5f0fID\u4e3aSnakeflower\uff0cdataCenterId\u9ed8\u8ba4\u4e3a1\uff0cworkerId\u7684\u503c\u8ba1\u7b97\u65b9\u5f0f\u5982\u4e0b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'InetAddress address;\ntry {\n    address = InetAddress.getLocalHost();\n} catch (final UnknownHostException e) {\n    throw new IllegalStateException(\n                        "Cannot get LocalHost InetAddress, please check your network!");\n}\nbyte[] ipAddressByteArray = address.getAddress();\nworkerId = (((ipAddressByteArray[ipAddressByteArray.length - 2] & 0B11)\n                    << Byte.SIZE) + (ipAddressByteArray[ipAddressByteArray.length - 1]\n                    & 0xFF));\n')),(0,r.kt)("p",null,"\u5982\u679c\u9700\u8981\u624b\u52a8\u6307\u5b9adataCenterId\u4ee5\u53caworkerId\uff0c\u5219\u5728application.properties\u6216\u8005\u542f\u52a8\u65f6\u6dfb\u52a0\u547d\u4ee4\u884c\u53c2\u6570"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"### set the dataCenterID manually\n# nacos.core.snowflake.data-center=\n### set the WorkerID manually\n# nacos.core.snowflake.worker-id=\n")),(0,r.kt)("a",{name:"ZLp5w"}),(0,r.kt)("h2",{id:"nacos\u5185\u5d4c\u7684\u8f7b\u91cf\u7684\u57fa\u4e8ederby\u7684\u5206\u5e03\u5f0f\u5173\u7cfb\u578b\u5b58\u50a8"},"Nacos\u5185\u5d4c\u7684\u8f7b\u91cf\u7684\u57fa\u4e8eDerby\u7684\u5206\u5e03\u5f0f\u5173\u7cfb\u578b\u5b58\u50a8"),(0,r.kt)("a",{name:"1B5KV"}),(0,r.kt)("h3",{id:"\u80cc\u666f"},"\u80cc\u666f"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5982\u679c\u914d\u7f6e\u6587\u4ef6\u6570\u91cf\u8f83\u5c11\uff0c\u5728\u96c6\u7fa4\u6a21\u5f0f\u4e0b\u9700\u8981\u9ad8\u53ef\u7528\u6570\u636e\u5e93\u96c6\u7fa4\u4f5c\u4e3a\u652f\u6491\u7684\u6210\u672c\u592a\u5927\uff0c\u671f\u671b\u6709\u4e00\u4e2a\u8f7b\u91cf\u7684\u5206\u5e03\u5f0f\u5173\u7cfb\u578b\u5b58\u50a8\u6765\u89e3\u51b3"),(0,r.kt)("li",{parentName:"ol"},"nacos\u5185\u90e8\u4e00\u4e9b\u5143\u6570\u636e\u4fe1\u606f\u5b58\u50a8\uff0c\u6bd4\u5982\u7528\u6237\u4fe1\u606f\uff0c\u547d\u540d\u7a7a\u95f4\u4fe1\u606f"),(0,r.kt)("li",{parentName:"ol"},"\u601d\u8def\u6765\u6e90\uff1a",(0,r.kt)("a",{parentName:"li",href:"https://github.com/rqlite/rqlite"},"https://github.com/rqlite/rqlite"))),(0,r.kt)("a",{name:"Du2qc"}),(0,r.kt)("h3",{id:"\u8bbe\u8ba1\u601d\u8def"},"\u8bbe\u8ba1\u601d\u8def"),(0,r.kt)("a",{name:"NzxHa"}),(0,r.kt)("h4",{id:"\u76ee\u6807"},"\u76ee\u6807"),(0,r.kt)("p",null,"\u8bbe\u8ba1\u76ee\u6807\uff0c\u662f\u671f\u671bnacos\u5b58\u5728\u4e24\u79cd\u6570\u636e\u5b58\u50a8\u6a21\u5f0f\uff0c\u4e00\u79cd\u662f\u73b0\u5728\u7684\u65b9\u5f0f\uff0c\u6570\u636e\u5b58\u50a8\u5728\u5916\u7f6e\u6570\u636e\u6e90\uff08\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff09\uff1b\u7b2c\u4e8c\u79cd\u65b9\u5f0f\u662f\u5185\u5d4c\u5b58\u50a8\u6570\u636e\u6e90\uff08Apache Derby\uff09\u3002\u7528\u6237\u80fd\u591f\u4f7f\u7528\u547d\u4ee4\u884c\u53c2\u6570\u914d\u7f6e\u7684\u65b9\u5f0f\uff0c\u968f\u610f\u4f7f\u7528\u8fd9\u4e24\u79cd\u6570\u636e\u5b58\u50a8\u6a21\u5f0f",(0,r.kt)("br",null),(0,r.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2020/png/333972/1591015542106-f14d2579-229f-4bfb-a432-e40854e65d6d.png#align=left&display=inline&height=903&margin=%5Bobject%20Object%5D&name=image.png&originHeight=903&originWidth=1514&size=237497&status=done&style=none&width=1514",alt:"image.png"})),(0,r.kt)("a",{name:"LqUtU"}),(0,r.kt)("h4",{id:"\u603b\u4f53"},"\u603b\u4f53"),(0,r.kt)("p",null,"\u5c06\u4e00\u6b21\u8bf7\u6c42\u64cd\u4f5c\u6d89\u53ca\u7684SQL\u4e0a\u4e0b\u6587\u6309\u987a\u5e8f\u4fdd\u5b58\u8d77\u6765\u3002\u7136\u540e\u901a\u8fc7\u4e00\u81f4\u534f\u8bae\u5c42\u5c06\u672c\u6b21\u8bf7\u6c42\u6d89\u53ca\u7684SQL\u4e0a\u4e0b\u6587\u8fdb\u884c\u540c\u6b65\uff0c\u7136\u540e\u6bcf\u4e2a\u8282\u70b9\u5c06\u5176\u89e3\u6790\u5e76\u91cd\u65b0\u6309\u987a\u5e8f\u5728\u4e00\u6b21\u6570\u636e\u5e93\u4f1a\u8bdd\u4e2d\u6267\u884c\u3002",(0,r.kt)("br",null),(0,r.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2020/png/333972/1587204104465-2270480a-de25-4c84-a11b-6edd2de99e66.png#align=left&display=inline&height=814&margin=%5Bobject%20Object%5D&name=%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6%20%281%29.png&originHeight=814&originWidth=1149&size=130886&status=done&style=none&width=1149",alt:"\u672a\u547d\u540d\u6587\u4ef6 (1).png"})),(0,r.kt)("a",{name:"yxFYn"}),(0,r.kt)("h4",{id:"\u8c01\u53ef\u4ee5\u5904\u7406\u8bf7\u6c42"},"\u8c01\u53ef\u4ee5\u5904\u7406\u8bf7\u6c42"),(0,r.kt)("p",null,"\u5f53\u4f7f\u7528\u8005\u5f00\u542f1.3.0\u7684\u65b0\u7279\u6027\u2014\u2014\u5185\u5d4c\u5206\u5e03\u5f0f\u5173\u7cfb\u578b\u6570\u636e\u5b58\u50a8\u65f6\uff0c\u6240\u6709\u7684\u5199\u64cd\u4f5c\u8bf7\u6c42\u90fd\u5c06\u8def\u7531\u5230Leader\u8282\u70b9\u8fdb\u884c\u5904\u7406\uff1b\u4f46\u662f\uff0c\u7531\u4e8eRaft\u72b6\u6001\u673a\u7684\u7279\u6027\uff0c\u5f53\u67d0\u4e00\u4e2a\u8282\u70b9\u5728apply\u6570\u636e\u5e93\u64cd\u4f5c\u8bf7\u6c42\u65f6\u53d1\u751f\u975eSQL\u903b\u8f91\u9519\u8bef\u5f15\u53d1\u7684\u5f02\u5e38\u65f6\uff0c\u5c06\u5bfc\u81f4\u72b6\u6001\u673a\u65e0\u6cd5\u7ee7\u7eed\u6b63\u5e38\u8fdb\u884c\u5de5\u4f5c\uff0c\u6b64\u65f6\u5c06\u4f1a\u89e6\u53d1\u914d\u7f6e\u7ba1\u7406\u6a21\u5757\u7684\u964d\u7ea7\u64cd\u4f5c"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"private void registerSubscribe() {\n    NotifyCenter.registerSubscribe(new SmartSubscribe() {\n\n        @Override\n        public void onEvent(Event event) {\n            if (event instanceof RaftDBErrorRecoverEvent) {\n                downgrading = false;\n                return;\n            }\n            if (event instanceof RaftDBErrorEvent) {\n                downgrading = true;\n            }\n        }\n\n        @Override\n        public boolean canNotify(Event event) {\n            return (event instanceof RaftDBErrorEvent) || (event instanceof RaftDBErrorRecoverEvent);\n        }\n    });\n}\n")),(0,r.kt)("p",null,"\u56e0\u6b64\uff0c\u7efc\u4e0a\u6240\u8ff0\uff0c\u53ef\u4ee5\u901a\u8fc7\u6d3b\u52a8\u56fe\u6765\u7406\u89e3\u4e0b\uff0c\u4ec0\u4e48\u60c5\u51b5\u4e0b\u9700\u8981\u5c06\u8bf7\u6c42\u8fdb\u884c\u8f6c\u53d1\n",(0,r.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/__puml/db53c1ade61235d4c9659607b98ef7c6.svg#lake_card_v2=eyJjb2RlIjoiQHN0YXJ0dW1sXG5cbigqKSAtLT4gXCJGaWx0ZXIuZG9GaWx0ZXJcIlxuXG5pZiBcIuacrOiKgueCueaYr0xlYWRlclwiIHRoZW5cbiAgLWxlZnQtPlt0cnVlXSBcIuacrOiKgueCueWkhOeQhlwiXG4gIC0tPiAoKilcbmVsc2VcbiAgICBpZiBcIuezu-e7n-mZjee6p-W8gOWQr1wiIHRoZW5cbiAgICAgICAgLS0-W3RydWVdIFwi6L2s5Y-R57uZTGVhZGVyXCJcbiAgICAgICAgLS0-ICgqKVxuICAgIGVsc2VcbiAgICAgICAgaWYgXCLlhpnmk43kvZzor7fmsYJcIiB0aGVuXG4gICAgICAgICAgICAtLT5bdHJ1ZV0gXCLovazlj5Hnu5lMZWFkZXJcIlxuICAgICAgICAgICAgLS0-ICgqKVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICAtLT5bZmFsc2VdIFwi5pys6IqC54K55aSE55CGXCJcbiAgICAgICAgZW5kaWZcbiAgICBlbmRpZlxuZW5kaWZcblxuQGVuZHVtbCIsInR5cGUiOiJwdW1sIiwibWFyZ2luIjp0cnVlLCJpZCI6IjFuWW9HIiwidXJsIjoiaHR0cHM6Ly9jZG4ubmxhcmsuY29tL3l1cXVlL19fcHVtbC9kYjUzYzFhZGU2MTIzNWQ0Yzk2NTk2MDdiOThlZjdjNi5zdmciLCJjYXJkIjoiZGlhZ3JhbSJ9",alt:null})),(0,r.kt)("a",{name:"g1buf"}),(0,r.kt)("h4",{id:"\u76f8\u5173\u6570\u636e\u627f\u8f7d\u5bf9\u8c61"},"\u76f8\u5173\u6570\u636e\u627f\u8f7d\u5bf9\u8c61"),(0,r.kt)("p",null,"\u6570\u636e\u5e93\u7684DML\u8bed\u53e5\u662fselect\u3001insert\u3001update\u3001delete\uff0c\u6839\u636eSQL\u8bed\u53e5\u5bf9\u4e8e\u6570\u636e\u64cd\u4f5c\u7684\u6027\u8d28\uff0c\u53ef\u4ee5\u5206\u4e3a\u4e24\u5927\u7c7b\uff1aquery\u4ee5\u53caupdate\uff0cselect\u8bed\u53e5\u5bf9\u5e94\u7684\u662f\u6570\u636e\u67e5\u8be2\uff0cinsert\u3001update\u3001delete\u8bed\u53e5\u5bf9\u5e94\u7684\u662f\u6570\u636e\u4fee\u6539\u3002\u540c\u65f6\u5728\u8fdb\u884c\u6570\u636e\u5e93\u64cd\u4f5c\u65f6\uff0c\u4e3a\u4e86\u907f\u514dSQL\u6ce8\u5165\uff0c\u4f7f\u7528\u7684\u662fPreparedStatement\uff0c\u56e0\u6b64\u9700\u8981SQL\u8bed\u53e5+\u53c2\u6570\uff0c\u56e0\u6b64\u53ef\u4ee5\u5f97\u5230\u4e24\u4e2a\u5173\u4e8e\u6570\u636e\u5e93\u64cd\u4f5c\u7684Request\u5bf9\u8c61"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"SelectRequest")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class SelectRequest implements Serializable {\n\n    private static final long serialVersionUID = 2212052574976898602L;\n    // \u67e5\u8be2\u7c7b\u522b\uff0c\u56e0\u4e3a\u76ee\u524d\u4f7f\u7528\u7684\u662fJdbcTemplate\uff0c\u67e5\u8be2\u5355\u4e2a\u3001\u67e5\u8be2\u591a\u4e2a\uff0c\u662f\u5426\u4f7f\u7528RowMapper\u8f6c\u4e3a\u5bf9\u8c61\n    private byte queryType;\n    // sql\u8bed\u53e5\n    // select * from config_info where\n    private String sql;\n    private Object[] args;\n    private String className;\n}\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"ModifyRequest")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class ModifyRequest implements Serializable {\n\n    private static final long serialVersionUID = 4548851816596520564L;\n\n    private int executeNo;\n    private String sql;\n    private Object[] args;\n}\n")),(0,r.kt)("a",{name:"moKl7"}),(0,r.kt)("h4",{id:"\u914d\u7f6e\u53d1\u5e03"},"\u914d\u7f6e\u53d1\u5e03"),(0,r.kt)("p",null,"\u914d\u7f6e\u53d1\u5e03\u64cd\u4f5c\u6d89\u53ca\u4e09\u4e2a\u4e8b\u52a1\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"config_info\u4fdd\u5b58\u914d\u7f6e\u4fe1\u606f"),(0,r.kt)("li",{parentName:"ol"},"config_tags_relation\u4fdd\u5b58\u914d\u7f6e\u4e0e\u6807\u7b7e\u7684\u5173\u8054\u5173\u7cfb"),(0,r.kt)("li",{parentName:"ol"},"his_config_info\u4fdd\u5b58\u4e00\u6761\u914d\u7f6e\u64cd\u4f5c\u5386\u53f2\u8bb0\u5f55")),(0,r.kt)("p",null,"\u8fd9\u4e09\u4e2a\u4e8b\u52a1\u90fd\u5728\u914d\u7f6e\u53d1\u5e03\u8fd9\u4e2a\u5927\u4e8b\u52a1\u4e0b\uff0c\u5982\u679c\u8bf4\u6211\u4eec\u5bf9\u6bcf\u4e2a\u4e8b\u52a1\u64cd\u4f5c\u8fdb\u884c\u4e00\u4e2aRaft\u534f\u8bae\u63d0\u4ea4\uff0c\u5047\u8bbe1\u30012\u4e24\u4e2a\u4e8b\u52a1\u901a\u8fc7Raft\u63d0\u4ea4\u540e\u90fd\u6210\u529fApply\u4e86\uff0c\u7b2c\u4e09\u4e2a\u4e8b\u52a1\u5728\u8fdb\u884cRaft\u63d0\u4ea4\u540eapply\u5931\u8d25\uff0c\u90a3\u4e48\u5bf9\u4e8e\u8fd9\u4e2a\u914d\u7f6e\u53d1\u5e03\u7684\u5927\u4e8b\u52a1\u6765\u8bf4\uff0c\u662f\u9700\u8981\u6574\u4f53\u56de\u6eda\u7684\uff0c\u5426\u5219\u5c31\u4f1a\u8fdd\u53cd\u539f\u5b50\u6027\uff0c\u90a3\u4e48\u53ef\u80fd\u9700\u8981\u8bf4\u5c06\u4e8b\u52a1\u56de\u6eda\u64cd\u4f5c\u53c8\u8fdb\u884c\u4e00\u6b21Raft\u63d0\u4ea4\uff0c\u90a3\u4e48\u6574\u4f53\u7684\u590d\u6742\u7a0b\u5ea6\u4e0a\u5347\uff0c\u5e76\u4e14\u76f4\u63a5\u5f15\u5165\u4e86\u5206\u5e03\u5f0f\u4e8b\u52a1\u7684\u7ba1\u7406\uff0c\u56e0\u6b64\u4e3a\u4e86\u907f\u514d\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5c06\u8fd9\u4e09\u4e2a\u4e8b\u52a1\u6d89\u53ca\u7684SQL\u4e0a\u4e0b\u6587\u8fdb\u884c\u6574\u5408\u6210\u4e00\u4e2a\u5927\u7684SQL\u4e0a\u4e0b\u6587\uff0c\u5bf9\u8fd9\u5927\u7684SQL\u4e0a\u4e0b\u6587\u8fdb\u884cRaft\u534f\u8bae\u63d0\u4ea4\u3002\u4fdd\u8bc1\u4e86\u4e09\u4e2a\u5b50\u4e8b\u52a1\u5728\u540c\u4e00\u6b21\u6570\u636e\u5e93\u4f1a\u8bdd\u5f53\u4e2d\uff0c\u6210\u529f\u89e3\u51b3\u539f\u5b50\u6027\u7684\u95ee\u9898\uff0c\u540c\u65f6\u7531\u4e8eRaft\u534f\u8bae\u5bf9\u4e8e\u4e8b\u52a1\u65e5\u5fd7\u7684\u5904\u7406\u662f\u4e32\u884c\u6267\u884c\u7684\uff0c\u56e0\u6b64\u76f8\u5f53\u4e8e\u5c06\u6570\u636e\u5e93\u7684\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u8c03\u6574\u4e3a\u4e32\u884c\u5316\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public void addConfigInfo(final String srcIp,\n            final String srcUser, final ConfigInfo configInfo, final Timestamp time,\n            final Map<String, Object> configAdvanceInfo, final boolean notify) {\n\n    try {\n        final String tenantTmp = StringUtils.isBlank(configInfo.getTenant()) ?\n                    StringUtils.EMPTY :\n                    configInfo.getTenant();\n        configInfo.setTenant(tenantTmp);\n        \n        // \u901a\u8fc7\u96ea\u82b1ID\u7b97\u6cd5\u83b7\u53d6\u6570\u636e\u5e93\u4e3b\u952e\n        long configId = idGeneratorManager.nextId(RESOURCE_CONFIG_INFO_ID);\n        long hisId = idGeneratorManager.nextId(RESOURCE_CONFIG_HISTORY_ID);\n\n        addConfigInfoAtomic(configId, srcIp, srcUser, configInfo, time,\n                    configAdvanceInfo);\n        String configTags = configAdvanceInfo == null ?\n                    null :\n                    (String) configAdvanceInfo.get("config_tags");\n\n        addConfigTagsRelation(configId, configTags, configInfo.getDataId(),\n                    configInfo.getGroup(), configInfo.getTenant());\n        insertConfigHistoryAtomic(hisId, configInfo, srcIp, srcUser, time, "I");\n        EmbeddedStorageContextUtils.onModifyConfigInfo(configInfo, srcIp, time);\n        databaseOperate.blockUpdate();\n    }\n    finally {\n        EmbeddedStorageContextUtils.cleanAllContext();\n    }\n}\n\npublic long addConfigInfoAtomic(final long id, final String srcIp,\n            final String srcUser, final ConfigInfo configInfo, final Timestamp time,\n            Map<String, Object> configAdvanceInfo) {\n    ...\n    // \u53c2\u6570\u5904\u7406\n    ...\n    final String sql =\n                "INSERT INTO config_info(id, data_id, group_id, tenant_id, app_name, content, md5, src_ip, src_user, gmt_create,"\n                        + "gmt_modified, c_desc, c_use, effect, type, c_schema) VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";\n    final Object[] args = new Object[] { id, configInfo.getDataId(),\n                configInfo.getGroup(), tenantTmp, appNameTmp, configInfo.getContent(),\n                md5Tmp, srcIp, srcUser, time, time, desc, use, effect, type, schema, };\n    SqlContextUtils.addSqlContext(sql, args);\n    return id;\n}\n\npublic void addConfigTagRelationAtomic(long configId, String tagName, String dataId,\n            String group, String tenant) {\n    final String sql =\n                "INSERT INTO config_tags_relation(id,tag_name,tag_type,data_id,group_id,tenant_id) "\n                        + "VALUES(?,?,?,?,?,?)";\n    final Object[] args = new Object[] { configId, tagName, null, dataId, group,\n                tenant };\n    SqlContextUtils.addSqlContext(sql, args);\n}\n\npublic void insertConfigHistoryAtomic(long configHistoryId, ConfigInfo configInfo,\n            String srcIp, String srcUser, final Timestamp time, String ops) {\n    ...\n    // \u53c2\u6570\u5904\u7406\n    ...\n    final String sql =\n                "INSERT INTO his_config_info (id,data_id,group_id,tenant_id,app_name,content,md5,"\n                        + "src_ip,src_user,gmt_modified,op_type) VALUES(?,?,?,?,?,?,?,?,?,?,?)";\n    final Object[] args = new Object[] { configHistoryId, configInfo.getDataId(),\n                configInfo.getGroup(), tenantTmp, appNameTmp, configInfo.getContent(),\n                md5Tmp, srcIp, srcUser, time, ops };\n\n    SqlContextUtils.addSqlContext(sql, args);\n}\n\n/**\n * Temporarily saves all insert, update, and delete statements under\n * a transaction in the order in which they occur\n *\n * @author <a href="mailto:liaochuntao@live.com">liaochuntao</a>\n */\npublic class SqlContextUtils {\n\n    private static final ThreadLocal<ArrayList<ModifyRequest>> SQL_CONTEXT =\n            ThreadLocal.withInitial(ArrayList::new);\n\n    public static void addSqlContext(String sql, Object... args) {\n        ArrayList<ModifyRequest> requests = SQL_CONTEXT.get();\n        ModifyRequest context = new ModifyRequest();\n        context.setExecuteNo(requests.size());\n        context.setSql(sql);\n        context.setArgs(args);\n        requests.add(context);\n        SQL_CONTEXT.set(requests);\n    }\n\n    public static List<ModifyRequest> getCurrentSqlContext() {\n        return SQL_CONTEXT.get();\n    }\n\n    public static void cleanCurrentSqlContext() {\n        SQL_CONTEXT.remove();\n    }\n\n}\n')),(0,r.kt)("p",null,"\u901a\u8fc7\u4e00\u4e2a\u65f6\u5e8f\u56fe\u6765\u66f4\u52a0\u76f4\u89c2\u7684\u7406\u89e3\n",(0,r.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/__puml/618e8997395fbc74433ac4a60f67b6b4.svg#lake_card_v2=eyJjb2RlIjoiQHN0YXJ0dW1sXG5cbmF1dG9udW1iZXJcblxuYWN0b3IgXCJVc2VyXCIgYXMgVXNlclxuXG5wYXJ0aWNpcGFudCBcIkNvbmZpZ1NlcnZpY2VcIiBhcyBTZXJ2aWNlXG5wYXJ0aWNpcGFudCBcIlBlcnNpc3RlbmNlU2VydmljZVwiIGFzIFJlcG9zaXRvcnlcbnBhcnRpY2lwYW50IFwiRGVyYnlcIiBhcyBEQlxucGFydGljaXBhbnQgXCJTUUxDb250ZXh0VXRpbHNcIiBhcyBTUUxDb250ZXh0XG5wYXJ0aWNpcGFudCBcIkxvZ1Byb2Nlc3NvclwiIGFzIFByb2Nlc3NvclxucGFydGljaXBhbnQgXCJDb25zaXN0ZW5jeVByb3RvY29sXCIgYXMgUHJvdG9jb2xcbnBhcnRpY2lwYW50IFwiTG9nXCIgYXMgTG9nXG5cbmFjdGl2YXRlIFVzZXJcblxuVXNlciAtPiBTZXJ2aWNlOiDlj5HotbfphY3nva7lj5HluIPor7fmsYJcbmFjdGl2YXRlIFNlcnZpY2VcblxuU2VydmljZSAtPiBSZXBvc2l0b3J5OiDphY3nva7lj5HluINcbmFjdGl2YXRlIFJlcG9zaXRvcnlcblxuUmVwb3NpdG9yeSAtPiBTUUxDb250ZXh0OiDmi6bmiKrlvZPliY1TUUzkuIrkuIvmlodcbmFjdGl2YXRlIFNRTENvbnRleHRcblxuUmVwb3NpdG9yeSAtPiBSZXBvc2l0b3J5OiBjb21taXQg5pON5L2cXG5cblNRTENvbnRleHQgLT4gUmVwb3NpdG9yeTog5b2T5YmN6K-35rGC5raJ5Y-K55qE5omA5pyJU1FM5LiK5LiL5paHXG5cbmRlYWN0aXZhdGUgU1FMQ29udGV4dFxuXG5SZXBvc2l0b3J5IC0-IExvZzog5p6E5bu66K-35rGC5L2TXG5cbmFjdGl2YXRlIExvZ1xuZGVhY3RpdmF0ZSBMb2dcblxuUmVwb3NpdG9yeSAtPiBQcm90b2NvbDogc3VibWl0KCkg6L-b6KGM6K-35rGC5o-Q5LqkXG5hY3RpdmF0ZSBQcm90b2NvbFxuZGVhY3RpdmF0ZSBSZXBvc2l0b3J5XG5cblByb3RvY29sIC0-IFByb2Nlc3Nvcjogb25BcHBseSgpIOaWueazle-8jOeKtuaAgeacuuWkjeWItkxvZ1xuYWN0aXZhdGUgUHJvY2Vzc29yXG5cblByb2Nlc3NvciAtPiBSZXBvc2l0b3J5OiDmiafooYzmiYDmnInnmoRTUUzkuIrkuIvmlodcbmFjdGl2YXRlIFJlcG9zaXRvcnlcblxuUmVwb3NpdG9yeSAtPiBEQjog5pWw5o2u6JC95bqTXG5hY3RpdmF0ZSBEQlxuXG5EQiAtPiBSZXBvc2l0b3J5OiDnu5PmnZ_lubbov5Tlm57nu5PmnpxcbmRlYWN0aXZhdGUgREJcblxuUmVwb3NpdG9yeSAtPiBQcm9jZXNzb3I6IOi_lOWbnkxvZ0Z1dHVyZeW5tuiuvue9ruacrOasoeaJp-ihjOeahOe7k-aenFxuZGVhY3RpdmF0ZSBSZXBvc2l0b3J5XG5cblByb2Nlc3NvciAtPiBQcm90b2NvbDog6L-U5ZueTG9nRnV0dXJlXG5kZWFjdGl2YXRlIFByb2Nlc3NvclxuXG5Qcm90b2NvbCAtPiBTZXJ2aWNlOiDmnKzmrKHor7fmsYLnmoTnu5PmnpxcbmRlYWN0aXZhdGUgUHJvdG9jb2xcblxuU2VydmljZSAtPiBVc2VyXG5kZWFjdGl2YXRlIFNlcnZpY2VcbmRlYWN0aXZhdGUgVXNlclxuXG5AZW5kdW1sIiwidHlwZSI6InB1bWwiLCJtYXJnaW4iOnRydWUsImlkIjoiVnQxNzciLCJ1cmwiOiJodHRwczovL2Nkbi5ubGFyay5jb20veXVxdWUvX19wdW1sLzYxOGU4OTk3Mzk1ZmJjNzQ0MzNhYzRhNjBmNjdiNmI0LnN2ZyIsImNhcmQiOiJkaWFncmFtIn0=",alt:null})),(0,r.kt)("a",{name:"AAJTE"}),(0,r.kt)("h3",{id:"\u5982\u4f55\u4f7f\u7528\u65b0\u7279\u6027"},"\u5982\u4f55\u4f7f\u7528\u65b0\u7279\u6027"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"./startup.sh -p embedded\n")),(0,r.kt)("p",null,"\u662f\u5426\u542f\u7528\u5185\u5d4c\u7684\u5206\u5e03\u5f0f\u5173\u7cfb\u578b\u5b58\u50a8\u7684\u6d3b\u52a8\u56fe\n",(0,r.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/__puml/1fd656ba3b39fe5de8fea78efdf98dd1.svg#lake_card_v2=eyJjb2RlIjoiQHN0YXJ0dW1sXG5cbigqKSAtLT4gXCJDb25maWcuc3RhcnQoKVwiXG5cbmlmIFwi5Y2V5py65qih5byPXCIgdGhlblxuICAtcmlnaHQtPlt0cnVlXSBcInJldHVybiDpu5jorqTljZXmnLrlrZjlgqjooYzkuLpcIlxuICAtLT4gKCopXG5lbHNlXG4gaWYgXCLlt7LphY3nva7lpJbnva7lrZjlgqhcIiB0aGVuXG4gICAgLS0-W3RydWVdIFwicmV0dXJuIOWklue9ruaVsOaNruWtmOWCqOihjOS4ulwiXG4gICAgLS0-ICgqKVxuIGVsc2VcbiAgICBpZiBcIuW8gOWQr-WGheW1jOWtmOWCqFwiIHRoZW5cbiAgICAgICAgLS0-W3RydWVdIFwicmV0dXJuIOi9u-mHj-WGheW1jOWIhuW4g-W8j-WtmOWCqOihjOS4ulwiXG4gICAgICAgIC0tPiAoKilcbiAgICBlbHNlXG4gICAgICAgIC0-W2ZhbHNlXSBcInJldHVybiDpu5jorqTlpJbnva7mlbDmja7lrZjlgqjooYzkuLpcIlxuICAgICAgICAtLT4gKCopXG5cdFx0ZW5kaWZcbiBlbmRpZlxuZW5kaWZcblxuQGVuZHVtbCIsInR5cGUiOiJwdW1sIiwibWFyZ2luIjp0cnVlLCJpZCI6IkNNN1VDIiwidXJsIjoiaHR0cHM6Ly9jZG4ubmxhcmsuY29tL3l1cXVlL19fcHVtbC8xZmQ2NTZiYTNiMzlmZTVkZThmZWE3OGVmZGY5OGRkMS5zdmciLCJjYXJkIjoiZGlhZ3JhbSJ9",alt:null})),(0,r.kt)("a",{name:"9UAXN"}),(0,r.kt)("h3",{id:"\u65b0\u7279\u6027\u7684\u76f8\u5173\u8fd0\u7ef4\u64cd\u4f5c"},"\u65b0\u7279\u6027\u7684\u76f8\u5173\u8fd0\u7ef4\u64cd\u4f5c"),(0,r.kt)("p",null,"\u76f4\u63a5\u67e5\u8be2\u6bcf\u4e2a\u8282\u70b9\u7684derby\u5b58\u50a8\u7684\u6570\u636e"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"GET /nacos/v1/cs/ops/derby?sql=select * from config_info\n\nreturn List<Map<String, Object>>\n")),(0,r.kt)("a",{name:"YcqO2"}),(0,r.kt)("h3",{id:"\u4e0d\u8db3"},"\u4e0d\u8db3"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5728\u6570\u636e\u5e93\u4e0a\u5c42\u6784\u5efa\u4e00\u5c42\u5206\u5e03\u5f0f\u6570\u636e\u64cd\u4f5c\u540c\u6b65\u5c42\uff0c\u5bf9\u6570\u636e\u5e93\u7684\u64cd\u4f5c\u5b58\u5728\u4e86\u9650\u5236\uff0c\u6bd4\u5982\u7b2c\u4e00\u6b65insert\u64cd\u4f5c\uff0c\u7136\u540eselect\u64cd\u4f5c\uff0c\u6700\u540e\u5728update\u64cd\u4f5c\uff0c\u8fd9\u79cd\u5728\u6570\u636e\u4fee\u6539\u8bed\u53e5\u4e2d\u7a7f\u63d2\u7740\u67e5\u8be2\u8bed\u53e5\u7684\u64cd\u4f5c\u987a\u5e8f\u662f\u4e0d\u652f\u6301\u7684"),(0,r.kt)("li",{parentName:"ol"},"\u9650\u5236\u4e86\u6570\u636e\u5e93\u7684\u6027\u80fd\uff0c\u7531\u4e8e\u95f4\u63a5\u7684\u5c06\u6570\u636e\u5e93\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u8c03\u6574\u4e3a\u4e86\u4e32\u884c\u5316\uff0c\u4eba\u4e3a\u7684\u5c06\u5e76\u53d1\u80fd\u529b\u964d\u4f4e\u4e86")),(0,r.kt)("a",{name:"7dul8"}),(0,r.kt)("h3",{id:"\u672a\u6765\u6f14\u8fdb"},"\u672a\u6765\u6f14\u8fdb"),(0,r.kt)("p",null,"\u5c06\u4e8eApache Derby\u5b98\u65b9\u4e00\u8d77\u5c1d\u8bd5\u57fa\u4e8eRaft\u5b9e\u73b0BingLog\u7684\u540c\u6b65\u590d\u5236\u64cd\u4f5c\uff0c\u4ece\u5e95\u5c42\u5b9e\u73b0\u6570\u636e\u5e93\u540c\u6b65\u80fd\u529b"))}d.isMDXComponent=!0}}]);