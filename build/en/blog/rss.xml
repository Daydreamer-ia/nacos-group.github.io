<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Nacos Blog</title>
        <link>https://nacos.io/en/blog</link>
        <description>Nacos Blog</description>
        <lastBuildDate>Mon, 13 Nov 2023 03:02:31 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[2.1.1-release]]></title>
            <link>https://nacos.io/en/blog/2.1.1-release</link>
            <guid>https://nacos.io/en/blog/2.1.1-release</guid>
            <pubDate>Mon, 13 Nov 2023 03:02:31 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[2.2.0-release]]></title>
            <link>https://nacos.io/en/blog/2.2.0-release</link>
            <guid>https://nacos.io/en/blog/2.2.0-release</guid>
            <pubDate>Mon, 13 Nov 2023 03:02:31 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[2.2.1-release]]></title>
            <link>https://nacos.io/en/blog/2.2.1-release</link>
            <guid>https://nacos.io/en/blog/2.2.1-release</guid>
            <pubDate>Mon, 13 Nov 2023 03:02:31 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[2.2.2-release]]></title>
            <link>https://nacos.io/en/blog/2.2.2-release</link>
            <guid>https://nacos.io/en/blog/2.2.2-release</guid>
            <pubDate>Mon, 13 Nov 2023 03:02:31 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[212-and-220beta-release]]></title>
            <link>https://nacos.io/en/blog/212-and-220beta-release</link>
            <guid>https://nacos.io/en/blog/212-and-220beta-release</guid>
            <pubDate>Mon, 13 Nov 2023 03:02:31 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[announcement-token-secret-key]]></title>
            <link>https://nacos.io/en/blog/announcement-token-secret-key</link>
            <guid>https://nacos.io/en/blog/announcement-token-secret-key</guid>
            <pubDate>Mon, 13 Nov 2023 03:02:31 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[higress]]></title>
            <link>https://nacos.io/en/blog/higress</link>
            <guid>https://nacos.io/en/blog/higress</guid>
            <pubDate>Mon, 13 Nov 2023 03:02:31 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[iscas2023]]></title>
            <link>https://nacos.io/en/blog/iscas2023</link>
            <guid>https://nacos.io/en/blog/iscas2023</guid>
            <pubDate>Mon, 13 Nov 2023 03:02:31 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[nacos-distro-mechanism]]></title>
            <link>https://nacos.io/en/blog/nacos-distro-mechanism</link>
            <guid>https://nacos.io/en/blog/nacos-distro-mechanism</guid>
            <pubDate>Mon, 13 Nov 2023 03:02:31 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[nacos-reigster-mechanism]]></title>
            <link>https://nacos.io/en/blog/nacos-reigster-mechanism</link>
            <guid>https://nacos.io/en/blog/nacos-reigster-mechanism</guid>
            <pubDate>Mon, 13 Nov 2023 03:02:31 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[springboot-0.2.10]]></title>
            <link>https://nacos.io/en/blog/springboot-0.2.10</link>
            <guid>https://nacos.io/en/blog/springboot-0.2.10</guid>
            <pubDate>Mon, 13 Nov 2023 03:02:31 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[up-to-2w-star]]></title>
            <link>https://nacos.io/en/blog/up-to-2w-star</link>
            <guid>https://nacos.io/en/blog/up-to-2w-star</guid>
            <pubDate>Mon, 13 Nov 2023 03:02:31 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[xiaomi-scale]]></title>
            <link>https://nacos.io/en/blog/xiaomi-scale</link>
            <guid>https://nacos.io/en/blog/xiaomi-scale</guid>
            <pubDate>Mon, 13 Nov 2023 03:02:31 GMT</pubDate>
            <description><![CDATA[Placeholder. DO NOT DELETE.]]></description>
            <content:encoded><![CDATA[<p>Placeholder. DO NOT DELETE.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[我们总结了3大使用建议，并首次公开 Nacos3.0 规划图 | Nacos 开源4周年]]></title>
            <link>https://nacos.io/en/blog/nacos3.0-is-coming</link>
            <guid>https://nacos.io/en/blog/nacos3.0-is-coming</guid>
            <pubDate>Wed, 10 Aug 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[我们总结了3大使用建议，并首次公开 Nacos3.0 规划图 | Nacos 开源4周年]]></description>
            <content:encoded><![CDATA[<h1>Nacos 是什么？</h1><p><strong>Nacos </strong>/nɑ:kəʊs/ 是 Dynamic <strong>Na</strong>ming and <strong>Co</strong>nfiguration <strong>S</strong>ervice的首字母简称，定位于一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。从 2018 年 7 月开始宣布开源以来，已经走过了第四个年头，在这四年里，备受广大开源用户欢迎，共收获<strong>23.3K的star</strong>数，<strong>10.3K的Fork</strong>数，在开源中国发布的 2021 年度 OSC 中国开源项目评选中，Nacos 被评为<strong>云原生领域人气指数 Top5 </strong>的项目，发布电子书《Nacos 架构与原理》<strong>6w+阅读，2w下载量</strong>，发布半年的时间里在阿里云藏经阁历史下载榜前十。Nacos 在社区共同的建设下不断成长，逐步的开始帮助用户解决实际问题，助力企业数字化转型，目前已经广泛的使用在国内的公司中，根据微服务领域调查问卷，Nacos 在注册配置中心领域已经成为国内首选，<strong>占有50%+国内市场份额</strong>，被头部企业广泛使用！</p><p><em>《2022中国开源发展蓝皮书》由中国开源软件推进联盟（COPU）牵头，联合中国开发者网络（CSDN）、北京开源创新委员会、开放原子开源基金会、中国电子信息产业发展研究院、中科院软件研究所等 85 家企业及行业机构、120 多位开源专家和志愿者共同协作编撰完成，旨在全面展现当前中国开源发展的全景图，为国家政府相关管理部门、科研院所、科技企业以及开源从业者提供更多的理论参考和数据支撑，进一步助力我国开源生态的蓬勃发展。</em></p><p>根据最近刚发布的《2022中国开源发展蓝皮书》报告中 <strong>Github中国项目活跃度TOP 20</strong>，<strong>Nacos 排名全国第六</strong>，作为基础类型云原生中间件，能有如此活跃度是非常不容易的，在上一年度《2021中国开源发展蓝皮书》中，Nacos 排名全国第十，也表现 Nacos 不仅仅维持高的项目活跃度，而且项目关注度和活跃度还在逐步提高。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128326734-77c2a094-ec94-4af1-a75b-a0a53fdc6ec4.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=535&amp;id=u47f643c7&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1178&amp;originWidth=1518&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=236968&amp;status=done&amp;style=none&amp;taskId=u4d6df18d-be84-4d38-93f2-2a962f874c9&amp;title=&amp;width=689.999985044653" alt="image.png" class="img_ev3q">
<img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128326737-122b53b1-ccb8-44f2-b065-30f17f8ef7d3.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=300&amp;id=ueacbdce0&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=660&amp;originWidth=1506&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=137871&amp;status=done&amp;style=none&amp;taskId=u7d71e0c9-9383-4cbf-961a-10e20121db0&amp;title=&amp;width=684.5454397083317" alt="image.png" class="img_ev3q">
同时<strong>阿里巴巴在国内企业中开源影响力排行第一</strong>，在《2022中国开源发展蓝皮书》中介绍：“阿里巴巴是国内参与开源技术生态建设的企业典范。自2011年至今，阿里累计开源项目超过3000个，代表性的项目包括龙蜥操作系统、Apache RocketMQ、Apache Dubbo、Spring Cloud Alibaba、 Nacos、Seata、PolarDB-X、PolarDB for PostgreSQL等”。
<strong>Nacos 是阿里巴巴微服务领域开源你项目活跃度排行第一</strong>，也得益于开源协作模式，并且在Nacos中有大量国内外知名公司的核心贡献者，其中也包含就职在腾讯、华为、小米等等知名企业的同学，也正是社区整体的贡献者和用户在帮助 Nacos 成长，让 Nacos 逐步完善生态，支持几乎所有主流语言，整合更多开源生态，也正是用户和社区贡献者让Nacos为企业数字化转型首选产品。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128326897-7ed32372-ee24-49b3-9d04-0dc212286f15.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=502&amp;id=ubd55857f&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1104&amp;originWidth=2408&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=1103472&amp;status=done&amp;style=none&amp;taskId=u311192a3-cae9-43e6-825c-b7e317f32f8&amp;title=&amp;width=1094.5454308218211" alt="image.png" class="img_ev3q"></p><h1>Nacos 使用上的3点重要建议</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-版本选择">Nacos 版本选择<a href="#nacos-版本选择" class="hash-link" aria-label="Direct link to Nacos 版本选择" title="Direct link to Nacos 版本选择">​</a></h2><p>Nacos 经过4年的发展，目前在大版本演进上已经到了第二代 Nacos 架构，即 Nacos 2.x 版本，Nacos 2.x 版本是基于 Nacos 1.x 中用户反馈使用习惯以及产品演进方向而构建的产品能力，中间包含了比如一致性算法升级，对性能的 10 倍提升，以及支持插件化来满足社区的定制诉求。并且保障了很好的兼容性，在服务能力上 Nacos 2.x 是完全兼容 Nacos 1.x 的协议，也就是 Nacos 2.x 服务端是完全兼容Nacos 1.x的客户端。
<img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128326915-21ee9085-b47d-4126-a9e6-2b29642d3040.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=685&amp;id=u1b918043&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1506&amp;originWidth=3510&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=653185&amp;status=done&amp;style=none&amp;taskId=u3d05de1e-ca37-460e-b2c3-493ce845509&amp;title=&amp;width=1595.4545108740003" alt="image.png" class="img_ev3q"></p><p>在基本能力上，Nacos 2.x 一致性协议复用了阿里在该领域最佳实践，以长连接为基础，减低通信损耗，基于Distro协议原有协议进行升级，在存储模型、保活模型上进行了重构，并且用推送机制代替了之前的轮训机制，进一步提升了产品的高可用以及稳定性，整体也复用了阿里百万实例的基础模型，在CAP理论基础上，根据场景来去选择最适合的协议，贴合场景来平衡一致性、高可用以及分区容灾，做到服务发现以及配置管理每个场景下，都做到稳定性、高可用、高性能的保障。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128326737-0bcc637d-fb28-4d50-831d-0efe3bf2baa5.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=702&amp;id=uc4858e76&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1544&amp;originWidth=3414&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=1949611&amp;status=done&amp;style=none&amp;taskId=u417b5c89-ea5d-4a63-a81b-e1830bae1ae&amp;title=&amp;width=1551.8181481834292" alt="image.png" class="img_ev3q">
在拓展能力上，Nacos 2.x版本开始支持插件化能力，基于插件化是更方便的支持用户各种场景，很多用户公司内部有完善的体系基于Nacos可以简单的改造就可以融合进入，在鉴权、配置加解密场景都可以做到按照用户需求进行定制，并且给出默认的开源实现供用户选择，加解密为例，开源给出的默认实现是基于AES，用户也可以进行自定义。并且目前数据库的插件已经在路上，后续还会在安全等更多方面支持可插拔的插件化能力。
<img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128329396-ed838e7b-23b3-4641-8d83-339621f3e7f6.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=725&amp;id=u49cc077c&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1594&amp;originWidth=3516&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=765234&amp;status=done&amp;style=none&amp;taskId=uebe8a7d1-a137-49e9-a2c1-b43d15e84d1&amp;title=&amp;width=1598.181783542161" alt="image.png" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-支持还能支持那些场景">Nacos 支持还能支持那些场景<a href="#nacos-支持还能支持那些场景" class="hash-link" aria-label="Direct link to Nacos 支持还能支持那些场景" title="Direct link to Nacos 支持还能支持那些场景">​</a></h2><p>Nacos基本核心能力是面向于整体分布式的服务注册与发现，以及分布式节点配置管理，使用领域可以说是非常广泛的，比较常用的包含，微服务领域、高可用领域、内容领域以及数据库领域等，目前在微服务领域Nacos基本能力使用最广，微服务领域定位在一站式解决了用户应用的寻址、流量、配置场景服务平台，在高可用领域Nacos积累了大量的经验，可以实现大量降级、容灾、多活的高可用场景，也可以支持内容分发以及数据库分库分表、主备切换等场景的基础能力，可以说分布式的场景下，基本都可以跟Nacos进行构建，也帮助业务后续拓展留足了准备。
<img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128329276-3018d13a-b48c-40c7-b849-91f8457b8150.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=635&amp;id=ue5613a5e&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1398&amp;originWidth=3350&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=552128&amp;status=done&amp;style=none&amp;taskId=u4e44c983-d5f2-46f0-b0c8-81aff9737c1&amp;title=&amp;width=1522.7272397230486" alt="image.png" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-排查问题最佳实践">Nacos 排查问题最佳实践<a href="#nacos-排查问题最佳实践" class="hash-link" aria-label="Direct link to Nacos 排查问题最佳实践" title="Direct link to Nacos 排查问题最佳实践">​</a></h2><p>注册配置中心在分布式节点交互中起着重要的作用，在业务分布式场景出现问题的时候需要快速进行诊断，判断是否是注册配置中心出现了问题，还是业务层的问题。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128330096-e0464b56-d248-4882-b6b0-7dfc97ef2d12.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=637&amp;id=u044898a4&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1402&amp;originWidth=3288&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=586155&amp;status=done&amp;style=none&amp;taskId=udfffd8de-9024-48b2-9632-d3892d254b3&amp;title=&amp;width=1494.545422152055" alt="image.png" class="img_ev3q">
在注册中心中，服务发现是业务排查问题第一优先级需要定位的，服务发现具体对应的就是服务地址数据是否同步到了业务节点上，那在Nacos场景上，推送记录就是最关键的一个特性能力，这部分能力可以通过Nacos日志查询到，目前Nacos社区已经开始计划设计事件中心来支撑这部分能力，为了更好的演示，这里也通过阿里云微服务引擎MSE展现一下白屏化的推送轨迹能力，用户可以通过服务名称或者客户端IP，进行查询变更的时间以及变更的内容，就可以快速明确当前注册中心是否存在问题，并且能帮住业务进一步定位具体原因。
<img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128329802-c9b74139-1a26-4f5e-a87f-f7984eefd7dc.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=672&amp;id=u2a11e04a&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1478&amp;originWidth=3444&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=1298759&amp;status=done&amp;style=none&amp;taskId=uc0445f1b-5b12-4665-8ddb-3af553555a5&amp;title=&amp;width=1565.4545115242327" alt="image.png" class="img_ev3q">
在配置中心链路，同样存在第一时间定位的问题，这里也通过阿里云微服务引擎MSE的最佳实践，推送轨迹能力展现排查的思路，可以通过配置名称或者订阅者客户端IP进行查询配置的变更时间，以及推送时间，以及推送内容MD5值进行匹配。
<img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128330232-5db3bdda-ff5d-4f33-81b8-f7380fda69f4.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=565&amp;id=u66cb46ed&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1244&amp;originWidth=3442&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=898613&amp;status=done&amp;style=none&amp;taskId=u238152f1-f7bb-4ff7-bd9c-6abf9fbf49d&amp;title=&amp;width=1564.5454206348459" alt="image.png" class="img_ev3q">
并且在分布式配置管理领域，通过补全推送轨迹能力，加上已经支持的历史版本查询能力，可以帮助业务全流程的观测配置的生命周期。
<img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128330919-a9cd7ce7-71c6-4df5-b24d-e952787f31a8.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=148&amp;id=ub13903d9&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=326&amp;originWidth=3452&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=109098&amp;status=done&amp;style=none&amp;taskId=ubf8f4f18-2f42-43bc-b309-8b3af2e9263&amp;title=&amp;width=1569.0908750817803" alt="image.png" class="img_ev3q">
关于注册配置中心排查问题的思路上，总结是两个重点，一是数据变更确认，二是快速确定关系并且进行恢复。大多数场景如果是业务变更引起的，一定要第一时间进行回顾变更，避免给业务带来问题。在稳定性要求比较高的领域，建议业务体系上面向1-5-10（故障1分钟发现，5分钟上线处理，10分钟恢复）建设稳定性，这部分也是比较通用的能力建设，这里就不进行详细拓展，后续有机会可以单独聊一下。</p><h1>Nacos 规划</h1><p>Nacos 已经经历了两个重要阶段，初创期和高速发展期，目前正处于被大规模使用的 Nacos 的第三阶段是成为基础设施，需要面向于基础设施进行演进，帮助企业数字化转型，深度的拥抱各个领域内的场景，并且更深度的帮助企业解决问题。Nacos 社区目前面向于第三阶段，开始筹备 Nacos 3.0 架构设计进行规划讨论，并且逐步开始进行落地。
目前针对 Nacos 3.0 的建设规划大图主要包含三部分，第一部分是开源品牌和社区的升级，主要是面向于社区建立更紧密的联系。第二部分是面向更多生态进行深度融合，包含K8S数据整合、以及多生态数据打通，第三部分是最基础的部分，产品能力升级，基于 Nacos2.x 的协议进行增强，并且支持统一控制面、多数据中心等基础能力，用于支撑 Nacos 3.0 生态建设以及品牌升级。
目前 Nacos 3.0 部分已经随着社区核心贡献者开展中，大多数还在规划阶段，后续会通过Github issues进行开放，随之会打上Nacos 3.0的标签，欢迎大家进行领取一起参与到Nacos 3.0的贡献。
<img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128331989-00a0bd06-65a9-45c9-9cbd-54f1c30a7f2b.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=713&amp;id=ueaab6b3a&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1568&amp;originWidth=3260&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=541963&amp;status=done&amp;style=none&amp;taskId=u8e3272fe-5488-46b2-8489-54c8fd9074a&amp;title=&amp;width=1481.8181497006383" alt="image.png" class="img_ev3q"></p><h1>参与开源建议</h1><p>最后部分整合我个人意见，向没有参与过开源的同学给出一些参与开源的建议，首先我认为开源对于开发者以及社区贡献都是非常有益的，如果你有时间并且也想参与开源，那我建议你从以下四个步骤进行深入：
第一步找到自己感兴趣的方向，这个点比较重要，会影响你后续贡献的持久程度，当然这个也是在逐步摸索中的，不过如果对于方向确认好后，应对的产品列表选择就会比较明朗了，在这个步骤考虑兴趣是我首要建议的，其次我建议，也可以考虑当前项目一些详细信息，重点考虑是否能帮助个人把价值的放大，使用范围越广的项目就越能让你的贡献在社会价值放大，也正向会提高成就感。
第二步是熟悉项目和产品，找到了方向和项目之后，就可以开始着手熟悉当前产品的细节，熟悉当前项目的运营机制，以及面向于产品开始接触对应领域问题，领域问题最后会沉淀成为你对这个领域的经验。
第三步其实就可以贡献开源了，这一个步骤其实面向于前两步骤是可以适当提前并行做，关键是从小问题入手做起，这样可以帮助你在前两个步骤中更快的找到感觉，也能从小问题开始帮助他人，在社区中建立个人影响力。
第四步其实是水到渠成的，面向于活跃的社区，当你足够熟悉该领域该产品之后，有了足够的贡献，就会在开源中逐步主导社区的决策，也能在社区中帮助更多的人发展共建。
<img loading="lazy" src="https://cdn.nlark.com/yuque/0/2022/png/1841635/1660128332043-0226d126-4ed8-4881-a36b-a9e3cffba02d.png#clientId=ueb02e93b-f556-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=642&amp;id=u502fa610&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1412&amp;originWidth=3312&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=588596&amp;status=done&amp;style=none&amp;taskId=u2afc3cd2-dd40-4145-a6e4-cc1ec7289de&amp;title=&amp;width=1505.4545128246978" alt="image.png" class="img_ev3q">
上边是对个人贡献开源产品流程建议，适用于大多数开源项目的贡献。额外在开源上我觉得Nacos是不错的选择，首先产品定位是比较基础，能帮助开发者沉淀更通用的领域能力，社区活跃度能保持全国第六，并且在微服务领域已经被广泛使用，能帮助个人很好的放大价值。
再就是Nacos的熟悉产品也会比较简单，Nacos.io 官网可以帮助你快速入门，也有Nacos电子书免费下载帮助你深度了解Nacos架构设计。贡献开源上可以从Nacos社区仓库中 good first issues开始，跟着产品演进的方向，从小事开始在社区中发声，最后在Nacos社区有很多核心模块需要主导者，并且在社区中成为核心贡献者有社区投票权利，主导未来Nacos发展方向，并且作为社区核心成员，会有很多线上线下分享的机会，帮助个人以及企业建立更多社会影响力。总之在开源领域其实只要你愿意熟悉，一定会有所收获，祝愿每一位开发者在自己喜欢的领域能做出你想要的产品。最后感谢Nacos开源社区每一位同学！</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos开源之夏，贡献社区赢取12000奖金]]></title>
            <link>https://nacos.io/en/blog/iscas2022</link>
            <guid>https://nacos.io/en/blog/iscas2022</guid>
            <pubDate>Mon, 16 May 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[欢迎在校同学们参与Nacos开源之夏，社区导师手把手让**你的代码被社会广泛复用，来赚取最高12000奖金，可**推荐入职/实习你心意公司，**又拿钱又成长又有价值**，你还等什么呢？报名马上截止，快来参与Nacos开源之夏。]]></description>
            <content:encoded><![CDATA[<p>欢迎在校同学们参与Nacos开源之夏，社区导师手把手让<strong>你的代码被社会广泛复用，来赚取最高12000奖金，可</strong>推荐入职/实习你心意公司，<strong>又拿钱又成长又有价值</strong>，你还等什么呢？报名马上截止，快来参与Nacos开源之夏。</p><h1>开源之夏是什么？</h1><p>开源之夏是由“开源软件供应链点亮计划”发起并长期支持的一项暑期开源活动，旨在鼓励<strong>在校学生</strong>积极参与开源软件的开发维护，促进优秀开源软件社区的蓬勃发展，培养和发掘更多优秀的开发者。
活动联合国内外各大开源社区，针对重要开源软件的开发与维护提供项目任务，并面向全球高校学生开放报名。
学生可在本活动中自主选择感兴趣的项目任务进行申请，并在中选后获得该开源项目资深维护者（社区导师）亲自指导的机会，完成项目并贡献给社区后，参与学生还将获得开源之夏<strong>活动奖金</strong>和结项证书。</p><h1>Nacos&amp;开源之夏2022</h1><p>Nacos被评为2021Github年度<strong>全国社区活跃度第六</strong>，Nacos开源产品定位是更易于构建云原生应用的动态服务发现、配置管理和服务管理平台，用云原生方式解决分布式领域核心问题。
自2018年孵化并开源以来，共收获<strong>21.8K的star</strong>数，<strong>9.5K的Fork</strong>数，在开源中国发布的 2021 年度 OSC 中国开源项目评选中，Nacos 被评为<strong>云原生领域人气指数 Top5 </strong>的项目，发布电子书《Nacos 架构与原理》阅读量近<strong>10W+</strong>，现已被大量微服务架构的软件公司选型作为其服务注册与发现中心。目前在国内服务注册中心及配置管理领域中<strong>市场占有率排名第一</strong>。
此次Nacos社区开放的题目中包含了Nacos第三代架构的部分核心功能模块，将直接参与社区的核心功能，欢迎进入Nacos开源之夏参与Nacos3.0的建设，为未来五年开源微服务发展奠定基础。</p><h1>参与Nacos开源之夏条件</h1><ul><li>本活动面向年满 18 周岁在校学生。</li><li>暑期即将毕业的学生，只要在申请时学生证处在有效期内，就可以提交申请。</li><li>海外学生可提供录取通知书、学生卡、在读证明等文件用于证明学生身份。</li></ul><h1>参与Nacos开源之夏，你能获得什么？</h1><ol><li><strong>【你的代码被社会广泛复用】</strong>你的代码可能会运行在上万家企业核心业务逻辑中，帮助企业解决问题。</li><li><strong>【赢得最高12000奖金】</strong>奖金总额根据项目难度分为进阶 12000 元、基础 8000 元（注：奖金数额为税前人民币金额）</li><li><strong>【社区核心人员辅导快速成长】</strong>只要你报名被选中，每个题目的导师会精心手把手教你融入社区，帮助你完成题目的设计以及最终的落地。</li><li><strong>【推荐入职/实习】</strong>在本次编程之夏项目中表现优秀同学，可推荐入职/实习 你心意的公司工作。</li><li><strong>【额外获得社区礼包】</strong>所有参与本次编程之夏项目的同学，均可获得Nacos社区大礼包。</li></ol><p><strong>百分百有奖品拿哦</strong>，现在唯一的问题是时间不多了，赶紧上车报名，截止报名时间是6月4日，6个核心题目，快点来报名参与Nacos编程之夏吧。</p><h1>报名方式</h1><p>点开Nacos开源之夏的<a href="https://summer-ospp.ac.cn/#/org/orgdetail/ab188e59-fab8-468f-bc89-bdc2bd8b5e64/" target="_blank" rel="noopener noreferrer">链接</a> 选择你喜欢的题目，Nacos社区围绕Nacos第三代架构精心计划了题目包含 “服务网格生态”、“多数据源建设”、“CoreDNS支持”、“K8S元数据同步”、“Nacos2.X建设”等技术方向展开。进行报名。
具体流程请参考<a href="https://summer-ospp.ac.cn/#/org/orgdetail/ab188e59-fab8-468f-bc89-bdc2bd8b5e64/" target="_blank" rel="noopener noreferrer">学生指南</a>访问可能会比较慢，请多等一下）
请注意找导师沟通截止流程时间，优先更导师沟通，能帮助你更好的了解题目。
想要报名的同学，请用钉钉扫码加入Nacos开源之夏2022钉钉群，方便大家交流题目内容。
<img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2022/png/11189/1652672158622-1a7de1a7-71da-4e80-aae9-13c6e5da821a.png#clientId=u35054081-9c85-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=617&amp;id=u3760c18e&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1632&amp;originWidth=1180&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=567452&amp;status=done&amp;style=none&amp;taskId=uef4eb68f-7e3e-4666-9a58-75d730e5cee&amp;title=&amp;width=446" alt="image.png" class="img_ev3q"></p><h1>参考资料</h1><p>Nacos Github：<a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos</a>
Nacos 官网：<a href="http://nacos.io" target="_blank" rel="noopener noreferrer">http://nacos.io</a>
为了让同学们更好地了解Nacos，我们提供了<a href="https://www.yuque.com/nacos/ebook" target="_blank" rel="noopener noreferrer">电子书</a>供大家阅读学习
对于微服务分布式事务有兴趣的同学，可以尝试填报<a href="https://mp.weixin.qq.com/s?__biz=Mzg2MTI2NDk2OQ==&amp;tempkey=MTE2NV9GNy9EWjczbFo5MkFoUCtXNWxnSEVlOXVicGREUHdDQXRVSW5NcTIwSWlhdE5BN2ltQUdBZWJNY050dzBaYXNKY0tBY1NEQ0VVbXpDNE9FMmg0eDBjUlZ0YWtlQ2lyZ2xrZEFfa0drQVFnaXRNUnYwSmZtMHZTTG0wRWdieTJwd3E2dlpTNE5EQzd0V0xiMlhEcjZSMl91WXB5by1Eb3ViX1VSektnfn4%3D&amp;chksm=4e188949796f005f87426542ac16c92bcdbb1248e8e9037afce0578920abd2dbf50d70553d5f&amp;mpshare=1&amp;srcid=0516E1M5ZS8oOWMl6bsdw8y0&amp;sharer_sharetime=1652684375116&amp;sharer_shareid=8056836193d95a1bb0631fa63ab5cc6a&amp;from=singlemessage&amp;scene=1&amp;subscene=10000&amp;clicktime=1652684382&amp;enterid=1652684382&amp;sessionid=0&amp;ascene=1&amp;realreporttime=1652684382988&amp;forceh5=1&amp;devicetype=android-30&amp;version=280016f8&amp;nettype=WIFI&amp;abtest_cookie=AAACAA%3D%3D&amp;lang=zh_CN&amp;exportkey=Af09sJIUNjyWxPx5MSjG0ws%3D&amp;pass_ticket=Ya0UtGtqSRfT4xcALdBO4s67oKTP%2FA3goUGjkSf4jSEBSJD%2FW0YVQqHwZQ5v0D%2FY&amp;wx_header=3" target="_blank" rel="noopener noreferrer">Seata开源之夏</a> 参与开源之夏
</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos 2.1.0版本发布，支持鉴权及加解密插件]]></title>
            <link>https://nacos.io/en/blog/2.1.0-release</link>
            <guid>https://nacos.io/en/blog/2.1.0-release</guid>
            <pubDate>Fri, 29 Apr 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos 2.1.0版本发布，支持鉴权及加解密插件]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="210">2.1.0<a href="#210" class="hash-link" aria-label="Direct link to 2.1.0" title="Direct link to 2.1.0">​</a></h2><p>在社区和开源之夏的导师同学的共同努力下，2.1.0版本的主要目标已经基本完成，经过了近1个月的Beta测试后，在51劳动节，Nacos社区发布2.1.0版本作为给所有社区参与者的劳动节礼物。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="新版本内容">新版本内容<a href="#新版本内容" class="hash-link" aria-label="Direct link to 新版本内容" title="Direct link to 新版本内容">​</a></h3><p>2.1.0版本主要增加了认证插件和配置加密插件能力。 并关闭默认支持服务端从 1.X 版本升级的能力，若需要使用平滑升级能力，需要在配置文件中开启此功能。
对于客户端，此版本重构了类扫描逻辑并删除了 org.reflections 依赖，以解决 org.reflections 冲突时的不兼容问题。
最后，这个版本做了一些控制台优化并修复了 2.0.4 中发现的一些问题。
详细变更日志如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Features</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5695] Add a plugin SPI for configuration encryption and decryption for Nacos 2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5696] Add a plugin SPI for authentication for Nacos 2.0.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#7930] Default close support upgrade from 1.X feature.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#7992] Support cluster grpc client to set thread pool size.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#8220] Add reset raft cluster operation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Enhancement &amp; Refactor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#7487] Add generics for the CacheBuilder.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#7879] Refactor destroy method of AbstractMemberLookup.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#7924][#8214] Add ldap auth plugin.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#7952] Ignore read request for raft follower's state machine to enhance raft stability.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#7966] Add more information in Auth/Distro/Curcuit-Filter when cause some server error.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#7971] Stop version judge Task and release thread after upgrade completely.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#8072] Enhance memory cost in DistroProtocol initialization.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#8107] Enhance console change password operation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#8156] Support js and css of console auto-upgrade. </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## BugFix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#1717][#7359] Fix XSS vulnerabilities.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6273] Fix loop request for offline server nodes API.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6999] Fix Nacos client does not support logback overload log configuration.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#7757] Fix jraft read request deserialize to write request problem. </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#7780] Fix config a-b-a problem.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#7941] Fix version comparison error in Config Detail page.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#8087] Fix text out of box in configuration manager.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#8108] Fix throw NPR for health check for v2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#8050] Fix configuration about Distro changes could not take effect.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#8161] Fix console can't use relative path problem.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#8163] Fix multi-instance share the same local snapshot.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#8196] Fix subscriber api without count when the query number is more than subscriber count.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Dependency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#7758] Update module nacos-consistency protobuf-maven-plugin version to 0.6.1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#7886] Enhance package scan logic and remove org.reflections dependency.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4981] Add much unit test.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#8009] Fix NPE of unit test. </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="插件化">插件化<a href="#插件化" class="hash-link" aria-label="Direct link to 插件化" title="Direct link to 插件化">​</a></h3><p>支持插件化是2.1.0版本的主要改动之一。Nacos通过<a href="https://docs.oracle.com/javase/tutorial/sound/SPI-intro.html" target="_blank" rel="noopener noreferrer">SPI</a> 的方式，允许用户和开发者实现自己的对应功能插件使用；目前Nacos已经支持鉴权和加解密的插件化能力。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="鉴权">鉴权<a href="#鉴权" class="hash-link" aria-label="Direct link to 鉴权" title="Direct link to 鉴权">​</a></h4><p>自从Nacos 1.2 版本加入鉴权功能后，社区对鉴权功能的讨论一直持续。原因是Nacos目前的鉴权系统设计为防止错用及用户隔离。但社区中对鉴权能力的要求不局限于此，为了满足不同的用户对鉴权程度的不同要求。Nacos社区希望设计一套用于鉴权的API，并将其注入到网络请求的流程中。
Nacos目前的鉴权实现也已经重构成默认的鉴权插件，社区所贡献的LADP也已改造完成，使用方式和以前一致；如果需要开发自定义的鉴权插件，可以参考文档<a href="https://nacos.io/zh-cn/docs/auth-plugin.html" target="_blank" rel="noopener noreferrer">鉴权插件</a>实现。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="加解密">加解密<a href="#加解密" class="hash-link" aria-label="Direct link to 加解密" title="Direct link to 加解密">​</a></h4><p>在Nacos社区中，许多用户关注配置中某些敏感信息的安全性问题。除了通过鉴权，社区也希望能对配置内容中的敏感信息进行加密。由于用户和开发者所使用或对接的算法和加解密系统可能不同，因此Nacos社区设计了一套用于加解密的API，并将其注入到发布和查询配置的工作流程中。 更多加解密插件的细节可以参考文档<a href="https://nacos.io/zh-cn/docs/config-encryption.html" target="_blank" rel="noopener noreferrer">配置加密插件</a>。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="默认关闭兼容1x服务端升级">默认关闭兼容1.X服务端升级<a href="#默认关闭兼容1x服务端升级" class="hash-link" aria-label="Direct link to 默认关闭兼容1.X服务端升级" title="Direct link to 默认关闭兼容1.X服务端升级">​</a></h3><p>默认关闭支持服务端从 1.X 版本升级的能力是Nacos2.1.0版本的另一个重要改动。在2.0.X版本中，数据结构进行了一些重新设计，导致和1.X的数据无法直接兼容，为了方便社区用户从1.X平滑升级到Nacos2.0版本，Nacos2.0版本除了兼容1.X的openAPI外，还新增了双写数据等逻辑；但这部分逻辑对系统资源有较大的损耗，并且由于机制较为复杂，导致部分直接使用2.0版本的用户可能会遇到一些版本切换的疑问。因此在Nacos2.1版本中，我们默认关闭了兼容1.X服务端平滑升级能功能，关闭该功能后直接部署2.1版本将不会再从1.X模式进行检测和升级，而是直接运行在2.X的数据模式下，同时也支持2.0版本直接升级2.1版本。
若是希望从Nacos1.X直接升级到Nacos2.1.0版本，则需要在application.properties文件中设置配置<code>nacos.core.support.upgrade.from.1x=true</code>，此时Nacos2.1版本会和Nacos2.0版本一样，以1.X的数据模式启动，并开始自动升级检测，待全集群数据一致，且准备完毕后，切换至2.0数据模式，更多升级相关的内容，请参考文档<a href="https://nacos.io/zh-cn/docs/2.0.0-upgrading.html" target="_blank" rel="noopener noreferrer">升级文档</a>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="社区">社区<a href="#社区" class="hash-link" aria-label="Direct link to 社区" title="Direct link to 社区">​</a></h2><p>在过去的一年里，社区内涌现出大量优秀的贡献者，他们为Nacos社区持续不断的注入活力和内容；正是有你们的关注和贡献，Nacos才能在2021年获得开源中国最受欢迎项目的奖项，在此郑重感谢去年参与社区贡献的Contributor，Committer和PMC同学，以及其他通过各种方式参与到社区的同学。
感谢同学们的持续贡献，正是有了大家的共同努力，Nacos才能变得越来越完善。
<img loading="lazy" alt="OSCHINA-Nacos.jpg" src="/en/assets/images/OSCHINA-Nacos-c0f45767945adb99c40d288571859928.jpg" width="425" height="374" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="新pmccommitter">新PMC&amp;Committer<a href="#新pmccommitter" class="hash-link" aria-label="Direct link to 新PMC&amp;Committer" title="Direct link to 新PMC&amp;Committer">​</a></h3><p>Nacos社区新晋级了一位PMC同学和两位Committer同学。
来自滴滴出行的<a href="https://github.com/sanxun0325" target="_blank" rel="noopener noreferrer">sanxun0325</a>同学作为Nacos，Dubbo Go，Sentinal的Committer，在社区十分活跃，在过去的2021年也是为Nacos社区的go-sdk做出了大量贡献，并主导着Nacos-go-sdk社区的发展；因此提名为Nacos社区的PMC。</p><p>另外，来自微众银行<a href="https://github.com/MajorHe1" target="_blank" rel="noopener noreferrer">MajorHe1</a>和小米科技<a href="https://github.com/hujun-w-2" target="_blank" rel="noopener noreferrer">hujun-w-2</a>同学，鉴于持续的大量社区贡献，经社区PMC及Committer的投票表决，提名为Nacos社区的Committer，希望二位能继续保持活跃，为Nacos社区添砖加瓦。</p><table><thead><tr><th><img loading="lazy" alt="MajorHe1-committer.jpg" src="/en/assets/images/MajorHe1-committer-4038e3a71272e268c19a01ce28f8c42a.jpg" width="1280" height="960" class="img_ev3q"></th><th><img loading="lazy" alt="hujun-w-2-committer.jpg" src="/en/assets/images/hujun-w-2-committer-08d24acd7489c375fc46b90cd39eed9e.jpg" width="1280" height="960" class="img_ev3q"></th></tr></thead></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="年度优秀committer">年度优秀Committer<a href="#年度优秀committer" class="hash-link" aria-label="Direct link to 年度优秀Committer" title="Direct link to 年度优秀Committer">​</a></h3><p>2021年度，Nacos社区有许多Committer利用自己的业余时间，持续的贡献者Nacos社区。为了感谢，Nacos社区评选出了12位2021年度优秀Committer，并特意制作了奖杯及卫衣，希望在2022年度，仍然能看到你们的身影。
这12位优秀Committer分别是（根据字母顺序）：</p><ul><li><a href="https://github.com/brotherlu-xcq" target="_blank" rel="noopener noreferrer">brotherlu-xcq</a></li><li><a href="https://github.com/catcherwong" target="_blank" rel="noopener noreferrer">catcherwong</a></li><li><a href="https://github.com/haoyann" target="_blank" rel="noopener noreferrer">haoyann</a></li><li><a href="https://github.com/horizonzy" target="_blank" rel="noopener noreferrer">horizonzy</a></li><li><a href="https://github.com/KomachiSion" target="_blank" rel="noopener noreferrer">KomachiSion</a></li><li><a href="https://github.com/li-xiao-shuang" target="_blank" rel="noopener noreferrer">li-xiao-shuang</a></li><li><a href="https://github.com/paderlol" target="_blank" rel="noopener noreferrer">paderlol</a></li><li><a href="https://github.com/realJackSun" target="_blank" rel="noopener noreferrer">realJackSun</a></li><li><a href="https://github.com/sanxun0325" target="_blank" rel="noopener noreferrer">sanxun0325</a></li><li><a href="https://github.com/shiyiyue1102" target="_blank" rel="noopener noreferrer">shiyiyue1102</a></li><li><a href="https://github.com/TTTTTAAAAAKKKKEEEENNNN" target="_blank" rel="noopener noreferrer">TTTTTAAAAAKKKKEEEENNNN</a></li><li><a href="https://github.com/xuechaos" target="_blank" rel="noopener noreferrer">xuechaos</a></li></ul><p>没有被选中的Committer同学也不要担心，2022年度我们仍然会保持这个活动，希望2022年度优秀Committer有你们的名字。
<img loading="lazy" alt="2021-committer-rewards.JPG" src="/en/assets/images/2021-committer-rewards-b1f798cc68b22efce3354e422840fe7a.JPG" width="567" height="756" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="贡献者激励活动">贡献者激励活动<a href="#贡献者激励活动" class="hash-link" aria-label="Direct link to 贡献者激励活动" title="Direct link to 贡献者激励活动">​</a></h3><p>相信很多贡献者都已经收到了Nacos寄出的小礼物了，此类的活动Nacos社区会持续进行，只需要您持续关注社区，积极参与社区共建，就能够获得哦。
<img loading="lazy" alt="Nacos-cup.jpg" src="/en/assets/images/Nacos-cup-4921e262dbf2a53cb64dc3096f5b454f.jpg" width="425" height="567" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="代码贡献活动">代码贡献活动<a href="#代码贡献活动" class="hash-link" aria-label="Direct link to 代码贡献活动" title="Direct link to 代码贡献活动">​</a></h4><p>Nacos社区预计在7月会再次进行贡献者的激励活动，届时会统计并评选出数十位2022年7月前较为活跃的贡献者（不仅是Nacos的主干仓库，也包含了nacos-group下的各个仓库），并寄出新的社区纪念礼品；下期的贡献者礼品是雨伞，赶紧进行贡献获取吧。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="优秀社区文章活动">优秀社区文章活动<a href="#优秀社区文章活动" class="hash-link" aria-label="Direct link to 优秀社区文章活动" title="Direct link to 优秀社区文章活动">​</a></h4><p>Nacos社区的贡献并不只包含代码，社区也欢迎广大用户或开发者发表技术文章来和大家分享关于Nacos的技术心得；其中包括但不限于：Nacos的应用、源码解析、产品融合和社区合作等。欢迎大家提交文章到Nacos官方文档的博客栏目中，或发布在自己的微信公众号及博客中；对于优秀的社区文章，Nacos社区会收录到博客栏目及阿里开源的官方网站中，并会给文章作者寄送相应的礼物。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="开源之夏2022">开源之夏2022<a href="#开源之夏2022" class="hash-link" aria-label="Direct link to 开源之夏2022" title="Direct link to 开源之夏2022">​</a></h4><p>在2021年，Nacos社区参与了由ISCAS（中国科学院软件研究所）和openEuler社区托管的开源之夏2021活动，在导师、高校同学和主办方的共同努力下，完成了数个意义非凡的课题，其中就包括本次发版中最关键的两个改动：鉴权插件及配置加密插件。
今年，开源之夏2022如期而至，Nacos社区也再次参与活动，并制定了6个课题，欢迎关注<a href="https://summer-ospp.ac.cn/nacos.io" target="_blank" rel="noopener noreferrer">开源之夏2022</a> ，参与Nacos的开源之夏2022。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="about-nacos">About Nacos<a href="#about-nacos" class="hash-link" aria-label="Direct link to About Nacos" title="Direct link to About Nacos">​</a></h3><p>Nacos 致力于帮助您发现、配置和管理微服务。Nacos 提供了一组简单易用的特性集，帮助您快速实现动态服务发现、服务配置、服务元数据及流量管理。
Nacos 帮助您更敏捷和容易地构建、交付和管理微服务平台。 Nacos 是构建以“服务”为中心的现代应用架构 (例如微服务范式、云原生范式) 的服务基础设施。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Install the HA Nacos cluster in Rainbond with one-click]]></title>
            <link>https://nacos.io/en/blog/use-nacos-with-rainbond</link>
            <guid>https://nacos.io/en/blog/use-nacos-with-rainbond</guid>
            <pubDate>Wed, 16 Mar 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[Current documentation describes how to install a high availability Nacos cluster with one click through Rainbond, a cloud native application management platform.]]></description>
            <content:encoded><![CDATA[<p>Current documentation describes how to install a high availability <a href="https://nacos.io" target="_blank" rel="noopener noreferrer">Nacos</a> cluster with one-click through <a href="https://www.rainbond.com/?channel=nacos" target="_blank" rel="noopener noreferrer">Rainbond</a>, a cloud native application management platform. This approach is suitable for users who are less familiar with Kubernetes, containerization and other complex technologies, and lowers the barrier to deploying Nacos in Kubernetes.</p><h1>Background</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="combination-of-rainbond-and-nacos">Combination of Rainbond and Nacos<a href="#combination-of-rainbond-and-nacos" class="hash-link" aria-label="Direct link to Combination of Rainbond and Nacos" title="Direct link to Combination of Rainbond and Nacos">​</a></h2><p>Rainbond is an easy to use open source cloud native application management platform. With the help of it, users can complete the deployment, operation and maintenance of microservices in a graphical interface. With the help of Kubernetes and containerization technology, automatic operation and maintenance capabilities such as fault self-healing and elastic expansion can be endowed to users' applications.</p><p>Rainbond has a built-in native Service Mesh microservice framework, and also has a good integration experience with other microservice frameworks such as Spring Cloud and Dubbo. Therefore, a large number of Rainbond users may also be users of the Nacos microservices registry. Instead of worrying about how to deploy a Nacos cluster, the Rainbond team made Nacos a one-click application template for free download and installation by open source users. This installation method greatly reduces the deployment burden of users using Nacos clusters. Currently, versions 1.4.2 and 2.0.4 are supported.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="about-application-template">About application template<a href="#about-application-template" class="hash-link" aria-label="Direct link to About application template" title="Direct link to About application template">​</a></h2><p>Application template is package manager for Rainbond cloud native application management platform. Users can install applications into Rainbond with one-click. No matter how complex the application is, the application template abstracts it into an package, which is installed with docker images of all the components, configuration information, and relationships between all the components.</p><h1>Prerequisite</h1><ul><li><p>Deployed Rainbond cloud native application management platform,<a href="https://www.rainbond.com/docs/quick-start/quick-install/?channel=nacos" target="_blank" rel="noopener noreferrer">Quick Start</a> Can run in a PC within a container.</p></li><li><p>Internet connection.</p></li></ul><h1>Quick Start</h1><ul><li><strong>Access the built-in open source app store</strong></li></ul><blockquote><p>Select the <strong>App Store</strong> on the left, switch to the <strong>Open Source App Store</strong>, and search <strong>nacos</strong> to find the Nacos-cluster application.</p></blockquote><p><img loading="lazy" src="https://static.goodrain.com/wechat/nacos-cluster/nacos-cluster-1.png" alt="nacos-1" class="img_ev3q"></p><ul><li><strong>One-click install</strong></li></ul><blockquote><p>Click <strong>Install</strong> on the right of nacos-Cluster to enter the installation page. After filling in simple information, click <strong>OK</strong> to start the installation, and the page automatically jumps to the topology view.</p></blockquote><p><img loading="lazy" src="https://static.goodrain.com/wechat/nacos-cluster/nacos-cluster-2.png" alt="nacos-2" class="img_ev3q"></p><p>Parameters：</p><table><thead><tr><th>Options</th><th>Instructions</th></tr></thead><tbody><tr><td>团队名称</td><td>User-defined workspace isolated by namespace</td></tr><tr><td>集群名称</td><td>Select which K8s cluster Nacos will be deployed to</td></tr><tr><td>选择应用</td><td>Select the application to which Nacos will be deployed, which contains several associated components</td></tr><tr><td>应用版本</td><td>Select the version of Nacos, the useable versions are 1.4.2 and 2.0.4</td></tr></tbody></table><p>After a few minutes, the Nacos cluster is installed and up and running.</p><p><img loading="lazy" src="https://static.goodrain.com/wechat/nacos-cluster/nacos-cluster-3.png" alt="nacos-3" class="img_ev3q"></p><ul><li><strong>Testing</strong></li></ul><p>Other microservice components that need to perform service registration can connect to the Nacos cluster using <code>${NACOS_HOST}:${NACOS_PORT}</code> after built <a href="https://www.rainbond.com/docs/use-manual/user-manual/component-connection/regist_and_discover" target="_blank" rel="noopener noreferrer">dependencies</a> to Nacos.</p><ul><li><p><strong>Service registration</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -X PUT </span><span class="token string" style="color:#e3116c">"http://</span><span class="token string variable" style="color:#36acaa">${NACOS_HOST}</span><span class="token string" style="color:#e3116c">:</span><span class="token string variable" style="color:#36acaa">${NACOS_PORT}</span><span class="token string" style="color:#e3116c">/nacos/v1/ns/instance?serviceName=nacos.naming.serviceName&amp;ip=20.18.7.10&amp;port=8080"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>Service discovery</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -X GET </span><span class="token string" style="color:#e3116c">"http://</span><span class="token string variable" style="color:#36acaa">${NACOS_HOST}</span><span class="token string" style="color:#e3116c">:</span><span class="token string variable" style="color:#36acaa">${NACOS_PORT}</span><span class="token string" style="color:#e3116c">/nacos/v1/ns/instance/list?serviceName=nacos.naming.serviceName"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>Publish config</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -X POST </span><span class="token string" style="color:#e3116c">"http://</span><span class="token string variable" style="color:#36acaa">${NACOS_HOST}</span><span class="token string" style="color:#e3116c">:</span><span class="token string variable" style="color:#36acaa">${NACOS_PORT}</span><span class="token string" style="color:#e3116c">/nacos/v1/cs/configs?dataId=nacos.cfg.dataId&amp;group=test&amp;content=helloWorld"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>Get config</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -X GET </span><span class="token string" style="color:#e3116c">"http://</span><span class="token string variable" style="color:#36acaa">${NACOS_HOST}</span><span class="token string" style="color:#e3116c">:</span><span class="token string variable" style="color:#36acaa">${NACOS_PORT}</span><span class="token string" style="color:#e3116c">/nacos/v1/cs/configs?dataId=nacos.cfg.dataId&amp;group=test"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h1>Advanced</h1><ul><li>The one-click installation of the Nacos cluster contains three instances, and the self-organizing and electing of the cluster is done automatically by initContailer.</li></ul><p><img loading="lazy" src="https://static.goodrain.com/wechat/nacos-cluster/nacos-cluster-4.png" alt="nacos-4" class="img_ev3q"></p><ul><li>Mysql is integrated as the data source by default. You can switch to other external data sources by configuring the following environment variables in the <strong>Nacos-server-2.0.4</strong> component's environment configuration.</li></ul><table><thead><tr><th>Name</th><th>Necessary</th><th>Description</th></tr></thead><tbody><tr><td><code>MYSQL_SERVICE_HOST</code></td><td>Y</td><td>Database address</td></tr><tr><td><code>MYSQL_SERVICE_PORT</code></td><td>Y</td><td>Database port</td></tr><tr><td><code>MYSQL_SERVICE_USER</code></td><td>Y</td><td>Database username</td></tr><tr><td><code>MYSQL_SERVICE_PASSWORD</code></td><td>Y</td><td>Database password</td></tr><tr><td><code>MYSQL_SERVICE_DB_NAME</code></td><td>Y</td><td>Database name</td></tr></tbody></table><ul><li><strong>Nacos-server-2.0.4</strong> data persistence directory is generated by default.</li></ul><p><img loading="lazy" src="https://static.goodrain.com/wechat/nacos-cluster/nacos-cluster-5.png" alt="nacos-5" class="img_ev3q"></p><ul><li>By default, the health check mechanism of <strong>Nacos-server-2.0.4</strong> is configured to ensure that instances are automatically offline when faults occur and online after recovery.</li></ul><p><img loading="lazy" src="https://static.goodrain.com/wechat/nacos-cluster/nacos-cluster-6.png" alt="nacos-6" class="img_ev3q"></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Apache APISIX Realizes Service Discovery Based on Nacos]]></title>
            <link>https://nacos.io/en/blog/apisix</link>
            <guid>https://nacos.io/en/blog/apisix</guid>
            <pubDate>Tue, 22 Feb 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[This article introduces the basic concepts of Apache APISIX and Nacos and Service Registry, and shows you the specific operation of Apache APISIX to realize service discovery based on Nacos.]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="apache-apisix-introduction">Apache APISIX Introduction<a href="#apache-apisix-introduction" class="hash-link" aria-label="Direct link to Apache APISIX Introduction" title="Direct link to Apache APISIX Introduction">​</a></h2><p><strong>Apache APISIX</strong> is a dynamic, real-time, high-performance API gateway.</p><p>APISIX provides rich traffic management features such as load balancing, dynamic upstream, canary release, circuit breaking, authentication, observability, and more. Apache APISIX not only has many practical plug-ins, but also supports plugin dynamic change and Hot-loading.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-introduction">Nacos Introduction<a href="#nacos-introduction" class="hash-link" aria-label="Direct link to Nacos Introduction" title="Direct link to Nacos Introduction">​</a></h2><p>Nacos is an easy-to-use, open source platform for dynamic service discovery, service configuration and service management.  It provides a set of simple and useful features enabling you to realize dynamic service discovery, service configuration, service metadata and traffic management. Nacos makes it easier and faster to construct, deliver and manage your microservices platform. It is the infrastructure that supports a service-centered modern application architecture with a microservices or cloud-native approach.</p><h1>Service Registry</h1><p>Service Registry is the core component of service management, similar to the role of directory service, and one of the most basic facilities in the microservices architecture. It is mainly used to store service information, such as service provider URL, routing information, and so on. The service registry is implemented by mapping complex service-side information to simple and understandable information for the client.</p><p>The core functions of the Service Registry are as follows:</p><ul><li><p>Service registration: Service providers register with the Service Registration Center.</p></li><li><p>Service discovery: Service consumers can find the call routing information of service providers through the registry.</p></li><li><p>Health check: Ensure that service nodes registered with the service registry can be invoked normally, and avoid the waste of call resources caused by invalid nodes.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-do-you-need-a-service-registry">Why do you need a service registry?<a href="#why-do-you-need-a-service-registry" class="hash-link" aria-label="Direct link to Why do you need a service registry?" title="Direct link to Why do you need a service registry?">​</a></h2><p>The registry is essentially to decouple service providers and service consumers. In the microservice system, each business service will call each other frequently, and the IP, port and other routing information of each service need to be managed uniformly. But how do you manage it? You can provide information about existing services to a unified service registry for management through the Service Registration function of the Service Registry.</p><p>From the above description, you can know that the registry can help users quickly find services and service addresses through mapping. As business updates iterate, services change frequently. Clients can still pull a list of services through the service discovery function of the registry after registering new services or service downtime on the service side. If the service node of the registry changes, the registry sends a request to notify the client to pull again.</p><p>If the service on the server side suddenly goes down and there is no feedback to the service registry, the client can show the service side its service status by actively reporting the heartbeat at regular intervals through the health check function of the service registry. If the service status is abnormal, the service registry will be notified, and the service registry can remove the down service nodes in time to avoid waste of resources.If the service on the server side suddenly goes down and there is no feedback to the service registry, the client can show the service side its service status by actively reporting the heartbeat at regular intervals through the health check function of the service registry. If the service status is abnormal, the service registry will be notified, and the service registry can remove the down service nodes in time to avoid waste of resources.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-application-scenarios-does-apache-apisix--nacos-provide-for-users">What application scenarios does Apache APISIX + Nacos provide for users?<a href="#what-application-scenarios-does-apache-apisix--nacos-provide-for-users" class="hash-link" aria-label="Direct link to What application scenarios does Apache APISIX + Nacos provide for users?" title="Direct link to What application scenarios does Apache APISIX + Nacos provide for users?">​</a></h2><p>Apache APISIX + Nacos can centralize business-independent control of each microservice node into Apache APISIX for unified management, that is, the ability to proxy and route forwarding interface services through Apache APISIX. After each microservice is registered on Nacos, Apache APISIX can obtain a list of services through Nacos's service discovery function and find the corresponding service address to implement dynamic proxy.</p><p><img loading="lazy" alt="img" src="/en/assets/images/apisix_en-0d9959bfcee96b44a6bf219efaa19863.png" width="949" height="705" class="img_ev3q"></p><h1>Apache APISIX realizes service discovery based on Nacos</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2><p>This article is based on the following environments.</p><ul><li>OS: Centos 7.9.</li><li>Apache APISIX 12.1.0, please refer to: <a href="https://apisix.apache.org/docs/apisix/how-to-build" target="_blank" rel="noopener noreferrer">Apache APISIX how-to-bulid</a>.</li><li>Nacos 2.0.4, please refer to: <a href="https://nacos.io/en-us/docs/quick-start.html" target="_blank" rel="noopener noreferrer">Nacos quick start</a></li><li>Node.js, please refer to: <a href="https://github.com/nodejs/help/wiki/Installation" target="_blank" rel="noopener noreferrer">node.js Installation</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-service-register">Step 1: Service Register<a href="#step-1-service-register" class="hash-link" aria-label="Direct link to Step 1: Service Register" title="Direct link to Step 1: Service Register">​</a></h2><ol><li>Use Node.js's Koa framework starts a simple test service on port 3005 as <a href="https://apisix.apache.org/docs/apisix/admin-api#upstream" target="_blank" rel="noopener noreferrer">upstream</a>.</li></ol><div class="language-JavaScript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-JavaScript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const Koa = require('koa');</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const app = new Koa();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app.use(async ctx =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ctx.body = 'Hello World';</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app.listen(3005);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Register the service on the command line by requesting the Nacos Open API.</li></ol><div class="language-Bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X POST 'http://127.0.0.1:8848/nacos/v1/ns/instance?serviceName=APISIX-NACOS&amp;ip=127.0.0.1&amp;port=3005&amp;ephemeral=false'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>After service registration, use the following command to query the current service.</li></ol><div class="language-Bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X GET 'http://127.0.0.1:8848/nacos/v1/ns/instance/list?serviceName=APISIX-NACOS'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Examples of correct returned results are as follows:</p><div class="language-JSON codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-JSON codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "name": "DEFAULT_GROUP@@APISIX-NACOS",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "groupName": "DEFAULT_GROUP",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "clusters": "",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "cacheMillis": 10000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "hosts": [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "instanceId": "127.0.0.1#3005#DEFAULT#DEFAULT_GROUP@@APISIX-NACOS",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "ip": "127.0.0.1",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "port": 3005,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "weight": 1.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "healthy": true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "enabled": true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "ephemeral": true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "clusterName": "DEFAULT",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "serviceName": "DEFAULT_GROUP@@APISIX-NACOS",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "metadata": {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "instanceHeartBeatInterval": 5000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "instanceHeartBeatTimeOut": 15000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "ipDeleteTimeout": 30000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "instanceIdGenerator": "simple"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "lastRefTime": 1643191399694,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "checksum": "",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "allIPs": false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "reachProtectionThreshold": false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "valid": true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-2added-nacos-route">Step 2:Added Nacos Route<a href="#step-2added-nacos-route" class="hash-link" aria-label="Direct link to Step 2:Added Nacos Route" title="Direct link to Step 2:Added Nacos Route">​</a></h2><p>Create a new route using the Admin API provided by Apache APISIX. APISIX selects the service discovery type to use through the <code>upstream.discovery_type</code> field. <code>upstream.service_name</code>  needs to be associated with the corresponding service name of the registry. Therefore, when creating a route, specify the service discovery type as Nacos.</p><div class="language-Shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl http://127.0.0.1:9080/apisix/admin/routes/1 -H 'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1' -X PUT -i -d '</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "uri": "/nacos/*",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "upstream": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "service_name": "APISIX-NACOS",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "type": "roundrobin",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "discovery_type": "nacos"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the above command, the request header <code>X-API-KEY</code> is the access token of the admin API, which can be viewed under <code>apisix.admin_key.key</code> in the<code>conf/config.yaml</code> file.</p><p>After successful addition, examples of correct returned results are as follows:</p><div class="language-JSON codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-JSON codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "action": "set",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "node": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "key": "\/apisix\/routes\/1",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "value": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "update_time": 1643191044,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "create_time": 1643176603,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "priority": 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "uri": "\/nacos\/*",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "upstream": {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "hash_on": "vars",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "discovery_type": "nacos",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "scheme": "http",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "pass_host": "pass",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "type": "roundrobin",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        "service_name": "APISIX-NACOS"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "id": "1",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      "status": 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In addition, you can also pass other service related parameters in <code>upstream.discovery_args</code>   to specify the namespace or group where the service is located. For details, please refer to the following table:</p><table><thead><tr><th><strong>Name</strong></th><th><strong>Type</strong></th><th><strong>Requirement</strong></th><th><strong>Default</strong></th><th><strong>Valid</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td>namespace_id</td><td>string</td><td>optional</td><td>public</td><td></td><td>This parameter is used to specify the namespace of the corresponding service</td></tr><tr><td>group_name</td><td>string</td><td>optional</td><td>DEFAULT_GROUP</td><td></td><td>This parameter is used to specify the group of the corresponding service</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-verify-configuration-results">Step 3: Verify configuration results<a href="#step-3-verify-configuration-results" class="hash-link" aria-label="Direct link to Step 3: Verify configuration results" title="Direct link to Step 3: Verify configuration results">​</a></h2><p>Use the following command to send the request to the route to be configured.</p><div class="language-Shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -i http://127.0.0.1:9080/nacos/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Examples of correct returned results are as follows:</p><div class="language-Apache codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Apache codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 200 OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: text/plain; charset=utf-8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Length: 11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection: keep-alive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Date: Thu, 27 Jan 2022 00:48:26 GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Server: APISIX/2.12.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello World</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It can be seen from the example that the new route in Apache APISIX can find the correct service address through Nacos service discovery and respond normally.</p><h1>Summary</h1><p>This article introduces the concept of registry and how Apache APISIX cooperates with Nacos to implement routing proxy based on service discovery. How to use Apache APISIX with Nacos in actual scenarios depends on the specific business requirements and past technical architecture.</p><p>To get more information about the <code>nacos</code> plugin description and full configuration list, you can refer to the <a href="https://apisix.apache.org/zh/docs/apisix/discovery/nacos" target="_blank" rel="noopener noreferrer">official documentation</a>.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos 2.0.3 Release, continue to improve stability.]]></title>
            <link>https://nacos.io/en/blog/2.0.3-release</link>
            <guid>https://nacos.io/en/blog/2.0.3-release</guid>
            <pubDate>Thu, 29 Jul 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos 2.0.3 Release, continue to improve stability.]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-203">Nacos 2.0.3<a href="#nacos-203" class="hash-link" aria-label="Direct link to Nacos 2.0.3" title="Direct link to Nacos 2.0.3">​</a></h2><p>Nacos2.0.3 中，Nacos社区继续针对1.X到2.0.X升级的健壮性和高可用做了充分优化，扫除上生产的稳定性忧虑；Java/Spring-boot/Golang/C#/Cpp多语言客户端也全面支持Nacos2.0，拉齐多语言代差；并且优化了大量控制台UI的易用功能，提升用户使用效率。</p><p>主要变更内容如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Features</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6384] Add redo feature for nacos client naming.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Enhancement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#1469] Add cluster delete button.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5884] Add the permission for history config.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5909] Enhance LADP auth log print out when auth check failed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5999] Adpat nacos endpoint in AddressServerMemberLookup.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6100] Enhance config managerment UI.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6129] Add ServerConfigChangeEvent when config file changed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6142] Redo register and subscribe when reconnection auth check failed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6160] Optimization of IP address acquisition method in nacos client.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6175] If the client already disconnect, ignore this request to avoid NPE.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6178] Unified configuration page style</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6204] Get data from database if user or role info not found in cache.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6367] Add IOReactorExceptionHandler to avoid IOReactor out of loop when meet unknown Network error.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6386] Stop v1 distro verification when cluster upgraded to v2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6403] Make the expired time of naming client be configurable in nacos-server.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## BugFix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6107] Fix Chinese account show with gibber in home page.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6109] Fix get InstanceUpgradeHelper instance error for double write service.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6116] Fix unable to check client beats when register same ip and port in old clients with high concurrent.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6169] Fix cluster page internationalization.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6198] Fix NPE when use StringUtils.join illegal.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6295] Fix instance metadata will not be removed for ip port client.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6335] Fix startup error when the JAVA_HOME path contains spaces under Linux/Unix/Mac system.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6382][#6476] Fix nacos-istio serviceInfo.getChecksum() always is empty.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#6423] Fix yaml parse concurrent problem.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>完整的Release Note请查看 <a href="https://github.com/alibaba/nacos/releases/tag/2.0.3" target="_blank" rel="noopener noreferrer">2.0.3</a> 。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="从nacos1x升级nacos20x">从Nacos1.X升级Nacos2.0.X<a href="#从nacos1x升级nacos20x" class="hash-link" aria-label="Direct link to 从Nacos1.X升级Nacos2.0.X" title="Direct link to 从Nacos1.X升级Nacos2.0.X">​</a></h2><p>Nacos服务端支持从1.X平滑升级到Nacos2.0.X；由于Nacos2.0对服务发现的数据结构进行了重构，因此升级过程中会采用异步双写数据的功能，在升级到2.0模式前，对数据进行校验，保证升级过程中的稳定运行。</p><p>在集群所有节点都升级到Nacos2.0.X版本之后，集群中的每一台节点都将开启自检，检查Nacos1.X模式下的数据是否和Nacos2.0模式下的数据一致，主要对比的是两个模式下的服务数及实例数是否相等，以及是否还有双写任务。
只有服务数及实例数相等，且没有双写任务之后，Nacos节点才会判定自身节点已经准备好升级到2.0模式，可以通过控制台的集群管理中节点元数据的<code>readyToUpgrade</code>字段来判断该节点是否准备完成。</p><p>当集群中所有节点都完成准备后，集群节点将会切换运行模式到2.0模式，此时请求流量将会切换至2.0模式运行，且开始接受gRPC的请求。如果未切换时，来自gRPC的请求将会提示<code>Nacos cluster is running with 1.X mode, can't accept gRPC request temporarily. Please check the server status or close Double write to force open 2.0 mode.</code></p><p>另外，从Nacos2.0.2版本开始，Nacos为升级添加了一些接口方便用户检查升级状态，找到升级到2.0模式不成功的原因，并且在特殊情况下能够进行主动补偿。</p><p>比如接口<code>/nacos/v1/ns/upgrade/ops/metrics</code>， 可以快速的查看到当前节点的状态，如当前1.X模式的服务数，实例数；2.0模式的服务数，实例数；双写任务遗留量；对应模式缺失的服务名等等内容，帮助用户快速定位升级问题。</p><p>更多升级相关信息请查看 <a href="https://nacos.io/zh-cn/docs/2.0.0-upgrading.html" target="_blank" rel="noopener noreferrer">Nacos 2.0 升级文档</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="客户端支持20">客户端支持2.0<a href="#客户端支持20" class="hash-link" aria-label="Direct link to 客户端支持2.0" title="Direct link to 客户端支持2.0">​</a></h2><p>目前Golang、C#、Cpp、nacos-spring-boot，客户端已经支持了nacos2.0的grpc能力，欢迎大家试用
​</p><ul><li><a href="https://github.com/nacos-group/nacos-spring-boot-project/releases/tag/0.1.10" target="_blank" rel="noopener noreferrer">nacos-spring-boot v0.1.10</a></li><li><a href="https://github.com/nacos-group/nacos-spring-boot-project/releases/tag/0.2.10" target="_blank" rel="noopener noreferrer">nacos-spring-boot v0.2.10</a></li><li><a href="https://github.com/nacos-group/nacos-sdk-go/releases/tag/v2.0.0-Alpha.1" target="_blank" rel="noopener noreferrer">nacos-sdk-go v2.0.0-Alpha.1</a></li><li><a href="https://github.com/nacos-group/nacos-sdk-csharp/releases/tag/v1.1.0" target="_blank" rel="noopener noreferrer">nacos-sdk-csharp v1.1.0</a></li><li><a href="https://github.com/nacos-group/nacos-sdk-cpp/releases/tag/1.0.8" target="_blank" rel="noopener noreferrer">nacos-sdk-cpp v1.0.8</a></li></ul><p>Python的多语言客户端正在紧张开发中，相信很快能与大家见面。 Nodejs部分欢迎社区小伙伴一起参与建设~</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="21版本预告">2.1版本预告<a href="#21版本预告" class="hash-link" aria-label="Direct link to 2.1版本预告" title="Direct link to 2.1版本预告">​</a></h2><p>自2.0版本12月初社区发布后，经过数个版本的优化，功能和性能趋于稳定；因此社区开始规划2.1版本。</p><p>在Nacos2.1版本中，我们计划移除对Nacos1.X服务端的升级支持，以移除1.X模式及双写等冗余代码，提升代码质量及可读性，用户仍可以从2.0.X版本进行升级。</p><p>在功能上，Nacos2.1版本将会开放部分功能的插件化能力，如已经在进行的Selector插件，鉴权插件及配置加解密插件。</p><p>另外，我们会对Nacos2.0的第三方依赖进行一些精简，减少用户使用过程中依赖冲突的问题。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="社区">社区<a href="#社区" class="hash-link" aria-label="Direct link to 社区" title="Direct link to 社区">​</a></h2><p>感谢来自社区同学们的持续贡献，正是有了大家的共同努力，Nacos才能变得越来越完善。</p><p>在此郑重感谢对本次Release有卓越贡献的社区同学（根据字母顺序）：</p><ul><li><a href="https://github.com/brotherlu-xcq" target="_blank" rel="noopener noreferrer">brotherlu-xcq</a></li><li><a href="https://github.com/MajorHe1" target="_blank" rel="noopener noreferrer">MajorHe1</a></li><li><a href="https://github.com/pixystone" target="_blank" rel="noopener noreferrer">pixystone</a></li><li><a href="https://github.com/shalk" target="_blank" rel="noopener noreferrer">shalk</a></li><li><a href="https://github.com/SunJiFengPlus" target="_blank" rel="noopener noreferrer">SunJiFengPlus</a></li><li><a href="https://github.com/zzq1314zll" target="_blank" rel="noopener noreferrer">zzq1314zll</a></li></ul><p>期待各位成为Nacos committer。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="about-nacos">About Nacos<a href="#about-nacos" class="hash-link" aria-label="Direct link to About Nacos" title="Direct link to About Nacos">​</a></h2><p>Nacos 致力于帮助您发现、配置和管理微服务。Nacos 提供了一组简单易用的特性集，帮助您快速实现动态服务发现、服务配置、服务元数据及流量管理。</p><p>Nacos 帮助您更敏捷和容易地构建、交付和管理微服务平台。 Nacos 是构建以“服务”为中心的现代应用架构 (例如微服务范式、云原生范式) 的服务基础设施。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Performance comparison between Nacos 2.0 upgrading or not.]]></title>
            <link>https://nacos.io/en/blog/performance-compare</link>
            <guid>https://nacos.io/en/blog/performance-compare</guid>
            <pubDate>Thu, 29 Jul 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos 2.0 improved the performance about 10 times by upgrading the communication protocol, framework, and data model, to solve the performance problems gradually exposed after the release of Nacos 1.0. In this article, Nacos1.0, Nacos1.0 upgrade Nacos2.0 process, Nacos2.0 to conduct a comprehensive performance comparison, in order to intuitively show the performance improvement brought by Nacos2.0.]]></description>
            <content:encoded><![CDATA[<p>Nacos2.0通过升级通信协议和框架、数据模型的方式将性能提升了约10倍，解决继 Nacos 1.0 发布逐步暴露的性能问题。本文通过压测 Nacos1.0，Nacos1.0升级Nacos2.0过程中，Nacos2.0 进行全面性能对比，直观的展示Nacos2.0所带来的性能提升。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="压测准备">压测准备<a href="#压测准备" class="hash-link" aria-label="Direct link to 压测准备" title="Direct link to 压测准备">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="环境准备">环境准备<a href="#环境准备" class="hash-link" aria-label="Direct link to 环境准备" title="Direct link to 环境准备">​</a></h3><p>为了方便Nacos部署升级和展示核心性能指标，我们是从<a href="https://cn.aliyun.com/product/aliware/mse" target="_blank" rel="noopener noreferrer">阿里云微服务引擎MSE</a>中购买的一个2核CPU+4G内存的三节点Nacos集群。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="压测模型">压测模型<a href="#压测模型" class="hash-link" aria-label="Direct link to 压测模型" title="Direct link to 压测模型">​</a></h3><p>为了展示不同规模下的系统表现，我们采用逐步增压的方式进行压测，将压力分为3个批次进行逐步启动，并观察每个批次下集群的运行表现。同时会在压力集群之外，再增加一个Dubbo服务的Demo，并使用Jmeter以100TPS的压力不停的调用，以模拟不同压力下，对实际业务调用存在的可能影响。</p><p>压测过程中，会在适当的时候对服务端和客户端进行升级；服务端的升级将直接使用MSE提供的一键升级功能，客户端的升级会使用分批次轮流重启的方式进行。</p><p><img loading="lazy" alt="压测模型" src="/en/assets/images/performance_model-97b609e8d29e6ec0b5b084d1da365c25.jpg" width="1550" height="732" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="压测过程">压测过程<a href="#压测过程" class="hash-link" aria-label="Direct link to 压测过程" title="Direct link to 压测过程">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nacos1x-server--nacos1x-client">Nacos1.X Server + Nacos1.X Client<a href="#nacos1x-server--nacos1x-client" class="hash-link" aria-label="Direct link to Nacos1.X Server + Nacos1.X Client" title="Direct link to Nacos1.X Server + Nacos1.X Client">​</a></h3><p>首先启动第一批施压集群，对MSE Nacos1.2.1进行施压，在6000个Providers的压力下，集群稳定时CPU大约25%，能够稳定保持6000实例。</p><p><img loading="lazy" alt="1.X6000实例CPU" src="/en/assets/images/1_6000_cpu-baab16c555248319a7e3751f105cb749.jpg" width="3098" height="508" class="img_ev3q">
<img loading="lazy" alt="1.X6000实例" src="/en/assets/images/1_6000_instance-aee611f962310aa4be0f35730054ff5f.jpg" width="3096" height="504" class="img_ev3q"></p><p>随后启动第二批施压集群，增加4000个Provider，合集10000个Provider。此时集群峰值CPU已经达到60%，稳定运行时大约在45%左右，集群能够稳定运行。</p><p><img loading="lazy" alt="1.X10000实例CPU" src="/en/assets/images/1_10000_cpu-a695b8af2bbff9a9109f1724f1d1b74a.jpg" width="3060" height="490" class="img_ev3q">
<img loading="lazy" alt="1.X10000实例" src="/en/assets/images/1_10000_instance-ce3c6f41290b3243a49d0824d5af1bbb.jpg" width="3024" height="502" class="img_ev3q"></p><p>在前两批的压力下，集群没有出现稳定性问题，所以Dubbo的调用保持正常，没有错误发生。</p><p><img loading="lazy" alt="1.X10000实例Dubbo" src="/en/assets/images/1_10000_dubbo-da8dd7d0766c57e101626142e0bb3760.png" width="1064" height="481" class="img_ev3q"></p><p>当第三批施压集群启动之后，压力总计14000个Provider。此时集群先是短暂的注册到13000个实例，之后很快出现实例数下跌，CPU跑满的问题。并且缩小时间范围可以看到，下跌后的实例仍然在小范围抖动。</p><p><img loading="lazy" alt="1.X14000实例CPU" src="/en/assets/images/1_14000_cpu-00b8c49ccf573f6c05ee87135f6af20e.jpg" width="3030" height="496" class="img_ev3q">
<img loading="lazy" alt="1.X14000实例" src="/en/assets/images/1_14000_instance-a8b02f1b13cf6309300be3004b5ac67c.jpg" width="3018" height="480" class="img_ev3q">
<img loading="lazy" alt="1.X14000实例抖动" src="/en/assets/images/1_14000_instance_shake-40f671422fd0ee548fedf18251dd90db.jpg" width="3026" height="512" class="img_ev3q"></p><p>同时Dubbo的调用出现错误，从Consumer的日志可以看出，是由于服务端无法支撑这个级别的压力，导致Dubbo Provider被摘除，所以调用的时候出现了<code>No provider</code>的错误。</p><p><img loading="lazy" alt="1.X14000实例Dubbo" src="/en/assets/images/1_14000_dubbo-5fa816b30338e3e9cd77fe21c416e649.png" width="1064" height="481" class="img_ev3q">
<img loading="lazy" alt="1.X14000实例Dubbo错误" src="/en/assets/images/1_14000_dubbo_error-dac9eef0c76a5d4b3d53175d66edd504.jpg" width="3566" height="312" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nacos2x-server--nacos1x-client">Nacos2.X Server + Nacos1.X Client<a href="#nacos2x-server--nacos1x-client" class="hash-link" aria-label="Direct link to Nacos2.X Server + Nacos1.X Client" title="Direct link to Nacos2.X Server + Nacos1.X Client">​</a></h3><p>由于服务端升级期间，会进行实例的双写操作，因此在升级过程中服务端存储的实例数会是实际实例值的两倍。根据上述测试结果，需要先将实例数回滚回第一批6000实例之后，或是升级配置扩容机器之后再尝试升级。本文使用回滚压力的方式，先停止后启动的施压集群。让集群恢复正常后再执行升级。</p><p><img loading="lazy" alt="升级前6000实例CPU" src="/en/assets/images/before_upgrade_cpu-d1c74733549728383a3fa828af094e3a.jpg" width="3088" height="486" class="img_ev3q">
<img loading="lazy" alt="升级前6000实例" src="/en/assets/images/before_upgrade_instance-2fe6c5eb295715f6124ce8e752d9c4b9.jpg" width="3052" height="482" class="img_ev3q">
<img loading="lazy" alt="升级前6000实例Dubbo" src="/en/assets/images/before_upgrade_dubbo-aa23e93668a3100461e9857ace56e8b1.png" width="1064" height="481" class="img_ev3q"></p><p>从监控图中可以看出，在停止后两批压力后，集群很快就恢复到了正常，运行稳定，Dubbo调用也恢复正常。之后使用MSE的升级功能，进行升级。升级过程中由于双写的性能损耗，导致CPU有较大的抖动；而且因为双写导致的实例数翻倍，实际上相当于12000实例的极限压力，服务端仍然有一定的抖动，因此导致了些许Dubbo的错误。若是在非极限压力下升级，将不会有此影响。</p><p><img loading="lazy" alt="升级后14000实例CPU" src="/en/assets/images/upgrading_cpu-8adead39922245f9d0bfb04e163f1a0c.jpg" width="3064" height="464" class="img_ev3q">
<img loading="lazy" alt="升级后14000实例" src="/en/assets/images/upgrading_instance-73fb6bb6f225e9cd00bc9e248e243661.jpg" width="3040" height="482" class="img_ev3q">
<img loading="lazy" alt="升级后14000实例Dubbo" src="/en/assets/images/upgrading_dubbo-408e2ea28e28e757151720ab66060edd.png" width="1064" height="481" class="img_ev3q"></p><p>随着服务端升级完成停止双写，消除了双写带来的性能损耗，CPU使用降低并趋于稳定，同时实例数也不再抖动，Dubbo调用完全恢复；如同1.X服务端一样，分两个批次启动施压集群，对比两个版本间在相同压力下的性能表现。</p><p><img loading="lazy" alt="升级后14000实例CPU" src="/en/assets/images/after_upgrade_cpu-7cafc402fa20692fc047a08a71d96354.jpg" width="3106" height="510" class="img_ev3q">
<img loading="lazy" alt="升级后14000实例" src="/en/assets/images/after_upgrade_instance-5745811ef8147996d0a3d3e478f492bd.jpg" width="3114" height="512" class="img_ev3q">
<img loading="lazy" alt="升级后14000实例Dubbo" src="/en/assets/images/after_upgrade_dubbo-7eb99da583572f6351a451c75a4a9ec2.png" width="1064" height="481" class="img_ev3q"></p><p>由于客户端依旧使用的是1.X的客户端，服务端的使用水位依然非常高，在全部压力启动后，CPU几乎达到100%；虽然没有像1.X服务端一样，出现大规模实例下跌，但是运行一段时间后依旧有少量的实例抖动，说明仅升级Nacos服务端到2.0版本能有一定的改善，但是没有彻底解决性能问题。</p><p><img loading="lazy" alt="升级后14000实例抖动" src="/en/assets/images/after_upgrade_instance_shake-88a15bfc8b3b8156ad61338d622c1e52.jpg" width="3032" height="470" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nacos2x-server--nacos2x-client">Nacos2.X Server + Nacos2.X Client<a href="#nacos2x-server--nacos2x-client" class="hash-link" aria-label="Direct link to Nacos2.X Server + Nacos2.X Client" title="Direct link to Nacos2.X Server + Nacos2.X Client">​</a></h3><p>为了完全释放Nacos2.0的性能，还需要将施压集群的客户端也升级到2.0以上版本。同样将分3个批次进行替换，期间由于Provider进行了重启，服务端有出现实例的下跌再恢复属于正常现象。随着施压集群的升级，可以发现CPU有了非常明显的下降，最终达到稳定时，CPU由最初的接近100%，降低到20%，集群稳定运行14000个实例。</p><p><img loading="lazy" alt="2.X14000实例CPU" src="/en/assets/images/2_14000_cpu-549f6b56287ca04b59041dfa4b28068f.jpg" width="3114" height="514" class="img_ev3q">
<img loading="lazy" alt="2.X14000实例" src="/en/assets/images/2_14000_instance-747758b3881f3abb6e1330f1452547a9.jpg" width="3100" height="514" class="img_ev3q">
<img loading="lazy" alt="2.X14000实例Dubbo" src="/en/assets/images/2_14000_dubbo-24cd3e2e0bbe884335ced04e2cdeb4be.png" width="1064" height="481" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="压测结果">压测结果<a href="#压测结果" class="hash-link" aria-label="Direct link to 压测结果" title="Direct link to 压测结果">​</a></h2><p>如上所述，我们能够得到<code>2核CPU+4G内存</code>的三节点集群在不同版本下的性能差异：</p><table><thead><tr><th>服务端版本</th><th>客户端版本</th><th>压力规模</th><th>集群稳定性</th><th>CPU使用</th></tr></thead><tbody><tr><td>Nacos1.X</td><td>Nacos1.X</td><td>14000</td><td>完全不稳定</td><td>100%</td></tr><tr><td>Nacos2.X（升级中）</td><td>Nacos1.X</td><td>6000</td><td>有一定抖动</td><td>100%</td></tr><tr><td>Nacos2.X</td><td>Nacos1.X</td><td>14000</td><td>有一定抖动</td><td>100%</td></tr><tr><td>Nacos2.X</td><td>Nacos2.X</td><td>14000</td><td>稳定</td><td>20%</td></tr></tbody></table><p>由此可见，Nacos2.0确实对性能有较大的提升，新用户建议直接全部采用Nacos2.0，老用户建议先升级Server端，然后在逐步升级客户端释放红利。最后从整个压测视角的监控，来直观的感受一下不同版本在不同阶段的性能表现：</p><p><img loading="lazy" alt="监控纵览" src="/en/assets/images/all-ba420b22959bd95a783dd0e6d843ecd4.jpg" width="1919" height="665" class="img_ev3q"></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos ISCAS 2021 start to apply]]></title>
            <link>https://nacos.io/en/blog/iscas2021</link>
            <guid>https://nacos.io/en/blog/iscas2021</guid>
            <pubDate>Tue, 25 May 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos ISCAS 2021 start to apply]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="关于nacos">关于Nacos<a href="#关于nacos" class="hash-link" aria-label="Direct link to 关于Nacos" title="Direct link to 关于Nacos">​</a></h2><p>Nacos（/nɑ:kəʊs/）是Dynamic <u>Na</u>ming and <u>Co</u>nfiguration <u>S</u>ervice的首字母简称，是一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。它孵化于阿里巴巴，成长于十年双十一的洪峰考验，沉淀了简单易用、稳定可靠、性能卓越的核心竞争力。
<img loading="lazy" alt="image.png" src="/en/assets/images/features-b3ef3792c7e7919ffae4df3ba4bc860d.png" width="680" height="259" class="img_ev3q"></p><p>Nacos经过数年的社区共建，支持诸如Java、Go、Python等主流语言、支持如Dubbo和Spring Cloud Alibaba等主流服务框架和配置管理框架、同时还支持对接了如Istio，CoreDNS等云原生组件，是目前使用最广泛的微服务框架基础设施。
<img loading="lazy" alt="image.png" src="/en/assets/images/ecology-e71e0177f31a7e7353199e2804e7019d.png" width="680" height="295" class="img_ev3q"></p><p>Nacos开源后快速成为国内首选，被互联网、视频、直播、金融领域公司广泛使用，支撑这国计民生的核心业务系统。
<img loading="lazy" alt="image.png" src="/en/assets/images/whouse-1ef86c86fcfcd53ed84d325a86b803a1.png" width="680" height="270" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="为什么选择nacos">为什么选择Nacos<a href="#为什么选择nacos" class="hash-link" aria-label="Direct link to 为什么选择Nacos" title="Direct link to 为什么选择Nacos">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="社区开放活跃">社区开放活跃<a href="#社区开放活跃" class="hash-link" aria-label="Direct link to 社区开放活跃" title="Direct link to 社区开放活跃">​</a></h3><p>Nacos在github上有17.6k stars 和 6.9k fork；社区共有28位核心Committer，其中一半来自于阿里巴巴，一半来自于社区各行各业。
​</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="产品功能强大">产品功能强大<a href="#产品功能强大" class="hash-link" aria-label="Direct link to 产品功能强大" title="Direct link to 产品功能强大">​</a></h3><p>Nacos 提供服务发现和服务健康监测、提供动态配置服务、提供动态 DNS 服务、提供服务及其元数据管理等核心能力，具备简单易用、特性丰富、超高性能、超大容量、高可用等优势。
​</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="生态联系紧密">生态联系紧密<a href="#生态联系紧密" class="hash-link" aria-label="Direct link to 生态联系紧密" title="Direct link to 生态联系紧密">​</a></h3><p>Nacos支持主流的微服务框架和应用框架，支持云原生生态。选择Nacos能够更容易嵌入和学习整个微服务体系及云原生体系。
​</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="参与nacos社区">参与Nacos社区<a href="#参与nacos社区" class="hash-link" aria-label="Direct link to 参与Nacos社区" title="Direct link to 参与Nacos社区">​</a></h2><p>Nacos主要通过官方网站和Github来进行社区参与，参与内容不仅限于代码提交，还包括文档、翻译、测试、文章分享、社区治理等等。</p><ul><li>Nacos官方网站：<a href="https://nacos.io/zh-cn/index.html" target="_blank" rel="noopener noreferrer">https://nacos.io</a></li><li>Nacos项目地址：<a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos</a></li><li>Nacos生态地址：<a href="https://github.com/nacos-group" target="_blank" rel="noopener noreferrer">https://github.com/nacos-group</a></li></ul><p>Nacos采用Apache 2.0 Lisence作为开源许可证，同时也赞同其<code>社区高于代码</code>的理念，并按照自己的方式践行。通过与生态伙伴积极共建能力、广泛接受来自各类用户的诉求和贡献、参与两届编程之夏活动，为Nacos社区带来和超过200位贡献者和十分合理的Committer构成。我们欢迎更多希望参与开源，从开源中提升技术、分享思考的同学加入到Nacos社区中。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="暑期2021">暑期2021<a href="#暑期2021" class="hash-link" aria-label="Direct link to 暑期2021" title="Direct link to 暑期2021">​</a></h2><p>Nacos--暑期2021项目已上线，项目申请报名已于5.24日开启，感兴趣的同学可以前往官网查看项目详情，先行了解和沟通并报名参与～。
​
Nacos社区为同学们准备了数个难度不一的题目，可以帮同学们快速了解微服务生态中配置中心和服务管理的相关内容：</p><ul><li>为Nacos Python SDK适配新版本gRPC接口（难度：简单）</li><li>添加配置加解密的插件SPI，并新增一类简单的加解密实现（难度：中等）</li><li>添加鉴权的插件SPI，并将当前的默认鉴权实现转化为插件化实现（难度：中等）</li><li>添加新的可观测性系统（难度：中等）</li><li>构建内嵌的反脆弱体系插件（难度：困难）</li></ul><p>更多详细内容可进入，Nacos官网、Nacos github或ISCAS官网中了解：
​</p><p>Nacos官方网址：<a href="https://nacos.io/zh-cn/index.html" target="_blank" rel="noopener noreferrer">https://nacos.io</a></p><p>Nacos社区相关内容：<a href="https://github.com/alibaba/nacos/issues/5693" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos/issues/5693</a></p><p>ISCAS相关内容：<a href="https://summer.iscas.ac.cn/#/org/orgdetail/nacos?lang=en" target="_blank" rel="noopener noreferrer">https://summer.iscas.ac.cn/#/org/orgdetail/nacos?lang=en</a></p><p>ISCAS学生指南：<a href="https://summer.iscas.ac.cn/help/" target="_blank" rel="noopener noreferrer">https://summer.iscas.ac.cn/help/</a></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos 2.0.1 + 1.4.2 Release]]></title>
            <link>https://nacos.io/en/blog/2.0.1-release</link>
            <guid>https://nacos.io/en/blog/2.0.1-release</guid>
            <pubDate>Mon, 10 May 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos 2.0.1 + 1.4.2 Release]]></description>
            <content:encoded><![CDATA[<p>Nacos is Alibaba's open source service discovery and configuration management project. The 2.0.1 version released is mainly dedicated to supporting the MCP-OVER-XDS protocol and making the JRaft election more stable.
The 1.4.2 version released also greatly enhances the stability of JRaft Leader election.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-201">Nacos 2.0.1<a href="#nacos-201" class="hash-link" aria-label="Direct link to Nacos 2.0.1" title="Direct link to Nacos 2.0.1">​</a></h2><p>Main upgrades in 2.0.1:</p><ol><li>Supporting MCP-OVER-XDS protocol in both nacos-istio plug-ins and modules.</li><li>Fixing the stability of the leader election of the JRaft protocol in the k8s environment.</li><li>Fixing the problem of frequently throwing 'Server is Down' error.</li></ol><p>Detail change logs：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[#3484] Support ldap login.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4856] Support mcp over xds.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5137] Support service list add view subscriber.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5367] Support client encryption plugin for nacos 2.0.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5307] Push support config some parameters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5334] Fix Server is Down problem in k8s environment.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5361] Check isUseGrpcFeatures() when register instance using GRPC protocol.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5486] Refactor Distro Config as singleton and replace GlobalConfig.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5169] Fix instance beat run only by responsible server.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5175] Fix publishConfig lost type.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5178] Fix NPE when init server list failed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5182] Fix throw NoSuchFieldException in ConfigController when service connect to nacos.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5204] Fix query error when pageNo is larger than service number.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5268] Fix subscriber app unknown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5327] Fix ThreadPool usage problem and add some monitor for distro.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5384] Fix the problem of unable to shutdown NacosConfigService.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5404] Fix frequently udp push for client 1.X.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5419] Fix Nacos 2.0 client auth may invalid for non public namespace.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5442] change state to UP when received status form old version server.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5096] Add unit tests in nacos 2.0.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5171][#5421][#5436][#5450][#5464] Fix IT for nacos 2.0.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-142">Nacos 1.4.2<a href="#nacos-142" class="hash-link" aria-label="Direct link to Nacos 1.4.2" title="Direct link to Nacos 1.4.2">​</a></h2><ol><li>This version mainly enhances the stability of Leader election in JRAft protocol. It can be used in conjunction with the latest nacos-k8s project to optimize stability to a large extent.</li><li>Moreover, it fixes many bugs in version 1.4.1 such as the prompt about "Server is Down" problems.</li></ol><p>Detail change logs：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[#4452] Add config compare features.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4602] Add new way for export config.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4996] Make log level changeable for nacos-core module.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5367] Add pre-plugin in client for encrypting config.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3922] Method createServiceIfAbsent in ServiceManager require sync.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4274] skip master-select task when db.num is 1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4753] Use SafeConstructor to parse yaml configuration.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4762] Naming health check thread num support user define it by self.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4770] Beta publish: change the way of select betaIps, from input to select.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4778] Make SecurityProxy.accessToken threadsafe in single writer multi reader.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4903] Add securuty hint for login page.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4917] Raft ops interface add auth.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4980] Log4J2NacosLogging.loadConfiguration() return directly When location is blank.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5010] Fix the usage of TemplateUtils.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5190] Add some hint log when login failed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5234] Solve the problem that page can be edited while publishing-config request is processing.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5331] Fix the mouse hovers over the margin in a pointer state and cannot be clicked.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5350] Add hint and detail reason for consistence status Down.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5439] Support specified naming UDP push port for client.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5434] Optimize the ConfigType.isValidType method.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3779] Check groupName can't be empty.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4661] ConfigServletInner#doGetConfig code optimization.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3610] Fix the press F1 to full screen issue in new config page.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3876] Fix push empty service name.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4306] Fix search service by group error problem.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4573,#4629] Jraft leader status check error.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4672] Fix cloning configuration lost description.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4699] Fix metadata batch operation may delete instance problem.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4756] Fix config list sort and search problem.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4787] Losting member if parsing host throw UnknownHostException.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4806] Fix addListener method comment.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4829] Remove instance when distro and raft remove instances data.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4852] Fix main.js is too large problem.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4854] Modify Header to support Keys Ignore Case.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4898] Fix instance list page bug.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4925] Fix member list change will cover member status and metadata problem.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5078] Fix the problem of inconsistent results for querying subscriber list data multiple times.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5026] Fix MetricsHttpAgent metrics twice.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5018] Check group and dataId in groupKey.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5114] ConcurrentHashSet.java is not compatible with jdk1.6 or 1.7.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5253] Fix missing auth identity header error.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5291] Fix Beat task will stop when throw unexpected exception.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5301] Respond all kinds of collections for istio's request.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5351] Fix Consistence status can't switch to UP after Jraft election.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5390] Fix ip verify error.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5427] Fix NPE if Jraft leader is null in CurcuitFilter.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5437] Fix config beta feature will lost dump event problem.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5451] Fix the tag can't be removed problem.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4822][#4823][#4824][#4825][#4979][#5506] Fix dependency security problem.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5277] Subscriber list servername add required.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#5380][#5418] Add and enhance unit test.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="community">Community<a href="#community" class="hash-link" aria-label="Direct link to Community" title="Direct link to Community">​</a></h2><p>With Nacos 2.0.1 released， Nacos community has a new committer: </p><p>This committer has made a lot of contributions in promoting multi-data source support, authentication and security, configuration module optimization and improvement, and actively participated in community discussions.</p><p><img loading="lazy" alt="haoyann_commiter.jpg" src="/en/assets/images/haoyann_commiter-f24a2de2a7868f5423a554fc13a36ad9.jpg" width="4032" height="3024" class="img_ev3q"> </p><p>The Nacos community welcomes more partners who would participate to contribution, including but not limited to:</p><ul><li>Source codes</li><li>Document</li><li>Discussion in community</li><li>Multiple-language</li><li>Combination of surrounding ecological products</li></ul><p>Active participation will get exquisite small gifts from the Nacos community~</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="about-nacos">About Nacos<a href="#about-nacos" class="hash-link" aria-label="Direct link to About Nacos" title="Direct link to About Nacos">​</a></h2><p>Nacos is committed to help you discover, configure, and manage your microservices. It provides a set of simple and useful features enabling you to realize dynamic service discovery, service configuration, service metadata and traffic management. </p><p>Nacos makes it easier and faster to construct, deliver and manage your microservices platform. It is the infrastructure that supports a service-centered modern application architecture with a microservices or cloud-native approach.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos 1.4.0 + Go SDK 1.0.1 Release]]></title>
            <link>https://nacos.io/en/blog/1.4.0-release</link>
            <guid>https://nacos.io/en/blog/1.4.0-release</guid>
            <pubDate>Mon, 02 Nov 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos 1.4.0 + Go SDK 1.0.1 Release]]></description>
            <content:encoded><![CDATA[<p>The annual double eleven shopping festival is coming again.
Have you grabbed goods you want?</p><p>In this festival, Nacos community will provide a gift for yours -- <code>Nacos 1.4.0</code> and <code>nacos-sdk-go 1.0.1</code> released.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-140">Nacos 1.4.0<a href="#nacos-140" class="hash-link" aria-label="Direct link to Nacos 1.4.0" title="Direct link to Nacos 1.4.0">​</a></h2><p>Main upgrade in 1.4.0:</p><ol><li>Refactors the distro protocol of the naming module and sinks to the nacos-core module.</li><li>Used jraft to replace the old self-implemented raft protocol to improve the performance and accuracy of raft semantics.</li><li>Unifies the http clients completely used by nacos, optimizes the usage of some http clients, and reduces connection cost, especially the number of CLOSE_WAIT connections.</li><li>Add a BETA interface to modify service metadata separately.</li><li>Fix some old version bugs and optimized console usage.</li></ol><p>Detail change logs：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[#1654] Fix content hightlight does not work in config detail page.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#2792] Save user information in login when auth open.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#2835] Fix the console loading continuously if there is no permission of the namespace.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#2866] Fix client do not have permision for api  /nacos/v1/ns/operator/metrics.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3117] Sink and Optimize the Notify implementation into common module.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3192] Unified http client in nacos server.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3315] nacos-client support https.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3397] Fix some error in start script.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3384] Fix raft information show error in console.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3500] Make page list of service manager same as config manager.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3509] Fix address server mode cannot be obtained application.properties.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3518] When binding roles, the user list is changed to the drop-down selection mode.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3530] Add refresh buttons for each page in console.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3533] Change client cache directory config.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3515][#3536][#3899] Upgrade dependency to fix security problem.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3528] Fix client get illegal project.version.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3550] Fix persistency file can't create in server side for raft protocol.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3560] Change title logo in browser.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3566] Extract and sink auth feature to nacos-auth from nacos-config.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3576] Adding the destroy lifecycle method on NamingMaintainService.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3592] Fix incorrect prompt when accessing unauthorized namespace.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3628] Enhance the client update interval when subscribe non-exist service.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3635] Replace raft of naming module by Jraft of consistency module.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3651] Enhance http client usage to reduce CLOSE_WAIT connection in nacos-server.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3661] Enhance raft group update logic for using Jraft.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3671] Move some util class into common package.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3676] Fix revert chunk does not work in Content Comparison page.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3692] Refactor Distro protocol in nacos naming module.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3687] Check serviceName's format in server and client.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3710] Fix service metadata can't be special words problem.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3781] Fix service list intermittently lost service.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3790] Fix the configuration garbled problem that may occur on the client.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3815] Fix client cache may be truncated when contain Chinese.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3833] Fix NotifyCenter will throw NullPointerException when no subscriber.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3855] Add changed detail from previous version in configuration detail page.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3904] Support operate instance's metadata alonely.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3909] Fix nacos server can't config domains.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#3973] Fix load config failed during the first run.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[#4110] Naming modules failed to work properly during the nacos capacity expansion.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-go-sdk-101">Nacos Go SDK 1.0.1<a href="#nacos-go-sdk-101" class="hash-link" aria-label="Direct link to Nacos Go SDK 1.0.1" title="Direct link to Nacos Go SDK 1.0.1">​</a></h2><p>This version mainly fixes some bugs in the old version and support https.</p><p>Detail change logs in <a href="https://github.com/nacos-group/nacos-sdk-go/releases/tag/v1.0.1" target="_blank" rel="noopener noreferrer">release notes</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="community">Community<a href="#community" class="hash-link" aria-label="Direct link to Community" title="Direct link to Community">​</a></h2><p>With Nacos 1.4.0 released， Nacos community will invite new two committers : Maijh97 and wangweizZZ.</p><p>They have made a lot of contributions in the unifying http client, sinking the auth module, supporting https in client, reorganizing part of the server thread pool and fixing bugs, and actively participated in community discussions.</p><p>The Nacos community welcomes more partners who would participate to contribution, including but not limited to:</p><ul><li>Source codes</li><li>Document</li><li>Discussion in community</li><li>Multiple-language</li><li>Combination of surrounding ecological products</li></ul><p>Active participation will get exquisite small gifts from the Nacos community~</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="about-nacos">About Nacos<a href="#about-nacos" class="hash-link" aria-label="Direct link to About Nacos" title="Direct link to About Nacos">​</a></h2><p>Nacos is committed to help you discover, configure, and manage your microservices. It provides a set of simple and useful features enabling you to realize dynamic service discovery, service configuration, service metadata and traffic management. </p><p>Nacos makes it easier and faster to construct, deliver and manage your microservices platform. It is the infrastructure that supports a service-centered modern application architecture with a microservices or cloud-native approach.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[v0.5.0 of Nacos-sdk-csharp was released! Capabilities aligned with Java SDK！]]></title>
            <link>https://nacos.io/en/blog/csharp-0.5.0</link>
            <guid>https://nacos.io/en/blog/csharp-0.5.0</guid>
            <pubDate>Thu, 03 Sep 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[v0.5.0 of Nacos-sdk-csharp was released! Capabilities aligned with Java SDK!]]></description>
            <content:encoded><![CDATA[<p>After promoted by Alibaba Summer of Coding(ASoC), <a href="https://github.com/nacos-group/nacos-sdk-csharp" target="_blank" rel="noopener noreferrer">nacos-sdk-csharp</a> released a new version 0.5.0. So far, nacos-sdk-csharp will have the same capabilities as the Java-sdk.</p><p>Thanks for contribution of Aman, Wenqing Huang during ASoC.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="main-release-note-of-v050-of-nacos-sdk-csharp">Main release note of v0.5.0 of Nacos-sdk-csharp<a href="#main-release-note-of-v050-of-nacos-sdk-csharp" class="hash-link" aria-label="Direct link to Main release note of v0.5.0 of Nacos-sdk-csharp" title="Direct link to Main release note of v0.5.0 of Nacos-sdk-csharp">​</a></h2><ol><li>Fixed auth request return 403</li><li>Failover of configuration was change from memory to file</li><li>Fixed can not retrieve available service after specify load balance strategy</li><li>Fixed can not refresh accesstoken due to only login once</li><li>Support Yaml and Ini parser</li><li>Support subscribe and unsubscribe of naming</li><li>Support PreferredNetworks to choose the network adapter</li><li>Perfect ASP.NET Core integration</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="近期预告">近期预告<a href="#近期预告" class="hash-link" aria-label="Direct link to 近期预告" title="Direct link to 近期预告">​</a></h2><p>Nacos社区和阿里巴巴编程之夏的成果远不止此，很快将会有cpp和python的新版本sdk发布哦。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="如何共建">如何共建<a href="#如何共建" class="hash-link" aria-label="Direct link to 如何共建" title="Direct link to 如何共建">​</a></h2><p>我们欢迎任何人积极参与Nacos社区。如果您在文档中发现拼写错误，在代码中发现错误，或想要新功能或想要提供建议，您可以<a href="https://github.com/alibaba/Nacos/issues/new" target="_blank" rel="noopener noreferrer">在GitHub上创建一个issues</a> 。</p><p>如果您想开始着手，可以选择github仓库中有以下标签的issues。</p><ul><li><a href="https://github.com/alibaba/nacos/labels/good%20first%20issue" target="_blank" rel="noopener noreferrer">good first issue</a> ：对于新手来说是非常好的入门issues。</li><li><a href="https://github.com/alibaba/nacos/labels/contribution%20%E6%AC%A2%E8%BF%8E" target="_blank" rel="noopener noreferrer">contribution welcome</a> ：非常需要解决的问题和非常重要的模块，但目前缺少贡献者，欢迎贡献者来贡献。</li></ul><p>除了以上的通用标签，还可以关注Nacos的多语言共建，目前我们已经支持各类主流语言：</p><ul><li><a href="https://github.com/nacos-group/nacos-sdk-csharp" target="_blank" rel="noopener noreferrer">csharp</a></li><li><a href="https://github.com/nacos-group/nacos-sdk-go" target="_blank" rel="noopener noreferrer">go</a></li><li><a href="https://github.com/nacos-group/nacos-sdk-cpp" target="_blank" rel="noopener noreferrer">cpp</a></li><li><a href="https://github.com/nacos-group/nacos-sdk-python" target="_blank" rel="noopener noreferrer">python</a></li><li><a href="https://github.com/nacos-group/nacos-sdk-nodejs" target="_blank" rel="noopener noreferrer">nodejs</a></li></ul><p>欢迎大家加入Nacos社区，贡献社区。用Apache的话说，<strong>“社区高于代码”!</strong>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="新人时刻---什么是nacos"><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer"></a>新人时刻 - "什么是Nacos？"<a href="#新人时刻---什么是nacos" class="hash-link" aria-label="Direct link to 新人时刻---什么是nacos" title="Direct link to 新人时刻---什么是nacos">​</a></h2><blockquote><p>还不知道什么是Nacos? 没关系，在github上star一下跟程序猿兄弟打个招呼吧!!</p></blockquote><p><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a> 是阿里巴巴于2018年7月份新开源的项目，Nacos的主要愿景是期望通过提供易用的 <code>动态服务发现</code>、<code>服务配置管理</code>、<code>服务共享与管理</code> 的基础设施，帮助用户在云原生时代更好的构建、交付、管理自己的微服务平台。</p><p>github项目地址在 <a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">这里</a></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos 两周年献礼，Nacos 1.3.2 + Go SDK 1.0.0发布]]></title>
            <link>https://nacos.io/en/blog/nacos-2nd-anniversary</link>
            <guid>https://nacos.io/en/blog/nacos-2nd-anniversary</guid>
            <pubDate>Wed, 05 Aug 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos 两周年献礼，Nacos 1.3.2 + Go SDK 1.0.0发布]]></description>
            <content:encoded><![CDATA[<p>Nacos自2018年8月5日开源以来，在社区两年的共同努力之下，获得了13400+ stars，发布了30个版本，吸引了 125 位优秀贡献者，积累了上百家企业案例的成绩。在Nacos开源两周年之际，社区同时发布Nacos 1.3.2版本和Go SDK 的1.0.0版本，为Nacos庆生。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-132">Nacos 1.3.2<a href="#nacos-132" class="hash-link" aria-label="Direct link to Nacos 1.3.2" title="Direct link to Nacos 1.3.2">​</a></h2><p>Nacos 1.3.2版本在1.3.1的基础上，继续重构和优化内核功能，主要改进如下：</p><ol><li>重构并统一 nacos-client 中http客户端的内容，增加拓展性和可读性</li><li>回滚在 nacos-client 1.3.1对apache http的使用，以减少依赖冲突和不可控的日志输出</li><li>重构Nacos中的事件通知模块，提高性能和可读性</li><li>修复Nacos服务端在Windows环境下启动失败的问题</li><li>修复Nacos控制台的部分问题</li><li>修复部分文档的描述错误</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-go-sdk-100">Nacos Go SDK 1.0.0<a href="#nacos-go-sdk-100" class="hash-link" aria-label="Direct link to Nacos Go SDK 1.0.0" title="Direct link to Nacos Go SDK 1.0.0">​</a></h2><p>Nacos-sdk-go的v1.0.0版本主要的改进如下：</p><ol><li>支持一个连接监听多个配置</li><li>支持取消配置监听功能</li><li>日志功能重新实现，支持日志轮转和日志实现替换</li><li>提升了实例选择的性能</li><li>文档和示例的完善</li><li>Nacos与dubbo-go、sentinel-golang等go语言微服务生态集成</li></ol><p>随着Go SDK 1.0.0正式版的发布，意味着Nacos在支持所有主流开发语言上更进了一步。目前，社区已经有Java、Golang、Python、Nodejs的语言支持。C++和C#的SDK也通过编程之夏稳步推进中，相信很快就可以和大家见面。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="后期规划">后期规划<a href="#后期规划" class="hash-link" aria-label="Direct link to 后期规划" title="Direct link to 后期规划">​</a></h2><p>在新的一年中，Nacos将会继续成长、聚焦 Nacos 内核构建，打造一个更稳定、更安全、更高效的微服务引擎
目前核心规划是：</p><ul><li>下沉并统一一致性模型</li><li>下沉并优化鉴权模型</li><li>升级连接通道，提升交互效率</li><li>升级服务数据模型，提升服务端运行效率</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="致谢">致谢<a href="#致谢" class="hash-link" aria-label="Direct link to 致谢" title="Direct link to 致谢">​</a></h2><p>随着视频、直播及线上教育行业大规模发展，Nacos在 虎牙、爱奇艺、芒果、Zoom、掌门、KK直播 等高速发展的企业中落地，有此成就，离不开社区贡献者和用户们的共同努力。</p><p>在此，感谢所有参与社区共建，为Nacos提供代码，设计以及讨论的贡献者和用户。</p><p>同时欢迎更多的个人及企业，参与到Nacos的共建中，让Nacos变得更加高效、稳定。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="结尾">结尾<a href="#结尾" class="hash-link" aria-label="Direct link to 结尾" title="Direct link to 结尾">​</a></h2><p>Nacos 致力于帮助您发现、配置和管理微服务。Nacos 提供了一组简单易用的特性集，帮助您快速实现动态服务发现、服务配置、服务元数据及流量管理。</p><p>Nacos 帮助您更敏捷和容易地构建、交付和管理微服务平台。 Nacos 是构建以“服务”为中心的现代应用架构 (例如微服务范式、云原生范式) 的服务基础设施。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[参与开源，Offer拿到手软 -- 来自一名2019阿里巴巴编程之夏同学的亲述]]></title>
            <link>https://nacos.io/en/blog/feeling-of-ASoC-2019</link>
            <guid>https://nacos.io/en/blog/feeling-of-ASoC-2019</guid>
            <pubDate>Tue, 14 Jul 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[来自一名2019阿里巴巴编程之夏同学的亲述]]></description>
            <content:encoded><![CDATA[<h3 class="anchor anchorWithStickyNavbar_LWe7" id="---来自一名2019阿里巴巴编程之夏同学的亲述">-- 来自一名2019阿里巴巴编程之夏同学的亲述<a href="#---来自一名2019阿里巴巴编程之夏同学的亲述" class="hash-link" aria-label="Direct link to -- 来自一名2019阿里巴巴编程之夏同学的亲述" title="Direct link to -- 来自一名2019阿里巴巴编程之夏同学的亲述">​</a></h3><blockquote><p>作者：廖春涛</p></blockquote><p>作者简介：</p><ul><li>阿里巴巴 nacos 项目管理委员会成员</li><li>阿里巴巴 spring-cloud-alibaba 项目提交者</li><li>阿里巴巴 nacos-spring-project 项目维护者</li><li>阿里巴巴 nacos-springboot-project 项目维护者</li><li>spring-cloud/spring-cloud-sleuth 项目贡献者</li><li>阿里巴巴云原生日讲师</li><li>2019年第一季阿里巴巴编程之夏学员</li><li>2018年中国大学生服务外包大赛三等奖（国家级）</li><li>2017年大学生创新创业大赛校级立项</li><li>2017年杭州电子科技大学互联网+大赛二等奖</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="起源">起源<a href="#起源" class="hash-link" aria-label="Direct link to 起源" title="Direct link to 起源">​</a></h2><p>不知不觉大学四年时光就过去了，而我的毕业，不仅仅是作为一名普通应届毕业生，同时，也是作为一名开源项目的PMC。</p><p>与开源结缘是在大三上的时候，那时与同学承接了一个商业外包，需要使用一个WxJava的开源项目。在项目交接之后，我打算用golang重新翻译此项目，顺便去学习了一下。在学习过程中，我在发现了几个小问题的过程中，贡献了一个优化，由此算正式与开源结缘了。</p><p>真正完全参与开源，是从大三下开始。那个时候经常和学长去参与各种技术讲座，比如Apache Flink、Apache APISIX、Service Mesh、分布式DB、服务治理等等。在四月的一天，学长推给我了一个有关服务治理的开源项目社区群，而我正好打算从理论到实践，将所学真真切切应用在实际当中。从这一天开始，真真切切的开始投入到开源当中。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前进">前进<a href="#前进" class="hash-link" aria-label="Direct link to 前进" title="Direct link to 前进">​</a></h2><p>参与开源，其过程就好比RPG游戏一般，一路升级打怪。从最开始的在SDK侧新增简单的增删改查功能，到参与维护两个Spring生态组建的维护。这期间，我重新学习了Spring内部的原理。在此期间，我对于Spring的整个设计理解更近了一步，彼时我能够更加灵活地运用Spring提供的各种钩子去实现用户对于组件的需求。</p><p>期间比较自豪的事情是发现了spring-cloud-seluth的bug，提交PR并进行了fix。其实发现这个问题的过程是比较曲折，最开始是有用户反馈zipkin无法与服务治理中心进行整合，于是我带着疑问，通过资料查找和研究源码等路径，发现zipkin从某个版本开始，他们自己写了一个webserver，因此无法使用spring相关的能力将zipkin-server注册到服务治理中心，因此我进行了一个简单的测试，将注册时机进行了简单的调整。但是由于过于定制化，因此没有进行回馈（其实问题的根本原因倒不是这个），只是将方案告诉给有此问题的相关用户。后面再持续跟进此问题时，发现仍然有zipkin与服务治理中心存在整合问题，但是这次是客户端，因此进行长时间的问题跟踪调试，最终确定问题的原因，接着进行反馈，最终提交PR进行修复。这一次的经历，让我学习到解决问题不应该只会埋头谷歌或者百度，而是应该从问题本身出发，去跟踪、观察问题，并成功解决。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="突破">突破<a href="#突破" class="hash-link" aria-label="Direct link to 突破" title="Direct link to 突破">​</a></h2><p>有了一次的成功经验，我变得更加有信心了。后面，我从客户端转战服务端，真正切入服务治理中心的核心。而此时，我已经成为一名committer了。为了能够更好地参与项目，同时符合committer的身份，我重新开始学习项目的源码、设计，纠正了许多第一次看源码时出现的理解误区，对于某些功能模块代码的设计有了更深的理解。同时，将高可用思想穿插于源码中，令我后面参与实习时，参与项目改造时，能够有更多的思考。
成为committer之后，不知道是不是初生牛犊不怕虎，我接受了内核模块的重构以及去MySQL依赖这两个艰巨的任务。其内核重构设计了一致性协议层的抽象设计、寻址模式的统一、事件机制的统一。其中，最难的莫过于一致性协议层的抽象以及设计了。其实，我对于一致性协议了解的并不是很多，只是知道CAP、BASE理论而已。但即使如此，我在接过任务之后，就开始各种开源项目源码的探究，比如JRaft、Etcd、Memberlist、hashicorp/raft等等，同时下载了各类的电子PDF进行学习，为我后面的工作打下了一定的理论基础。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="探索">探索<a href="#探索" class="hash-link" aria-label="Direct link to 探索" title="Direct link to 探索">​</a></h2><p>待秋招以及实习结束之后，我正式开始了相关任务的工作，设计文档编写、基础理论支持、相关项目设计学习、代码编写，其实就是一个需求，从成立到最终产出的全过程，综合性挺强的。这个时候的代码设计不再是随心所欲了，将一个单机的关系型存储变为一个分布式强一致性的关系型存储，其必须保证数据的一致性、事务的ACID性质，需要结合大量的资料以及前人项目的设计进行参考，当时提出的思路方案就有四五种。其中，为了从数据库内部解决这个问题，我还去学习了apache derby的源码——了解到插入一条数据的流程是怎么样的以及其master-slave机制的实现。可以说，通过这些的前期准备以及与其他大佬们的交流，令我后面的代码编写变得更加游刃有余。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="感想">感想<a href="#感想" class="hash-link" aria-label="Direct link to 感想" title="Direct link to 感想">​</a></h2><p>对于应届生的我来说，参与开源项目并且成为committer，也算是我的一项优势吧，也正因如此，我在秋招的时候基本是面试一家，收获一家公司的offer，其中也不乏SP。</p><p>参与开源项目，是一个将理论付诸于生产实践的有效途径，它让你需要考虑各种因素，比如接口设计、新老版本的数据兼容、可扩展性、边界因素的思考等等，同时还会使得自己知识面的横向以及纵向的延伸；不仅如此，参与开源的过程中，你需要和世界不同的开发者进行思想的碰撞交流，有时候通过交流，能够使得自己对于自己的设计有更深的认识，发现设计上的不足，同时也锻炼了自己口述、文字的能力。</p><p>虽然自己没几天就要去某大厂工作了，但是还是希望自己能够保证工作质量同时深入学习工作方向内容的空闲时间，保持对开源参与的热情，从开源中学习，并将自己学习的知识回馈当中。</p><p>最后汇报一下今年阿里巴巴编程之夏的最新进展。经过 3 轮的严格筛选，本次阿里巴巴编程之夏共有 29 名同学突出重围，马上开始 coding 的夏天啦！献上部分同学“开学照”，唯有热爱，可抵岁月漫长，加油，同学们！</p><hr><h1>Nacos 团队招人啦~ 欢迎21年毕业同学加入阿里云，共建云原生！</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一招聘对象">一、招聘对象<a href="#一招聘对象" class="hash-link" aria-label="Direct link to 一、招聘对象" title="Direct link to 一、招聘对象">​</a></h2><p>2020年11月- 2021年10月毕业的应届毕业生</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二部门介绍">二、部门介绍<a href="#二部门介绍" class="hash-link" aria-label="Direct link to 二、部门介绍" title="Direct link to 二、部门介绍">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="我们是谁">我们是谁？<a href="#我们是谁" class="hash-link" aria-label="Direct link to 我们是谁？" title="Direct link to 我们是谁？">​</a></h3><p>云原生致力于打造世界上最先进、稳定的云原生基础设施，是阿里云最核心的部门之一。
我们的目标是让云成为成本最低，效率最高，稳定性最强的应用运行环境。在这里，我们设计超大规模容器与调度系统，发挥出云的极致弹性能力；我们构建高性能微服务架构，提供云端应用的无限拓展的能力；我们打造标准易用的 PaaS 平台，让云上研发变得简单、可控。
在这里，你会参与到容器、Kubernetes、Service Mesh、Serverless 等最前沿的技术研发与探索中来；你也会与 CNCF TOC 和 SIG 联席主席， etcd 创始人、K8s Operator 创始人等组成的国内最顶尖的云原生技术团队一同工作。
在这里，你会参与到全球最顶级的开源项目（如 Kubernetes、Containerd、OAM、Apache Dubbo、Nacos、Arthas）研发工作中，一同拓展云技术的边界，既赋能阿里巴巴全球经济体，更服务全世界的开发者用户。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="团队大咖">团队大咖<a href="#团队大咖" class="hash-link" aria-label="Direct link to 团队大咖" title="Direct link to 团队大咖">​</a></h3><ul><li>丁宇（花名：叔同，研究员），云原生应用平台团队负责人。2010 年加入淘宝，9 次参与双 11 作战，阿里高可用架构、双 11 稳定性负责人，阿里容器、调度、集群管理、运维技术负责人，推动和参与了双 11 几代技术架构的演进和升级。</li><li>张瓅玶（花名：谷朴，研究员），负责集群资源管理和利用率优化。之前在 Google 基础设施事业群的集群管理部门工作了 5 年多，并领导了资源管理和优化调度团队，负责了 FlexBorg, Autoscaling 等多个产品。加入 Google 前在加州大学伯克利分校从事智能系统的研究工作，本科和博士毕业于清华大学。</li><li>易立（花名：微垣，资深技术专家），目前负责阿里云区块链服务和容器服务的研发工作。之前曾在IBM中国开发中心工作，担任资深技术专员；作为架构师和主要开发人员负责或参与了一系列在云计算、区块链、Web 2.0，SOA领域的产品研发和创新。本科和硕士毕业于北京大学。</li><li>李响（资深技术专家），基础软件开源方向战略负责人，CNCF 全球 9 位 TOC 之一。前 CoreOS 分布式项目主管，负责 Kubernetes、etcd 等分布式系统相关项目在 CoreOS 的开发工作，他的主要兴趣在于分布式一致协议、分布式存储、分布式系统调度等，开源项目 etcd 作者。</li><li>张磊（高级技术专家），Kubernetes项目资深成员和联合维护者，主要关注容器运行时接口(CRI)、调度、资源管理和基于虚拟化技术的容器运行时等特性，共同负责Kubernetes上游和阿里集团大型集群管理系统的工程工作，曾就职于微软研究院（MSR）和KataContainers团队。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="三岗位要求">三、岗位要求<a href="#三岗位要求" class="hash-link" aria-label="Direct link to 三、岗位要求" title="Direct link to 三、岗位要求">​</a></h2><ul><li>本科及以上学历，计算机、数学、电子工程、通信等相关专业；</li><li>具备扎实的数据结构和计算机系统基础，精通一种开发语言；</li><li>对基础软件充满热情，具备较好的动手能力和技术热情，有成功的研究型或实战型项目技术成果落地者优先；</li><li>关注开源技术，有开源贡献者优先；</li><li>快速学习，不断突破技术瓶颈，乐于探索未知领域，随时准备好去面对新挑战；</li><li>良好的团队合作精神，能够做到严谨、皮实、乐观。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="四开放职位">四、开放职位<a href="#四开放职位" class="hash-link" aria-label="Direct link to 四、开放职位" title="Direct link to 四、开放职位">​</a></h2><ul><li>Golang研发工程师</li><li>JAVA研发工程师</li><li>C/C++研发工程师</li><li>基础平台研发工程师</li><li>前端开发工程师</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="五工作地点">五、工作地点<a href="#五工作地点" class="hash-link" aria-label="Direct link to 五、工作地点" title="Direct link to 五、工作地点">​</a></h2><p>杭州/北京/深圳</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="六投递渠道">六、投递渠道<a href="#六投递渠道" class="hash-link" aria-label="Direct link to 六、投递渠道" title="Direct link to 六、投递渠道">​</a></h2><p><a href="mailto:water.lyl@alibaba-inc.com" target="_blank" rel="noopener noreferrer">water.lyl@alibaba-inc.com</a></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos 1.2.0权限控制介绍和使用]]></title>
            <link>https://nacos.io/en/blog/nacos 1.2.0 guide</link>
            <guid>https://nacos.io/en/blog/nacos 1.2.0 guide</guid>
            <pubDate>Tue, 10 Mar 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos是阿里巴巴开源的服务发现与配置管理项目，本次发布的1.2.0版本，主要带来的是权限控制。]]></description>
            <content:encoded><![CDATA[<a name="bc2d5709"></a># Nacos权限控制设计方案<a name="If4qS"></a>## 方案背景 Nacos自开源依赖，权限控制一直需求比较强烈，这也反应了用户需求将Nacos部署到生产环境的需求。最新发布的Nacos 1.2.0版本已经支持了服务发现和配置管理的权限控制，保障用户安全上生产。本文主要介绍Nacos权限控制的设计方案和使用指南。<a name="YBdcs"></a>### 什么是权限控制？ 在分布式服务调用时，需要对未知的或者不受信任的请求来源的请求进行识别和拒绝。权限控制一般分为两个阶段：身份识别（Authentication）和权限识别（Authorization）。身份认证主要确定访问者的身份，权限识别则判断这个访问者是否有对应资源的权限。<p>在Nacos的场景中，配置管理的权限控制指的是设置某个配置能否被某个用户读写，这个比较好理解，没有权限的用户旧无法读取或者写入对应的配置。服务发现的权限控制指的是用户是否有权限进行某个服务的注册或者订阅，这里需要注意的是服务发现的权限控制只能够控制用户是否可以从Nacos获取到服务的地址或者在Nacos上修改服务的地址。但是如果已经获取到了服务的地址，Nacos无法在服务真正调用时进行权限控制，这个时候的权限控制需要由服务框架来完成。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1576216016307-2da56934-917f-46ec-b3eb-a221bc91a9e0.png#align=left&amp;display=inline&amp;height=240&amp;name=image.png&amp;originHeight=480&amp;originWidth=1904&amp;size=271408&amp;status=done&amp;style=none&amp;width=952#align=left&amp;display=inline&amp;height=480&amp;originHeight=480&amp;originWidth=1904&amp;status=done&amp;style=none&amp;width=1904" alt="image.png" class="img_ev3q"></p><a name="TvavD"></a>### 常见实现方式<a name="xDBnq"></a>#### 认证（Authentication）<ul><li>用户名+密码</li><li>Cookie（只适用于浏览器）</li><li>Session</li><li>Token（JWT，Oauth，LDAP，SAML，OpenID）</li><li>AK/SK<a name="vqrqi"></a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="鉴权authorization">鉴权（Authorization）<a href="#鉴权authorization" class="hash-link" aria-label="Direct link to 鉴权（Authorization）" title="Direct link to 鉴权（Authorization）">​</a></h4><ul><li>ACL： 规定<strong>资源</strong>可以被哪些<strong>主体</strong>进行哪些操作；</li><li>DAC： 规定<strong>资源</strong>可以被哪些<strong>主体</strong>进行哪些操作&nbsp;同时，<strong>主体</strong>可以将<strong>资源</strong>的权限，授予其他<strong>主体</strong>；</li><li>MAC：a. 规定<strong>资源</strong>可以被哪些类别的<strong>主体</strong>进行哪些<strong>操作</strong> b. 规定<strong>主体</strong>可以对哪些等级的<strong>资源</strong>进行哪些<strong>操作</strong> 当一个<strong>操作</strong>，同时满足a与b时，允许<strong>操作</strong>；</li><li>RBAC： a. 规定<strong>角色</strong>可以对哪些<strong>资源</strong>进行哪些<strong>操作</strong> b. 规定<strong>主体</strong>拥有哪些<strong>角色</strong>当一个操作，同时满足a与b时，允许<strong>操作</strong>；</li><li>ABAC： 规定哪些<strong>属性</strong>的<strong>主体</strong>可以对哪些<strong>属性</strong>的<strong>资源</strong>在哪些<strong>属性</strong>的情况下进行哪些<strong>操作</strong>。</li></ul><a name="liyG7"></a>## 方案详情 Nacos的权限控制，目标是能够满足用户基本的鉴权需求，同时能够保持扩展性，可以支持去对接用户自带的用户管理系统或者鉴权系统，包括后面和K8S生态以及Service Mesh生态能够无缝的融合。基于这样的考虑，目前Nacos权限控制的设计是自带一个基本的实现，然后可以支持用户扩展。具体的设计如下。<a name="H0kp9"></a>### 模块设计 整体的模块设计是尽量将鉴权的逻辑抽象出来，不在服务发现模块或者配置管理模块添加相关的逻辑。通过配置文件可以选择当前使用的鉴权系统。Nacos自带的认证系统使用JWT Token，自带的鉴权系统使用的是RBAC。<p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1576219027093-45345003-c583-46ec-a161-01b5f4b3ff47.png#align=left&amp;display=inline&amp;height=450&amp;name=image.png&amp;originHeight=900&amp;originWidth=1744&amp;size=699757&amp;status=done&amp;style=none&amp;width=872#align=left&amp;display=inline&amp;height=900&amp;originHeight=900&amp;originWidth=1744&amp;status=done&amp;style=none&amp;width=1744" alt="image.png" class="img_ev3q"></p><a name="jeLdT"></a>### 认证算法 对于用户来说，不管是在控制台还是在客户端，都是上传用户名和密码来获取一个token，然后后续的每一次到Nacos的请求都会带上这个token来表明身份。这个token会有一个失效时间，对于控制台来说，只需要直接提示用户重新登录即可，对于客户端则需要有一个定期到Nacos刷新token的逻辑。<p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1576219050917-51013ce2-49f3-4a86-b5f9-bd07fc88f8e8.png#align=left&amp;display=inline&amp;height=368&amp;name=image.png&amp;originHeight=736&amp;originWidth=1718&amp;size=575605&amp;status=done&amp;style=none&amp;width=859#align=left&amp;display=inline&amp;height=736&amp;originHeight=736&amp;originWidth=1718&amp;status=done&amp;style=none&amp;width=1718" alt="image.png" class="img_ev3q"></p><a name="vSB1T"></a>### 鉴权算法 Nacos自带的鉴权系统使用的是RBAC模型，可以在网上查询相关的资料。<a name="RZZGa"></a>#### 数据模型 鉴权的数据模型也是基于标准的RBAC来设计的，分为用户、角色和权限三部分。用户就是由用户名和密码组成的用户信息，角色则是一个逻辑上的用户组，Nacos启动时会自带一个全局管理员的角色，只有这个全局管理员的角色可以进行添加用户、添加角色、添加授权等操作，保证安全性。而权限则是由资源+动作来组成。<p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1576736418792-936a9d1a-5095-47fc-9f87-230abed38384.png#align=left&amp;display=inline&amp;height=451&amp;name=image.png&amp;originHeight=902&amp;originWidth=1834&amp;size=438246&amp;status=done&amp;style=none&amp;width=917#align=left&amp;display=inline&amp;height=902&amp;originHeight=902&amp;originWidth=1834&amp;status=done&amp;style=none&amp;width=1834" alt="image.png" class="img_ev3q"></p><a name="0bd4753c"></a>### 接口设计 以下接口涉及到登录和鉴权的所有逻辑，这些接口除了登录接口，其他接口都只能由全局管理员来调用。<a name="7d94de1c"></a>#### 用户管理<ul><li>创建用户：POST<br>
/nacos/v1/auth/users?username=xx&amp;password=yy</li><li>删除用户：DELETE /nacos/v1/auth/users?username=xx&amp;password=yy</li><li>更新用户：PUT /nacos/v1/auth/users?username=xx&amp;oldPassword=yy&amp;newPassword=zz</li><li>登录：POST<br>
/nacos/v1/auth/users/login?username=xxx&amp;password=yyy</li></ul><a name="3f856ec2"></a>#### 角色管理<ul><li>创建角色/绑定用户到角色：POST /nacos/v1/auth/roles?role=xx&amp;username=yy</li><li>删除某个用户的角色：DELETE /nacos/v1/auth/roles?role=xx&amp;username=yy</li><li>获取用户的所有角色：GET /nacos/v1/auth/roles?username=xxx</li></ul><a name="23bbdd59"></a>#### 权限管理<ul><li>给角色添加权限：POST /nacos/v1/auth/permissions?role=xxx&amp;resource=yyy&amp;action=zzz</li><li>从角色删除权限：DELETE /nacos/v1/auth/permissions?role=xxx&amp;resource=yyy&amp;action=zzz</li><li>获取某个角色的权限：GET /nacos/v1/auth/permissions?role=xxx</li></ul><a name="4Hil5"></a># Nacos权限控制实战<a name="TWc9w"></a>## 安装Nacos 1.2.0<ol><li>部署包准备。可以直接下载安装包：<a href="https://github.com/alibaba/nacos/releases/tag/1.2.0" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos/releases/tag/1.2.0</a>，也可以将Nacos master分支clone下来进行源码编译：</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mvn -Prelease-nacos -Dmaven.test.skip</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true clean </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -U</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>安装包解压，然后使用distribution/nacos-mysql.sql进行数据库初始化，主要是新增了users, roles, permissions三张表，standalone模式使用distribution/schema.sql进行初始化。</li><li>Server端打开权限控制开关。修改con/application.properties内容：</li></ol><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nacos.core.auth.enabled=</span><span class="token boolean" style="color:#36acaa">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个开关采用了热加载模式，无需重启Server即可生效。因此当权限控制功能使用有异常时，可以直接回滚到不鉴权的模式。</p><p><strong>注意：</strong> Nacos 1.2.0里登录和鉴权是绑定关系，而由于这个开关的默认值为false，因此默认启动时，是没有登录界面的，这点请读者注意。</p><a name="xBJZi"></a>## 使用权限控制<ol><li>使用管理员账号登录Nacos控制台（如果页面提示错误，可以清空浏览器缓存刷新页面）：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333810/1580890674563-4d235fd9-983c-4b03-b45c-b1e164152ac7.png#align=left&amp;display=inline&amp;height=470&amp;name=image.png&amp;originHeight=940&amp;originWidth=2870&amp;size=274455&amp;status=done&amp;style=none&amp;width=1435#align=left&amp;display=inline&amp;height=940&amp;originHeight=940&amp;originWidth=2870&amp;status=done&amp;style=none&amp;width=2870" alt="image.png" class="img_ev3q"></p><p>可以看到，左侧边栏增加了一个父菜单和三个子菜单，分别用于权限控制里的用户创建、角色创建以及权限管&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;理。这个菜单栏只会在管理员登录的时候显示，也就意味着只有管理员才能进行权限的管理和分配。</p><ol start="2"><li>管理用户。点击“用户列表”，进入用户管理页面，可以进行用户的创建、修改和删除：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333810/1580890674569-a729854e-a72d-4b3b-bc4c-53f9df831f3e.png#align=left&amp;display=inline&amp;height=573&amp;name=image.png&amp;originHeight=1146&amp;originWidth=2872&amp;size=349203&amp;status=done&amp;style=none&amp;width=1436#align=left&amp;display=inline&amp;height=1146&amp;originHeight=1146&amp;originWidth=2872&amp;status=done&amp;style=none&amp;width=2872" alt="image.png" class="img_ev3q"></p><ol start="3"><li>管理角色。因为Nacos的自带的权限是基于角色来进行分配的，因此需要给创建好的用户绑定一些角色：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333810/1580890674603-f69520a1-f53e-4eb7-9186-f2963e7b3d65.png#align=left&amp;display=inline&amp;height=545&amp;name=image.png&amp;originHeight=1090&amp;originWidth=2874&amp;size=346611&amp;status=done&amp;style=none&amp;width=1437#align=left&amp;display=inline&amp;height=1090&amp;originHeight=1090&amp;originWidth=2874&amp;status=done&amp;style=none&amp;width=2874" alt="image.png" class="img_ev3q"></p><ol start="4"><li>管理权限。角色创建好以后，就可以给这个角色赋予特定的权限了：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333810/1580890674580-e22945e1-be3a-46bd-b8f3-11b38eee0786.png#align=left&amp;display=inline&amp;height=581&amp;name=image.png&amp;originHeight=1162&amp;originWidth=2876&amp;size=368264&amp;status=done&amp;style=none&amp;width=1438#align=left&amp;display=inline&amp;height=1162&amp;originHeight=1162&amp;originWidth=2876&amp;status=done&amp;style=none&amp;width=2876" alt="image.png" class="img_ev3q"></p><p>在“添加资源”对话框里，可以选择绑定的角色，命名空间资源以及对应的动作类型，例如在上图中，我们给角色role1绑定命名空间test的读写权限。然后又因为刚刚我们是将user1绑定到了role1上，那么user1这个用户就可以对test这个命名空间的资源进行读写操作了。</p><ol start="5"><li>使用user1登录控制台。点击控制台右上角，退出admin账号，然后用刚才创建的user1进行登录：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333810/1580890674574-ca6eee1f-b749-4275-897d-ab9fba0ebf80.png#align=left&amp;display=inline&amp;height=449&amp;name=image.png&amp;originHeight=898&amp;originWidth=2874&amp;size=340563&amp;status=done&amp;style=none&amp;width=1437#align=left&amp;display=inline&amp;height=898&amp;originHeight=898&amp;originWidth=2874&amp;status=done&amp;style=none&amp;width=2874" alt="image.png" class="img_ev3q"></p><p>如上图所示，首先是左侧的权限管理菜单消失了，因为当前用户不是管理员。其次是会弹出一个鉴权失败的提示框。不用担心，这个提示框意思是user1没有public命名空间的读权限，所以会弹出，但是不影响我们将命名空间切换到test：<br><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333810/1580890674621-bc16b2ad-4a9e-4ebc-83e8-fa41f4a0cba4.png#align=left&amp;display=inline&amp;height=536&amp;name=image.png&amp;originHeight=1072&amp;originWidth=2876&amp;size=554716&amp;status=done&amp;style=none&amp;width=1438#align=left&amp;display=inline&amp;height=1072&amp;originHeight=1072&amp;originWidth=2876&amp;status=done&amp;style=none&amp;width=2876" alt="image.png" class="img_ev3q"></p><p>如上图所示，我们可以看到test命名空间的配置数据了，下面我们再来介绍客户端的使用。</p><ol start="6"><li>首先依赖最新的nacos 1.2.0客户端，然后在初始化时添加如下代码：</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Properties properties = new Properties();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">properties.put(PropertyKeyConst.NAMESPACE, "99a791cf-41c4-4535-9e93-b0141652bad0");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">properties.put(PropertyKeyConst.SERVER_ADDR, "127.0.0.1:8848");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 配置用户名：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">properties.put(PropertyKeyConst.USERNAME, "user1");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 配置密码：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">properties.put(PropertyKeyConst.PASSWORD, "pwd1");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ConfigService iconfig = NacosFactory.createConfigService(properties);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="7"><li>使用客户端进行正常的读写配置操作。</li></ol><a name="8eF0X"></a># 我们在招人 阿里巴巴云原生基础技术中台是隶属于阿里云基础产品事业部的核心研发团队，致力于打造稳定、标准、先进的云原生应用基础平台，推动行业面向云原生技术升级与革命。在这里，你将与来自云计算、大数据领域的顶尖技术专家亲密合作，在全球独一无二的场景和规模中从事Kubernetes、Service Mesh、Serverless、Open Application Model（OAM）、Cloud Native Microservices、OpenMessaging、Event Streaming等云原生生态核心基础技术及Apache Dubbo、Apache RocketMQ、Nacos、Arthas等顶级开源项目的研发和落地工作。在标杆级的平台上，既服务阿里巴巴全球经济体，更服务全世界的开发者用户。目前在招聘技术专家岗位，详情可参考：[http://www.posterhr.com/html/CkgpBwD6f?from=timeline&amp;isappinstalled=0](http://www.posterhr.com/html/CkgpBwD6f?from=timeline&amp;isappinstalled=0)（可以直接投递，也可以将简历直接发送到dungu.zpf#alibaba-inc.com。#替换为@）]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos 1.3.0 new kernel construction process]]></title>
            <link>https://nacos.io/en/blog/nacos-1.3.0-design</link>
            <guid>https://nacos.io/en/blog/nacos-1.3.0-design</guid>
            <pubDate>Wed, 12 Feb 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos 1.3.0 new kernel construction process]]></description>
            <content:encoded><![CDATA[<a name="0YIG0"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="summarize">Summarize<a href="#summarize" class="hash-link" aria-label="Direct link to Summarize" title="Direct link to Summarize">​</a></h2><p>This 1.3.0 is implanted to a great extent, involving the modification of two large modules and the addition of a core module</p><ol><li>nacos-core module modification<ol><li>nacos</li><li>nacos internal event mechanism</li><li>nacos consistency protocol layer</li></ol></li><li>nacos-config module modification<ol><li>Add embedded distributed data storage components</li><li>Separation of embedded storage and external storage</li><li>Simple operation and maintenance of embedded storage</li></ol></li><li>Add nacos-consistency module<ol><li>Unified abstraction for AP protocol and CP protocol</li></ol></li></ol><a name="rnkDY"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="system-parameters-changes">System parameters changes<a href="#system-parameters-changes" class="hash-link" aria-label="Direct link to System parameters changes" title="Direct link to System parameters changes">​</a></h2><a name="1Gmg9"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="updates">Updates<a href="#updates" class="hash-link" aria-label="Direct link to Updates" title="Direct link to Updates">​</a></h3><table><thead><tr><th align="center"><strong>core</strong></th><th>nacos.watch-file.max-dirs</th><th>JVM parameter</th><th>Maximum number of monitored directories</th></tr></thead><tbody><tr><td align="center"></td><td>nacos.core.notify.ring-buffer-size</td><td>JVM parameter</td><td>Quick notification of the maximum length of the queue</td></tr><tr><td align="center"></td><td>nacos.core.notify.share-buffer-size</td><td>JVM parameter</td><td>The maximum length of the slow notification queue</td></tr><tr><td align="center"></td><td>nacos.core.member.fail-access-cnt</td><td>JVM parameter.properties</td><td>Maximum number of failed visits to cluster member nodes</td></tr><tr><td align="center"></td><td>nacos.core.address-server.retry</td><td>JVM parameter、application.properties</td><td>Address server addressing mode, first start request retry times</td></tr></tbody></table><br><a name="kxo8O"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-future-overall-logical-architecture-of-nacos-and-its-components">The future overall logical architecture of Nacos and its components<a href="#the-future-overall-logical-architecture-of-nacos-and-its-components" class="hash-link" aria-label="Direct link to The future overall logical architecture of Nacos and its components" title="Direct link to The future overall logical architecture of Nacos and its components">​</a></h2><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333972/1587129046320-5a286f38-8db4-4e76-9b42-8bd859f51a60.png#align=left&amp;display=inline&amp;height=1184&amp;margin=%5Bobject%20Object%5D&amp;name=1561217775318-6e408805-18bb-4242-b4e9-83c5b929b469.png&amp;originHeight=1184&amp;originWidth=1608&amp;size=279074&amp;status=done&amp;style=none&amp;width=1608" alt="1561217775318-6e408805-18bb-4242-b4e9-83c5b929b469.png" class="img_ev3q"></p><a name="Hyc6u"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-cluster-member-node-addressing-mode">Nacos cluster member node addressing mode<a href="#nacos-cluster-member-node-addressing-mode" class="hash-link" aria-label="Direct link to Nacos cluster member node addressing mode" title="Direct link to Nacos cluster member node addressing mode">​</a></h2><p>Before 1.3.0, nacos' naming module and config module had their own member list management tasks. In order to unify the replacement mode of nacos assigning the next member list, the implementation of merge management is replaced from the named module and the config module, unified to the addressing module of the core module, and the command line parameters are added at the same time -Dnacos.member.list **To set the list listed by nacos, this parameter can be called an alternative to the cluster.conf file. The current nacos addressing mode categories are as follows</p><ol><li>In stand-alone mode: StandaloneMemberLookup</li><li>Play mode<ol><li>The cluster.conf file exists: FileConfigMemberLookup</li><li>The cluster.conf file does not exist or -Dnacos.member.list is not set: AddressServerMemberLookup</li></ol></li></ol><p>If you want to specify an addressing mode, set this parameter：<strong>nacos.core.member.lookup.type=<!-- -->[file,address-server]</strong></p><p>The logical diagram is as follows
<img loading="lazy" src="https://cdn.nlark.com/yuque/__puml/e209a677aa8b5ffce23589e987ee5129.svg#lake_card_v2=eyJjb2RlIjoiQHN0YXJ0dW1sXG5cbigqKSAtLT4gXCJMb29rdXBGYWN0b3J5LmluaXQoKVwiXG5cbmlmIFwic3RhbmRhbG9uZSBtb2RlXCIgdGhlblxuICAtLT5bdHJ1ZV0gXCJyZXR1cm4gU3RhbmRhbG9uZU1lbWJlckxvb2t1cFwiXG4gIC0tPiBMb29rdXAucnVuKClcbmVsc2VcbiBpZiBcImNsdXN0ZXIuY29uZiBleGlzdHNcIiB0aGVuXG4gICAgLS0-W3RydWVdIFwicmV0dXJuIEZpbGVDb25maWdNZW1iZXJMb29rdXBcIlxuICAgIC0tPiBMb29rdXAucnVuKClcbiBlbHNlXG4gICAgLT5bZmFsc2VdIFwicmV0dXJuIEFkZHJlc3NTZXJ2ZXJNZW1iZXJMb29rdXBcIlxuICAgIC0tPiBMb29rdXAucnVuKClcbiBlbmRpZlxuZW5kaWZcblxuLS0-ICgqKVxuXG5AZW5kdW1sIiwidHlwZSI6InB1bWwiLCJpZCI6IlplWGtkIiwidXJsIjoiaHR0cHM6Ly9jZG4ubmxhcmsuY29tL3l1cXVlL19fcHVtbC9lMjA5YTY3N2FhOGI1ZmZjZTIzNTg5ZTk4N2VlNTEyOS5zdmciLCJjYXJkIjoiZGlhZ3JhbSJ9" class="img_ev3q"></p><a name="wqkMp"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="addressing-mode-details">Addressing mode details<a href="#addressing-mode-details" class="hash-link" aria-label="Direct link to Addressing mode details" title="Direct link to Addressing mode details">​</a></h3><p>Next, I introduce two other addressing modes in addition to the addressing mode in stand-alone mode<br></p><a name="egl3H"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fileconfigmemberlookup">FileConfigMemberLookup<a href="#fileconfigmemberlookup" class="hash-link" aria-label="Direct link to FileConfigMemberLookup" title="Direct link to FileConfigMemberLookup">​</a></h4><p>This addressing mode is managed based on the cluster.conf file, and each node will read the list of member nodes in the cluster.conf file under their respective ${nacos.home}/conf and then form a cluster. And after reading the cluster.conf file under ${nacos.home}/conf for the first time, it will automatically register a directory listener with the operating system's <em><strong>inotify</strong></em> mechanism to monitor ${nacos.home}/ All file changes in the conf directory (note that only files will be monitored here, and file changes in subdirectories cannot be monitored)<br>When you need to expand or shrink the cluster nodes, you need to manually modify the content of the member node list of cluster.conf under ${nacos.home}/conf for each node.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">private FileWatcher watcher = new FileWatcher() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public void onChange(FileChangeEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            readClusterConfFromDisk();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public boolean interest(String context) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return StringUtils.contains(context, "cluster.conf");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void start() throws NacosException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    readClusterConfFromDisk();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (memberManager.getServerList().isEmpty()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throw new NacosException(NacosException.SERVER_ERROR,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    "Failed to initialize the member node, is empty");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Use the inotify mechanism to monitor file changes and automatically</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // trigger the reading of cluster.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        WatchFileCenter.registerWatcher(ApplicationUtils.getConfFilePath(), watcher);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catch (Throwable e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Loggers.CLUSTER.error("An exception occurred in the launch file monitor : {}", e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The first time you directly read the node list information in the cluster.conf file, then register a directory listener with WatchFileCenter, and automatically trigger <em><strong>readClusterConfFromDisk()</strong></em> to re-read cluster.conf when the cluster.conf file changes file<br><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333972/1591014354207-49c1e934-2aa5-465a-8a2b-0b09902814f8.png#align=left&amp;display=inline&amp;height=531&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=531&amp;originWidth=1169&amp;size=105696&amp;status=done&amp;style=none&amp;width=1169" alt="image.png" class="img_ev3q"></p><a name="yFTCl"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="addressservermemberlookup">AddressServerMemberLookup<a href="#addressservermemberlookup" class="hash-link" aria-label="Direct link to AddressServerMemberLookup" title="Direct link to AddressServerMemberLookup">​</a></h4><p>This addressing mode is based on an additional web server to manage cluster.conf. Each node periodically requests the content of the cluster.conf file from the web server, and then implements addressing between cluster nodes and expansion and contraction. <br>When you need to expand or shrink the cluster, you only need to modify the cluster.conf file, and then each node will automatically get the latest cluster.conf file content when it requests the address server.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void start() throws NacosException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (start.compareAndSet(false, true)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.maxFailCount = Integer.parseInt(ApplicationUtils.getProperty("maxHealthCheckFailCount", "12"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        initAddressSys();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        run();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private void initAddressSys() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String envDomainName = System.getenv("address_server_domain");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (StringUtils.isBlank(envDomainName)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        domainName = System.getProperty("address.server.domain", "jmenv.tbsite.net");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        domainName = envDomainName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String envAddressPort = System.getenv("address_server_port");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (StringUtils.isBlank(envAddressPort)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addressPort = System.getProperty("address.server.port", "8080");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addressPort = envAddressPort;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addressUrl = System.getProperty("address.server.url",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ApplicationUtils.getContextPath() + "/" + "serverlist");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addressServerUrl = "http://" + domainName + ":" + addressPort + addressUrl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    envIdUrl = "http://" + domainName + ":" + addressPort + "/env";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Loggers.CORE.info("ServerListService address-server port:" + addressPort);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Loggers.CORE.info("ADDRESS_SERVER_URL:" + addressServerUrl);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SuppressWarnings("PMD.UndefineMagicConstantRule")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private void run() throws NacosException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // With the address server, you need to perform a synchronous member node pull at startup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Repeat three times, successfully jump out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean success = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Throwable ex = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int maxRetry = ApplicationUtils.getProperty("nacos.core.address-server.retry", Integer.class, 5);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (int i = 0; i &lt; maxRetry; i ++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            syncFromAddressUrl();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            success = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Throwable e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ex = e;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Loggers.CLUSTER.error("[serverlist] exception, error : {}", ExceptionUtil.getAllExceptionMsg(ex));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!success) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throw new NacosException(NacosException.SERVER_ERROR, ex);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GlobalExecutor.scheduleByCommon(new AddressServerSyncTask(), 5_000L);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>During initialization, it will take the initiative to synchronize the current cluster member list information with the address server, and if it fails, retry, the maximum number of retries can be controlled by setting <em><strong>nacos.core.address-server.retry</strong></em>, The default is 5 times, and then after success, a scheduled task will be created to synchronize the cluster member node information to the address server<br><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333972/1591014362972-004f5338-af0d-4d0d-b769-4f3d5118c08a.png#align=left&amp;display=inline&amp;height=846&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=846&amp;originWidth=1149&amp;size=188886&amp;status=done&amp;style=none&amp;width=1149" alt="image.png" class="img_ev3q"></p><a name="sgOTI"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-node-management-and-addressing-modes-are-combined">How node management and addressing modes are combined<a href="#how-node-management-and-addressing-modes-are-combined" class="hash-link" aria-label="Direct link to How node management and addressing modes are combined" title="Direct link to How node management and addressing modes are combined">​</a></h3><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333972/1591014400580-39b83aa0-c548-4241-a49e-0d72abda2a95.png#align=left&amp;display=inline&amp;height=715&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=715&amp;originWidth=1189&amp;size=131826&amp;status=done&amp;style=none&amp;width=1189" alt="image.png" class="img_ev3q"><br>After MemberLookup starts, it will perform addressing tasks according to different addressing modes, will collect cluster node list information, call memberChange, trigger cluster node changes, and then publish node change events</p><a name="idHpC"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-consensus-protocol-protocol-layer-abstraction">Nacos consensus protocol protocol layer abstraction<a href="#nacos-consensus-protocol-protocol-layer-abstraction" class="hash-link" aria-label="Direct link to Nacos consensus protocol protocol layer abstraction" title="Direct link to Nacos consensus protocol protocol layer abstraction">​</a></h2><p>From the overall architecture of nacos in the future, it can be seen that the consistency protocol layer will be the core module of nacos, and will serve each functional module built on the core module, or the service and core module itself. The consistency protocol needs to choose between availability and consistency because of the existence of partition fault tolerance, so there are two major types of consistency: final consistency and strong consistency. In nacos, both types of consistency protocols are possible. For example, the naming module uses AP and CP for data management of service instances, respectively. For the config module, it will involve the use of CP. At the same time, there are the following functional demand points</p><ol><li>At present, the persistence service uses a variant version of raft, and the business and the raft protocol are coupled. Therefore, it needs to be decoupled and decoupled. At the same time, a standard Java version of Raft is selected for implementation.</li><li>For small and medium-sized users, the configuration is basically not super much. An independent mysql is relatively heavy and requires a light-weight storage solution. It also supports 2.0 not dependent on mysql and 3.0 dependent on mysql configurability</li><li>Due to CP or AP, there are many implementations, how to make a good abstraction of the consistency protocol layer, so that in the future can quickly achieve the specific implementation of the underlying consistency protocol replacement, such as the Raft protocol, the current selection of nacos It is JRaft, it is not excluded that in the future nacos will implement a standard raft protocol or Paxos protocol by itself</li><li>Since there are multiple function modules working independently in Nacos, there can be no influence between each function module. For example, when the A module processes the request too slowly or an exception occurs, it cannot affect the normal operation of the B module, that is, each function module is in use. How to isolate the data processing of each module when using a consistent protocol?</li></ol><p>According to the consensus protocol and the above functional requirements, this time an abstract consensus protocol layer and related interfaces were made</p><a name="3w8xM"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="consensus-agreement-abstraction">Consensus agreement abstraction<a href="#consensus-agreement-abstraction" class="hash-link" aria-label="Direct link to Consensus agreement abstraction" title="Direct link to Consensus agreement abstraction">​</a></h3><a name="p7zRo"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="consistencyprotocol">ConsistencyProtocol<a href="#consistencyprotocol" class="hash-link" aria-label="Direct link to ConsistencyProtocol" title="Direct link to ConsistencyProtocol">​</a></h4><p>The so-called consistency is the characteristic of whether multiple copies can maintain consistency, and the essence of the copy is data, and the operation of the data is either acquisition or modification. At the same time, the consensus protocol is actually for distributed situations, and this necessarily involves multiple nodes. Therefore, there is a need for a corresponding interface to be able to adjust the coordination protocol of the collaborative work node. What if we want to observe the operation of the consistency agreement? For example, the Raft protocol, we want to know who is the leader in the current cluster, the term of office, and who are the member nodes in the current cluster? Therefore, it is also necessary to provide a consistent protocol metadata acquisition. <br>In summary, the general design of ConsistencyProtcol can come out</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface ConsistencyProtocol&lt;T extends Config, P extends LogProcessor&gt; extends CommandOperations {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Consistency protocol initialization: perform initialization operations based on the incoming Config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 一致性协议初始化，根据 Config 实现类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param config {@link Config}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void init(T config);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Add a log handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param processors {@link LogProcessor}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void addLogProcessors(Collection&lt;P&gt; processors);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Copy of metadata information for this consensus protocol</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 该一致性协议的元数据信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return metaData {@link ProtocolMetaData}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ProtocolMetaData protocolMetaData();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Obtain data according to the request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param request request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return data {@link Response}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @throws Exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Response getData(GetRequest request) throws Exception;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Get data asynchronously</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param request request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return data {@link CompletableFuture&lt;Response&gt;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CompletableFuture&lt;Response&gt; aGetData(GetRequest request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Data operation, returning submission results synchronously</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 同步数据提交，在 Datum 中已携带相应的数据操作信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param data {@link Log}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return submit operation result {@link Response}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @throws Exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Response submit(Log data) throws Exception;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Data submission operation, returning submission results asynchronously</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 异步数据提交，在 Datum 中已携带相应的数据操作信息，返回一个Future，自行操作，提交发生的异常会在CompleteFuture中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param data {@link Log}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return {@link CompletableFuture&lt;Response&gt;} submit result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @throws Exception when submit throw Exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CompletableFuture&lt;Response&gt; submitAsync(Log data);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * New member list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 新的成员节点列表，一致性协议自行处理相应的成员节点是加入还是离开</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param addresses [ip:port, ip:port, ...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void memberChange(Set&lt;String&gt; addresses);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Consistency agreement service shut down</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 一致性协议服务关闭</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For the CP protocol, due to the concept of Leader, it is necessary to provide a method for obtaining who is the current Leader of the CP protocol.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface CPProtocol&lt;C extends Config&gt; extends ConsistencyProtocol&lt;C&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Returns whether this node is a leader node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param group business module info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return is leader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @throws Exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean isLeader(String group) throws Exception;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="oJFpB"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="data-operation-request-submission-objectloggetrequest">Data operation request submission object：Log、GetRequest<a href="#data-operation-request-submission-objectloggetrequest" class="hash-link" aria-label="Direct link to Data operation request submission object：Log、GetRequest" title="Direct link to Data operation request submission object：Log、GetRequest">​</a></h4><p>As mentioned above, the consistency protocol is actually for data operations. Data operations are basically divided into two categories: data query and data modification, and at the same time, data isolation between different functional modules must be satisfied. Therefore, the data modification operations and data query operations are explained separately here.</p><ol><li>Data modification<ol><li>Data modification operation, you must know which functional module this request belongs to</li><li>For data modification operations, you must first know what kind of modification operation this data modification operation is for, so that the function module can perform corresponding logical operations for the real data modification operation</li><li>For data modification operations, you must know what the modified data is, that is, the request body. In order to make the consistency protocol layer more general, here for the data structure of the request body, the byte[] array is selected</li><li>The type of data, because we serialize the real data into a byte[] array, in order to be able to serialize normally, we may also need to record what the type of this data is</li><li>The information summary or identification information of this request</li><li>The additional information for this request is used to expand the data to be transmitted in the future</li></ol></li></ol><p>In summary, it can be concluded that the design of the Log object is as follows</p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message Log {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Function module grouping information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string group = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Abstract or logo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string key = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Specific request data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bytes data = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // type of data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string type = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // More specific data manipulation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string operation = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // extra information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    map&lt;string, string&gt; extendInfo = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Data query<ol><li>For data query operations, you must know which function module initiated the request</li><li>What are the conditions for data query? In order to be compatible with data query operations of various storage structures, here byte[] is used for storage</li><li>The additional information for this request is used to expand the data to be transmitted in the future</li></ol></li></ol><p>In summary, the design of the GetRequest object is as follows</p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">message GetRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Function module grouping information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string group = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Specific request data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bytes data = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // extra information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    map&lt;string, string&gt; extendInfo = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="vBig4"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="function-modules-use-consistency-protocollogprocessor">Function modules use consistency protocol：LogProcessor<a href="#function-modules-use-consistency-protocollogprocessor" class="hash-link" aria-label="Direct link to Function modules use consistency protocol：LogProcessor" title="Direct link to Function modules use consistency protocol：LogProcessor">​</a></h4><p>After the data operation is submitted through the consistency protocol, each node needs to process the Log or GetRequest object. Therefore, we need to abstract a Log and GetRequest object Processor. Different functional modules implement the processor. ConsistencyProtocol will internally According to the group attributes of Log and GetRequest, the Log and GetRequest objects are routed to a specific Processor. Of course, the Processor also needs to indicate which functional module it belongs to.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public abstract class LogProcessor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * get data by key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param request request {@link GetRequest}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return target type data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public abstract Response onRequest(GetRequest request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Process Submitted Log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param log {@link Log}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return {@link boolean}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public abstract Response onApply(Log log);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Irremediable errors that need to trigger business price cuts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param error {@link Throwable}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onError(Throwable error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * In order for the state machine that handles the transaction to be able to route</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * the Log to the correct LogProcessor, the LogProcessor needs to have an identity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return Business unique identification name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public abstract String group();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For the CP protocol, such as the Raft protocol, there is a snapshot design, so we need to separately extend a method for the CP protocol</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public abstract class LogProcessor4CP extends LogProcessor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Discovery snapshot handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * It is up to LogProcessor to decide which SnapshotOperate should be loaded and saved by itself</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return {@link List &lt;SnapshotOperate&gt;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public List&lt;SnapshotOperation&gt; loadSnapshotOperate() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Collections.emptyList();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="zbsAE"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h4><p>As can be seen from the above points, ConsistencyProtocol is the use interface exposed to the upper layer functional modules. Each ConsistencyProtocol has a backend implemented by a specific consistency protocol. Because Backend cannot be well compatible with nacos existing architecture design, so The additional LogProcessor is designed to solve this problem.<br><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333972/1591015048030-8a4bff4a-20ed-46dd-a7f7-98655b22946f.png#align=left&amp;display=inline&amp;height=591&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=591&amp;originWidth=886&amp;size=93327&amp;status=done&amp;style=none&amp;width=886" alt="image.png" class="img_ev3q"><br>同At the time, because the backend inside the consistency protocol layer needs to implement the isolation processing of the data of different business modules, and this piece of logic is implemented by the request object and the group attribute of the LogProcessor<br><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333972/1591015155835-a897262e-8e57-409c-bf94-d57bf765c80b.png#align=left&amp;display=inline&amp;height=591&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=591&amp;originWidth=910&amp;size=118083&amp;status=done&amp;style=none&amp;width=910" alt="image.png" class="img_ev3q"></p><a name="C1yU6"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="consistent-protocol-layer-workflow">Consistent protocol layer workflow<a href="#consistent-protocol-layer-workflow" class="hash-link" aria-label="Direct link to Consistent protocol layer workflow" title="Direct link to Consistent protocol layer workflow">​</a></h3><p>We can take a look at a sequence diagram, the general workflow of the consistency protocol layer
<img loading="lazy" src="https://cdn.nlark.com/yuque/__puml/30b7e270e7aef8bb63136aaffbe5bfbf.svg#lake_card_v2=eyJjb2RlIjoiQHN0YXJ0dW1sXG5cbnBhcnRpY2lwYW50IFwiTWVtYmVyTWFuYWdlclwiIGFzIE5hY29zQ2x1c3RlclxucGFydGljaXBhbnQgXCJCdXNpbmVzc01vZHVsZVwiIGFzIEJpelxucGFydGljaXBhbnQgXCJDb25zaXN0ZW5jeVByb3RvY29sXCIgYXMgUHJvdG9jb2xcbnBhcnRpY2lwYW50IFwiQ0FQQmFja2VuZFwiIGFzIEJhY2tlbmRcbnBhcnRpY2lwYW50IFwiQ29uZmlnXCIgYXMgQ29uZmlnXG5wYXJ0aWNpcGFudCBcIkxvZ1Byb2Nlc3NvclwiIGFzIFByb2Nlc3NvclxucGFydGljaXBhbnQgXCJMb2dcIiBhcyBMb2dcblxuYWN0aXZhdGUgTmFjb3NDbHVzdGVyXG5OYWNvc0NsdXN0ZXIgLT4gTmFjb3NDbHVzdGVyOiBpbml0KCkg5Yid5aeL5YyWTmFjb3Ppm4bnvqRcblxuTmFjb3NDbHVzdGVyIC0-IENvbmZpZzog6I635Y-WQ29uZmln5a-56LGhXG5hY3RpdmF0ZSBDb25maWdcbkNvbmZpZyAtPiBDb25maWc6IOaUtumbhkxvZ1Byb2Nlc3NvcueahOS_oeaBr1xuQ29uZmlnIC0-IE5hY29zQ2x1c3RlclxuZGVhY3RpdmF0ZSBDb25maWdcblxuXG5OYWNvc0NsdXN0ZXIgLT4gUHJvdG9jb2w6IOiOt-WPluaJgOaciUNvbnNpc3RlbmN5UHJvdG9jb2zlrp7njrBcbmFjdGl2YXRlIFByb3RvY29sXG5cbk5hY29zQ2x1c3RlciAtPiBQcm90b2NvbDogaW5pdChDb25maWcpIOaWueazleaJp-ihjFxuXG5kZWFjdGl2YXRlIFByb3RvY29sXG5kZWFjdGl2YXRlIE5hY29zQ2x1c3RlclxuXG5cbkJpeiAtPiBMb2c6IOWIm-W7uuS4gOS4quS6i-WKoeWvueixoVxuYWN0aXZhdGUgQml6XG5hY3RpdmF0ZSBMb2dcblxuXG5Mb2cgLT4gTG9nOiDorr7nva5kYXRhXG5Mb2cgLT4gTG9nOiDorr7nva5rZXlcbkxvZyAtPiBMb2c6IOiuvue9rmNsYXNzTmFtZVxuTG9nIC0-IExvZzog6K6-572uZXh0ZW5kSW5mb1xuTG9nIC0-IEJpelxuZGVhY3RpdmF0ZSBMb2dcblxuQml6IC0-IFByb3RvY29sOiBzdWJtaXQoTG9nKSDosIPnlKjkuIDoh7TmgKfljY_orq7ov5vooYzkuovliqHmj5DkuqRcbmFjdGl2YXRlIFByb3RvY29sXG5cblByb3RvY29sIC0-IEJhY2tlbmQ6IOWGhemDqOS4gOiHtOaAp-WNj-iuruW3peS9nFxuYWN0aXZhdGUgQmFja2VuZFxuXG5CYWNrZW5kIC0-IFByb3RvY29sOiDov5Tlm57lt6XkvZzlpITnkIbnu5PmnpxcbmRlYWN0aXZhdGUgQmFja2VuZFxuXG5Qcm90b2NvbCAtPiBQcm9jZXNzb3I6IOWwhkxvZ-WIhuWPkeWIsOWvueW6lOeahFByb2Nlc3Nvcu-8jOiwg-eUqCBvbkFwcGx5IOaWueazlVxuYWN0aXZhdGUgUHJvdG9jb2xcbmRlYWN0aXZhdGUgUHJvdG9jb2xcblxuUHJvY2Vzc29yIC0-IEJpejog5LqL5Yqh5o-Q5Lqk57uT5p6cXG5cbmRlYWN0aXZhdGUgUHJvY2Vzc29yXG5kZWFjdGl2YXRlIEJpelxuXG5AZW5kdW1sIiwidHlwZSI6InB1bWwiLCJtYXJnaW4iOnRydWUsImlkIjoiNFZpMkwiLCJ1cmwiOiJodHRwczovL2Nkbi5ubGFyay5jb20veXVxdWUvX19wdW1sLzMwYjdlMjcwZTdhZWY4YmI2MzEzNmFhZmZiZTViZmJmLnN2ZyIsImNhcmQiOiJkaWFncmFtIn0=" class="img_ev3q"></p><a name="xtBNU"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-implementation-option-of-cp-protocol-in-nacos-consistency-protocol-layerjraft">The implementation option of CP protocol in Nacos consistency protocol layer——JRaft<a href="#the-implementation-option-of-cp-protocol-in-nacos-consistency-protocol-layerjraft" class="hash-link" aria-label="Direct link to The implementation option of CP protocol in Nacos consistency protocol layer——JRaft" title="Direct link to The implementation option of CP protocol in Nacos consistency protocol layer——JRaft">​</a></h3><p>After the consistency protocol layer is abstracted, the rest is the choice of concrete consistency protocol implementation. Here we have chosen Ant Financial's open source JRaft, so how can we use JRaf as a backend of the CP protocol? The following simple flow chart describes the initialization process when JRaft is used as a Backend of the CP protocol</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * A concrete implementation of CP protocol: JRaft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;pre&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                                           ┌──────────────────────┐               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                                           │                      │               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *            ┌──────────────────────┐       │                      ▼               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *            │   ProtocolManager    │       │        ┌───────────────────────────┐ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *            └──────────────────────┘       │        │for p in [LogProcessor4CP] │ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        │                  │        └───────────────────────────┘ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        ▼                  │                      │               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *      ┌──────────────────────────────────┐ │                      ▼               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *      │    discovery LogProcessor4CP     │ │             ┌─────────────────┐      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *      └──────────────────────────────────┘ │             │  get p.group()  │      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        │                  │             └─────────────────┘      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        ▼                  │                      │               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                 ┌─────────────┐           │                      │               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                 │ RaftConfig  │           │                      ▼               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                 └─────────────┘           │      ┌──────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        │                  │      │  create raft group service   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        ▼                  │      └──────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *              ┌──────────────────┐         │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *              │  JRaftProtocol   │         │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *              └──────────────────┘         │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        │                  │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                     init()                │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        │                  │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        ▼                  │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *               ┌─────────────────┐         │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *               │   JRaftServer   │         │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *               └─────────────────┘         │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        │                  │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        │                  │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        ▼                  │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *             ┌────────────────────┐        │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *             │JRaftServer.start() │        │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *             └────────────────────┘        │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        │                  │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        └──────────────────┘                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;/pre&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author &lt;a href="mailto:liaochuntao@live.com"&gt;liaochuntao&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>JRaftProtocol is a concrete implementation of a ConsistencyProtocol when JRaft is used as the backend of the CP protocol. It has a JRaftServer member attribute inside. JRaftServer distributes various API operations of JRaft, such as data operation submission, data query, and member node changes. , Leader node query, etc.</p><p><em><strong>Note: The data generated during JRaft operation is in the ${nacos.home}/data/protocol/raft file directory. Different business modules have different file groupings. If the node crashes or shuts down abnormally, clear the files in the directory and restart the node</strong></em></p><p>Since JRaft implements the concept of raft group, it is possible to use the design of raft group to create a raft group for each function module. Here is part of the code, which shows how to embed LogProcessor in the state machine and create a Raft Group for each LogPrcessor</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">synchronized void createMultiRaftGroup(Collection&lt;LogProcessor4CP&gt; processors) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // There is no reason why the LogProcessor cannot be processed because of the synchronization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!this.isStarted) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.processors.addAll(processors);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final String parentPath = Paths</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .get(ApplicationUtils.getNacosHome(), "data/protocol/raft").toString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (LogProcessor4CP processor : processors) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        final String groupName = processor.group();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (multiRaftGroup.containsKey(groupName)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new DuplicateRaftGroupException(groupName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Ensure that each Raft Group has its own configuration and NodeOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Configuration configuration = conf.copy();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        NodeOptions copy = nodeOptions.copy();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JRaftUtils.initDirectory(parentPath, groupName, copy);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Here, the LogProcessor is passed into StateMachine, and when the StateMachine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // triggers onApply, the onApply of the LogProcessor is actually called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        NacosStateMachine machine = new NacosStateMachine(this, processor);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        copy.setFsm(machine);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        copy.setInitialConf(configuration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Set snapshot interval, default 1800 seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int doSnapshotInterval = ConvertUtils.toInt(raftConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            .getVal(RaftSysConstants.RAFT_SNAPSHOT_INTERVAL_SECS),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    RaftSysConstants.DEFAULT_RAFT_SNAPSHOT_INTERVAL_SECS);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // If the business module does not implement a snapshot processor, cancel the snapshot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        doSnapshotInterval = CollectionUtils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .isEmpty(processor.loadSnapshotOperate()) ? 0 : doSnapshotInterval;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        copy.setSnapshotIntervalSecs(doSnapshotInterval);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Loggers.RAFT.info("create raft group : {}", groupName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RaftGroupService raftGroupService = new RaftGroupService(groupName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    localPeerId, copy, rpcServer, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Because RpcServer has been started before, it is not allowed to start again here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Node node = raftGroupService.start(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        machine.setNode(node);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RouteTable.getInstance().updateConfiguration(groupName, configuration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RaftExecutor.executeByCommon(() -&gt; registerSelfToCluster(groupName, localPeerId, configuration));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Turn on the leader auto refresh for this group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Random random = new Random();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        long period = nodeOptions.getElectionTimeoutMs() + random.nextInt(5 * 1000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RaftExecutor.scheduleRaftMemberRefreshJob(() -&gt; refreshRouteTable(groupName),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    nodeOptions.getElectionTimeoutMs(), period, TimeUnit.MILLISECONDS);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        multiRaftGroup.put(groupName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    new RaftGroupTuple(node, processor, raftGroupService, machine));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="4czvB"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="qa-why-do-you-want-to-create-multiple-raft-groups">Q&amp;A: Why do you want to create multiple raft groups<a href="#qa-why-do-you-want-to-create-multiple-raft-groups" class="hash-link" aria-label="Direct link to Q&amp;A: Why do you want to create multiple raft groups" title="Direct link to Q&amp;A: Why do you want to create multiple raft groups">​</a></h4><p>Some people may have doubts. Since the LogProcessor has been designed before, you can use a Raft Group. When the state machine is appl, you can route to different LogProcessors according to the Log group attribute. Each function module creates a Raft group, will it consume a lot of resources? <br>As mentioned before, we hope that the modules that work independently do not affect each other. For example, the A module processing Log may cause the application speed to be slow because of the Block operation, or an exception may occur halfway. For the Raft protocol , When the log apply fails, the state machine will not be able to continue to move forward, because if you continue to move forward, due to the previous step of the apply failure, all subsequent applications may fail, which will cause the data of this node and other nodes Data is never consistent. If we put all the modules that work independently in the same raft group, that is, a state machine, for the data processing request processing, the above-mentioned problems will inevitably occur, and a module will be uncontrollable in the apply log. Factors will affect the normal operation of other modules.</p><a name="2GyRw"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="jraft-operation-and-maintenance">JRaft operation and maintenance<a href="#jraft-operation-and-maintenance" class="hash-link" aria-label="Direct link to JRaft operation and maintenance" title="Direct link to JRaft operation and maintenance">​</a></h3><p>In order to allow users to perform simple operation and maintenance of JRaft, such as leader switching, resetting the current Raft cluster members, triggering a node to perform Snapshot operations, etc., a simple HTTP interface is provided for operation, and the interface has certain Limit, that is, only one operation instruction can be executed at a time</p><p>1、Switch the leader node of a certain Raft Group</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /nacos/v1/core/ops/raft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "groupId": "xxx",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "command": "transferLeader"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "value": "ip:{raft_port} or ip:{raft_port},ip:{raft_port},ip:{raft_port}"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="Fs7VE"></a><p>2、Reset a Raft Group cluster member</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /nacos/v1/core/ops/raft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "groupId": "xxx",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "command": "resetRaftCluster",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "value": "ip:{raft_port},ip:{raft_port},ip:{raft_port},ip:{raft_port}"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that this operation is a high-risk operation. This operation and maintenance command can only be used when the n/2 + 1 node of the Raft cluster fails to meet the requirements of more than half of the vote after the crash. It is used to quickly reorganize the remaining nodes to the Raft cluster to provide external Service, but this operation will greatly cause the loss of data<br></p><a name="VfG5T"></a><p>3、Trigger a Raft Group to perform a snapshot operation</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /nacos/v1/core/ops/raft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "groupId": "xxx",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "command": "doSnapshot",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "value": "ip:{raft_port}"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="m9LfI"></a><p>4、Remove a member of a Raft Group</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /nacos/v1/core/ops/raft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "groupId": "xxx",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "command": "removePeer",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "value": "ip:{raft_port}"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="ev3MW"></a><p>5、Remove multiple members of a Raft Group in batches</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /nacos/v1/core/ops/raft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "groupId": "xxx",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "command": "removePeers",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    "value": "ip:{raft_port},ip:{raft_port},ip:{raft_port},..."</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="GzMuP"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="jraft-protocol-related-configuration-parameters">JRaft protocol related configuration parameters<a href="#jraft-protocol-related-configuration-parameters" class="hash-link" aria-label="Direct link to JRaft protocol related configuration parameters" title="Direct link to JRaft protocol related configuration parameters">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">### Sets the Raft cluster election timeout, default value is 5 second</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos.core.protocol.raft.data.election_timeout_ms=5000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### Sets the amount of time the Raft snapshot will execute periodically, default is 30 minute</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos.core.protocol.raft.data.snapshot_interval_secs=30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### Requested retries, default value is 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos.core.protocol.raft.data.request_failoverRetries=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### raft internal worker threads</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos.core.protocol.raft.data.core_thread_num=8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### Number of threads required for raft business request processing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos.core.protocol.raft.data.cli_service_thread_num=4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### raft linear read strategy, defaults to index</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos.core.protocol.raft.data.read_index_type=ReadOnlySafe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### rpc request timeout, default 5 seconds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos.core.protocol.raft.data.rpc_request_timeout_ms=5000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="linear-reading-parameter-analysis">Linear reading parameter analysis<a href="#linear-reading-parameter-analysis" class="hash-link" aria-label="Direct link to Linear reading parameter analysis" title="Direct link to Linear reading parameter analysis">​</a></h4><ol><li><strong>ReadOnlySafe</strong><ol><li>In this linear read mode, every time a Follower makes a read request, it needs to synchronize with the Leader to submit the site information, and the Leader needs to initiate a lightweight RPC request to prove that it is the Leader to more than half of the Follower, which is equivalent to a Follower read, at least 1 + (n/2) + 1 RPC request is required.</li></ol></li><li><strong>ReadOnlyLeaseBased</strong><ol><li>In this linear read mode, each time the Follower makes a read request, the Leader only needs to determine whether its Leader lease has expired. If it does not expire, it can directly reply that the Follower is the Leader, but the mechanism has strict requirements on the machine clock. For clock synchronization, consider using this linear read mode.</li></ol></li></ol><a name="WiLDa"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-embedded-distributed-id">Nacos embedded distributed ID<a href="#nacos-embedded-distributed-id" class="hash-link" aria-label="Direct link to Nacos embedded distributed ID" title="Direct link to Nacos embedded distributed ID">​</a></h2><p>The distributed ID embedded in nacos is Snakeflower, the dataCenterId defaults to 1, and the value of workerId is calculated as follows</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">InetAddress address;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = InetAddress.getLocalHost();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> catch (final UnknownHostException e) </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    throw new IllegalStateException(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        "Cannot get LocalHost InetAddress</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> please check your network</span><span class="token tag" style="color:#00009f">!</span><span class="token plain">");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ipAddressByteArray = address.getAddress();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">workerId = (((ipAddressByteArray</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ipAddressByteArray.length </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> &amp; 0B11)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &lt;&lt; Byte.SIZE) + (ipAddressByteArray</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ipAddressByteArray.length </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &amp; 0xFF));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you need to manually specify dataCenterId and workerId, add command line parameters in application.properties or startup</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">### set the dataCenterID manually</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># nacos.core.snowflake.data-center=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### set the WorkerID manually</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># nacos.core.snowflake.worker-id=</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="ZLp5w"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-embedded-lightweight-derby-based-distributed-relational-storage">Nacos embedded lightweight Derby-based distributed relational storage<a href="#nacos-embedded-lightweight-derby-based-distributed-relational-storage" class="hash-link" aria-label="Direct link to Nacos embedded lightweight Derby-based distributed relational storage" title="Direct link to Nacos embedded lightweight Derby-based distributed relational storage">​</a></h2><a name="1B5KV"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="background">Background<a href="#background" class="hash-link" aria-label="Direct link to Background" title="Direct link to Background">​</a></h3><ol><li>If the number of configuration files is small, the cost of supporting a highly available database cluster in the cluster mode is too large, and it is expected to have a lightweight distributed relational storage to solve</li><li>Some metadata information storage inside nacos, such as user information, namespace information</li><li>Source of ideas:<a href="https://github.com/rqlite/rqlite" target="_blank" rel="noopener noreferrer">https://github.com/rqlite/rqlite</a></li></ol><a name="Du2qc"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="design-ideas">Design ideas<a href="#design-ideas" class="hash-link" aria-label="Direct link to Design ideas" title="Direct link to Design ideas">​</a></h3><a name="NzxHa"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="aims">aims<a href="#aims" class="hash-link" aria-label="Direct link to aims" title="Direct link to aims">​</a></h4><p>The design goal is to expect nacos to have two data storage modes, one is the current way, the data is stored in an external data source (relational database); the second way is the embedded storage data source (Apache Derby). Users can use the command line parameter configuration to freely use these two data storage modes<br><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333972/1591015542106-f14d2579-229f-4bfb-a432-e40854e65d6d.png#align=left&amp;display=inline&amp;height=903&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=903&amp;originWidth=1514&amp;size=237497&amp;status=done&amp;style=none&amp;width=1514" alt="image.png" class="img_ev3q"></p><a name="LqUtU"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="overall">overall<a href="#overall" class="hash-link" aria-label="Direct link to overall" title="Direct link to overall">​</a></h4><p>Save the SQL context involved in a request operation in order. Then synchronize the SQL context involved in this request through the consensus protocol layer, and then each node parses it and executes it again in a database session in sequence.<br><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333972/1587204104465-2270480a-de25-4c84-a11b-6edd2de99e66.png#align=left&amp;display=inline&amp;height=814&amp;margin=%5Bobject%20Object%5D&amp;name=%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6%20%281%29.png&amp;originHeight=814&amp;originWidth=1149&amp;size=130886&amp;status=done&amp;style=none&amp;width=1149" alt="未命名文件 (1).png" class="img_ev3q"></p><a name="yxFYn"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="related-data-bearing-objects">Related data bearing objects<a href="#related-data-bearing-objects" class="hash-link" aria-label="Direct link to Related data bearing objects" title="Direct link to Related data bearing objects">​</a></h4><p>The DML statements of the database are select, insert, update, and delete. According to the nature of SQL statements for data operations, they can be divided into two categories: query and update. The select statement corresponds to data query, and the insert, update, and delete statements correspond to Data modification. At the same time, when performing database operations, in order to avoid SQL injection, PreparedStatement is used, so SQL statements + parameters are required, so two Request objects about database operations can be obtained</p><ol><li>SelectRequest</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class SelectRequest implements Serializable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final long serialVersionUID = 2212052574976898602L;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Query category, because currently using JdbcTemplate, query a single, multiple queries, whether to use RowMapper into an object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private byte queryType;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // sql语句</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // select * from config_info where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String sql;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Object[] args;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String className;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>ModifyRequest</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ModifyRequest implements Serializable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final long serialVersionUID = 4548851816596520564L;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int executeNo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String sql;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Object[] args;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="moKl7"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="configure-publishing">Configure publishing<a href="#configure-publishing" class="hash-link" aria-label="Direct link to Configure publishing" title="Direct link to Configure publishing">​</a></h4><p>The configuration release operation involves three transactions:</p><ol><li>config_info saves configuration information</li><li>config_tags_relation saves the association relationship between configuration and tags</li><li>his_config_info saves a history of configuration operations</li></ol><p>These three transactions are all configured and released under this big transaction. If we say that we perform a Raft protocol submission for each transaction operation, assume that 1, 2 transactions are successfully applied after being submitted through Raft, and the third transaction is in Raft. Apply fails after submission, then for the big transaction released by this configuration, it needs to be rolled back as a whole, otherwise it will violate the atomicity, then it may be necessary to say that the transaction rollback operation is again Raft submitted, then the overall complexity Rise, and directly introduce the management of distributed transactions, so in order to avoid this problem, we integrate the SQL contexts involved in these three transactions into a large SQL context, and submit the Raft protocol to this large SQL context. It ensures that the three sub-transactions successfully solve the atomicity problem in the same database session. At the same time, because the Raft protocol processes the transaction log serially, it is equivalent to adjusting the transaction isolation level of the database to serialization.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public void addConfigInfo(final String srcIp,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            final String srcUser, final ConfigInfo configInfo, final Timestamp time,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            final Map&lt;String, Object&gt; configAdvanceInfo, final boolean notify) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        final String tenantTmp = StringUtils.isBlank(configInfo.getTenant()) ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    StringUtils.EMPTY :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    configInfo.getTenant();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        configInfo.setTenant(tenantTmp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Obtain the database primary key through the snowflake ID algorithm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        long configId = idGeneratorManager.nextId(RESOURCE_CONFIG_INFO_ID);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        long hisId = idGeneratorManager.nextId(RESOURCE_CONFIG_HISTORY_ID);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addConfigInfoAtomic(configId, srcIp, srcUser, configInfo, time,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    configAdvanceInfo);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String configTags = configAdvanceInfo == null ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    null :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    (String) configAdvanceInfo.get("config_tags");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addConfigTagsRelation(configId, configTags, configInfo.getDataId(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    configInfo.getGroup(), configInfo.getTenant());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        insertConfigHistoryAtomic(hisId, configInfo, srcIp, srcUser, time, "I");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        EmbeddedStorageContextUtils.onModifyConfigInfo(configInfo, srcIp, time);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        databaseOperate.blockUpdate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        EmbeddedStorageContextUtils.cleanAllContext();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public long addConfigInfoAtomic(final long id, final String srcIp,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            final String srcUser, final ConfigInfo configInfo, final Timestamp time,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;String, Object&gt; configAdvanceInfo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 参数处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final String sql =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                "INSERT INTO config_info(id, data_id, group_id, tenant_id, app_name, content, md5, src_ip, src_user, gmt_create,"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        + "gmt_modified, c_desc, c_use, effect, type, c_schema) VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final Object[] args = new Object[] { id, configInfo.getDataId(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                configInfo.getGroup(), tenantTmp, appNameTmp, configInfo.getContent(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                md5Tmp, srcIp, srcUser, time, time, desc, use, effect, type, schema, };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SqlContextUtils.addSqlContext(sql, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void addConfigTagRelationAtomic(long configId, String tagName, String dataId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String group, String tenant) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final String sql =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                "INSERT INTO config_tags_relation(id,tag_name,tag_type,data_id,group_id,tenant_id) "</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        + "VALUES(?,?,?,?,?,?)";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final Object[] args = new Object[] { configId, tagName, null, dataId, group,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                tenant };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SqlContextUtils.addSqlContext(sql, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void insertConfigHistoryAtomic(long configHistoryId, ConfigInfo configInfo,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String srcIp, String srcUser, final Timestamp time, String ops) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 参数处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final String sql =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                "INSERT INTO his_config_info (id,data_id,group_id,tenant_id,app_name,content,md5,"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        + "src_ip,src_user,gmt_modified,op_type) VALUES(?,?,?,?,?,?,?,?,?,?,?)";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final Object[] args = new Object[] { configHistoryId, configInfo.getDataId(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                configInfo.getGroup(), tenantTmp, appNameTmp, configInfo.getContent(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                md5Tmp, srcIp, srcUser, time, ops };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SqlContextUtils.addSqlContext(sql, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Temporarily saves all insert, update, and delete statements under</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * a transaction in the order in which they occur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author &lt;a href="mailto:liaochuntao@live.com"&gt;liaochuntao&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SqlContextUtils {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final ThreadLocal&lt;ArrayList&lt;ModifyRequest&gt;&gt; SQL_CONTEXT =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ThreadLocal.withInitial(ArrayList::new);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void addSqlContext(String sql, Object... args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ArrayList&lt;ModifyRequest&gt; requests = SQL_CONTEXT.get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ModifyRequest context = new ModifyRequest();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        context.setExecuteNo(requests.size());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        context.setSql(sql);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        context.setArgs(args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        requests.add(context);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SQL_CONTEXT.set(requests);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static List&lt;ModifyRequest&gt; getCurrentSqlContext() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return SQL_CONTEXT.get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void cleanCurrentSqlContext() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SQL_CONTEXT.remove();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A more intuitive understanding through a timing diagram
<img loading="lazy" src="https://cdn.nlark.com/yuque/__puml/618e8997395fbc74433ac4a60f67b6b4.svg#lake_card_v2=eyJjb2RlIjoiQHN0YXJ0dW1sXG5cbmF1dG9udW1iZXJcblxuYWN0b3IgXCJVc2VyXCIgYXMgVXNlclxuXG5wYXJ0aWNpcGFudCBcIkNvbmZpZ1NlcnZpY2VcIiBhcyBTZXJ2aWNlXG5wYXJ0aWNpcGFudCBcIlBlcnNpc3RlbmNlU2VydmljZVwiIGFzIFJlcG9zaXRvcnlcbnBhcnRpY2lwYW50IFwiRGVyYnlcIiBhcyBEQlxucGFydGljaXBhbnQgXCJTUUxDb250ZXh0VXRpbHNcIiBhcyBTUUxDb250ZXh0XG5wYXJ0aWNpcGFudCBcIkxvZ1Byb2Nlc3NvclwiIGFzIFByb2Nlc3NvclxucGFydGljaXBhbnQgXCJDb25zaXN0ZW5jeVByb3RvY29sXCIgYXMgUHJvdG9jb2xcbnBhcnRpY2lwYW50IFwiTG9nXCIgYXMgTG9nXG5cbmFjdGl2YXRlIFVzZXJcblxuVXNlciAtPiBTZXJ2aWNlOiDlj5HotbfphY3nva7lj5HluIPor7fmsYJcbmFjdGl2YXRlIFNlcnZpY2VcblxuU2VydmljZSAtPiBSZXBvc2l0b3J5OiDphY3nva7lj5HluINcbmFjdGl2YXRlIFJlcG9zaXRvcnlcblxuUmVwb3NpdG9yeSAtPiBTUUxDb250ZXh0OiDmi6bmiKrlvZPliY1TUUzkuIrkuIvmlodcbmFjdGl2YXRlIFNRTENvbnRleHRcblxuUmVwb3NpdG9yeSAtPiBSZXBvc2l0b3J5OiBjb21taXQg5pON5L2cXG5cblNRTENvbnRleHQgLT4gUmVwb3NpdG9yeTog5b2T5YmN6K-35rGC5raJ5Y-K55qE5omA5pyJU1FM5LiK5LiL5paHXG5cbmRlYWN0aXZhdGUgU1FMQ29udGV4dFxuXG5SZXBvc2l0b3J5IC0-IExvZzog5p6E5bu66K-35rGC5L2TXG5cbmFjdGl2YXRlIExvZ1xuZGVhY3RpdmF0ZSBMb2dcblxuUmVwb3NpdG9yeSAtPiBQcm90b2NvbDogc3VibWl0KCkg6L-b6KGM6K-35rGC5o-Q5LqkXG5hY3RpdmF0ZSBQcm90b2NvbFxuZGVhY3RpdmF0ZSBSZXBvc2l0b3J5XG5cblByb3RvY29sIC0-IFByb2Nlc3Nvcjogb25BcHBseSgpIOaWueazle-8jOeKtuaAgeacuuWkjeWItkxvZ1xuYWN0aXZhdGUgUHJvY2Vzc29yXG5cblByb2Nlc3NvciAtPiBSZXBvc2l0b3J5OiDmiafooYzmiYDmnInnmoRTUUzkuIrkuIvmlodcbmFjdGl2YXRlIFJlcG9zaXRvcnlcblxuUmVwb3NpdG9yeSAtPiBEQjog5pWw5o2u6JC95bqTXG5hY3RpdmF0ZSBEQlxuXG5EQiAtPiBSZXBvc2l0b3J5OiDnu5PmnZ_lubbov5Tlm57nu5PmnpxcbmRlYWN0aXZhdGUgREJcblxuUmVwb3NpdG9yeSAtPiBQcm9jZXNzb3I6IOi_lOWbnkxvZ0Z1dHVyZeW5tuiuvue9ruacrOasoeaJp-ihjOeahOe7k-aenFxuZGVhY3RpdmF0ZSBSZXBvc2l0b3J5XG5cblByb2Nlc3NvciAtPiBQcm90b2NvbDog6L-U5ZueTG9nRnV0dXJlXG5kZWFjdGl2YXRlIFByb2Nlc3NvclxuXG5Qcm90b2NvbCAtPiBTZXJ2aWNlOiDmnKzmrKHor7fmsYLnmoTnu5PmnpxcbmRlYWN0aXZhdGUgUHJvdG9jb2xcblxuU2VydmljZSAtPiBVc2VyXG5kZWFjdGl2YXRlIFNlcnZpY2VcbmRlYWN0aXZhdGUgVXNlclxuXG5AZW5kdW1sIiwidHlwZSI6InB1bWwiLCJtYXJnaW4iOnRydWUsImlkIjoiVnQxNzciLCJ1cmwiOiJodHRwczovL2Nkbi5ubGFyay5jb20veXVxdWUvX19wdW1sLzYxOGU4OTk3Mzk1ZmJjNzQ0MzNhYzRhNjBmNjdiNmI0LnN2ZyIsImNhcmQiOiJkaWFncmFtIn0=" class="img_ev3q"></p><a name="AAJTE"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-use-new-features">How to use new features<a href="#how-to-use-new-features" class="hash-link" aria-label="Direct link to How to use new features" title="Direct link to How to use new features">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./startup.sh -p embedded</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Whether to enable the embedded distributed relational storage activity diagram
<img loading="lazy" src="https://cdn.nlark.com/yuque/__puml/1fd656ba3b39fe5de8fea78efdf98dd1.svg#lake_card_v2=eyJjb2RlIjoiQHN0YXJ0dW1sXG5cbigqKSAtLT4gXCJDb25maWcuc3RhcnQoKVwiXG5cbmlmIFwi5Y2V5py65qih5byPXCIgdGhlblxuICAtcmlnaHQtPlt0cnVlXSBcInJldHVybiDpu5jorqTljZXmnLrlrZjlgqjooYzkuLpcIlxuICAtLT4gKCopXG5lbHNlXG4gaWYgXCLlt7LphY3nva7lpJbnva7lrZjlgqhcIiB0aGVuXG4gICAgLS0-W3RydWVdIFwicmV0dXJuIOWklue9ruaVsOaNruWtmOWCqOihjOS4ulwiXG4gICAgLS0-ICgqKVxuIGVsc2VcbiAgICBpZiBcIuW8gOWQr-WGheW1jOWtmOWCqFwiIHRoZW5cbiAgICAgICAgLS0-W3RydWVdIFwicmV0dXJuIOi9u-mHj-WGheW1jOWIhuW4g-W8j-WtmOWCqOihjOS4ulwiXG4gICAgICAgIC0tPiAoKilcbiAgICBlbHNlXG4gICAgICAgIC0-W2ZhbHNlXSBcInJldHVybiDpu5jorqTlpJbnva7mlbDmja7lrZjlgqjooYzkuLpcIlxuICAgICAgICAtLT4gKCopXG5cdFx0ZW5kaWZcbiBlbmRpZlxuZW5kaWZcblxuQGVuZHVtbCIsInR5cGUiOiJwdW1sIiwibWFyZ2luIjp0cnVlLCJpZCI6IkNNN1VDIiwidXJsIjoiaHR0cHM6Ly9jZG4ubmxhcmsuY29tL3l1cXVlL19fcHVtbC8xZmQ2NTZiYTNiMzlmZTVkZThmZWE3OGVmZGY5OGRkMS5zdmciLCJjYXJkIjoiZGlhZ3JhbSJ9" class="img_ev3q"></p><a name="9UAXN"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="new-features-related-operation-and-maintenance-operations">New features related operation and maintenance operations<a href="#new-features-related-operation-and-maintenance-operations" class="hash-link" aria-label="Direct link to New features related operation and maintenance operations" title="Direct link to New features related operation and maintenance operations">​</a></h3><p>Directly query the data stored in each node's derby</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /nacos/v1/cs/ops/derby?sql=select * from config_info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return List&lt;Map&lt;String, Object&gt;&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="YcqO2"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="insufficient">insufficient<a href="#insufficient" class="hash-link" aria-label="Direct link to insufficient" title="Direct link to insufficient">​</a></h3><ol><li>Build a distributed data operation synchronization layer on the upper layer of the database, there are restrictions on the operation of the database, such as the first insert operation, then the select operation, and finally the update operation, which is interspersed with query statements in the data modification statement The order of operations is not supported</li><li>Limiting the performance of the database, due to the indirect adjustment of the database transaction isolation level to serialization, the concurrency ability is artificially reduced</li></ol><a name="7dul8"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="future-evolution">Future evolution<a href="#future-evolution" class="hash-link" aria-label="Direct link to Future evolution" title="Direct link to Future evolution">​</a></h3><p>Apache Derby official will try to realize the synchronous replication operation of BingLog based on Raft, and realize the database synchronization capability from the bottom</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Namespace,endpoint 最佳实践]]></title>
            <link>https://nacos.io/en/blog/namespace-endpoint-best-practices</link>
            <guid>https://nacos.io/en/blog/namespace-endpoint-best-practices</guid>
            <pubDate>Fri, 06 Dec 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[随着使用 Nacos 的企业越来越多，遇到的最频繁的两个问题就是：如何在我的生产环境正确的来使用 namespace 以及 endpoint。]]></description>
            <content:encoded><![CDATA[<p>随着使用 Nacos 的企业越来越多，遇到的最频繁的两个问题就是：如何在我的生产环境正确的来使用 namespace 以及 endpoint。这篇文章主要就是针对这两个问题来聊聊使用 nacos 过程中关于这两个参数配置的最佳实践方式。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="namespce">namespce<a href="#namespce" class="hash-link" aria-label="Direct link to namespce" title="Direct link to namespce">​</a></h2><p>关于 namespace ，以下主要从 <strong>namespace 的设计背景</strong> 和 <strong>namespace 的最佳实践</strong> 两个方面来讨论。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="namespace-的设计背景">namespace 的设计背景<a href="#namespace-的设计背景" class="hash-link" aria-label="Direct link to namespace 的设计背景" title="Direct link to namespace 的设计背景">​</a></h3><p>namespace 的设计是 nacos 基于此做多环境以及多租户数据(<strong>配置和服务</strong>)隔离的。即：</p><ul><li>从一个租户(用户)的角度来看，如果有多套不同的环境，那么这个时候可以根据指定的环境来创建不同的 namespce，以此来实现多环境的隔离。例如，你可能有日常，预发和生产三个不同的环境，那么使用一套 nacos 集群可以分别建以下三个不同的 namespace。如下图所示：</li></ul><p><img loading="lazy" src="http://edas.oss-cn-hangzhou.aliyuncs.com/deshao/pictures/nacos_ingle_tenant_namespace.jpg" class="img_ev3q"></p><ul><li>从多个租户(用户)的角度来看，每个租户(用户)可能会有自己的 namespace,每个租户(用户)的配置数据以及注册的服务数据都会归属到自己的 namespace 下，以此来实现多租户间的数据隔离。例如超级管理员分配了三个租户，分别为张三、李四和王五。分配好了之后，各租户用自己的账户名和密码登录后，创建自己的命名空间。如下图所示：</li></ul><p><img loading="lazy" src="http://edas.oss-cn-hangzhou.aliyuncs.com/deshao/pictures/nacos_multi_tenant_namespace.jpg" class="img_ev3q"></p><p>  <strong>注意:</strong> 该功能还在规划中。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="namespace-的最佳实践">namespace 的最佳实践<a href="#namespace-的最佳实践" class="hash-link" aria-label="Direct link to namespace 的最佳实践" title="Direct link to namespace 的最佳实践">​</a></h3><p>关于 namespace 的最佳实践，这部分主要包含有两个 Action：</p><ul><li>如何来获取 namespace 的值</li><li>namespace 参数初始化方式</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="如何来获取-namespace-的值">如何来获取 namespace 的值<a href="#如何来获取-namespace-的值" class="hash-link" aria-label="Direct link to 如何来获取 namespace 的值" title="Direct link to 如何来获取 namespace 的值">​</a></h3><p>无论您是基于 Spring Cloud 或者 Dubbo 来使用 nacos，都会涉及到 namespace 的参数输入，那么这个时候 namespace 的值从哪里可以获取呢？</p><ol><li><p>如果您在使用过程中没有感知到这个参数的输入，那么 nacos 统一会使用一个默认的 namespace 作为输入，nacos naming 会使用 <strong>public</strong> 作为默认的参数来初始化，nacos config 会使用一个<strong>空字符串</strong>作为默认的参数来初始化。</p></li><li><p>如果您需要自定义自己的 namespace，那么这个值该怎么来产生？</p><p>可以在 nacos 的控制台左边功能侧看到有一个 <strong>命名空间</strong> 的功能，点击就可以看到 <strong>新建命名空间</strong> 的按钮，那么这个时候就可以创建自己的命名空间了。创建成功之后，会生成一个<strong>命名空间ID</strong>，主要是用来避免<strong>命名空间名称</strong>有可能会出现重名的情况。因此当您在应用中需要配置指定的 namespace 时，<strong>填入的是命名空间ID</strong>。重要的事情说三遍：</p><ol><li>当您在应用中需要配置指定的 namespace 时，<strong>填入的是命名空间 ID</strong></li><li>当您在应用中需要配置指定的 namespace 时，<strong>填入的是命名空间 ID</strong></li><li>当您在应用中需要配置指定的 namespace 时，<strong>填入的是命名空间 ID</strong></li></ol></li></ol><p>说明: namesace 为 <strong>public</strong> 是 nacos 的一个保留控件，如果您需要创建自己的 namespace，最好不要和 <strong>public</strong> 重名，以一个实际业务场景有具体语义的名字来命名，以免带来字面上不容易区分自己是哪一个 namespace。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="namespace-参数初始化方式">namespace 参数初始化方式<a href="#namespace-参数初始化方式" class="hash-link" aria-label="Direct link to namespace 参数初始化方式" title="Direct link to namespace 参数初始化方式">​</a></h3><p>nacos client 对 namespace 的初始化流程如下图所示:</p><p><img loading="lazy" src="http://edas.oss-cn-hangzhou.aliyuncs.com/deshao/nacos/nacos_namespace.jpg" class="img_ev3q"></p><p>nacos client 对 namespace 的初始化，主要包含两部分：</p><ul><li><p>用户态通过 nacos client 构造实例时通过 properties 参数传入的 namespace。</p></li><li><p>在云环境下(<strong>阿里云下的 EDAS</strong>)的 namespace 参数解析。</p><p>可通过 <strong>-Dnacos.use.cloud.namespace.parsing=true/false</strong> 来控制是否需要在云环境自动解析 namespace 参数，默认为 <strong>true</strong>，是会自动解析，其目的就是方便用户上云时可以以零成本的方式平滑上云。如果用户在云上需要用自建的 nacos 下的 namespace，那这个时候只需将 <strong>-Dnacos.use.cloud.namespace.parsing=false</strong> 即可。</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="endpoint">endpoint<a href="#endpoint" class="hash-link" aria-label="Direct link to endpoint" title="Direct link to endpoint">​</a></h2><p>关于 endpoint ，也主要从 <strong>endpoint 的设计背景</strong> 和 <strong>endpoint 的参数初始化</strong> 两个方面来讨论。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="endpoint-的设计背景">endpoint 的设计背景<a href="#endpoint-的设计背景" class="hash-link" aria-label="Direct link to endpoint 的设计背景" title="Direct link to endpoint 的设计背景">​</a></h3><p>当 nacos server 集群需要扩缩容时，客户端需要有一种能力能够及时感知到集群发生变化。及时感知到集群的变化是通过 endpoint 来实现的。也即客户端会定时的向 endpoint 发送请求来更新客户端内存中的集群列表。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="endpoint-的参数初始化">endpoint 的参数初始化<a href="#endpoint-的参数初始化" class="hash-link" aria-label="Direct link to endpoint 的参数初始化" title="Direct link to endpoint 的参数初始化">​</a></h3><p>Nacos Client 提供一种可以对传入的 endpoint 参数规则解析的能力。即当通过构造函数的 <strong>properties</strong> 来初始化 endpoint 时，指定的 endpoint 值可以是一个具体的值，也可以是一个占位符的形式，如下所示: </p><blockquote><p><strong>\${endpoint.options:defaultValue}</strong>。</p></blockquote><p>说明：</p><ol><li><strong>endpoint.options</strong> 是一个具体的变量。支持从系统属性，系统环境变量中读取。</li><li><strong>defaultValue</strong> 是给出的一个默认值。当从具体的变量中没有被正确初始化时，会使用给出的默认值来初始化。</li></ol><p>整个 endpoint 的解析规则比较复杂，整体的一个解析流程图如下所示:</p><p><img loading="lazy" src="http://edas.oss-cn-hangzhou.aliyuncs.com/deshao/nacos/nacos_endpoint.jpg" class="img_ev3q">	</p><p><strong>注意：</strong> 蓝色特别区分的是支持云环境下(阿里云上的 EDAS)自动从系统环境变量中来读取 endpoint 值，以此来达到用户本地开发或者将应用往云上迁移的时候以零成本的改造方式实现平滑上云。</p><p>说明：</p><ul><li><p>开启 endpoint 参数规则解析</p><ol><li><p>如果在初始化 Nacos Client 的时候，没有通过 properties 来指定 endpoint，这个时候会从系统环境变量中变量名为 <strong>ALIBABA<!-- -->_<!-- -->ALIWARE<!-- -->_<!-- -->ENDPOINT<!-- -->_<!-- -->URL</strong> 指定的值来初始化，如果系统环境变量也没有设置，那么这个时候将会返回一个空字符串。</p></li><li><p>如果设置了 endpoint，</p></li><li><p>设置的 endpoint 是一个指定具体的值。</p><p>这时会先从系统环境变量中变量名为 <strong>ALIBABA<!-- -->_<!-- -->ALIWARE<!-- -->_<!-- -->ENDPOINT<!-- -->_<!-- -->URL</strong> 指定的值来初始化，如果系统环境变量没有设置，那么这个时候用用户态传入的具体值来初始化 endpoint。</p></li><li><p>以占位符的形式输入。</p><p>这时会解析出具体占位符的值，然后:</p><ol><li><p>依次从系统属性和环境变量中来取值。</p><p> 例如，您输入的是 <strong>${nacos.endpoint:defaultValue}</strong>，那么解析出来的占位符是 <strong>nacos.endpoint</strong>。解析出来后，会先读取系统属性中(<strong>即 System.getProperty("nacos.endpoint")</strong>)是否设置了 <strong>nacos.endpoint</strong> 变量值，如果没有，则会从系统环境变量中变量名为 <strong>nacos.endpoint</strong> 指定的值来初始化。</p></li><li><p>如果通过解析出来的占位符还没有正确初始化 endpoint，则会从系统环境变量中变量名为 <strong>ALIBABA<!-- -->_<!-- -->ALIWARE<!-- -->_<!-- -->ENDPOINT<!-- -->_<!-- -->URL</strong> 指定的值来初始化。</p></li><li><p>如果经过以上两步还没有被初始化，这时如果您设置了默认值，这个时候就会使用默认值来初始化 endpoint，否则的话以解析出来的占位符返回。	</p></li></ol></li></ol></li><li><p>关闭 endpoint 参数规则解析</p><p>当关闭了 endpoint 参数规则解析的时候，这个时候就以用户态在构造 Nacos Client 时通过 properties 参数输入的 endpoint 值为主。</p></li></ul><p>默认情况下， Nacos Client 是开启 endpoint 参数规则解析的能力。如果你想关闭该能力，有两种方式可以帮您来实现。</p><ol><li>可在 Nacos Client 初始化的时候在传入的 properties 实例中指定 key 为 <strong>isUseEndpointParsingRule</strong>，值为 <strong>false</strong> 即可关闭。</li><li>如果您的应用是 Java 程序的应用，也可以通过 <strong>-Dnacos.use.endpoint.parsing.rule=false</strong> 来关闭。 </li></ol><p><strong>注意</strong>：其中第一种方式的优先级高于第二种方式。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Pilot MCP协议介绍]]></title>
            <link>https://nacos.io/en/blog/pilot mcp</link>
            <guid>https://nacos.io/en/blog/pilot mcp</guid>
            <pubDate>Wed, 20 Nov 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[Istio是目前主流的Service Mesh组件。Istio基于Service Mesh的理念，承担着服务发现、服务通信、负载均衡、限流熔断、监控等等功能]]></description>
            <content:encoded><![CDATA[<a name="VRC6c"></a># 背景介绍 Istio是目前主流的Service Mesh组件。Istio基于Service Mesh的理念，承担着服务发现、服务通信、负载均衡、限流熔断、监控等等功能。让应用不用关心这些底层逻辑，专注于业务的开发和访问即可。软件行业的趋势一定是让业务的开发越来越轻松和简便，所以从这个角度看以Istio为代表的Service Mesh一定会越来越流行。至于目前存在的一些包括性能和设计复杂的问题，一定可以通过技术手段解决。<a name="hKDrO"></a># 总体架构<p>MCP协议推出的背后，是Pilot意图重构以解决之前架构带来的代码维护、测试、扩展及稳定性等多方面的问题。在之前的架构中，Pilot内嵌了与K8S的交互逻辑以及其他扩展的注册中心和配置中心的逻辑。这样导致Pilot内部逻辑比较复杂、承担职责不够清晰。同时与各个组件的交互协议也不统一，导致Pilot难以维护这些代码，对于后面的扩展组件接入，也望而却步。在Pilot的重构设计文档中，对于Pilot目前存在的问题是这么总结的<!-- -->[1]<!-- -->：<br>“</p><ul><li>Pilot is more difficult to test than is necessary. It requires a dependency on K8S Apiserver in order to write more complex unit or simple integration tests.</li><li>We have smeared logic for dealing with the vagaries of K8S CRDs across Pilot, Mixer &amp; Citadel. Common concerns like K8S integration, resource validation and API versioning do not share a common implementation. The proposal to resurrect <strong>Galley </strong>is primarily motivated by an obvious need to improve our user-facing API experience.</li><li>Consuming the K8S API client in Pilot is a source of bloat and represents a production risk. Moving that risk to Galley while isolating the network control plane from it should be a performance and stability win.</li><li>The contract between Pilot, Kubernetes and other platforms is under-specified. We implicitly consume the totality of the K8S API surface even if we don’t need it.</li><li>Writing extensions to Pilot requires developers to consume our build process and this has proven to be a barrier to adoption for partners. This is analogous to the recent architectural shift in Mixer to use out-of-process adapters for the same reasons.</li></ul><p>”<br></p><br>Istio在Pilot重构设计文档中，展示了基于MCP协议的内部组件架构。在这个架构中，Pilot与Envoy还是使用Envoy定义的ADS协议，Pilot与Galley、外部的注册中心、配置中心以及其他的Pilot之间，都是通过MCP协议进行通讯：<br><br>![image.png](https://cdn.nlark.com/yuque/0/2019/png/333810/1574243165093-102c6f18-c565-4e0f-a2dc-a374ccc412d4.png#align=left&amp;display=inline&amp;height=383&amp;name=image.png&amp;originHeight=766&amp;originWidth=1256&amp;search=&amp;size=414042&amp;status=done&amp;width=628)<p>这样的设计比较好的定义了Pilot的职责，就是整个Service Mesh的控制面，但是不感知任何Istio以外的组件，即使是K8S也是如此。所有与外部组件包括注册中心和配置中心的交互逻辑，都移到了Pilot进程以外，通过运行特定的MCP Server来与Pilot进行通讯。Galley的职责，我认为是Pilot中默认的配置来源的MCP Server，目前是实现了与K8S数据的对接。这个文档中还定义了Pilot与Pilot之间的数据访问也是通过MCA（基于MCP协议定义的API），但是文档里没有提供更多的细节，会不会是Pilot未来会支持数据的分片以提高Pilot整体的数据容量？</p><a name="GiDba"></a># 协议定义 看完了Pilot的整体演进架构，我们来看一下MCP协议的设计[2]，MCP协议在设计上参考了与Envoy的交互协议xDS。<br>![image.png](https://cdn.nlark.com/yuque/0/2019/png/333810/1574243165174-59e66666-d992-440d-b066-89d1825abc38.png#align=left&amp;display=inline&amp;height=424&amp;name=image.png&amp;originHeight=594&amp;originWidth=944&amp;search=&amp;size=67856&amp;status=done&amp;width=674)<p>在MCP协议中，定义了两个身份：Sink和Source。Sink指代的是数据的接收端，Source指代的是数据的发送端即数据源。MCP协议基于gRPC双向流协议进行定义，Sink端和Source端都可以随时往对端发送数据，相互不会阻塞。从上图的协议交互也可以看出，Sink端可以主动发送RequestResources请求来向Source端要求数据，同时Source端也可以主动将Resources数据发送给Sink端。Sink端在收到数据后会返回一个ACK确认。在RequestResources请求和ACK响应中，主要有两个字段：</p><ul><li>collection：表示此次请求需要的数据类型，目前Istio定义了17种类型（测试得出，实际数据以Istio官方说法为准），其中包含了serviceentries作为服务发现的数据等。</li><li>nonce：类似于请求的ID，用来与响应或者请求进行匹配。</li></ul><p>而在返回的数据中，还有一个字段就是resources字段，里面包含真正的数据，具体的数据格式和collection的类型有关。</p><p>同时MCP协议还定义了增量推送的能力，如下图所示。可以在RequestResouces请求中增加incremental=true字段，这样Sink在收到数据后，会根据增量的形式进行数据的更新。协议的文档中还指出，必须在RequestResouces请求中包含incremental=true的情况下，才能返回给Sink增量的数据，否则Sink端对于该数据的处理将是未知的。目前社区的Pilot还没有支持增量的MCP数据推送，从下一节的源码分析中可以看到，Pilot对于每一个Source（Pilot可以配置多个Source，每个Source之间的数据是隔离的）发送的数据，都是整体替换更新的。目前社区的一个进展是正在进行serviceentries类型数据的增量更新的支持，而且是endpoints粒度的增量更新<!-- -->[3]<!-- -->。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1574243165196-05ba5a17-e84b-44cc-89e8-9e7ee00c9fa4.png#align=left&amp;display=inline&amp;height=403&amp;name=image.png&amp;originHeight=594&amp;originWidth=1068&amp;search=&amp;size=75600&amp;status=done&amp;width=724" alt="image.png" class="img_ev3q"></p><a name="C3kOS"></a># Pilot Sink端启动流程<p>Pilot在启动的时候，会根据ConfigMap里的配置，进行MCP Server的初始化。主要的逻辑可以参考下图：</p><a name="rETVj"></a># ![istio mcp.png](https://cdn.nlark.com/yuque/0/2019/png/333810/1574243165184-426a4245-ef40-4c44-9bbe-d36326e3151a.png#align=left&amp;display=inline&amp;height=1151&amp;name=istio%20mcp.png&amp;originHeight=1151&amp;originWidth=951&amp;search=&amp;size=94058&amp;status=done&amp;width=951) Pilot启动时，会调用server.NewServer来新建Pilot Server。在此过程中，会去读取ConfigSource配置里面的address。由于可能会配置多个address，那么Pilot在这里会循环去创建多个Sink客户端①，每一个Sink客户端拥有独立的数据。在这里有一点要注意的是，这个循环中会尝试与每个MCP Server建立gRPC连接，而如果其中一个MCP Server连接不上的话，整个循环就会推出，并返回error。也就是说如果Pilot在启动过程中无法连上每一个MCP Server，那么Pilot就会处于不健康状态，而在运行时没有这个限制②。当Sink客户端都新建完以后，就会再次循环异步调用每个Sink客户端的run方法，进行数据的收发了。<p>Sink端的run方法主要是调用EstablishResouceStream方法来建立双向流连接。在连接建立后，会调用creatIntialRquests请求来创建一次初始请求③，也就是说Pilot不会在启动时阻塞的去从每个MCP Server拉取数据，更新完后再提供服务，而是异步的进行数据的请求。事实上，Pilot也只会主动发这一次数据的请求④，接下来的数据更新都依赖于MCP Server的主动推送。在收到数据后，则进行handleResponse方法进行数据的更新⑤。</p><a name="dWz8x"></a># Pilot Sink端处理流程<p>下面介绍的是Pilot的Sink端在接收到数据的处理逻辑。从下图中可以看出，在接收到数据后，会先判断是否返回了错误，如果返回错误则直接结束数据的更新。如果没有错误，则进入Apply(change)方法。在这个方法中，会先新建一个innerStore的Map来保存更新到的数据。然后会将原来的configStore里对应collection类型的数据直接由这个innerStore进行替换。因此可以看出Pilot目前还不支持增量的MCP数据推送。在更新完数据后，则调用serviceEntryEvents或者ClearDiscoveryServerCache来通知Envoy等组件进行数据的更新。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1574243165176-751ae4ee-eaab-4395-a4d1-4c2531b66d4c.png#align=left&amp;display=inline&amp;height=638&amp;name=istio%20mcp2.png&amp;originHeight=771&amp;originWidth=618&amp;search=&amp;size=52868&amp;status=done&amp;width=511" alt="istio mcp2.png" class="img_ev3q"></p><a name="s5oWA"></a># 总结与展望 目前Source端可以参考的代码有Galley，以及Nacos开发的独立MCP Server，用于进行MCP功能的测试和压测[4]，以及和Nacos Server一起部署的Java版本的MCP Server[5]。本文不做详细介绍，有兴趣的同学可以自行阅读相关源代码。<p>整体来看目前Pilot MCP协议还处于快速的更新和迭代阶段，未来可能还会有很多的变化。但是Istio基于MCP协议进行重构的大方向应该是不会跑了。Nacos团队目前也在密切关注着Istio及其他云原生组件的发展方向，同时将会陆续发布相关的功能，敬请期待。</p><p>[1]<!-- --> Pilot重构设计文档 <a href="https://docs.google.com/document/d/1S5ygkxR1alNI8cWGG4O4iV8zp8dA6Oc23zQCvFxr83U/edit#" target="_blank" rel="noopener noreferrer">https://docs.google.com/document/d/1S5ygkxR1alNI8cWGG4O4iV8zp8dA6Oc23zQCvFxr83U/edit#</a><br>[2]<!-- --> MCP协议介绍 <a href="https://github.com/istio/api/tree/master/mcp" target="_blank" rel="noopener noreferrer">https://github.com/istio/api/tree/master/mcp</a><br>[3]<!-- --> Pilot serviceentries增量推送的PR <a href="https://github.com/istio/istio/pull/12276" target="_blank" rel="noopener noreferrer">https://github.com/istio/istio/pull/12276</a><br>[4]<!-- --> Nacos提供的独立的MCP Server，Go语言开发 <a href="https://github.com/nacos-group/nacos-istio" target="_blank" rel="noopener noreferrer">https://github.com/nacos-group/nacos-istio</a><br>[5]<!-- --> Nacos对接Istio的issue，以及相关的commits <a href="https://github.com/alibaba/nacos/issues/1409" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos/issues/1409</a></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos 1.1.4发布，业界率先支持Istio MCP协议]]></title>
            <link>https://nacos.io/en/blog/nacos 1.1.4</link>
            <guid>https://nacos.io/en/blog/nacos 1.1.4</guid>
            <pubDate>Thu, 24 Oct 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos是阿里巴巴开源的服务发现与配置管理项目，本次发布的1.1.4版本，主要带来的是与Istio的对接功能，使用的是Istio最新的MCP协议。]]></description>
            <content:encoded><![CDATA[<p>Nacos是阿里巴巴开源的服务发现与配置管理项目，本次发布的1.1.4版本，主要带来的是与Istio的对接功能，使用的是Istio最新的MCP协议。本文将介绍包括这个功能在内的新版本发布的功能。</p><a name="GdnN0"></a>## 升级指南<a name="SXacG"></a>#### 服务端 0.8.0及以上版本：<ol><li>解压安装包后替换{nacos.home}/target/nacos-server.jar</li><li>逐台重启Nacos Server即可</li></ol><p>0.8.0以下版本，先升级到1.0.0版本。</p><a name="CNPhB"></a>#### 客户端 替换pom依赖即可。<a name="07ZzZ"></a>## 支持Istio MCP协议 这是本次版本最大的更新，主要是实现了Nacos服务数据往Istio下发的功能，也是目前业界所有注册中心里面第一个由官方提供的MCP协议对接版本。Pilot最新的设计中，是使用MCP协议来与所有后端的数据源进行交互的。这样做的好处是可以解耦所有扩展组件的代码，Pilot保持轻量的逻辑，在代码质量、组件稳定性及扩展性方面都大幅提升。我们可以看一下Pilot官方提供的Pilot设计图（地址：[https://docs.google.com/document/d/1S5ygkxR1alNI8cWGG4O4iV8zp8dA6Oc23zQCvFxr83U/edit#heading=h.k34grc1as8vr](https://docs.google.com/document/d/1S5ygkxR1alNI8cWGG4O4iV8zp8dA6Oc23zQCvFxr83U/edit#heading=h.k34grc1as8vr)）：<br>![image.png](https://cdn.nlark.com/yuque/0/2019/png/333810/1572940023007-e19f92da-a5a1-41f0-b37e-db8a678ad57f.png#align=left&amp;display=inline&amp;height=455&amp;name=image.png&amp;originHeight=659&amp;originWidth=1080&amp;search=&amp;size=360963&amp;status=done&amp;width=746)<br>图1 Pilot的最新设计概念图<p>虽然在设计图中，Pilot后端的MCP Server已经有了Consul、Eureka等，但是这些项目目前都没有官方支持的MCP Server。Nacos是目前首个官方支持Istio MCP协议的项目。</p><p>关于MCP协议的设计，可以参考Istio的<a href="https://github.com/istio/api/tree/master/mcp" target="_blank" rel="noopener noreferrer">文档</a>。Nacos实现的MCP Server，目前使用的是单个服务编号，全量服务推送的模式，因为目前Pilot还不支持增量的服务数据推送（Nacos 1.1.4发布之后，Pilot已经支持了endpoint级别的增量推送，Nacos也会在下个版本支持）。实现的逻辑就是启动一个gRPC Server来进行MCP数据的传输，代码可以参考：<a href="https://github.com/alibaba/nacos/tree/develop/istio" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos/tree/develop/istio</a>。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1572940023014-089f4517-840c-4f6e-ae29-2c308926d069.png#align=left&amp;display=inline&amp;height=365&amp;name=image.png&amp;originHeight=730&amp;originWidth=1372&amp;search=&amp;size=300144&amp;status=done&amp;width=686" alt="image.png" class="img_ev3q"><br>图2 Nacos MCP Server架构</p><p>使用Nacos MCP Server的方式如下：</p><ol><li>下载最新的Nacos 1.1.4安装包，解压；</li><li>配置application.properties，然后重启Nacos；</li></ol><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nacos.istio.mcp.server.enabled=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意：如果Nacos是集群部署，则只需要配置一台Server启动MCP Server即可，因为每台Nacos Server的数&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;据都是全量的。同时Nacos MCP Server使用的端口是18848，请注意端口是否冲突；</p><ol start="3"><li>配置Pilot使用Nacos MCP Server：</li></ol><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">configSources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- address: x.x.x.x:18848</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>重启Pilot；</li></ol><a name="srliR"></a>## 自定义实例ID 在之前的版本中，Instance类的instanceId字段，是用来作为唯一标识这个instance的属性，它的值默认是不能由客户端来指定的。在1.1.4版本中，我们支持了允许客户端自定义ID以及一个新增加的instanceId生成算法：一个服务内唯一的整数，这个整数可以用来作为实例在服务内的唯一索引。这个功能由vettal-wu贡献，非常感谢。<p>这个整形instanceId的使用方式为在注册时配置instance的metadata，指定使用该id生成算法，样例代码如下：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Instance instance = new Instance();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance.setIp("1.1.1.1");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance.setPort(80);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 必须设置ephemeral=false，来保证服务端使用的是严格的一致性协议，否则可能会导致生成的instance id冲突：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance.setEhpemeral(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance.setMetadata(new HashMap&lt;String, String&gt;());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance.getMetadata().put(PreservedMetadataKeys.INSTANCE_ID_GENERATOR, Constants.SNOWFLAKE_INSTANCE_ID_GENERATOR);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Nacos在这个版本也有一些关于代码质量上的优化更新，具体可以参考1.1.4版本issue列表：<a href="https://github.com/alibaba/nacos/issues?q=is%3Aissue+milestone%3A1.1.4" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos/issues?q=is%3Aissue+milestone%3A1.1.4</a>。</p><a name="B7djZ"></a>## 如何共建<p>为了实现这一目标，你需要积极参与Nacos社区。如果您在文档中发现拼写错误，在代码中发现错误，或想要新功能或想要提供建议，您可以<a href="https://github.com/alibaba/Nacos/issues/new" target="_blank" rel="noopener noreferrer">在GitHub上创建一个issues</a>。</p><p>如果您想开始着手，可以选择github仓库中有以下标签的issues。</p><ul><li><a href="https://github.com/alibaba/nacos/labels/good%20first%20issue" target="_blank" rel="noopener noreferrer">good first issue</a>：对于新手来说是非常好的入门issues。</li><li><a href="https://github.com/alibaba/nacos/labels/contribution%20%E6%AC%A2%E8%BF%8E" target="_blank" rel="noopener noreferrer">contribution welcome</a>：非常需要解决的问题和非常重要的模块，但目前缺少贡献者，欢迎贡献者来贡献。</li></ul><a name="7ddae8a4"></a>## 蓬勃发展的 Nacos 社区<blockquote><p>DISS is cheap, show me your hand
比吐槽更重要的是搭把手，参与社区一起发展Nacos</p></blockquote><ul><li>作为用户关注和加入 Nacos 社区</li></ul><p>Nacos 社区正在蓬勃发展，截止到发文为止，Nacos 短短几个月已经有 9 个微信群，其中 7 个已满员，1个QQ群，1个钉钉群，关注 Nacos 的社区人数已经近5000人，在 Nacos 群里跟 “道（基）友” 切磋技术，交流经验，招聘交友，抢抢红包...不亦乐乎。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1572940023025-5e1cf910-5e80-4353-8b47-d0565a65bbda.png#align=left&amp;display=inline&amp;height=998&amp;name=image.png&amp;originHeight=998&amp;originWidth=1786&amp;search=&amp;size=298649&amp;status=done&amp;width=1786" alt="image.png" class="img_ev3q"></p><ul><li>作为代码贡献者加入 Nacos 社区</li></ul><p>从Nacos用户发展而成贡献者顺理成章，而Nacos开发团队也确实在日趋壮大，从开始的只有4个代码contributor发展到目前的40多个，1.1.4版本中，参与Nacos仓库贡献的开发者有：stackisok,loadchange, ly641921791, EZLippi, rushsky518, universefeeler, nkorange, vettal-wu, beldon等。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1542704700864-a9d54856-9bf6-4176-b449-c13fa02c5800.png#align=left&amp;display=inline&amp;height=387&amp;linkTarget=_blank&amp;originHeight=888&amp;originWidth=1716&amp;width=748#align=left&amp;display=inline&amp;height=386&amp;originHeight=888&amp;originWidth=1716&amp;search=&amp;status=done&amp;width=746" class="img_ev3q"></p><a name="2461e1c0"></a>## 新人时刻 - "什么是Nacos？"<blockquote><p>还不知道什么是Nacos? 没关系，在github上star一下跟程序猿兄弟打个招呼吧!!</p></blockquote><p><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a>&nbsp;是阿里巴巴于2018年7月份新开源的项目，Nacos的主要愿景是期望通过提供易用的&nbsp;<code>动态服务发现</code>、<code>服务配置管理</code>、<code>服务共享与管理</code>&nbsp;的基础设施，帮助用户在云原生时代更好的构建、交付、管理自己的微服务平台。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1572940023011-845b558c-5af1-4e75-8f6e-4aee37cdbb44.png#align=left&amp;display=inline&amp;height=332&amp;name=image.png&amp;originHeight=664&amp;originWidth=1614&amp;search=&amp;size=282270&amp;status=done&amp;width=807" alt="image.png" class="img_ev3q"></p><p>github项目地址在&nbsp;<a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">这里</a></p><a name="f26dbb6d"></a>## 更多与 Nacos 相关的开源项目信息<ul><li><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a></li><li><a href="https://github.com/dubbo/dubbo-registry-nacos" target="_blank" rel="noopener noreferrer">Dubbo Registry Nacos</a></li><li><a href="https://github.com/nacos-group/nacos-coredns-plugin" target="_blank" rel="noopener noreferrer">Nacos DNS-F</a></li><li><a href="https://github.com/nacos-group/nacos-docker" target="_blank" rel="noopener noreferrer">Nacos Docker</a></li><li><a href="https://github.com/nacos-group/nacos-spring-project" target="_blank" rel="noopener noreferrer">Nacos Spring Project</a></li><li><a href="https://github.com/nacos-group/nacos-spring-boot-project" target="_blank" rel="noopener noreferrer">Nacos Spring Boot</a></li><li><a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba</a></li><li><a href="http://dubbo.io/" target="_blank" rel="noopener noreferrer">Dubbo</a></li><li><a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">Sentinel</a></li><li><a href="https://projects.spring.io/spring-cloud/" target="_blank" rel="noopener noreferrer">Spring Cloud</a></li><li><a href="https://github.com/Nepxion/Discovery" target="_blank" rel="noopener noreferrer">Nepxion Discovery</a></li><li><a href="https://github.com/SpringCloud/spring-cloud-gateway-nacos" target="_blank" rel="noopener noreferrer">Spring Cloud Gateway Nacos</a></li></ul><a name="aswNK"></a>## 下期预告 Nacos的下个版本是1.2.0版本，将会支持社区广泛关注的权限控制功能，敬请期待。]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos整合Confd，支持nginx配置管理]]></title>
            <link>https://nacos.io/en/blog/nacos-confd</link>
            <guid>https://nacos.io/en/blog/nacos-confd</guid>
            <pubDate>Fri, 06 Sep 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[为什么要支持confd，老的应用配置管理模式是启动时读取配置文件，然后重新读取配置文件需要应用重启。一般的配置管理系统都是代码侵入性的]]></description>
            <content:encoded><![CDATA[<p>为什么要支持confd，老的应用配置管理模式是启动时读取配置文件，然后重新读取配置文件需要应用重启。一般的配置管理系统都是代码侵入性的，应用接入配置管理系统都需要使用对应的SDK来查询和监听数据的变更。对于一些已经成熟的系统来说，接入SDK来实现动态配置管理是很难实现的，Nacos通过引入配置管理工具confd可以实现系统的配置变更做到无代码侵入性。</p><p>confd是一个轻量级的配置管理工具，可以通过查询后端存储系统来实现第三方系统的动态配置管理，如Nginx、Tomcat、HAproxy、Docker配置等。confd目前支持的后端有etcd、ZooKeeper等，Nacos
1.1版本通过对confd定制支持Nacos作为后端存储。</p><p>confd能够查询和监听后端系统的数据变更，结合配置模版引擎动态更新本地配置文件，保持和后端系统的数据一致，并且能够执行命令或者脚本实现系统的reload或者重启。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="安装confd插件">安装confd插件<a href="#安装confd插件" class="hash-link" aria-label="Direct link to 安装confd插件" title="Direct link to 安装confd插件">​</a></h2><p>confd的安装可以通过源码安装方式，confd基于Go语言编写，其编译安装依赖Go，首先需要确保本地安装了Go，版本不低于v1.10
创建confd目录，下载confd源码，编译生成可执行文件</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p $GOPATH/src/github.com/kelseyhightower</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd $GOPATH/src/github.com/kelseyhightower</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://github.com/nacos-group/nacos-confd/archive/v0.19.1.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -xvf v0.19.1.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv nacos-confd-0.19.1 confd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd confd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>复制confd文件到bin目录下，启动confd</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo cp bin/confd /usr/local/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">confd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="confd结合nacos实现nginx配置管理示例">confd结合Nacos实现nginx配置管理示例<a href="#confd结合nacos实现nginx配置管理示例" class="hash-link" aria-label="Direct link to confd结合Nacos实现nginx配置管理示例" title="Direct link to confd结合Nacos实现nginx配置管理示例">​</a></h2><p>本文介绍使用Nacos结合confd实现Nginx配置管理，为简单起见以Nginx的黑名单功能为演示示例，Nacos使用官网部署的服务，域名为console.nacos.io。Nginx的安装可以参考网上文章</p><p><img loading="lazy" src="https://img.alicdn.com/tfs/TB1X_KhdUz1gK0jSZLeXXb9kVXa-720-405.jpg" alt="image" class="img_ev3q"></p><ul><li>1.创建confd所需目录</li></ul><p>confd配置文件默认在/etc/confd中，可以通过参数-confdir指定。目录中包含两个子目录，分别是：conf.d templates</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /etc/confd/{conf.d,templates}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>2.创建confd配置文件</li></ul><p>confd会先读取conf.d目录中的配置文件(toml格式)，然后根据文件指定的模板路径去渲染模板。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/confd/conf.d/nginx.toml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>内容为如下，其中nginx.conf.tmpl文件为confd的模版文件，keys为模版渲染成配置文件所需的配置内容，/usr/local/nginx/conf/nginx.conf为生成的配置文件</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[template]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">src = " nginx.conf.tmpl"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dest =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"/usr/local/nginx/conf/nginx.conf"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keys = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"/nginx/conf",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">check_cmd = "/usr/local/nginx/sbin/nginx -t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-c {{.src}}"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reload_cmd = "/usr/local/nginx/sbin/nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-s reload"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>3.创建模版文件</li></ul><p>拷贝Nginx原始的配置，增加对应的渲染内容</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cp /usr/local/nginx/conf/nginx.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/confd/templates/nginx.conf.tmpl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/confd/templates/nginx.conf.tmpl</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>增加内容为:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">···</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{{$data := json (getv "/nginx/conf")}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{{range $data.blackList}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deny {{.}};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{{end}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">···</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>4.在Nacos上创建所需的配置文件</li></ul><p>在public命名空间创建dataId为nginx.conf的配置文件，group使用默认的DEFAULT_GROUP即可，配置内容为json格式</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"blackList":["10.0.1.104","10.0.1.103"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://img.alicdn.com/tfs/TB1PSKwdKP2gK0jSZFoXXauIVXa-1986-1024.png" alt="image" class="img_ev3q"></p><ul><li>5.启动confd</li></ul><p>启动confd，从Nacos获取配置文件，渲染Nginx配置文件。backend设置成nacos，node指定访问的Nacos服务地址，watch让confd支持动态监听</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">confd -backend nacos -node http://console.nacos.io:80 -watch</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>6.查看Nginx配置文件，验证Nginx启动</li></ul><p>查看生成的/usr/local/nginx/conf/nginx.conf配置文件是否存在如下内容</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deny 10.0.1.104;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deny 10.0.1.103;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>curl命令访问Nginx，验证是否返回正常。http响应状态码为200说明访问Nginx正常</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl http://$IP:8080/ -i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 200 OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>7.查看本机Ip，加到Nacos配置文件黑名单中</li></ul><p>假设本机的Ip为30.5.125.107，将本机的Ip加入到Nginx黑名单</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"blackList":["10.0.1.104","10.0.1.103","30.5.125.107"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>8.查看Nginx配置文件，验证黑名单是否生效</li></ul><p>查看生成的/usr/local/nginx/conf/nginx.conf配置文件是否存在如下内容</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deny 10.0.1.104;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deny 10.0.1.103;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deny 30.5.125.107;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>curl命令访问Nginx，访问应该被拒绝，返回403</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl http://$IP:8080/ -i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 403 Forbidden</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2><p>本文介绍了使用Nacos结合confd来做自动化管理，confd作为轻量级的配置管理工具可以做到对第三方系统无代码侵入性。本文只是简单使用Nginx的黑名单功能来演示Nacos+confd的使用方式，当然Nginx还具有限流、反向代理等功能以及其他的系统比如Naproxy、Tomcat、Docker等也同样可以使用Nacos+confd做管理，大家可以到Nacos<a href="https://nacos.io" target="_blank" rel="noopener noreferrer">官网</a>贡献相应的demo或者方案。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Eureka 2.0 开源工作宣告停止？别担心，ANS 即将 C位强势出道！]]></title>
            <link>https://nacos.io/en/blog/eureka2</link>
            <guid>https://nacos.io/en/blog/eureka2</guid>
            <pubDate>Thu, 22 Aug 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[Eureka 2.0 开源工作宣告停止？别担心，ANS 即将 C位强势出道！]]></description>
            <content:encoded><![CDATA[<p>近日，Netflix 公司在 github 上公告 Eureka 2.0 开源工作停止，继续使用风险自负。这一消息在spring cloud 开发者中引起了一些担心和忧虑。</p><p>同时在阿里巴巴正式宣布其开源计划， 将通过 Nacos 项目将阿里巴巴在建设共享服务体系中使用的服务发现、配置及服务管理平台贡献给开源社区，通过打造 Dubbo + Nacos 的经典组合进一步释放 Dubbo 在云原生及 Service Mesh 时代中，在大规模微服务治理、流量治理、服务集成与服务共享等服务平台能力建设上的威力，同时 Nacos 会非常关注对主流开源社区，如 Spring Cloud 和 Kubernetes 云原生体系的无缝对接与支持。</p><p>ANS (alibaba naming service) 是 nacos 组件中的服务发现部分。开源流程正在紧张地进行中。同时 ANS 与 spring cloud 结合的 spring cloud starter ans 也将同时开源到 spring cloud <a href="https://github.com/spring-cloud-incubator/spring-cloud-alibabacloud" target="_blank" rel="noopener noreferrer">官方孵化器</a>。</p><p>ANS 同样也支持 spring cloud 应用的服务注册与发现，同时默认集成了负载均衡组件 Ribbon，Eureka 用户可以简单地通过替换 maven 项目中 pom.xml 文件中的依赖来实现无缝迁移。</p><p>想抢先体验？来试试商业版的 EDAS Ans starter 吧！</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="快速开始">快速开始<a href="#快速开始" class="hash-link" aria-label="Direct link to 快速开始" title="Direct link to 快速开始">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="服务提供者">服务提供者<a href="#服务提供者" class="hash-link" aria-label="Direct link to 服务提供者" title="Direct link to 服务提供者">​</a></h3><ol><li><p>创建一个 Spring Cloud 工程，命名为 service-provider。这里我们以 spring boot 1.5.8 和 spring cloud Dalston.SR4 为例。在 pom.xml 中引入需要的依赖内容。<br>
<!-- -->其他版本如 spring boot 2 + spring cloud Finchley 也同样支持，请您自行修改版本号和替换相应的组件依赖。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;parent&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;version&gt;1.5.8.RELEASE&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;relativePath/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/parent&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;artifactId&gt;spring-cloud-starter-ans&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;version&gt;1.1.3&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;artifactId&gt;spring-cloud-alibaba-edas-starter&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;version&gt;1.1.3&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependencyManagement&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;version&gt;Dalston.SR4&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;type&gt;pom&lt;/type&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;scope&gt;import&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependencyManagement&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><ol><li><p>编码服务提供端的启动类，其中 @EnableDiscoveryClient 注解表明此应用需开启服务注册与发现功能。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableDiscoveryClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ServerApplication {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SpringApplication.run(ServerApplication.class, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>既然是服务提供者，所以我们还需要提供一个简单的服务。这里 EchoController 的逻辑很简单，将收到的参数回显给调用者。</p></li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    @RestController</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public class EchoController {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @RequestMapping(value = "/echo/{string}", method = RequestMethod.GET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public String echo(@PathVariable String string) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return string;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li><p>权限配置，配置阿里云账号的 AccessKey、SecretKey，以及 EDAS 的命名空间信息。</p><ol><li><p>配置阿里云 AccessKey 和 SecretKey</p><p>登陆 <a href="https://usercenter.console.aliyun.com/#/accesskey" target="_blank" rel="noopener noreferrer">阿里云AK管理控制台</a>。找到 <code>用户信息管理</code> 下的 <code>安全信息管理</code>。</p><p>复制 <code>AccessKey ID</code> 和 <code>Access Key Secret</code>，分别对应配置项中的 alibaba.cloud.access-key 和 alibaba.cloud.secret-key。</p><p>安全凭证信息格式如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">alibaba.cloud.access-key=xxxxxxxxxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alibaba.cloud.secret-key=xxxxxxxxxx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/54319/1531104058520-831f4dba-6279-4bd3-9632-899d29830868.png" alt="2.png" class="img_ev3q"> </p></li></ol></li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. 配置 EDAS 的命名空间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    登录 [EDAS 控制台](https://edas.console.aliyun.com/#/home)。未开通EDAS的用户需要先开通EDAS，**EDAS 标准版促销进行中，每月仅需1元。**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    在左侧导航栏中单击**命名空间**。在命名空间列表页面选择**地域**，并找到您想发布到的命名空间，复制其**命名空间ID**，对应配置项中的 **alibaba.edas.namespace**。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        alibaba.edas.namespace=xxxxxxxxxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ![1.png](https://cdn.yuque.com/lark/0/2018/png/54319/1531104049757-c3d2aefd-5d57-4434-a04f-2cd939cf58b0.png) </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li><p>综上，我们的配置文件 application.properties 内容最后是这样的。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring.application.name=service-provider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server.port=18081</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alibaba.cloud.access-key=xxxxxxxxxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alibaba.cloud.secret-key=xxxxxxxxxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alibaba.edas.namespace=cn-hangzhou</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><ol><li><p>启动 service-provider 服务，在 EDAS 页面查看服务注册的信息。</p><p>可以看到服务列表中已经存在的实例 service-provider，从详情页可以看到IP地址是本机的地址192.168.0.107,端口是 18081。</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/jpeg/54319/1531104455581-1d9521aa-927e-4292-9d83-b1057ab67c02.jpeg" alt="3.JPG" class="img_ev3q"> </p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/54319/1531104077485-48d3d67b-584d-4729-aef2-2fbb64c0b846.png" alt="4.png" class="img_ev3q"> </p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="服务消费者">服务消费者<a href="#服务消费者" class="hash-link" aria-label="Direct link to 服务消费者" title="Direct link to 服务消费者">​</a></h3><p>这个例子中，我们将不仅仅是演示服务发现的功能，同时还将演示 ANS 服务发现 与 RestTemplate、AsyncRestTemplate 和 FeignClient 这三个客户端是如何结合的。因为实际使用中，我们更多使用的是用这三个客户端进行服务调用。</p><ol><li><p>创建一个 Spring Cloud 工程，命名为 service-consumer。首先在 pom.xml 中引入需要的依赖内容：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;parent&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;version&gt;1.5.8.RELEASE&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;relativePath/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/parent&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;artifactId&gt;spring-cloud-starter-ans&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;version&gt;1.1.3&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;artifactId&gt;spring-cloud-alibaba-edas-starter&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;version&gt;1.1.3&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependencyManagement&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;version&gt;Dalston.SR4&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;type&gt;pom&lt;/type&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;scope&gt;import&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependencyManagement&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>因为在这里我们要演示 FeignClient 的使用，所以与 service-provider 相比，pom.xml 文件中的依赖增加了一个 spring-cloud-starter-feign。</p></li></ol><ol><li><p>完成以下四个步骤，配置好 RestTemplate 、 AsyncRestTemplate 和 FeignClient。</p><ol><li><p>在使用 FeignClient 之前，我们还需要对它的配置，配置服务名以及方法对应的 HTTP 请求，示例代码如下</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@FeignClient(name = "service-provider")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface EchoService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RequestMapping(value = "/echo/{str}", method = RequestMethod.GET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String echo(@PathVariable("str") String str);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>在启动类中，使用 @EnableDiscoveryClient 注解启用服务注册与发现</p></li><li><p>在启动类中，使用 @EnableFeignClients 注解激活 FeignClient</p></li><li><p>在启动类中，添加 @LoadBalanced 注解将 RestTemplate 与 AsyncRestTemplate 与服务发现结合。</p></li></ol><p>最终启动类的代码如下</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableDiscoveryClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableFeignClients</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ConsumerApplication {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @LoadBalanced</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public RestTemplate restTemplate() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new RestTemplate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @LoadBalanced</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public AsyncRestTemplate asyncRestTemplate(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new AsyncRestTemplate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SpringApplication.run(ConsumerApplication.class, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>创建一个Controller，供我们演示和验证服务发现功能使用。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class TestController {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private RestTemplate restTemplate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private AsyncRestTemplate asyncRestTemplate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private  EchoService echoService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RequestMapping(value = "/echo-rest/{str}", method = RequestMethod.GET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String rest(@PathVariable String str) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return restTemplate.getForObject("http://service-provider/echo/" + str, String.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RequestMapping(value = "/echo-async-rest/{str}", method = RequestMethod.GET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String asyncRest(@PathVariable String str) throws Exception{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ListenableFuture&lt;ResponseEntity&lt;String&gt;&gt; future = asyncRestTemplate.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                getForEntity("http://service-provider/echo/"+str, String.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return future.get().getBody();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RequestMapping(value = "/echo-feign/{str}", method = RequestMethod.GET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String feign(@PathVariable String str) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return echoService.echo(str);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>最后，添加应用基本配置和阿里云 AK、SK 以及 EDAS 的 namespace。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring.application.name=service-consumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server.port=18082</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alibaba.cloud.access-key=xxxxxxxxxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alibaba.cloud.secret-key=xxxxxxxxxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alibaba.edas.namespace=cn-hangzhou</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>启动服务，首先查看EDAS控制台，查询服务，可以看到，服务注册成功了。</p><p>再对我们的演示 API 分别进行调用，可以看到调用都成功了。
<img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/54319/1531104088354-7cc0fae7-95cf-4c62-a9ea-1b9a53908949.png" alt="5.png" class="img_ev3q"> </p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/54319/1531104133698-f9621e80-7cb1-4789-a88a-929f720b5c2b.png" alt="6.png" class="img_ev3q"> </p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="demo-下载">Demo 下载<a href="#demo-下载" class="hash-link" aria-label="Direct link to Demo 下载" title="Direct link to Demo 下载">​</a></h2><p><a href="http://edas-public.oss-cn-hangzhou.aliyuncs.com/install_package/demo/ans-service-provider.zip" target="_blank" rel="noopener noreferrer">service-provider</a></p><p><a href="http://edas-public.oss-cn-hangzhou.aliyuncs.com/install_package/demo/ans-service-consumer.zip" target="_blank" rel="noopener noreferrer">service-consumer</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="更多配置项">更多配置项<a href="#更多配置项" class="hash-link" aria-label="Direct link to 更多配置项" title="Direct link to 更多配置项">​</a></h2><table><thead><tr><th>配置项</th><th>key</th><th>默认值</th><th>说明</th><th>补充说明</th></tr></thead><tbody><tr><td>服务名</td><td>spring.cloud.ans.doms</td><td>spring.application.name</td><td>当此项未配置时，默认从spring.application.name中获取<br>需要发布多个服务时，中间用英文的 <code>,</code> 号隔开</td><td>production</td></tr><tr><td>是否注册</td><td>spring.cloud.ans.register-enabled</td><td>true</td><td>当只需要发现，不需要注册时，可以通过将值设置成false来关闭注册</td><td>production</td></tr><tr><td>想要注册的IP</td><td>spring.cloud.ans.ip</td><td>无</td><td>当需要指定本机注册的IP时，通过此值来配置，优先级最高</td><td>production</td></tr><tr><td>想要注册的IP所属的网卡</td><td>spring.cloud.ans.interface-name</td><td>无</td><td>当确定需要发布哪块网卡对应的IP地址时，通过此参数配置，值为网卡名</td><td>production</td></tr><tr><td>想要注册的端口</td><td>spring.cloud.ans.port</td><td>无</td><td>想要注册的端口</td><td>production</td></tr><tr><td>注册的权重</td><td>spring.cloud.ans.weight</td><td>1</td><td>数值越大权重越高，取值范围为</td><td>test</td></tr><tr><td>集群</td><td>spring.cloud.ans.cluster</td><td>DEFAULT</td><td>可以通过集群来分别标记服务</td><td>test</td></tr><tr><td>租户环境</td><td>spring.cloud.ans.env</td><td>DEFAULT</td><td>相同租户的相同环境下的服务才能互相发现</td><td>test</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="工作原理">工作原理<a href="#工作原理" class="hash-link" aria-label="Direct link to 工作原理" title="Direct link to 工作原理">​</a></h2><p>下面我们将从 服务注册中心寻址、服务注册与下线、客户端结合、高可用、安全等多个方面来分析原理。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="服务注册中心寻址">服务注册中心寻址<a href="#服务注册中心寻址" class="hash-link" aria-label="Direct link to 服务注册中心寻址" title="Direct link to 服务注册中心寻址">​</a></h3><p>配置阿里云的 AccessKey 和 SecretKey 之后，再指定 EDAS 的命名空间，那么程序会在启动的过程中去调用 EDAS 的接口，获取到此命名空间对应的账号权限信息和地址服务器的地址。</p><p>ANS 客户端通过地址服务器就能拿到 ANS Server端的地址。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="服务注册与下线">服务注册与下线<a href="#服务注册与下线" class="hash-link" aria-label="Direct link to 服务注册与下线" title="Direct link to 服务注册与下线">​</a></h3><p>服务注册的通信协议是 HTTP 协议，在 Spring 启动过程中，收到 EmbeddedServletContainerInitializedEvent 或 ServletWebServerInitializedEvent
事件时，会将服务注册到 ANS Server 端。</p><p>服务注册成功后，ANS client 端将会主动向 server 端发送心跳，当超过一定时间内 server 端没有收到 client 端的心跳时，会将服务标记成不可用，这样其他 client 在查询时就能发现此服务当前处于不可用的状态。<br>
<!-- -->如果短时间内，大量 client 与 server 心跳失败，则会出发降级保护机制，服务会暂时不被标记成不可用的状态。</p><p>当应用程序停止时，收到 ContextClosedEvent 事件后，ANS client 会调用 server 端的反注册接口，将此服务下线。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="客户端结合">客户端结合<a href="#客户端结合" class="hash-link" aria-label="Direct link to 客户端结合" title="Direct link to 客户端结合">​</a></h3><p>与客户端结合的方式， ans starter已经实现自动与 Ribbon 组件的结合。  </p><p>Ribbon的关键接口有下面三个:</p><table><thead><tr><th>属性</th><th>提供的功能</th><th></th></tr></thead><tbody><tr><td>ServerList</td><td>提供 getInitialListOfServers 和 getUpdatedListOfServers 方法，获取和刷新 serverList。</td><td></td></tr><tr><td>IRule</td><td>选择出一个服务节点</td><td></td></tr><tr><td>IPing</td><td>提供 isAlive 方法，负责探测serverList中节点是否可用</td><td></td></tr></tbody></table><p>目前 ans-starter 在 spring context 中默认实例化了一个 AnsServerList。AnsServerList 实现了 Ribbon 的 ServerList<!-- -->&lt;<!-- -->Server&gt; 接口。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConditionalOnMissingBean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public ServerList&lt;Server&gt; ribbonServerList(IClientConfig config) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AnsServerList serverList = new AnsServerList(config.getClientName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return serverList;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果您有其他需求，可以自行实现 Ribbon 的接口，或者直接在 github 上通过 issue 向我们提需求，我们评估通过后会加上此功能。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="高可用实现">高可用实现<a href="#高可用实现" class="hash-link" aria-label="Direct link to 高可用实现" title="Direct link to 高可用实现">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="服务端高可用">服务端高可用<a href="#服务端高可用" class="hash-link" aria-label="Direct link to 服务端高可用" title="Direct link to 服务端高可用">​</a></h4><p>ANS作为分布式系统，服务端高可用包含以下几个方面：</p><ul><li>集群内机器数据对等，每台机器存储全量数据；</li><li>支持机房容灾功能，即一个集群中的某个机房内的机器全部挂掉不影响服务；</li><li>服务端异常自动探测，一旦某个机器挂了，该机器相关的任务（如健康检查）自动漂移到其他机器；</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="客户端高可用">客户端高可用<a href="#客户端高可用" class="hash-link" aria-label="Direct link to 客户端高可用" title="Direct link to 客户端高可用">​</a></h4><p>ANS 为了保证高可用，在客户端高可用方面同样做了很多工作，以应对不同场景的异常情况。</p><ul><li><p>推空保护，当客户端收到服务端推送的空数据时，忽略掉该数据，使用上次的数据；</p></li><li><p>本地内存缓存，当运行时与服务注册中心的连接丢失或服务注册中心完全宕机，仍能正常地调用服务。</p></li><li><p>本地缓存文件，当应用与服务注册中心发生网络分区或服务注册中心完全宕机后，应用进行了重启操作，内存里没有数据，此时应用可以通过读取本地已落盘持久化的数据来获取到最后一次订阅到的内容。</p></li><li><p>本地容灾文件夹。正常的情况下，容灾文件夹内是没有内容的。当服务端完全宕机且长时间不能恢复，同时服务提供者又发生了很大的变更时，可以通过在容灾文件夹内添加文件的方式来开启本地容灾。此时客户端会忽略原有的本地缓存文件，只从本地容灾文件中读取配置。极端情况下，服务端完全不可用时，可以通过修改缓存文件的方式达到支持服务发布变更的目的。</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="安全的实现">安全的实现<a href="#安全的实现" class="hash-link" aria-label="Direct link to 安全的实现" title="Direct link to 安全的实现">​</a></h3><p>EDAS 服务注册发现组件，结合 EDAS 已有的安全功能，在每次注册、心跳和查询请求中都添加了验签鉴权的操作，保护了服务的安全性。</p><p>所以如果您发现您配置的权限信息都无误，但是运行文档中的 Demo 却注册失败了。则可能是由于您本机的时间不准确，从而导致验签鉴权失败。此时您需要校正本机的时间，建议打开时间自动同步功能。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="faq">FAQ<a href="#faq" class="hash-link" aria-label="Direct link to FAQ" title="Direct link to FAQ">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="问为什么我的服务注册总是失败">问：为什么我的服务注册总是失败？<a href="#问为什么我的服务注册总是失败" class="hash-link" aria-label="Direct link to 问：为什么我的服务注册总是失败？" title="Direct link to 问：为什么我的服务注册总是失败？">​</a></h4><h4 class="anchor anchorWithStickyNavbar_LWe7" id="答如果您在确认账号信息都准确无误的情况下但是运行此文档中的-demo-却注册失败了有可能是由于您本机的时间不准确从而导致验签鉴权失败此时您需要校正本机的时间建议打开时间自动同步功能">答：如果您在确认账号信息都准确无误的情况下，但是运行此文档中的 Demo 却注册失败了。有可能是由于您本机的时间不准确，从而导致验签鉴权失败。此时您需要校正本机的时间，建议打开时间自动同步功能。<a href="#答如果您在确认账号信息都准确无误的情况下但是运行此文档中的-demo-却注册失败了有可能是由于您本机的时间不准确从而导致验签鉴权失败此时您需要校正本机的时间建议打开时间自动同步功能" class="hash-link" aria-label="Direct link to 答：如果您在确认账号信息都准确无误的情况下，但是运行此文档中的 Demo 却注册失败了。有可能是由于您本机的时间不准确，从而导致验签鉴权失败。此时您需要校正本机的时间，建议打开时间自动同步功能。" title="Direct link to 答：如果您在确认账号信息都准确无误的情况下，但是运行此文档中的 Demo 却注册失败了。有可能是由于您本机的时间不准确，从而导致验签鉴权失败。此时您需要校正本机的时间，建议打开时间自动同步功能。">​</a></h4>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos 1.1.0发布，支持灰度配置和地址服务器模块]]></title>
            <link>https://nacos.io/en/blog/nacos 1.1.0</link>
            <guid>https://nacos.io/en/blog/nacos 1.1.0</guid>
            <pubDate>Wed, 10 Jul 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos 是阿里巴巴开源的配置中心和服务发现产品，开源距今已经超过一年的时间。本次1.1.0的发布，带来了许多重量级的特性更新，包括灰度配置等社区呼声很高的特性。]]></description>
            <content:encoded><![CDATA[<p>Nacos 是阿里巴巴开源的配置中心和服务发现产品，开源距今已经超过一年的时间。本次1.1.0的发布，带来了许多重量级的特性更新，包括灰度配置等社区呼声很高的特性，下面会介绍1.1.0版本发布的新特性和每个特性的使用方式。</p><a name="CQSXH"></a>## 升级指南<a name="6l7mA"></a>#### Server端 0.8.0及以上版本：<ol><li>解压安装包后替换{nacos.home}/target/nacos-server.jar</li><li>删除{nacos.home}/plugins/cmdb/及{nacos.home}/plugins/health/下的所有文件</li><li>逐台重启Nacos Server即可</li></ol><p>0.8.0以下版本，先升级到1.0.0版本。</p><a name="yfczA"></a>#### Client端 请使用最新的1.1.1版本，修复了1.1.0版本的一个客户端版本显示问题。<a name="CfMxA"></a>## 新增特性<ul><li>灰度配置</li><li>配置导入导出及配置同步&nbsp;</li><li>地址服务器模块</li><li>服务订阅者列表</li><li>自定义实例心跳周期</li><li>Config监听器优化</li><li>Nacos Go SDK发布</li></ul><a name="LYY0I"></a>### 灰度配置 @yanlinly&nbsp;@loadchange<p>灰度配置指的是指定部分客户端IP进行新配置的下发，其余客户端配置保持不变，用以验证新配置对客户端的影响，保证配置的平稳发布。灰度配置是生产环境中一个比较重要的功能，对于保证生产环境的稳定性非常重要。在1.1.0中，Nacos支持了以IP为粒度的灰度配置，具体使用步骤如下：</p><ol><li>在配置列表页面，点击某个配置的“编辑配置”按钮：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562579955002-bc2de409-26a4-43b7-8cdb-4bc83653ce8a.png#align=left&amp;display=inline&amp;height=262&amp;name=image.png&amp;originHeight=524&amp;originWidth=2506&amp;size=183572&amp;status=done&amp;width=1253" alt="image.png" class="img_ev3q"></p><ol start="2"><li>勾选“Beta发布”，在文本框里填入要下发配置配置的IP，多个IP用逗号分隔：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562580241038-085504e7-b63a-42ec-9304-08256ae3beba.png#align=left&amp;display=inline&amp;height=429&amp;name=image.png&amp;originHeight=858&amp;originWidth=1766&amp;size=148534&amp;status=done&amp;width=883" alt="image.png" class="img_ev3q"></p><ol start="3"><li>修改配置内容，点击“发布Beta”按钮，即可完成灰度配置的发布：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562580334216-78ac746b-e0de-4c33-b67d-bde89ef13f55.png#align=left&amp;display=inline&amp;height=527&amp;name=image.png&amp;originHeight=1054&amp;originWidth=2506&amp;size=179061&amp;status=done&amp;width=1253" alt="image.png" class="img_ev3q"></p><ol start="4"><li>点击“发布Beta”后，“发布Beta”按钮变灰，此时可以选择“停止Beta”或者“发布”。“停止Beta”表示取消停止灰度发布，当前灰度发布配置的IP列表和配置内容都会删除，页面回到正常发布的样式。“发布”表示将灰度配置在所有客户端生效，之前的配置也会被覆盖，同时页面回到正常发布的样式：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562595148249-e64b0585-525d-450d-a87c-6e3fd194351c.png#align=left&amp;display=inline&amp;height=489&amp;name=image.png&amp;originHeight=978&amp;originWidth=2512&amp;size=184032&amp;status=done&amp;width=1256" alt="image.png" class="img_ev3q"></p><a name="1t0AL"></a>### 配置导入导出及配置同步 @KeRan213539<p>配置管理的另一个常见需求是能够将一个集群的配置同步到另外一个集群，或者从一个命名空间同步到另外一个命名空间。来自社区的贡献者KeRan213539贡献这个非常实用的功能，具体使用步骤如下：</p><ol><li>导出查询结果。可以根据查询条件，将当期查询出的所有结果打包为一个文件：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562596769546-89546d16-a764-488c-8f87-b1d038a207d2.png#align=left&amp;display=inline&amp;height=415&amp;name=image.png&amp;originHeight=830&amp;originWidth=2526&amp;size=368179&amp;status=done&amp;width=1263" alt="image.png" class="img_ev3q"></p><ol start="2"><li>导出选中的配置：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562597197759-8cefeff9-13f6-4ef1-8c84-570efcd268e0.png#align=left&amp;display=inline&amp;height=367&amp;name=image.png&amp;originHeight=734&amp;originWidth=2506&amp;size=412720&amp;status=done&amp;width=1253" alt="image.png" class="img_ev3q"></p><ol start="3"><li>导入配置，可以选择相同配置的处理策略。</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562597316659-9b4e673b-e74a-47ca-b4f6-a95ed63aebfb.png#align=left&amp;display=inline&amp;height=443&amp;name=image.png&amp;originHeight=886&amp;originWidth=2500&amp;size=472512&amp;status=done&amp;width=1250" alt="image.png" class="img_ev3q"></p><p>当发现有相同的配置时，会有相应的提示：<br><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562597345803-2cb1c6b2-aed5-41af-9e18-c43fd2fc3822.png#align=left&amp;display=inline&amp;height=478&amp;name=image.png&amp;originHeight=956&amp;originWidth=2370&amp;size=427447&amp;status=done&amp;width=1185" alt="image.png" class="img_ev3q"></p><p>同时如果导入的配置文件格式不符合要求，也会有相应的提示：<br><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562597543119-019c1e1d-0712-4d1e-9f53-bc8e01156290.png#align=left&amp;display=inline&amp;height=398&amp;name=image.png&amp;originHeight=796&amp;originWidth=2508&amp;size=411258&amp;status=done&amp;width=1254" alt="image.png" class="img_ev3q"></p><ol start="4"><li>配置同步，选取想要同步的配置，点击“克隆”，然后再选择要同步的目标命名空间，就可以将配置同步到对应的命名空间：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562597665286-c5427451-62e6-4a47-b819-644d9709d089.png#align=left&amp;display=inline&amp;height=470&amp;name=image.png&amp;originHeight=940&amp;originWidth=2516&amp;size=499705&amp;status=done&amp;width=1258" alt="image.png" class="img_ev3q"></p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562597707334-4766ffef-cf8e-4791-a634-0857ac3eb40a.png#align=left&amp;display=inline&amp;height=466&amp;name=image.png&amp;originHeight=932&amp;originWidth=2536&amp;size=427102&amp;status=done&amp;width=1268" alt="image.png" class="img_ev3q"></p><ol start="5"><li>导入导出文件格式说明。均为zip压缩包，压缩包内有多个目录，目录名为配置的group，目录下有具体的文件，文件名为配置的dataId，每个文件的内容为配置具体的内容：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562654528090-ab113140-c7d9-4eda-8a67-051a9f13f591.png#align=left&amp;display=inline&amp;height=75&amp;name=image.png&amp;originHeight=81&amp;originWidth=635&amp;size=34863&amp;status=done&amp;width=591" alt="image.png" class="img_ev3q"></p><a name="a9Rf1"></a>### 地址服务器模块 @pbting<p>1.1.0的安装包列表里多了一个nacos-address-server-1.1.0。这个安装包的作用是作为地址服务器模块，单独部署。关于地址服务器的介绍可以参考Nacos官网<a href="https://nacos.io/en-us/blog/address-server.html" target="_blank" rel="noopener noreferrer">地址服务器文章</a>，这里只做一个简单的说明。</p><p>一般中间件产品，客户端寻址服务端的方式都是在客户端配置服务端的地址列表，这样有一个缺点是当服务端的地址发生变动时，客户端无法实时的感知到，也无法动态调整访问的服务端集群。而在阿里巴巴的一种比较常见的客户端寻址服务端的方式是地址服务器。简单的说就是部署单独的地址服务器，地址服务器提供接口，获取相关中间件产品服务端集群的地址。由于地址服务器功能比较单一，因此稳定性比较容易保证。客户端只需要配置地址服务器的域名，通过地址服务器获取想要访问的中间件的集群地址，这样既保证能够感知中间件集群的动态变化，也能够为客户端配置更灵活的集群访问策略。</p><p>下面介绍地址服务器模块的使用。</p><ol><li>部署地址服务器</li><li>将安装包列表里的nacos-address-server.tar.gz或者nacos-address-server.zip解压。</li><li>单机模式启动：执行 sh bin/startup.sh -m standalone -s nacos-address 以 standalone 的方式启动 address server。</li><li>集群模式启动：在 conf 目录下 将 cluster.conf.example 重名名为 cluster.conf，然后加入其它 server 的节点。加完后，执行 sh bin/startup.sh -s nacos-address 即可。</li><li>配置地址服务器域名：将部署好的地址服务器集群IP挂载到一个域名下，我们假设为address.nacos.com</li><li>在地址服务器上配置Nacos集群的地址列表：</li></ol><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Add IP to nacos cluster:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -X POST '$ADDRESS_SERVER:8080/nacos/v1/as/nodes?ips=1.1.1.1:8848,2.2.2.2:8848,3.3.3.3:8848'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Remove IP from nacos cluster:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -X DELETE '$ADDRESS_SERVER:8080/nacos/v1/as/nodes?ips=1.1.1.1:8848,2.2.2.2:8848,3.3.3.3:8848'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>客户端配置endpoint为该地址服务器集群域名：在构造Nacos客户端时，除了可以通过指定serverAddr来访问Nacos集群外，还可以配置endpoint属性，将这个属性的值设为address.nacos.com，这样就可以达到和配置serverAddr相同的效果。</li><li>通过源码构建地址服务器安装包，在Nacos工程根目录下执行：</li></ol><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mvn -Prelease-address clean install -Dmaven.test.skip=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>安装包会生成在distribution/target目录下。</p><a name="6COIS"></a>### 服务订阅者列表 @nicholas2015<p>服务订阅者列表是1.1.0增加的另外一个功能，就是可以在控制台上查看一个服务的消费者，执行步骤如下：</p><ol><li>在服务列表页面，找到想要查询订阅者的服务：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562640498681-5ab822e5-e293-4c17-9abe-63d541cb8058.png#align=left&amp;display=inline&amp;height=266&amp;name=image.png&amp;originHeight=532&amp;originWidth=2504&amp;size=149955&amp;status=done&amp;width=1252" alt="image.png" class="img_ev3q"></p><ol start="2"><li>进入订阅者列表页面，在“服务名称”输入框输入想要查询的服务名，在“分组名称”输入框输入服务的分组名（默认为DEFAULAT_GROUP），点击“查询”后，得到订阅者的信息，包括IP和端口、客户端版本和应用名。</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562640552803-6fa89abd-a5c0-4ecd-90ce-cd9e6eacab1c.png#align=left&amp;display=inline&amp;height=280&amp;name=image.png&amp;originHeight=560&amp;originWidth=2492&amp;size=120344&amp;status=done&amp;width=1246" alt="image.png" class="img_ev3q"></p><a name="Gw6wo"></a>### 服务自定义心跳周期 @lanCao<p>之前的版本中，客户端注册服务时，不能自定义上报心跳的周期以及客户端下线时自动删除实例的间隔。在1.1.0中，我们支持了这个特性，应用可以在注册时，通过设置实例的metadata，来指定心跳周期、健康检查过期时间及删除实例时间。具体举例如下：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">String serviceName = randomDomainName();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Instance instance = new Instance();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance.setIp("1.1.1.1");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance.setPort(9999);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Map&lt;String, String&gt; metadata = new HashMap&lt;String, String&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 设置心跳的周期，单位为秒，这里将心跳间隔设置为3秒：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.put(PreservedMetadataKeys.HEART_BEAT_INTERVAL, "3000");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 设置心跳超时时间，单位为秒，这里将心跳超时时间设为6秒，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 即服务端6秒收不到客户端心跳，会将该客户端注册的实例设为不健康：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.put(PreservedMetadataKeys.HEART_BEAT_TIMEOUT, "6000");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 设置实例删除的超时时间，单位为秒，这里将实例删除超时时间设为9秒，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 即服务端9秒收不到客户端心跳，会将该客户端注册的实例删除：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.put(PreservedMetadataKeys.IP_DELETE_TIMEOUT, "9000");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance.setMetadata(metadata);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">naming.registerInstance(serviceName, instance);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="QFEGE"></a>### Config 监听器的优化 @chuntaojun<br>当存在程序启动之初，如果用户通过`ConfigService.getConfig`获取配置的同时，又注册了监听器，那么会存在监听器再次通知用户刚刚获取的配置信息。因此在`version 1.1.0`版本中，增加了新的接口以及一个系统参数（使用户无需修改现有代码） ```java String getConfigAndSignListener(String dataId, String group, long timeoutMs, Listener listener) throws NacosException; ```<p>该方法在获取配置后，随即注册一个监听器，避免监听器通知用户刚刚才拉取的配置信息<br><code>nacos.enableRemoteSyncConfig=true | false</code><br>设置该系统参数，将在监听器注册时主动去向远端拉取当前最新的配置信息，但是存在一定的网络开销，因此建议用户采取接口的方式</p><a name="unUgM"></a>### Nacos Go SDK @lzp0412&nbsp;@peggypig @atlanssia<p>Nacos上周还发布了Go语言的SDK，目前发布了0.1.0-beta版本，仓库地址是：<a href="https://github.com/nacos-group/nacos-sdk-go" target="_blank" rel="noopener noreferrer">https://github.com/nacos-group/nacos-sdk-go</a>。Nacos Go SDK是单独的仓库，由Nacos Committer参与维护，在代码上不属于Nacos 1.1.0。在此也非常欢迎社区的Go语言高手，参与Nacos Go SDK的演进。</p><a name="0LhDq"></a>## 如何共建<p>为了实现这一目标，你需要积极参与Nacos社区。如果您在文档中发现拼写错误，在代码中发现错误，或想要新功能或想要提供建议，您可以<a href="https://github.com/alibaba/Nacos/issues/new" target="_blank" rel="noopener noreferrer">在GitHub上创建一个issues</a>。</p><p>如果您想开始着手，可以选择github仓库中有以下标签的issues。</p><ul><li><a href="https://github.com/alibaba/nacos/labels/good%20first%20issue" target="_blank" rel="noopener noreferrer">good first issue</a>：对于新手来说是非常好的入门issues。</li><li><a href="https://github.com/alibaba/nacos/labels/contribution%20%E6%AC%A2%E8%BF%8E" target="_blank" rel="noopener noreferrer">contribution welcome</a>：非常需要解决的问题和非常重要的模块，但目前缺少贡献者，欢迎贡献者来贡献。</li></ul><a name="7ddae8a4"></a>## 蓬勃发展的 Nacos 社区<blockquote><p>DISS is cheap, show me your hand
比吐槽更重要的是搭把手，参与社区一起发展Nacos</p></blockquote><ul><li>作为用户关注和加入 Nacos 社区</li></ul><p>Nacos 社区正在蓬勃发展，截止到发文为止，Nacos 已经有 9 个微信群，其中 7 个已满员，1个QQ群，1个钉钉群，关注 Nacos 的社区人数已经近5000人，在 Nacos 群里跟 “道（基）友” 切磋技术，交流经验，招聘交友，抢抢红包...不亦乐乎。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1560397428130-a878b99a-665f-413d-9e69-ec36b13f731f.png#align=left&amp;display=inline&amp;height=431&amp;name=image.png&amp;originHeight=420&amp;originWidth=698&amp;size=144746&amp;status=done&amp;width=716" alt="image.png" class="img_ev3q"></p><ul><li>作为代码贡献者加入 Nacos 社区</li></ul><p>为了能够与代码贡献者更方便的交流，我们组建了钉钉群“Nacos社区核心贡献小组（<strong>23335652</strong>）”，这个群里都是都是对Nacos贡献非常感兴趣的小伙伴，如果你也想成为Nacos贡献者，甚至成为Committer，欢迎加入这个群和群里的小伙伴一起切磋！</p><p>在Nacos官网&nbsp;<a href="http://nacos.io/" target="_blank" rel="noopener noreferrer">nacos.io</a>&nbsp;中，已经添加<a href="https://nacos.io/zh-cn/docs/nacos-dev.html" target="_blank" rel="noopener noreferrer">团队介绍页</a>，里面包括Nacos的开发者角色定义及职责划分，同时包含了Nacos的开发者们介绍和靓照哦，欢迎大家加入Nacos社区，贡献社区。用Apache的话说，<strong>“社区高于代码”!</strong></p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1542704700864-a9d54856-9bf6-4176-b449-c13fa02c5800.png#align=left&amp;display=inline&amp;height=387&amp;linkTarget=_blank&amp;originHeight=888&amp;originWidth=1716&amp;width=748#align=left&amp;display=inline&amp;height=386&amp;originHeight=888&amp;originWidth=1716&amp;status=done&amp;width=746" class="img_ev3q"></p><a name="2461e1c0"></a>## 新人时刻 - "什么是Nacos？"<blockquote><p>还不知道什么是Nacos? 没关系，在github上star一下跟程序猿兄弟打个招呼吧!!</p></blockquote><p><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a>&nbsp;是阿里巴巴于2018年7月份新开源的项目，Nacos的主要愿景是期望通过提供易用的&nbsp;<code>动态服务发现</code>、<code>服务配置管理</code>、<code>服务共享与管理</code>&nbsp;的基础设施，帮助用户在云原生时代更好的构建、交付、管理自己的微服务平台。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562644065145-5f315c7d-b48a-453d-9718-20fb9121dd14.png#align=left&amp;display=inline&amp;height=374&amp;name=image.png&amp;originHeight=748&amp;originWidth=1722&amp;size=456424&amp;status=done&amp;width=861" alt="image.png" class="img_ev3q"></p><p>github项目地址在&nbsp;<a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">这里</a></p><a name="f26dbb6d"></a>## 更多与 Nacos 相关的开源项目信息<ul><li><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a></li><li><a href="https://github.com/dubbo/dubbo-registry-nacos" target="_blank" rel="noopener noreferrer">Dubbo Registry Nacos</a></li><li><a href="https://github.com/nacos-group/nacos-coredns-plugin" target="_blank" rel="noopener noreferrer">Nacos DNS-F</a></li><li><a href="https://github.com/nacos-group/nacos-docker" target="_blank" rel="noopener noreferrer">Nacos Docker</a></li><li><a href="https://github.com/nacos-group/nacos-spring-project" target="_blank" rel="noopener noreferrer">Nacos Spring Project</a></li><li><a href="https://github.com/nacos-group/nacos-spring-boot-project" target="_blank" rel="noopener noreferrer">Nacos Spring Boot</a></li><li><a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba</a></li><li><a href="http://dubbo.io/" target="_blank" rel="noopener noreferrer">Dubbo</a></li><li><a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">Sentinel</a></li><li><a href="https://projects.spring.io/spring-cloud/" target="_blank" rel="noopener noreferrer">Spring Cloud</a></li><li><a href="https://github.com/Nepxion/Discovery" target="_blank" rel="noopener noreferrer">Nepxion Discovery</a></li><li><a href="https://github.com/SpringCloud/spring-cloud-gateway-nacos" target="_blank" rel="noopener noreferrer">Spring Cloud Gateway Nacos</a></li></ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos GA后的整体规划]]></title>
            <link>https://nacos.io/en/blog/nacos-roadmap</link>
            <guid>https://nacos.io/en/blog/nacos-roadmap</guid>
            <pubDate>Mon, 08 Jul 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[根据Nacos既定的演进方向，以及在与社区进行充分的[讨论](https://github.com/alibaba/nacos/issues/1433)后，Nacos接下来的版本计划也浮出水面。]]></description>
            <content:encoded><![CDATA[<p>Nacos是阿里巴巴2018年开源的服务发现和配置管理项目，并于今年的4月10号GA，距今已经过去了快两个月时间了。Nacos GA代表着用户可以在生产环境上大规模使用，目前也已经有众多用户<a href="https://github.com/alibaba/nacos/issues/273" target="_blank" rel="noopener noreferrer">登记</a>使用。在GA之后，Nacos并未停下前进的脚步，不断的开发新的功能和优化用户体验。与此同时，Nacos倾听社区的声音，每一次迭代和发布都会包含用户关心的功能点。根据Nacos既定的演进方向，以及在与社区进行充分的<a href="https://github.com/alibaba/nacos/issues/1433" target="_blank" rel="noopener noreferrer">讨论</a>后，Nacos接下来的版本计划也浮出水面。Nacos在今年还将发布6到7个大版本，每个版本包含的重要特性如下：</p><a name="aq5sL"></a>#### 1.1.0<ul><li><strong>Go SDK发布：</strong> Go语言SDK</li><li><strong>地址服务器：</strong> 使用地址服务器模式进行Nacos服务端集群寻址</li><li><strong>灰度配置：</strong> 设置灰度的机器IP来进行配置的灰度发布<a name="MxxeU"></a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="120">1.2.0<a href="#120" class="hash-link" aria-label="Direct link to 1.2.0" title="Direct link to 1.2.0">​</a></h4><ul><li><strong>配置权限控制：</strong> 对配置的读写进行权限的控制，支持对接三方权限系统</li><li><strong>DNS协议，支持K8S服务域名解析：</strong> 通过支持DNS协议访问，无侵入的解决服务发现问题，并支持K8S域名解析</li><li><strong>Service Mesh打通：</strong> 对接开源流行的Service Mesh组件，支持作为服务发现后端和配置管理后端<a name="eqoii"></a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="130">1.3.0<a href="#130" class="hash-link" aria-label="Direct link to 1.3.0" title="Direct link to 1.3.0">​</a></h4><ul><li><strong>服务权限控制：</strong> 对服务的注册注销及查询进行权限的控制，支持对接三方权限系统</li><li><strong>Mysql依赖可替换为其他存储：</strong> 支持将MySQL依赖替换为Oracle等常见数据库系统依赖</li><li><strong>gRPC服务发现支持：</strong> 通过Go SDK和Java SDK支持gRPC和gRPC-java的服务注册与发现<a name="Czkv8"></a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="140">1.4.0<a href="#140" class="hash-link" aria-label="Direct link to 1.4.0" title="Direct link to 1.4.0">​</a></h4><ul><li><strong>配置加密：</strong> 敏感配置加密存储和传输，保证数据安全</li><li><strong>confd模式模板渲染：</strong> 支持将配置或者服务数据渲染到文件模板，适配异构系统</li><li><strong>健康检查SPI化，可以使用K8S健康检查：</strong> 支持使用Kubernetes自带的健康检查方式来检查服务实例的健康状态<a name="RFUj5"></a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="150">1.5.0<a href="#150" class="hash-link" aria-label="Direct link to 1.5.0" title="Direct link to 1.5.0">​</a></h4><ul><li><strong>配置发布审批：</strong> 配置发布管控体系，减少人为失误引起的故障</li><li><strong>IPv6支持：</strong> 支持在IPv6网络环境下进行服务的注册与发现和配置的管理</li><li><strong>长连接推送通道重构：</strong> 重构推送通道，提升SLA</li><li><strong>configMap对接：</strong> 和Kubernetes的配置进行打通<a name="lykZW"></a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="160">1.6.0<a href="#160" class="hash-link" aria-label="Direct link to 1.6.0" title="Direct link to 1.6.0">​</a></h4><ul><li><strong>Thrift服务发现：</strong> 支Thrift服务框架服务注册于发现</li><li><strong>支持Region、AZ等类似信息存储：</strong> 支持进行环境信息的注册，根据环境进行自定义访问策略</li><li><strong>运维命令行：</strong> 使用更简洁的方式，进行集群的运维</li><li><strong>打标支持，对接K8S label：</strong> 能够打自定义标签，能够理由Kubernetes的label进行负载均衡及灰度配置等<a name="qK0hH"></a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="170">1.7.0<a href="#170" class="hash-link" aria-label="Direct link to 1.7.0" title="Direct link to 1.7.0">​</a></h4><ul><li><strong>无状态化：</strong> 存储和计算分离，让系统本身无状态</li><li><strong>一致性协议抽象及Raft协议替换：</strong> 全新的Raft协议，支持替换</li></ul><a name="dbaJf"></a>### 增强现有功能，提供更多生产环境需求特性 目前用户集中反馈的需求有灰度配置、权限控制、发布审批等功能，这些特性我们都会在接下来的版本以最高优先级实现。这些特性基本上用户在以往的生产经验中都有所接触，这里不再做详细的介绍。<p>同时，为了最大化降低用户的部署运维成本，我们会先支持多种数据库的依赖，包括Oracle等数据库，这样可以让用户不需要为了使用Nacos再单独搭建一套MySQL集群。后面我们会更进一步，将外部数据库依赖彻底去除，支持Nacos完全使用本地存储。包括无状态化，也会在未来的版本支持，争取让用户以最低成本的方式运行Nacos。</p><a name="DHiVd"></a>### 与更多生态进行对接，形成联动优势，提升用户效率 一个产品的成功，往往是因为一个生态的成功。Nacos目前架构的优势之一，就是可以比较平滑的支持多个生态。目前已经支持的有Dubbo生态、Spring Cloud生态，而正在打通的有gRPC和Kubernetes，未来还计划支持Thrift等服务框架。我们的目标是用户无论在哪种生态下，都不需要为注册中心或者配置中心的选型烦恼。<a name="KyZiP"></a>### 云原生领域布局和组件打通 云原生是当前非常火热的一个概念。在CNCF、Pivotal等机构相继定义和大力推动云原生的背景下，用户对整个软件的生命周期管理都有了全新的认知。云原生是一个极具潜力的理念，Nacos也会在接下来的演进中对云原生做重点支持。<a name="fPVms"></a>### 内核升级，提升性能和稳定性 Nacos目前的内核，包括自建Raft、MySQL依赖，长轮询及UDP推送等，都会在接下来进行重新设计，目标是优化到最合理的架构，提升整体的性能和稳定性。]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos打通CMDB实现就近访问]]></title>
            <link>https://nacos.io/en/blog/cmdb</link>
            <guid>https://nacos.io/en/blog/cmdb</guid>
            <pubDate>Thu, 06 Jun 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[在服务进行多机房或者多地域部署时，跨地域的服务访问往往延迟较高，一个城市内的机房间的典型网络延迟在1ms左右，而跨城市的网络延迟，例如上海到北京大概为30ms。]]></description>
            <content:encoded><![CDATA[<p>CMDB在企业中，一般用于存放与机器设备、应用、服务等相关的元数据。一般当企业的机器及应用达到一定规模后就需要这样一个系统来存储和管理它们的元数据。有一些广泛使用的属性例如机器的IP、主机名、机房、应用、region等，这些数据一般会在机器部署时录入到CMDB，运维或者监控平台会使用这些数据进行展示或者相关的运维操作。</p><p>在服务进行多机房或者多地域部署时，跨地域的服务访问往往延迟较高，一个城市内的机房间的典型网络延迟在1ms左右，而跨城市的网络延迟，例如上海到北京大概为30ms。此时自然而然的一个想法就是能不能让服务消费者和服务提供者进行同地域访问。阿里巴巴集团内部很早就意识到了这样的需求，在内部的实践中，这样的需求是通过和CMDB打通来实现的。在服务发现组件中，对接CMDB，然后通过配置的访问规则，来实现服务消费者到服务提供者的同地域优先，这样的调用每天都在阿里巴巴集团内部大量执行。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15356/1544702277705-0bbfca60-6629-477c-92bb-1a690e68f9cd.png#align=left&amp;display=inline&amp;height=330&amp;originHeight=330&amp;originWidth=448&amp;status=done&amp;width=448" class="img_ev3q"><br>图1 服务的同地域优先访问</p><p>这实际上就是一种负载均衡策略，在Nacos的规划中，丰富的服务端的可配置负载均衡策略是我们的重要发展方向，这与当前已有的注册中心产品不太一样。在设计如何在开源的场景中，支持就近访问的时候，与企业自带的CMDB集成是我们考虑的一个核心问题。除此之外，我们也在考虑将Nacos自身扩展为一个实现基础功能的CMDB。无论如何，我们都需要能够从某个地方获取IP的环境信息，这些信息要么是从企业的CMDB中查询而来，要么是从自己内置的存储中查询而来。</p><a name="pwyxgn"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cmdb插件机制"><a href="https://yuque.alibaba-inc.com/nacos/opensource/uk8inc/edit#pwyxgn" target="_blank" rel="noopener noreferrer"></a>CMDB插件机制<a href="#cmdb插件机制" class="hash-link" aria-label="Direct link to cmdb插件机制" title="Direct link to cmdb插件机制">​</a></h2><p>先不考虑如何将CMDB的数据应用于负载均衡，我们需要首先在Nacos里将CMDB的数据通过某种方法获取。在实际使用中，基本上每个公司都会通过购买或者自研搭建自己的CMDB，那么为了能够解耦各个企业的CMDB具体实现，一个比较好的策略是使用SPI机制，约定CMDB的抽象调用接口，由各个企业添加自己的CMDB插件，无需任何代码上的重新构建，即可在运行状态下对接上企业的CMDB。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15356/1544842539697-cca20e3d-0f78-45b8-92b9-3b7559e838b2.png#align=left&amp;display=inline&amp;height=394&amp;originHeight=394&amp;originWidth=295&amp;status=done&amp;width=295" class="img_ev3q"><br>图2 Nacos CMDB SPI机制原理</p><p>如图2所示，Nacos定义了一个SPI接口，里面包含了与第三方CMDB约定的一些方法。用户依照约定实现了相应的SPI接口后，将实现打成jar包放置到Nacos安装目录下，重启Nacos即可让Nacos与CMDB的数据打通。整个流程并不复杂，但是理解CMDB SPI接口里方法和相应概念的含义不太简单。在这里对CMDB机制的相关概念和接口含义做一个详细说明。</p><a name="ga38al"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cmdb抽象概念"><a href="https://yuque.alibaba-inc.com/nacos/opensource/uk8inc/edit#ga38al" target="_blank" rel="noopener noreferrer"></a>CMDB抽象概念<a href="#cmdb抽象概念" class="hash-link" aria-label="Direct link to cmdb抽象概念" title="Direct link to cmdb抽象概念">​</a></h2><a name="d1gdtg"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="实体entity"><a href="https://yuque.alibaba-inc.com/nacos/opensource/uk8inc/edit#d1gdtg" target="_blank" rel="noopener noreferrer"></a>实体（Entity）<a href="#实体entity" class="hash-link" aria-label="Direct link to 实体entity" title="Direct link to 实体entity">​</a></h3><p>实体是作为CMDB里数据的承载方，在一般的CMDB中，一个实体可以指一个IP、应用或者服务。而这个实体会有很多属性，例如IP的机房信息，服务的版本信息等。</p><a name="hig8ag"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="实体类型entity-type"><a href="https://yuque.alibaba-inc.com/nacos/opensource/uk8inc/edit#hig8ag" target="_blank" rel="noopener noreferrer"></a>实体类型（Entity Type）<a href="#实体类型entity-type" class="hash-link" aria-label="Direct link to 实体类型entity-type" title="Direct link to 实体类型entity-type">​</a></h3><p>我们并不限定实体一定是IP、应用或者服务，这取决于实际的业务场景。Nacos有计划在未来支持不同的实体类型，不过就目前来说，服务发现需要的实体类型是IP。</p><a name="bm37ew"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="标签label"><a href="https://yuque.alibaba-inc.com/nacos/opensource/uk8inc/edit#bm37ew" target="_blank" rel="noopener noreferrer"></a>标签（Label）<a href="#标签label" class="hash-link" aria-label="Direct link to 标签label" title="Direct link to 标签label">​</a></h3><p>Label是我们抽象出的Entity属性，Label定义为一个描述Entity属性的K-V键值对。Label的key和value的取值范围一般都是预先定义好的，当需要对Label进行变更，如增加新的key或者value时，需要调用单独的接口并触发相应的事件。一个常见的Label的例子是IP的机房信息，我们认为机房（site）是Label的key，而机房的集合（site1, site2, site3）是Label的value，这个Label的定义就是：site: {site1, site2, site3}。</p><a name="1osqbb"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="实体事件entity-event"><a href="https://yuque.alibaba-inc.com/nacos/opensource/uk8inc/edit#1osqbb" target="_blank" rel="noopener noreferrer"></a>实体事件（Entity Event）<a href="#实体事件entity-event" class="hash-link" aria-label="Direct link to 实体事件entity-event" title="Direct link to 实体事件entity-event">​</a></h3><p>实体的标签的变更事件。当CMDB的实体属性发生变化，需要有一个事件机制来通知所有订阅方。为了保证实体事件携带的变更信息是最新准确的，这个事件里只会包含变更的实体的标识以及变更事件的类型，不会包含变更的标签的值。</p><a name="3vu8pv"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cmdb约定接口"><a href="https://yuque.alibaba-inc.com/nacos/opensource/uk8inc/edit#3vu8pv" target="_blank" rel="noopener noreferrer"></a>CMDB约定接口<a href="#cmdb约定接口" class="hash-link" aria-label="Direct link to cmdb约定接口" title="Direct link to cmdb约定接口">​</a></h2><p>在设计与CMDB交互接口的时候，我们参考了内部对CMDB的访问接口，并与若干个外部客户进行了讨论。我们最终确定了以下要求第三方CMDB插件必须实现的接口：</p><a name="hc8tsu"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="获取标签列表"><a href="https://yuque.alibaba-inc.com/nacos/opensource/uk8inc/edit#hc8tsu" target="_blank" rel="noopener noreferrer"></a>获取标签列表<a href="#获取标签列表" class="hash-link" aria-label="Direct link to 获取标签列表" title="Direct link to 获取标签列表">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Set&lt;String&gt; getLabelNames();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个方法将返回CMDB中需要被Nacos识别的标签名集合，CMDB插件可以按需决定返回什么标签个Nacos。不在这个集合的标签将会被Nacos忽略，即使这个标签出现在实体的属性里。我们允许这个集合会在运行时动态变化，Nacos会定时去调用这个接口刷新标签集合。</p><a name="2v2vks"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="获取实体类型"><a href="https://yuque.alibaba-inc.com/nacos/opensource/uk8inc/edit#2v2vks" target="_blank" rel="noopener noreferrer"></a>获取实体类型<a href="#获取实体类型" class="hash-link" aria-label="Direct link to 获取实体类型" title="Direct link to 获取实体类型">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Set&lt;String&gt; getEntityTypes();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>获取CMDB里的实体的类型集合，不在这个集合的实体类型会被Nacos忽略。服务发现模块目前需要的实体类似是ip，如果想要通过打通CMDB数据来实现服务的高级负载均衡，请务必在返回集合里包含“ip”。</p><a name="sw9ryi"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="获取标签详情"><a href="https://yuque.alibaba-inc.com/nacos/opensource/uk8inc/edit#sw9ryi" target="_blank" rel="noopener noreferrer"></a>获取标签详情<a href="#获取标签详情" class="hash-link" aria-label="Direct link to 获取标签详情" title="Direct link to 获取标签详情">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Label getLabel(String labelName);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>获取标签的详细信息。返回的Label类里包含标签的名字和标签值的集合。如果某个实体的这个标签的值不在标签值集合里，将会被视为无效。</p><a name="va70wg"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="查询实体的标签值"><a href="https://yuque.alibaba-inc.com/nacos/opensource/uk8inc/edit#va70wg" target="_blank" rel="noopener noreferrer"></a>查询实体的标签值<a href="#查询实体的标签值" class="hash-link" aria-label="Direct link to 查询实体的标签值" title="Direct link to 查询实体的标签值">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">String getLabelValue(String entityName, String entityType, String labelName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String getLabelValues(String entityName, String entityType);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里包含两个方法，一个是获取实体某一个标签名对应的值，一个是获取实体所有标签的键值对。参数里包含实体的值和实体的类型。注意，这个方法并不会在每次在Nacos内部触发查询时去调用，Nacos内部有一个CMDB数据的缓存，只有当这个缓存失效或者不存在时，才会去访问CMDB插件查询数据。为了让CMDB插件的实现尽量简单，我们在Nacos内部实现了相应的缓存和刷新逻辑。</p><a name="byohax"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="查询实体"><a href="https://yuque.alibaba-inc.com/nacos/opensource/uk8inc/edit#byohax" target="_blank" rel="noopener noreferrer"></a>查询实体<a href="#查询实体" class="hash-link" aria-label="Direct link to 查询实体" title="Direct link to 查询实体">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">String getAllEntities();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Entity getEntity(String entityName, String entityType);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查询实体包含两个方法：查询所有实体和查询单个实体。查询单个实体目前其实就是查询这个实体的所有标签，不过我们将这个方法与获取所有标签的方法区分开来，因为查询单个实体方法后面可能会进行扩展，比查询所有标签获取的信息要更多。</p><p>查询所有实体则是一次性将CMDB的所有数据拉取过来，该方法可能会比较消耗性能，无论是对于Nacos还是CMDB。Nacos内部调用该方法的策略是通过可配置的定时任务周期来定时拉取所有数据，在实现该CMDB插件时，也请关注CMDB服务本身的性能，采取合适的策略。</p><a name="tgn5ut"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="查询实体事件"><a href="https://yuque.alibaba-inc.com/nacos/opensource/uk8inc/edit#tgn5ut" target="_blank" rel="noopener noreferrer"></a>查询实体事件<a href="#查询实体事件" class="hash-link" aria-label="Direct link to 查询实体事件" title="Direct link to 查询实体事件">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;EntityEvent&gt; getEntityEvents(long timestamp);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个方法意在获取最近一段时间内实体的变更消息，增量的去拉取变更的实体。因为Nacos不会实时去访问CMDB插件查询实体，需要这个拉取事件的方法来获取实体的更新。参数里的timestamp为上一次拉取事件的时间，CMDB插件可以选择使用或者忽略这个参数。</p><a name="p7g6dw"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cmdb插件开发流程"><a href="https://yuque.alibaba-inc.com/nacos/opensource/uk8inc/edit#p7g6dw" target="_blank" rel="noopener noreferrer"></a>CMDB插件开发流程<a href="#cmdb插件开发流程" class="hash-link" aria-label="Direct link to cmdb插件开发流程" title="Direct link to cmdb插件开发流程">​</a></h2><p>参考&nbsp;<a href="https://github.com/nacos-group/nacos-examples" target="_blank" rel="noopener noreferrer">https://github.com/nacos-group/nacos-examples</a>，这里已经给出了一个示例plugin实现。<br>具体步骤如下：</p><ol><li>新建一个maven工程，引入依赖nacos-api:</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;artifactId&gt;nacos-api&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;version&gt;0.7.0&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>引入打包插件：</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;plugin&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;configuration&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &lt;descriptorRefs&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &lt;/descriptorRefs&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;/configuration&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;/plugin&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>定义实现类，继承com.alibaba.nacos.api.cmdb.CmdbService，并实现相关方法。<br><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15356/1543916500193-213df77a-096d-4fd9-a283-85241a856fbf.png#align=left&amp;display=inline&amp;height=116&amp;originHeight=116&amp;originWidth=585&amp;status=done&amp;width=585" class="img_ev3q"><br></li><li>在src/main/resource/目录下新建目录：META-INF/services<br><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15356/1543916595978-fd322205-16c1-4a95-9cdc-4a6292ee3b66.png#align=left&amp;display=inline&amp;height=96&amp;originHeight=96&amp;originWidth=379&amp;status=done&amp;width=379" class="img_ev3q"><br></li><li>在src/main/resources/META-INF/services目录下新建文件com.alibaba.nacos.api.cmdb.CmdbService，并在文件里将第三步中创建的实现类全名写入该文件:<br><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15356/1545036650034-75d11aee-8738-485f-9426-52e560b059cd.png#align=left&amp;display=inline&amp;height=136&amp;originHeight=178&amp;originWidth=944&amp;status=done&amp;width=719" class="img_ev3q"><br></li><li>代码自测完成后，执行命令进行打包：</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mvn package assembly:single -Dmaven.test.skip=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="7"><li>将target目录下的包含依赖的jar包上传到nacos CMDB插件目录：</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{nacos.home}/plugins/cmdb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="8"><li>在nacos的application.properties里打开加载插件开关：</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nacos.cmdb.loadDataAtStart=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="9"><li>重启nacos Server，即可加载到您实现的nacos-cmdb插件获取您的CMDB数据。<br></li></ol><a name="5mpctx"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用selector实现同机房优先访问"><a href="https://yuque.alibaba-inc.com/nacos/opensource/uk8inc/edit#5mpctx" target="_blank" rel="noopener noreferrer"></a>使用Selector实现同机房优先访问<a href="#使用selector实现同机房优先访问" class="hash-link" aria-label="Direct link to 使用selector实现同机房优先访问" title="Direct link to 使用selector实现同机房优先访问">​</a></h2><p>在拿到CMDB的数据之后，就可以运用CMDB数据的强大威力来实现多种灵活的负载均衡策略了，下面举例来说明如何使用CMDB数据和Selector来实现就近访问。</p><p>假设目前Nacos已经通过CMDB拿到了一些IP的机房信息，且它们对应的标签信息如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">11.11.11.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    site: x11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">22.22.22.22</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    site: x12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">33.33.33.33</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    site: x11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">44.44.44.44</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    site: x12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">55.55.55.55</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    site: x13</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>11.11.11.11、22.22.22.22、33.33.33.33、44.44.44.44和55.55.55.55.55都包含了标签site，且它们对应的值分别为x11、x12、x11、x12、x13。我们先注册一个服务，下面挂载IP11.11.11.11和22.22.22.22。<br><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15356/1545035855381-5d9dcfad-75ab-43ad-a084-8ae4a65f914c.png#align=left&amp;display=inline&amp;height=307&amp;originHeight=516&amp;originWidth=1254&amp;status=done&amp;width=747" class="img_ev3q"><br>图3 服务详情</p><p>然后我们修改服务的“服务路由类型”，并配置为基于同site优先的服务路由：<br><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15356/1545035973200-497c0649-b652-4c36-bf6c-7cddfc5b75c6.png#align=left&amp;display=inline&amp;height=499&amp;originHeight=499&amp;originWidth=610&amp;status=done&amp;width=610" class="img_ev3q"><br>图4 编辑服务路由类型</p><p>这里我们将服务路由类型选择为标签，然后输入标签的表达式：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CONSUMER.label.site = PROVIDER.label.site</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个表达式的格式和我们抽象的Selector机制有关，具体将会在另外一篇文章中介绍。在这里您需要记住的就是，任何一个如下格式的表达式：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CONSUMER.label.labelName = PROVIDER.label.labelName</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>将能够实现基于同labelName优先的负载均衡策略。</p><p>然后假设服务消费者的IP分别为33.33.33.33、44.44.44.44和55.55.55.55，它们在使用如下接口查询服务实例列表：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">naming.selectInstances("nacos.test.1", true)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>那么不同的消费者，将获取到不同的实例列表。33.33.33.33获取到11.11.11.11，44.44.44.44将获取到22.22.22.22，而55.55.55.55将同时获取到11.11.11.11和22.22.22.22。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[阿里巴巴基于 Nacos 实现环境隔离的实践]]></title>
            <link>https://nacos.io/en/blog/address-server</link>
            <guid>https://nacos.io/en/blog/address-server</guid>
            <pubDate>Wed, 05 Jun 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[说到环境隔离，首先应该搞清楚什么环境。 环境这个词目前还没有一个比较统一的定义，有些公司叫环境，在阿里云上叫region，在kubernetes架构中叫namespace等等。]]></description>
            <content:encoded><![CDATA[<p>随着Nacos 0.8版本的release，Nacos离正式生产版本又近了一步（其实已经有不少企业已经上了生产，如虎牙）。一般而言，企业研发的流程一般是这样的：先在测试环境开发和测试功能，然后再灰度，最后发布到生产环境。并且，为了生产环境的稳定，测试环境需要跟生产环境隔离；必然要遇到一个问题：多环境问题，即多个环境的数据（如测试环境和生产环境）如何隔离？如何优雅的隔离（不需要用户做任何改动）。下文将就Nacos环境隔离问题，向大家介绍阿里在这方面的实践经验。</p><a name="d0eabe32"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是环境">什么是环境？<a href="#什么是环境" class="hash-link" aria-label="Direct link to 什么是环境？" title="Direct link to 什么是环境？">​</a></h2><p>说到环境隔离，首先应该搞清楚什么环境。 环境这个词目前还没有一个比较统一的定义，有些公司叫环境，在阿里云上叫region，在kubernetes架构中叫namespace等等。本文认为，环境是逻辑上或物理上独立的一整套系统，这套系统中包含了处理用户请求的全部组件（网关、服务框架、微服务注册中心、配置中心、消息系统、缓存、数据库等），可以处理指定类别的请求。举个栗子，很多网站都会有用户id的概念，可以按照用户id划分，用户id以偶数结尾的请求全部由一套系统处理，而奇数结尾的请求由另一套系统处理。如下图所示。 我们这里说的环境隔离是指物理隔离，即不同环境是指不同的机器集群。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1559699207043-bff71a91-b187-489e-a3c4-79322913fd54.png#alt=undefined" class="img_ev3q"></p><a name="efec68f6"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="环境隔离有什么用">环境隔离有什么用<a href="#环境隔离有什么用" class="hash-link" aria-label="Direct link to 环境隔离有什么用" title="Direct link to 环境隔离有什么用">​</a></h2><p>上一节定义了环境的概念，即一套包含了处理用户请求全部必要组件的系统，用来处理指定类别的请求。本节跟大家讨论一下环境隔离有哪些好处。从概念的定义可以看出，环境隔离至少有三个方面的好处：故障隔离、故障恢复、灰度测试；</p><a name="dbbde2aa"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="故障隔离">故障隔离<a href="#故障隔离" class="hash-link" aria-label="Direct link to 故障隔离" title="Direct link to 故障隔离">​</a></h3><p>首先，因为环境是能够处理用户请求的独立组件单元，也就是说用户请求的处理链路有多长，都不会跳出指定的机器集群。即使这部分机器故障了，也只是会影响部分用户，从而把故障隔离在指定的范围内。如果我们按照用户id把全部机器分为十个环境，那么一个环境出问题，对用户的影响会降低为十分之一，大大提高系统可用性。</p><a name="e443c432"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="故障恢复">故障恢复<a href="#故障恢复" class="hash-link" aria-label="Direct link to 故障恢复" title="Direct link to 故障恢复">​</a></h3><p>环境隔离的另一个重要优势是可以快速恢复故障。当某个环境的服务出现问题之后，可以快速通过下发配置，改变用户请求的路由方向，把请求路由到另一套环境，实现秒级故障恢复。当然，这需要一个强大的分布式系统支持，尤其是一个强大的配置中心（如Nacos），需要快速把路由规则配置数据推送到全网的应用进程。</p><a name="385e0b0a"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="灰度测试">灰度测试<a href="#灰度测试" class="hash-link" aria-label="Direct link to 灰度测试" title="Direct link to 灰度测试">​</a></h3><p>灰度测试是研发流程中不可或缺的一个环节。传统的研发流程中，测试和灰度环节，需要测试同学做各种各样的配置，如绑定host、配置jvm参数、环境变量等等，比较麻烦。经过多年的实践，阿里巴巴内部的测试和灰度对开发和测试非常友好，通过环境隔离功能来保证请求在指定的机器集群处理，开发和测试不需要做任何做任何配置，大大提高了研发效率。</p><a name="37555cc2"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos如何做环境隔离">Nacos如何做环境隔离<a href="#nacos如何做环境隔离" class="hash-link" aria-label="Direct link to Nacos如何做环境隔离" title="Direct link to Nacos如何做环境隔离">​</a></h2><p>前面两节讲到了环境的概念、环境隔离有哪些作用，本节将向大家介绍如何把Nacos按照前面的思路隔离成多个环境。Nacos脱胎于阿里巴巴中间件部门的软负载小组，在环境隔离方面我们有多年的经验。下面简单介绍下把Nacos隔离为多个物理集群，nacos客户端不需要做任何代码改动即可实现环境自动路由。</p><a name="b6724cff"></a>### 原理<p>在开始前，我们先做一些约束：</p><ul><li>一台机器上部署的应用都在一个环境内；</li><li>一个应用进程内默认情况下只连一个环境的Nacos；</li><li>通过某种手段可以拿到客户端所在机器ip；</li><li>用户对机器的网段有规划；</li></ul><p>下面简单介绍一下基本原理：</p><ul><li>我们知道网络中32位的ipv4可以划分为很多网段，如192.168.1.0/24这种，并且一般稍大型的公司都会有网段规划，按照一定的用途划分网段。我们可以利用这个原理做环境隔离，即不同网段的IP属于不同的环境，如192.168.1.0/24属于环境A， 192.168.2.0/24属于环境B等。</li><li>使用过Nacos的应该知道，有两种方式初始化Nacos客户端实例，一种是直接告诉客户端nacos服务端的IP；另一种是告诉客户端一个endpoint，客户端通过HTTP请求到endpoint查询nacos服务端IP列表。我们利用Nacos第二种初始化方式。</li><li>增强endpoint的功能。在endpoint端配置网段和环境的映射关系，endpoint在接收到客户端的请求之后，根据客户端的来源IP所属网段，计算出该客户端所属环境，然后找到对应环境的IP列表返回给客户端。如下图<img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1559699221719-b127d968-2374-4fad-b433-733f47642bf0.png#alt=undefined" class="img_ev3q"></li></ul><a name="f172b185"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一个环境隔离server的示例">一个环境隔离server的示例<a href="#一个环境隔离server的示例" class="hash-link" aria-label="Direct link to 一个环境隔离server的示例" title="Direct link to 一个环境隔离server的示例">​</a></h2><p>上面讲了基于IP段做环境隔离的约束和基本原理，那么如何实现一个地址服务器呢。最简单的方法是基于nginx实现，利用nginx的geo模块，做IP端和环境的映射，然后利用nginx返回静态文件内容。</p><ul><li>安装nginx <a href="http://nginx.org/en/docs/install.html" target="_blank" rel="noopener noreferrer">http://nginx.org/en/docs/install.html</a></li><li>在nginx-proxy.conf中配置geo映射，<a href="http://nginx.org/en/docs/http/ngx_http_geo_module.html" target="_blank" rel="noopener noreferrer">参考这里</a></li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">geo $env {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default        "";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  192.168.1.0/24 -env-a;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  192.168.2.0/24 -env-b;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>配置nginx根路径及转发规则，这里只需要简单的返回静态文件的内容；</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 在http模块中配置根路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root                    /tmp/htdocs;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 在server模块中配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rewrite ^(.*)$  /$1$env break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>配置Nacos服务端IP列表配置文件，在/tmp/hotdocs/nacos目录下配置以环境名结尾的文件，文件内容为IP，一行一个</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ll /tmp/hotdocs/nacos/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r-- 1 user1 users 0 Mar  5 08:53 serverlist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r-- 1 user1 users 0 Mar  5 08:53 serverlist-env-a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r-- 1 user1 users 0 Mar  5 08:53 serverlist-env-b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$cat /tmp/hotdocs/nacos/serverlist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.1.3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>验证</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl 'localhost:8080/nacos/serverlist'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.1.3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>至此， 一个简单的根据IP网段做环境隔离的示例已经可以工作了，不同网段的nacos客户端会自动获取到不同的Nacos服务端IP列表，实现环境隔离。这种方法的好处是用户不需要配置任何参数，各个环境的代码和配置是一样的，但需要提供底层服务的同学做好网络规划和相关配置。</p><a name="25f9c7fa"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2><p>本文简单介绍了环境隔离的概念，环境隔离的三个好处以及Nacos如何基于网段做环境隔离。最后，给出了一个基于nginx做endpoint服务端的环境隔离配置示例。本文只是列出了一种可行的方法，不排除有更优雅的实现方法，如果大家有更好的方法可以看到nacos社区或<a href="https://nacos.io" target="_blank" rel="noopener noreferrer">官网</a>贡献方案。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos 1.0.0 发布，正式大规模生产可用]]></title>
            <link>https://nacos.io/en/blog/nacos1.0.0</link>
            <guid>https://nacos.io/en/blog/nacos1.0.0</guid>
            <pubDate>Wed, 10 Apr 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos 1.0.0是正式GA的版本，在架构、功能和API设计上进行了全方位的重构和升级，在经过3个RC版本的社区体验之后正式发布，1.0.0版本标志着Nacos已经可以大规模在生产环境使用。]]></description>
            <content:encoded><![CDATA[<p>经过 3 个 RC 版本的社区体验之后，Nacos 正式发布 1.0.0 GA 版本，在架构、功能和 API 设计上进行了全方位的重构和升级。</p><p>1.0.0 版本的发布标志着 Nacos 已经可以大规模地生产环境中使用，新版本不仅针对社区的需求和集群的稳定性相应地增加了一些新特性，而且还发布了服务发现模块的性能测试报告，以及完整的 API 列表和架构设计文档。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-演进历程">Nacos 演进历程<a href="#nacos-演进历程" class="hash-link" aria-label="Direct link to Nacos 演进历程" title="Direct link to Nacos 演进历程">​</a></h2><p>Nacos 自 2018 年 7 月份开源以来，有赖于社区的大力关注和参与，在不到一年的时间里，已经演进了 10+ 个版本。同时也有很多企业客户一直都使用 Nacos 作为生产环境的注册中心和配置中心。</p><p>Nacos 源于阿里巴巴内部近十年的生产环境打磨的核心中间件，在开源之前就支撑着双十一等大型业务场景。Nacos 开源不仅是为了丰富整个微服务生态，也是为了打造一款真正能够应对大规模、高并发和复杂环境下复杂需求的生产级服务注册中心和配置管理平台。在 1.0.0  GA 版本发布之际，在此回顾一下 Nacos 的演进历程：</p><ul><li><p>2018.07.20 - Nacos 0.1.0：支持基本的服务发现功能和配置管理功能。</p></li><li><p>2018.09.15 - Nacos 0.2.0：正式支持 SpringCloud 生态。</p></li><li><p>2018.10.26 - Nacos 0.3.0：提供控制台界面。</p></li><li><p>2018.11.19 - Nacos 0.5.0：开源 DNS-F，支持 DNS 协议服务发现。</p></li><li><p>2018.12.06 - Nacos 0.6.0：正式支持 Dubbo 客户端注册服务，支持 K8S 部署。</p></li><li><p>2018.12.18 - Nacos 0.7.0：支持 CMDB 元数据管理，支持 Node.js 客户端。</p></li><li><p>2019.01.22 - Nacos 0.8.0：PRE-GA 支持控制台账号登录，支持命名空间，Nacos-Sync 打通 Eureka 和 Zookeeper。</p></li><li><p>2019.04.10 - Nacos 1.0.0 GA ：同时支持 AP 和 CP 一致性，发布压测报告，稳定性加强和体验优化。</p></li></ul><h1><strong>Nacos 1.0.0 新增的特性</strong></h1><h3 class="anchor anchorWithStickyNavbar_LWe7" id="注册实例支持ephemeral字段">注册实例支持ephemeral字段<a href="#注册实例支持ephemeral字段" class="hash-link" aria-label="Direct link to 注册实例支持ephemeral字段" title="Direct link to 注册实例支持ephemeral字段">​</a></h3><p>Nacos 1.0.0 版本在 instance 级别上增加了一个ephemeral字段，该字段表示注册的实例是临时实例还是持久化实例。如果是临时实例，则不会在Nacos服务端持久化存储，需要通过上报心跳的方式进行保活，如果一段时间内没有上报心跳，则会被Nacos服务端摘除。在被摘除后如果又开始上报心跳，则会重新将这个实例注册。持久化实例则会持久化到Nacos服务端，此时即使注册实例的客户端进程不在，这个实例也不会从服务端删除，只会将健康状态设为不健康。</p><p><img loading="lazy" src="https://img.alicdn.com/tfs/TB1Yq_2RNjaK1RjSZFAXXbdLFXa-525-595.png" class="img_ev3q"></p><p>同一个服务下可以同时有临时实例和持久化实例，这意味着当这服务的所有实例进程不在时，会有部分实例从服务上摘除，剩下的实例则会保留在服务下。</p><p>由于老版本客户端注册实例时不会上传 ephemeral 字段，需要在 Nacos 服务端设置一个默认的 ephemeral 值。Nacos 1.0.0 里 ephemeral 的默认值为 true，即老版本客户端默认注册的是临时实例。如果需要让老客户端注册的实例类型是持久化实例，可以设置开关：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X PUT '$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=defaultInstanceEphemeral&amp;value=false'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意事项：当从老版本Nacos升级到Nacos 1.0.0时，从磁盘加载的实例数据会被置为持久化实例。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="注册实例支持-groupname-字段">注册实例支持 groupName 字段<a href="#注册实例支持-groupname-字段" class="hash-link" aria-label="Direct link to 注册实例支持 groupName 字段" title="Direct link to 注册实例支持 groupName 字段">​</a></h3><p>客户端注册实例时，可以在方法级别指定要注册的分组名，这个分组名和服务名是对服务的一个二维的标识，二者共同定位一个服务。一个典型的使用分组的例子如下：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namingService.registerInstance("nacos.test.1", "group1", instance);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>不指定分组的接口依然是支持的，此时会在服务端为这个服务分配一个默认的分组：DEFAULT_GROUP。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="增加了server状态的设置">增加了Server状态的设置<a href="#增加了server状态的设置" class="hash-link" aria-label="Direct link to 增加了Server状态的设置" title="Direct link to 增加了Server状态的设置">​</a></h3><p>Nacos 增加了对 Server 状态的控制，所有的状态都定义在 com.alibaba.nacos.naming.cluster.ServerStatus</p><p>类里。</p><p><img loading="lazy" src="https://img.alicdn.com/tfs/TB13uYWRMHqK1RjSZJnXXbNLpXa-596-408.png" class="img_ev3q"></p><p>各个状态的含义介绍如下：</p><ul><li>UP：Server 一切正常，读写请求都会被接受；</li><li>DOWN：Server 异常，所有请求会返回 HTTP 503 错误；</li><li>STARTING：Server 还在启动中，所有请求返回 HTTP 503 错误；</li><li>PAUSED：Server 被人工暂停，区别于 DOWN 可能是系统自己检测到异常然后设置 DOWN 状态，PAUSED 状态表示当前 Server 可能是没问题的，只是人工进行了干预；</li><li>WRITE_ONLY：只有非 GET 请求会被接受；</li><li>READ_ONLY：只有 GET 请求会被接受；</li></ul><p>用户可以使用如下接口来修改集群所有机器的状态，如果再加上 debug=true 参数，则只修改当前机器的状态。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X PUT '$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=overriddenServerStatus&amp;value=READ_ONLY'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>同时这个状态是会自适应进行修改的，比如启动时这个状态为 STARTING，等到数据装载完毕，则会自动将状态置为 UP，在运行过程中，如果检测到系统异常如磁盘满，则又会将状态置为 DOWN。不过自适应的状态值优先级要低于使用接口设置的状态值，因此当你想恢复自适应的状态调节的时候，记得将接口 overriddenServerStatus 设置为空。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="增加全局推送开关">增加全局推送开关<a href="#增加全局推送开关" class="hash-link" aria-label="Direct link to 增加全局推送开关" title="Direct link to 增加全局推送开关">​</a></h3><p>支持了全局推送开关，可以打开或者关闭服务变更的推送，调用接口如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -X PUT '$NACOS_SERVER:8848/nacos/v1/ns/operator/switches?entry=pushEnabled&amp;value=false'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>关闭推送后，客户端依然会通过轮询的方式来更新到数据，只是更新的速度没有推送那么快。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="支持启动时数据预热">支持启动时数据预热<a href="#支持启动时数据预热" class="hash-link" aria-label="Direct link to 支持启动时数据预热" title="Direct link to 支持启动时数据预热">​</a></h3><p>在老版本的 Nacos 中，只要 Server 启动成功就会开始对外提供服务，此时服务的数据并不一定完全加载完成，这样可能会导致客户端接收到的数据并不完整。1.0.0 版本增加了数据预热的逻辑，对于持久化数据，则会等待所有数据从磁盘加载完成；对于临时实例这样的非持久化数据，则会等待从其他Server拉取到完整数据。所有数据都准备好之后，才会将 Server 状态置为 UP。</p><p>注意事项：</p><p>对于临时实例的预热，实现机制是 Server 在启动时会从其他Server节点拉取数据，拉取成功则启动成功。但是当从老版本 Server 升级到 1.0.0 时，由于这个拉取全量数据的接口在老版本 Server 中不存在，那么第一个升级的机器将无法拉到任何数据，从而后面升级的机器也无法从第一个升级的机器拉取到数据。此时建议使用调用 API 将 Server 的运行状态设置为 WRITE_ONLY，允许客户端数据逐步汇聚补偿上来，但是要阻止任何查询的流量，直到集群数据准备好以后，再将这个运行状态清空，集群自动调整运行状态，最后就会提供完整服务。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="元数据编辑框优化">元数据编辑框优化<a href="#元数据编辑框优化" class="hash-link" aria-label="Direct link to 元数据编辑框优化" title="Direct link to 元数据编辑框优化">​</a></h3><p>此前的元数据编辑框需要用户按照指定格式来编辑，容易出错，如下图所示：</p><p><img loading="lazy" src="https://img.alicdn.com/tfs/TB1VgDQRNTpK1RjSZFMXXbG_VXa-602-392.png" class="img_ev3q"></p><p>1.0.0 版本对服务页面的元数据编辑框进行了优化，在调整编辑框大小的同时，增加语法高亮，方便用户进行编辑和识别格式问题，编辑框预览图如下：<img loading="lazy" src="https://img.alicdn.com/tfs/TB1nwL3RIfpK1RjSZFOXXa6nFXa-552-149.png" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="支持-mysql-80">支持 MySQL 8.0<a href="#支持-mysql-80" class="hash-link" aria-label="Direct link to 支持 MySQL 8.0" title="Direct link to 支持 MySQL 8.0">​</a></h3><p>Nacos 1.0.0 支持了 MySQL 8.0 驱动。您只需要将8.0版本的驱动jar包放置在{nacos.home}/plugins/mysql/下即可，不需要其他改动。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-100-实现大规模生产可用">Nacos 1.0.0 实现大规模生产可用<a href="#nacos-100-实现大规模生产可用" class="hash-link" aria-label="Direct link to Nacos 1.0.0 实现大规模生产可用" title="Direct link to Nacos 1.0.0 实现大规模生产可用">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="api-完整列表开放模型和架构设计文档更新">API 完整列表开放，模型和架构设计文档更新<a href="#api-完整列表开放模型和架构设计文档更新" class="hash-link" aria-label="Direct link to API 完整列表开放，模型和架构设计文档更新" title="Direct link to API 完整列表开放，模型和架构设计文档更新">​</a></h3><p>服务发现和配置管理的完整 API 列表会发布到官网</p><p><em>地址：<a href="https://nacos.io/zh-cn/docs/open-API.html" target="_blank" rel="noopener noreferrer">https://nacos.io/zh-cn/docs/open-API.html</a></em></p><p>除了核心功能外，也包含部分运维接口，方便开发者进行集成。同时对于 Nacos 的数据模型、集群模型、架构设计及模块设计文档进行了更新</p><p><em>地址：<a href="https://nacos.io/zh-cn/docs/architecture.html" target="_blank" rel="noopener noreferrer">https://nacos.io/zh-cn/docs/architecture.html</a></em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="性能测试报告发布">性能测试报告发布<a href="#性能测试报告发布" class="hash-link" aria-label="Direct link to 性能测试报告发布" title="Direct link to 性能测试报告发布">​</a></h3><p>Nacos 1.0.0 进行了性能测试，针对服务发现和配置管理的读写能力进行了大规模场景的压力测试。目前得到的测试数据是：</p><ul><li><p>容量：服务实例数 100 万+，配置数 100 万+，支持客户端连接 100 万+；</p></li><li><p>读写TPS：1 万+；</p></li><li><p>节点扩展能力：100 节点+；</p></li><li><p>推送能力：1 万客户端订阅同一配置/服务，3 秒内收到变更通知比例 99.9%；</p></li></ul><p>目前压测报告已经更新到官网：</p><p><em>https:**//nacos.io/zh-cn/docs/nacos-naming-benchmark.html</em></p><p><em>https:**//nacos.io/zh-cn/docs/nacos-config-benchmark.html</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="100-企业用户已经上线生产环境">100+ 企业用户已经上线生产环境<a href="#100-企业用户已经上线生产环境" class="hash-link" aria-label="Direct link to 100+ 企业用户已经上线生产环境" title="Direct link to 100+ 企业用户已经上线生产环境">​</a></h3><p>目前 Nacos 作为服务发现和配置中心已经有 100 多个用户的生产环境中服役，包含阿里巴巴、<em>虎牙</em> 等企业已经将 Nacos 大规模应用在核心业务场景中。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="升级建议">升级建议<a href="#升级建议" class="hash-link" aria-label="Direct link to 升级建议" title="Direct link to 升级建议">​</a></h3><p>Nacos 1.0.0 服务端个别接口与 0.8.0 以前的版本不兼容，0.8.0之前版本需要先升级到0.8.0，再升级到1.0.0。对客户端而言，Nacos 1.0.0 兼容 0.5.0 及以上的版本的客户端访问。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="如何共建"><strong>如何共建</strong><a href="#如何共建" class="hash-link" aria-label="Direct link to 如何共建" title="Direct link to 如何共建">​</a></h3><hr><ol><li><p>如果您在文档中发现拼写错误，在代码中发现错误，想要新功能或想要提供建议，您可以在GitHub上创建一个 issues</p><p><em>地址：<a href="https://github.com/alibaba/Nacos/issues/new" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/Nacos/issues/new</a></em></p></li><li><p>或者可以选择 GitHub 仓库中有以下标签的 issues 入手：</p></li></ol><ul><li>good first issue：对于新手来说是非常好的入门 issues。</li><li>contribution welcome：亟待解决的问题和非常重要的模块，但目前缺少贡献者，欢迎贡献者来贡献。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="img-感谢贡献者们"><strong><img loading="lazy" src="https://res.wx.qq.com/mpres/htmledition/images/icon/common/emotion_panel/smiley/smiley_66.png?tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="img" class="img_ev3q"> 感谢贡献者们</strong><a href="#img-感谢贡献者们" class="hash-link" aria-label="Direct link to img-感谢贡献者们" title="Direct link to img-感谢贡献者们">​</a></h2><p>Nacos 开发团队正在日益壮大，从最开始的只有 4 个代码 Contributor，发展到目前的 40 多个。在 1.0.0 版本的开发中，社区同学贡献了很大的力量，在此表示感谢，他们是（排序不分先后）：</p><p><em>yanlinly、xuechaos、hxy1991、jifengnan、nkorange、neatlife、loadchange、TsingLiang、jameslcj、duansheli、pbting、mingyixu、paderlol、nanamikon</em> 等。</p><p><img loading="lazy" src="https://img.alicdn.com/tfs/TB1vmOsQb2pK1RjSZFsXXaNlXXa-1716-888.png" alt="img" class="img_ev3q"></p><blockquote><p>DISS is cheap, show me your hand 比吐槽更重要的是搭把手，参与社区一起发展Nacos</p></blockquote><p>扫码进群，现在就加入我们。<img loading="lazy" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img" class="img_ev3q"></p><p><img loading="lazy" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img" class="img_ev3q"></p><p><strong>新人时刻 - 什么是 Nacos ？</strong></p><hr><p><strong>Nacos</strong> 是阿里巴巴于 2018 年 7 月份新开源的项目，Nacos 的主要愿景是期望通过提供易用的 动态服务发现、 服务配置管理、 服务共享与管理的基础设施，帮助用户在云原生时代更好的构建、交付、管理自己的微服务平台。</p><p><img loading="lazy" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img" class="img_ev3q"></p><p><strong>与 Nacos 相关的开源项目</strong></p><p><strong><em>Nacos（点击“阅读原文”可进入）</em></strong></p><p><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos</a></p><p><strong><em>Dubbo Registry Nacos</em></strong></p><p><a href="https://github.com/dubbo/dubbo-registry-nacos" target="_blank" rel="noopener noreferrer">https://github.com/dubbo/dubbo-registry-nacos</a></p><p><strong><em>Nacos DNS-F</em></strong></p><p><a href="https://github.com/nacos-group/nacos-coredns-plugin" target="_blank" rel="noopener noreferrer">https://github.com/nacos-group/nacos-coredns-plugin</a></p><p><strong><em>Nacos Spring Project</em></strong></p><p><a href="https://github.com/nacos-group/nacos-spring-project" target="_blank" rel="noopener noreferrer">https://github.com/nacos-group/nacos-spring-project</a></p><p><strong><em>Nacos Spring Boot</em></strong></p><p><a href="https://github.com/nacos-group/nacos-spring-boot-project" target="_blank" rel="noopener noreferrer">https://github.com/nacos-group/nacos-spring-boot-project</a></p><p><strong><em>Spring Cloud Alibaba</em></strong></p><p><a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba" target="_blank" rel="noopener noreferrer">https://github.com/spring-cloud-incubator/spring-cloud-alibaba</a></p><p><strong><em>Dubbo</em></strong></p><p><a href="http://dubbo.apache.org/en-us/" target="_blank" rel="noopener noreferrer">http://dubbo.apache.org/en-us/</a></p><p><strong><em>Sentinel</em></strong></p><p><a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/Sentinel</a></p><p><strong><em>Spring Cloud</em></strong></p><p><a href="https://spring.io/projects/spring-cloud" target="_blank" rel="noopener noreferrer">https://spring.io/projects/spring-cloud</a></p><p><strong><em>Nepxion Discovery</em></strong></p><p><a href="https://github.com/Nepxion/Discovery" target="_blank" rel="noopener noreferrer">https://github.com/Nepxion/Discovery</a></p><p><strong><em>Spring Cloud Gateway Nacos</em></strong></p><p><a href="https://github.com/SpringCloud/spring-cloud-gateway-nacoshttps://github.com/SpringCloud/spring-cloud-gateway-nacos" target="_blank" rel="noopener noreferrer">https://github.com/SpringCloud/spring-cloud-gateway-nacoshttps://github.com/SpringCloud/spring-cloud-gateway-nacos</a>)</p><p><em>本文作者：</em></p><p>朱鹏飞（花名：敦谷）</p><p>Github ID: nkorange，阿里巴巴中间件高级开发工程师，Nacos 开源项目负责人，Nacos 注册中心等模块主要贡献者。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos 0.9.0版本进行发布]]></title>
            <link>https://nacos.io/en/blog/nacos0.9.0</link>
            <guid>https://nacos.io/en/blog/nacos0.9.0</guid>
            <pubDate>Thu, 07 Mar 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos 0.9.0版本进行发布]]></description>
            <content:encoded><![CDATA[<p>天下武功，唯快不破，Nacos一直秉承着稳定性和快速迭代，Nacos 0.9.0版本于上周正式发布release，功能围绕着，Nacos-Sync的稳定性、Server功能拆分部署、Nacos python语言体系的支持，并且在此基础之上，Nacos首次发布核心团队人员，并在持续招募中。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-sync稳定性提升">Nacos-Sync稳定性提升<a href="#nacos-sync稳定性提升" class="hash-link" aria-label="Direct link to Nacos-Sync稳定性提升" title="Direct link to Nacos-Sync稳定性提升">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-sync简介">Nacos-Sync简介<a href="#nacos-sync简介" class="hash-link" aria-label="Direct link to Nacos-Sync简介" title="Direct link to Nacos-Sync简介">​</a></h3><p><a href="https://github.com/nacos-group/nacos-sync" target="_blank" rel="noopener noreferrer">Nacos-Sync</a>是Nacos的核心组件，作用是多注册中心数据同步的功能工具，目前支持的同步注册中心包括 Nacos、Zookeeper、Eureka和Consul，主要场景，包括多注册中心数据互相同步，注册中心升级过程的数据迁移，官网提供<a href="https://nacos.io/en-us/docs/nacos-sync-use.html" target="_blank" rel="noopener noreferrer">迁移操作手册</a>。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="090-增强稳定性">0.9.0 增强稳定性<a href="#090-增强稳定性" class="hash-link" aria-label="Direct link to 0.9.0 增强稳定性" title="Direct link to 0.9.0 增强稳定性">​</a></h3><p>Nacos 0.9的主线功能加强<a href="https://nacos.io/en-us/docs/nacos-sync.html" target="_blank" rel="noopener noreferrer">Nacos-Sync</a>的稳定性，一方面增强Nacos-Sync的基础测试用例覆盖面，保证Nacos-Sync以后的快速迭代过程中主线功能稳定性，另一方面通过监控体系的完善，对接了Prometheus通过metrics暴露数据，并且天然集成grafana监控，保证了Nacos-Sync生产级别稳定性。
随着Nacos 0.9.0版本发布，Nacos-Sync 0.3版本支持了metrics监控，能通过metrics数据观察Nacos-Sync服务的运行状态，提升了Nacos-Sync的在生产环境的监控能力。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用prometheus采集nacos-sync-metrics数据">使用Prometheus采集Nacos-Sync metrics数据<a href="#使用prometheus采集nacos-sync-metrics数据" class="hash-link" aria-label="Direct link to 使用Prometheus采集Nacos-Sync metrics数据" title="Direct link to 使用Prometheus采集Nacos-Sync metrics数据">​</a></h3><p>继 Kubernetes 之后，Prometheus成为第二个正式从 CNCF 毕业的开源项目。Nacos及Nacos-Sync支持Prometheus metrics也是Nacos拥抱云原生的第一步。Prometheus作为新一代的云原生监控系统，除了能对Kubernetes容器集群进行监控之外，也能对容器中的应用进行监控。不过Prometheus的数据展示能力比较差，一般会借助第三方数据监控平台。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="grafana监控nacos-sync">grafana监控Nacos-Sync<a href="#grafana监控nacos-sync" class="hash-link" aria-label="Direct link to grafana监控Nacos-Sync" title="Direct link to grafana监控Nacos-Sync">​</a></h3><p>Grafana是一款强大的数据可视化开源软件，能通过非常漂亮的图表和曲线展示监控数据，支持多种数据源，包括Prometheus。</p><p>和Nacos监控一样，官网给Nacos-Sync也提供了监控模版，简单的几步就可以很方便地在Grafana上监控Nacos-Sync</p><p>Nacos-Sync监控同样也分为三个模块:</p><ul><li>nacos-sync monitor展示核心监控项
<img loading="lazy" src="https://img.alicdn.com/tfs/TB1GeNWKmzqK1RjSZFHXXb3CpXa-2834-1588.png" alt="monitor" class="img_ev3q"></li><li>nacos-sync detail和alert两个模块的展示监控曲线和告警
<img loading="lazy" src="https://img.alicdn.com/tfs/TB1kP8UKbvpK1RjSZPiXXbmwXXa-2834-1570.png" alt="detail" class="img_ev3q"></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-server功能拆分部署">Nacos Server功能拆分部署<a href="#nacos-server功能拆分部署" class="hash-link" aria-label="Direct link to Nacos Server功能拆分部署" title="Direct link to Nacos Server功能拆分部署">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="为什么要拆分部署">为什么要拆分部署<a href="#为什么要拆分部署" class="hash-link" aria-label="Direct link to 为什么要拆分部署" title="Direct link to 为什么要拆分部署">​</a></h3><p>一般公司随着业务规模的不断膨胀，我们建议业务对注册中心和配置中心进行拆分部署，在Nacos 0.9.0版本以后，支持注册中心模块和配置中心模块的拆分部署，在启动命令进行加入参数，来指定启动指定Nacos 功能模块，默认全部功能启用，目前支持指定配置中心模块和注册中心模块。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用方法">使用方法<a href="#使用方法" class="hash-link" aria-label="Direct link to 使用方法" title="Direct link to 使用方法">​</a></h3><p>启动Nacos server时候，增加<code>-f</code>参数，意思是function mode，和对应模块标示来进行启动，如果不传，或者传入有误，都将启动全部功能。
配置中心参数对应<code>config</code>，注册中心参数对应<code>naming</code>。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="启动命令">启动命令<a href="#启动命令" class="hash-link" aria-label="Direct link to 启动命令" title="Direct link to 启动命令">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sh startup.sh -m standalone -f naming</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>启动之后，你可以通过启动日志头看到是否正确启动了功能模块，并且Nacos console将只展现启动的对应模块。</p><ul><li>Nacos启动日志头信息
<img loading="lazy" src="https://img.alicdn.com/tfs/TB1ADCrKAvoK1RjSZFDXXXY3pXa-1552-522.jpg" class="img_ev3q"></li><li>单独启动配置中心的控制台示例
<img loading="lazy" src="https://img.alicdn.com/tfs/TB1sXyoKpzqK1RjSZFCXXbbxVXa-2674-940.png" class="img_ev3q"></li><li>单独启动注册中心的控制台示例
<img loading="lazy" src="https://img.alicdn.com/tfs/TB1yKyiKCzqK1RjSZFLXXcn2XXa-2680-738.png" class="img_ev3q"></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-python语言体系的支持">Nacos python语言体系的支持<a href="#nacos-python语言体系的支持" class="hash-link" aria-label="Direct link to Nacos python语言体系的支持" title="Direct link to Nacos python语言体系的支持">​</a></h2><p>Nacos开始支持python语言体系，兼容Nacos0.8.0版本，<a href="https://github.com/nacos-group/nacos-sdk-python" target="_blank" rel="noopener noreferrer">Nacos-sdk—Python</a>在github上的<a href="https://github.com/nacos-group" target="_blank" rel="noopener noreferrer">Nacos-Group</a>中,支持的Python版本包括 2.7、3.6和3.7，操作简单，一行命令安装，可以在仓库中看到详细的<a href="https://github.com/nacos-group/nacos-sdk-python/blob/master/README.md" target="_blank" rel="noopener noreferrer">使用说明</a>，感谢周文同学的贡献。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-团队页悄悄上线">Nacos 团队页悄悄上线<a href="#nacos-团队页悄悄上线" class="hash-link" aria-label="Direct link to Nacos 团队页悄悄上线" title="Direct link to Nacos 团队页悄悄上线">​</a></h2><p>在Nacos 0.9.0的版本中，Nacos官网 <a href="http://nacos.io/" target="_blank" rel="noopener noreferrer">nacos.io</a>上线了Nacos社区的核心Committer团队首次和大家见面，<a href="https://nacos.io/en-us/docs/nacos-dev.html" target="_blank" rel="noopener noreferrer">Nacos 核心团队页</a>，并且社区团队在持续扩大中，<a href="https://nacos.io/en-us/docs/contributing-dev.html" target="_blank" rel="noopener noreferrer">Nacos的社区有着自己的社区共建规范</a>，并且在吸收新人上，不仅仅是需要开发者，还需要测试大牛、文档贡献者和社区管理者。我们鼓励大家积极参与Nacos社区，社区有一套机制可以使您，从用户角色到提交者角色，甚至是PMC角色。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="如何共建">如何共建<a href="#如何共建" class="hash-link" aria-label="Direct link to 如何共建" title="Direct link to 如何共建">​</a></h3><p>为了实现这一目标，你需要积极参与Nacos社区。如果您在文档中发现拼写错误，在代码中发现错误，或想要新功能或想要提供建议，您可以<a href="https://github.com/alibaba/Nacos/issues/new" target="_blank" rel="noopener noreferrer">在GitHub上创建一个issues</a>。</p><p>如果您想开始着手，可以选择github仓库中有以下标签的issues。</p><ul><li><a href="https://github.com/alibaba/nacos/labels/good%20first%20issue" target="_blank" rel="noopener noreferrer">good first issue</a>：对于新手来说是非常好的入门issues。</li><li><a href="https://github.com/alibaba/nacos/labels/contribution%20%E6%AC%A2%E8%BF%8E" target="_blank" rel="noopener noreferrer">contribution welcome</a>：非常需要解决的问题和非常重要的模块，但目前缺少贡献者，欢迎贡献者来贡献。</li></ul><p>除了以上的通用标签，还可以关注Nacos目前重点关注的多语言共建招募，<a href="https://github.com/alibaba/nacos/issues?utf8=%E2%9C%93&amp;q=is%3Aissue+is%3Aopen+recruit+client" target="_blank" rel="noopener noreferrer">C++、PHP的多语言核心贡献者招募</a>，和并且还有<a href="https://github.com/alibaba/nacos/issues/787" target="_blank" rel="noopener noreferrer">社区群组负责人招募</a>，欢迎大家加入Nacos社区，贡献社区。用Apache的话说，<strong>“社区高于代码”!</strong>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="蓬勃发展的-nacos-社区">蓬勃发展的 Nacos 社区<a href="#蓬勃发展的-nacos-社区" class="hash-link" aria-label="Direct link to 蓬勃发展的 Nacos 社区" title="Direct link to 蓬勃发展的 Nacos 社区">​</a></h2><blockquote><p>DISS is cheap, show me your hand
比吐槽更重要的是搭把手，参与社区一起发展Nacos</p></blockquote><ul><li>作为用户关注和加入 Nacos 社区</li></ul><p>Nacos 社区正在蓬勃发展，截止到发文为止，Nacos 短短几个月已经有 9 个微信群，其中 7 个已满员，1个QQ群，1个钉钉群，关注 Nacos 的社区人数已经近5000人，在 Nacos 群里跟 “道（基）友” 切磋技术，交流经验，招聘交友，抢抢红包...不亦乐乎。</p><p>要加入 Nacos 微信社区，你可以通过扫下面的<strong>“超哥”</strong>“超哥”** 帮你拉入 “Nacos社区微信交流群”</p><p><img loading="lazy" src="https://img.alicdn.com/tfs/TB1q6SBKq6qK1RjSZFmXXX0PFXa-1984-1124.png" class="img_ev3q"></p><ul><li>作为代码贡献者加入 Nacos 社区</li></ul><p>从Nacos用户发展而成贡献者顺理成章，而Nacos开发团队也确实在日趋壮大，从开始的只有4个代码contributor发展到目前的39个，在0.9.0 版本的开发中，社区同学贡献了很大的力量，在此特别感谢，他们的githubId是（注：不分先后） paderlol、jifengnan、loadchange、nkorange、hxy1991、huangyunbin、darkness463、luoxn28、TsingLiang、xuechaos、nanamikon、systp、jameslcj、pader.zhang，相信后续有跟多同学参与到Nacos社区的共建中。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1542704700864-a9d54856-9bf6-4176-b449-c13fa02c5800.png#align=left&amp;display=inline&amp;height=387&amp;linkTarget=_blank&amp;originHeight=888&amp;originWidth=1716&amp;width=748" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="新人时刻---什么是nacos"><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer"></a>新人时刻 - "什么是Nacos？"<a href="#新人时刻---什么是nacos" class="hash-link" aria-label="Direct link to 新人时刻---什么是nacos" title="Direct link to 新人时刻---什么是nacos">​</a></h2><blockquote><p>还不知道什么是Nacos? 没关系，在github上star一下跟程序猿兄弟打个招呼吧!!</p></blockquote><p><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a> 是阿里巴巴于7月份新开源的项目，Nacos的主要愿景是期望通过提供易用的 <code>动态服务发现</code>、<code>服务配置管理</code>、<code>服务共享与管理</code> 的基础设施，帮助用户在云原生时代更好的构建、交付、管理自己的微服务平台。</p><p><img loading="lazy" src="https://img.alicdn.com/tfs/TB1pCyAKpzqK1RjSZSgXXcpAVXa-1910-894.png" class="img_ev3q"></p><p>github项目地址在 <a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">这里</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="更多与-nacos-相关的开源项目信息"><a href="https://yuque.alibaba-inc.com/nacos/opensource/dawygn#kn9iog" target="_blank" rel="noopener noreferrer"></a>更多与 Nacos 相关的开源项目信息<a href="#更多与-nacos-相关的开源项目信息" class="hash-link" aria-label="Direct link to 更多与-nacos-相关的开源项目信息" title="Direct link to 更多与-nacos-相关的开源项目信息">​</a></h2><ul><li><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a></li><li><a href="https://github.com/dubbo/dubbo-registry-nacos" target="_blank" rel="noopener noreferrer">Dubbo Registry Nacos</a></li><li><a href="https://github.com/nacos-group/nacos-coredns-plugin" target="_blank" rel="noopener noreferrer">Nacos DNS-F</a></li><li><a href="https://github.com/nacos-group/nacos-docker" target="_blank" rel="noopener noreferrer">Nacos Docker</a></li><li><a href="https://github.com/nacos-group/nacos-spring-project" target="_blank" rel="noopener noreferrer">Nacos Spring Project</a></li><li><a href="https://github.com/nacos-group/nacos-spring-boot-project" target="_blank" rel="noopener noreferrer">Nacos Spring Boot</a></li><li><a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba</a></li><li><a href="http://dubbo.io/" target="_blank" rel="noopener noreferrer">Dubbo</a></li><li><a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">Sentinel</a></li><li><a href="https://projects.spring.io/spring-cloud/" target="_blank" rel="noopener noreferrer">Spring Cloud</a></li><li><a href="https://github.com/Nepxion/Discovery" target="_blank" rel="noopener noreferrer">Nepxion Discovery</a></li><li><a href="https://github.com/SpringCloud/spring-cloud-gateway-nacos" target="_blank" rel="noopener noreferrer">Spring Cloud Gateway Nacos</a></li></ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos 0.9.0版本进行发布]]></title>
            <link>https://nacos.io/en/blog/nacos0.9-intro</link>
            <guid>https://nacos.io/en/blog/nacos0.9-intro</guid>
            <pubDate>Thu, 28 Feb 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos 0.9.0版本进行发布]]></description>
            <content:encoded><![CDATA[<p>Nacos 发布 0.9.0 版本，该版本加强了 Nacos-Sync 稳定性，增加了监控体系，完善了测试用例，并且支持 Naming 和 Config 的分模块启动，此外还修复了社区提出的一些 issues：</p><ul><li>[#412]<!-- --> Nacos can support Dubbo service registration discovery and configuration management</li><li>[#388]<!-- --> Cluster name should be provided in the Instance</li><li>[#377]<!-- --> Clean up messy code in Naming module</li><li>[#369]<!-- --> Support instance list persisted on disk</li><li>[#366]<!-- --> Findbugs-maven-plugin version</li><li>[#362]<!-- --> The metadata will lost when online or offline instance through web ui</li><li>[#352]<!-- --> Refactoring internationalization Nacos console</li><li>[#278]<!-- --> Nacos docker img</li><li>[#243]<!-- --> Optimize the efficiency of integration testing, it’s taking too long now</li></ul><p>感谢以下 Contributors 对 Nacos 0.9.0版本的贡献，他们是：</p><p>@paderlol、@jifengnan、@loadchange、@nkorange、@hxy1991、@huangyunbin、@darkness463、@luoxn28、@TsingLiang、@xuechaos、@nanamikon、@systp、@jameslcj、@pader.zhang</p><p>详情参考：<a href="https://github.com/alibaba/nacos/releases/tag/0.9.0" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos/releases/tag/0.9.0</a></p><p>Nacos team 介绍 ：<a href="https://nacos.io/en-us/docs/nacos-dev.html" target="_blank" rel="noopener noreferrer">https://nacos.io/en-us/docs/nacos-dev.html</a> （持续扩展中，欢迎加入）</p><p>如何加入 Nacos team：<a href="https://nacos.io/en-us/docs/contributing-dev.html" target="_blank" rel="noopener noreferrer">https://nacos.io/en-us/docs/contributing-dev.html</a></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[虎牙直播在微服务改造方面的实践和总结]]></title>
            <link>https://nacos.io/en/blog/huya-practice</link>
            <guid>https://nacos.io/en/blog/huya-practice</guid>
            <pubDate>Sun, 10 Feb 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[虎牙直播在微服务改造方面的实践和总结]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="https://img.alicdn.com/tfs/TB1i4ugBjDpK1RjSZFrXXa78VXa-1522-584.png" alt="_2019_02_14_5_33_45" class="img_ev3q"></p><p>相比文字和图片，直播提供了人与人之间更丰富的沟通形式，其对平台稳定性的考验很大，那么倡导“<strong><em>以技术驱动娱乐</em></strong>”的虎牙直播（以下简称“虎牙”）是如何在技术上赋能娱乐，本文将为您介绍虎牙在DNS、服务注册、CMDB和服务配置中心等方面的实践。</p><p>文章整理自虎牙基础保障部中间件团队负责人张波（社区ID：zhangjimmy）在Dubbo Meetup 广州站沙龙上的分享，阿里巴巴中间件授权发布，分享议题如下： </p><ul><li>为什么选用Nacos</li><li>DNS-F的技术价值和应用场景</li><li>服务注册的实践</li><li>CMDB的应用和实践</li><li>服务配置的实践</li></ul><p>##为什么选用 Nacos</p><p>虎牙关注 Nacos 是从v0.2 开始的（<a href="https://mp.weixin.qq.com/s?__biz=MzU4NzU0MDIzOQ==&amp;mid=2247485479&amp;idx=1&amp;sn=bea1d2fc47f7002594bc0762938d4539&amp;chksm=fdeb3a47ca9cb351483b865b1e1e435166efead2c5cc7993bb7bed9549afb8aa4d6d81f7c9cd&amp;token=1795393417&amp;lang=zh_CN#rd" target="_blank" rel="noopener noreferrer">最新版本：Pre-GA v0.8</a>），我们也参与了社区的建设，可以说是比较早期的企业用户。</p><p>Nacos 是一个更易于帮助构建云原生应用的动态服务发现、配置和服务管理平台，提供「注册中心」、「配置中心」和「动态DNS服务」三大功能。</p><p>首先，在虎牙的微服务场景中，起初有多个注册中心，每一个注册中心服务于某一部分微服务，缺少一个能融合多个注册中心，并把他们逐一打通，然后实现一个能管理整个微服务体系的大的注册中心。</p><p>以下内容摘自我们考虑引入Nacos时，在服务注册中心方案上的选型对比：</p><p><img loading="lazy" src="https://yqfile.alicdn.com/3ef377be6df69b7c528536095a74297be909de09.jpeg" alt="0001" class="img_ev3q"></p><p>Nacos提供 DNS-F功能， 可以与K8S、Spring Cloud和Dubbo等多个开源产品进行集成，实现服务的注册功能。</p><p>其次，在服务配置中心方案的选型过程中，我们希望配置中心和注册中心能够打通，这样可以省去我们在微服务治理方面的一些投入。因此，我们也同步比较了一些服务配置中心的开源方案：</p><p><img loading="lazy" src="https://yqfile.alicdn.com/61d46c7b6ae7acb1bcc6eb94be0066537b45a9b7.jpeg" alt="0002" class="img_ev3q"></p><p>例如Spring Cloud Config Server、Zookeeper和ETCD，总体评估下来，基于我们微服务体系现状以及业务场景，我们决定使用Nacos作为我们的服务注册和服务发现的方案。使用过程中，我们发现，随着社区版本的不断更新和虎牙的深入实践，Nacos的优势远比我们调研过程中发现的更多，接下来，我将围绕DNS-F、Nacos-Sync、 CMDB和负载均衡4方面来分享虎牙的实践。</p><p>##DNS - F 的技术价值</p><p><img loading="lazy" src="https://yqfile.alicdn.com/25198113a9e8bebfd3763def3dccf089bfa943c4.jpeg" alt="0003" class="img_ev3q"></p><p><strong>Nacos 提供的DNS-F功能的第一个技术价值在于，弥补了我们内部微服务没有一个全局动态调度能力的空白。</strong>刚才提到，虎牙有多个微服务体系，但并没有一个微服务具备全局动态调度的能力，因为它们各自都是独立的。目前，我们通过Nacos已经融合了四个微服务体系的注册中心，最终目标是把所有的微服务都融合在一起，实现全局动态调动的能力。</p><p><strong>第二，DNS-F解决了服务端端到端面临的挑战，即延时大、解析不准、故障牵引慢的问题。</strong></p><p>如何去理解呢？</p><p>当内部有多个微服务体系的时候，每一个体系的成熟度是不同的。例如，有一些微服务框架对同机房或CMDB路由是不支持的，当一个服务注册到了多个IDC中心，去调用它的服务的时候，即便是同机房，也可能调用到一个不是同机房的节点。这样就会无端的造成服务的延时和解析不准。</p><p>即使我们基于DNS做一些解析的优化，但仍然无法完全解决服务的延时和解析不准。这是因为DNS都是IP策略的就近解析，无法根据服务的物理状态、物理信息进行路由。此外，当一个核心服务出现问题，如果缺少一个融合了多个调用方和被调用方的信息的统一的注册中心，就很难去准确判断如何去牵引，从而导致故障牵引慢。有了Nacos后，就可以接入一个统一的注册中心以及配置中心，去解决这些问题。（目前，虎牙还在微服务体系的改造过程中，未完全实现统一的注册中心）</p><p><strong>第三，提供专线流量牵引能力。</strong>虎牙的核心机房的流量互通，是使用专线来实现的。专线的特性就是物理建设的，而且我们的专线建设可能不像BAT那么大，例如我们专线容量的冗余只有50%，假设某个直播异常火爆，突发流量高于平常的两百倍，超过了专线的建设能力，这时候一个服务就有可能会导致全网故障。但是，通过全局的注册中心和调动能力，我们就可以把流量牵引到其他地方，例如迁移到公网，甚至牵引到一个不存在的地址，来平衡一下。即便某个服务出现问题，也不会影响我们的全局服务。</p><p><strong>第四，支持服务端的多种调度需求</strong>，包括同机房路由、同机器路由，以及同机架路由，Nacos都可以去做适配。此外，基于Nacos 的DNS-F功能，我们还实现了加速外部域名解析和服务故障牵引秒级生效。</p><p>##DNS - F 的应用场景</p><p><img loading="lazy" src="https://yqfile.alicdn.com/7cecef1baea37febe4ec6906267d07b030552f3b.jpeg" alt="0004" class="img_ev3q"></p><p>这张图是Nacos DNS-F的一个具体实现，实际上是拦截了OS层的DNS请求。如果经过DNS的域名是内部服务，它就会从Nacos Server 获取结果，如果不是，就会转发到其它的LocalDNS进行解析。</p><p><img loading="lazy" src="https://yqfile.alicdn.com/8cb3cf8a96a1bc5a2a56a8230117b40294c7da9c.jpeg" alt="0005" class="img_ev3q"></p><p>以数据库高可用的应用场景为例，我们的数据库切换效率比较低，依赖业务方修改配置，时效不确定，通常需要10分钟以上（备注：我们的数据库实际上已经实现了主备的功能，但当一个主服务出现问题的时候，总是要去切换IP。）切换IP的过程中，依赖运维和开发的协作，这是一个比较长的过程。</p><p>引入DNS后，当主出现问题的时候，就可以很快的用另外一个主的IP来进行替换，屏蔽故障，而且节点的故障检测和故障切换都可以自动完成，并不依赖运维和开发的协作，节省了时间。当然，这个场景的解法有很多，比如说使用MySQL - Proxy也可以去解这个问题，但我们的MySQL - Proxy还在建设中，想尽快的把这个问题解决，所以采用了DNS的方式。</p><p>下面我们再着重分享下基于DNS-F对LocalDNS的优化。虎牙还没有去建设自己的LocalDNS，大部分使用的是一些公共的DNS，大致有以下这些组成。</p><p><img loading="lazy" src="https://yqfile.alicdn.com/232023934e87766f6e336858783ab85c24b324a0.jpeg" alt="0006" class="img_ev3q"></p><p>这种组成方式会存在一个问题。假设服务突然一下崩溃后，之后服务又马上正常了，这种情况我们无法重现去找到崩溃原因。因为很多场景下，是一个公共DNS的请求超时导致的，甚至一个解析失败导致的，在那一刻，因为无法保留现场的，所以就发现不了问题。</p><p>以我们的监测数据来看，DNS解析错误的比例达到1‰左右，超时比例将更高。意思是在使用公共DNS的情况下，服务有1‰的几率是会超时或失败，如果服务没有做好容错，就会出现异常。同时，一些公共DNS解析的延时都是不定的，比如在亚马逊上一些比较不好的节点，它的延时会比较高，平均超过三四十毫秒。</p><p><img loading="lazy" src="https://yqfile.alicdn.com/817a1aacf83e650a108d0cfdf50c93cae19e8adc.jpeg" alt="0007" class="img_ev3q"></p><p>然后我们基于DNS-F对LocalDNS做了一些优化。优化结果如下：</p><ul><li>平均解析时间从之前的超过两百毫秒降低到两毫秒以下；</li><li>缓存命中率从92%提升到了99%以上；</li><li>解析失败率之前是1‰，现在基本上没有了。</li></ul><p>优化的效果也体现在我们的风控服务上，平均延迟下降10ms，服务超时比例下降25%，降低了因延迟或服务超时导致的用户上传的图片或文字违规但未被审核到的风险。</p><p>##服务注册的实践</p><p>虎牙的核心业务是跑在Tars上的。</p><blockquote><p>Tars：腾讯开源的一款微服务框架。  </p></blockquote><p>Tars主要是支持C++，但对Java、PHP等开发语言的支持力度比较差，这就使得我们非C++的业务方去调用它就会很别扭。引入Nacos以后，我们通过Nacos支持的DNS协议来实现服务发现过程中对全语言的支持。</p><p>当然，Nacos不只是一个注册中心，它具备了融合多个数据中心的能力，支持多数据源的同步，例如，我们目前已经支持了Taf（虎牙内部的一个重要微服务体系）、Nacos自身、ZooKeeper、以及K8S上一些服务注册的同步。</p><p><img loading="lazy" src="https://yqfile.alicdn.com/c1625c404950f858283a40e98bb82ab142e39de5.jpeg" alt="0008" class="img_ev3q"></p><p>同时，基于Nacos集群的双向同步功能(Nacos-Sync)，我们实现了国内的两个可用区，以及国外的多个可用区之间的数据值同步，最终实现了一处注册、多地可读。</p><p>Nacos-Sync是事件机制，即同步任务通过事件触发，可以灵活地开启和关闭你要同步的任务，然后根据服务变化事件触发监听，保证实时性，最后通过定时的全量突发同步事件，保证服务数据的最终一致。同时，Nacos-Sync也支持服务心跳维持，即多个数据中心的心跳，可以使用Nacos-Sync代理要来实现远端同步。此外，也支持心跳与同步任务绑定，便于灵活控制。</p><p>由于Taf上有数万个注册服务，同步的量特别大，所以我们在Nacos-Sync做了一些改造，通过任务分片来实现数万服务同步的可用性保障。改造步骤是先以服务为粒度定义任务，然后在多个分片上分散任务负载，最后以单分片多副本来保证任务可用性。</p><p>##对接 CMDB，实现就近访问</p><p>在服务进行多机房或者多地域部署时，跨地域的服务访问往往延迟较高，一个城市内的机房间的典型网络延迟在1ms左右，而跨城市的网络延迟，例如上海到北京大概为30ms。此时自然而然的一个想法就是能不能让服务消费者和服务提供者进行同地域访问。</p><p>Nacos定义了一个SPI接口，里面包含了与第三方CMDB约定的一些方法。用户依照约定实现了相应的SPI接口后，将实现打成Jar包放置到Nacos安装目录下，重启Nacos即可让Nacos与CMDB的数据打通。</p><p><img loading="lazy" src="https://yqfile.alicdn.com/d8020624cc008a9452224b18768946d5a5e1b9b7.jpeg" alt="0009" class="img_ev3q"></p><p>在实际的落地过程中，我们是在DNS-F接入Taf，在DNS-F上实现Taf的中控接口，无缝对接Taf的sdk。DNS-F提供缓存负载均衡和实例信息，Nacos则提供负载均衡信息的查询接口。</p><p>##服务配置的实践</p><p>虎牙的域名（<a href="http://www.huya.com%EF%BC%89%E4%BC%9A%E6%8E%A5%E5%85%A5%E5%8D%8E%E5%8D%97%E3%80%81%E5%8D%8E%E4%B8%AD%E3%80%81%E5%8D%8E%E5%8C%97%E5%A4%9A%E4%B8%AAIDC%E6%9C%BA%E6%88%BF%EF%BC%8C%E6%AF%8F%E4%B8%AA%E6%9C%BA%E6%88%BF%E9%83%BD%E4%BC%9A%E5%BB%BA%E8%AE%BE%E4%B8%80%E4%B8%AANginx%E5%8E%BB%E5%81%9A%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%EF%BC%8C%E7%BB%8F%E8%BF%87%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E6%B5%81%E9%87%8F%E4%BC%9A%E9%80%9A%E8%BF%87%E4%B8%93%E7%BA%BF%E8%BF%94%E5%9B%9E%E5%88%B0%E6%88%91%E4%BB%AC%E7%9A%84%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E3%80%82%E5%9C%A8%E8%BF%99%E4%B8%AA%E8%BF%87%E7%A8%8B%E4%B8%AD%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%88%91%E4%BB%AC%E5%8E%BB%E4%BF%AE%E6%94%B9%E4%B8%80%E4%B8%AA%E5%9C%A8%E4%B8%AD%E9%97%B4%E7%9A%84%E9%85%8D%E7%BD%AE%EF%BC%8C%E9%9C%80%E8%A6%81%E4%B8%8B%E5%8F%91%E5%88%B0%E5%A4%9A%E4%B8%AA%E6%9C%BA%E6%88%BF%E7%9A%84%E4%B8%8A%E7%99%BE%E4%B8%AA%E8%B4%9F%E8%B4%A3%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E6%9C%BA%E5%99%A8%E4%B8%8A%EF%BC%8C%E5%A6%82%E6%9E%9C%E5%87%BA%E7%8E%B0%E9%85%8D%E7%BD%AE%E4%B8%8B%E5%8F%91%E4%B8%8D%E5%8F%8A%E6%97%B6%EF%BC%8C%E6%88%96%E4%B8%8B%E5%8F%91%E9%85%8D%E7%BD%AE%E5%A4%B1%E8%B4%A5%EF%BC%8C%E6%9E%81%E5%A4%A7%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%87%BA%E7%8E%B0%E6%95%85%E9%9A%9C%EF%BC%8C%E5%90%8C%E6%97%B6%EF%BC%8C%E8%B4%9F%E8%B4%A3%E5%9D%87%E8%A1%A1%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%9C%BA%E5%99%A8%E5%AF%B9%E5%BC%B9%E6%80%A7%E8%83%BD%E5%8A%9B%E7%9A%84%E8%A6%81%E6%B1%82%E8%BE%83%E9%AB%98%EF%BC%8C%E5%9C%A8%E4%B8%9A%E5%8A%A1%E9%AB%98%E5%B3%B0%E5%A6%82%E6%9E%9C%E4%B8%8D%E8%83%BD%E5%BF%AB%E9%80%9F%E6%89%A9%E5%AE%B9%EF%BC%8C%E5%AE%B9%E6%98%93%E5%87%BA%E7%8E%B0%E5%85%A8%E7%BD%91%E6%95%85%E9%9A%9C%E3%80%82" target="_blank" rel="noopener noreferrer">www.huya.com）会接入华南、华中、华北多个IDC机房，每个机房都会建设一个Nginx去做负载均衡，经过负载均衡的流量会通过专线返回到我们的后端服务器上。在这个过程中，如果我们去修改一个在中间的配置，需要下发到多个机房的上百个负责负载均衡的机器上，如果出现配置下发不及时，或下发配置失败，极大可能会出现故障，同时，负责均衡服务的机器对弹性能力的要求较高，在业务高峰如果不能快速扩容，容易出现全网故障。</a></p><p><img loading="lazy" src="https://yqfile.alicdn.com/72ecb3dd72d5347932f97b5efd3433ac2bb52a03.jpeg" alt="0010" class="img_ev3q"></p><p>传统的配置下发方式是通过服务端下发文件更新配置，更新配置生效时间长，由于需要预先知道负责均衡集群的机器信息，扩缩容需要等元信息同步以后才能接入流量，扩容流量的接入时间较长。</p><p>引入Nacos后，我们采用了配置中心监听方式，通过客户端主动监听配置更新，配置便可秒级生效，新扩容服务主动拉取全量配置，流量接入时长缩短3分钟+。</p><p>##虎牙对 Nacos 改造和升级的总结</p><p>引入Nacos的过程中，我们所做的改造和升级总结如下。</p><p>一是在<strong>DNS-F</strong>上，我们增加了对外部域名的预缓存的支持，Agent的监控数据对接到公司的内部监控，日志输出也对接到内部的日志服务，然后和公司的CMDB对接，并实现了DNS-F Cluster集群。我们之所以去构建一个DNS-FCluster集群，是为了避免内存、硬盘或版本问题导致的DNS服务无效，有了DNS-F Cluster集群，当本地Agent出现问题的时候，就可以通过集群去代理和解析DNS请求。</p><p>二是在<strong>Nacos-Sync</strong>上，我们对接了TAF注册服务和K8S注册服务，以及解决了多数据中心环形同步的问题。</p><p>三是在<strong>Nacos CMDB</strong>上，我们对Nacos CMDB进行了扩展，对接了虎牙自己的CMDB，并对接了内部的负载均衡策略。</p><p>###本文作者
张波，社区ID zhangjimmy，Nacos Committer，虎牙基础保障部中间件团队负责人，阿里云MVP。</p><p>###其他服务化改造实践：</p><ul><li><a href="https://mp.weixin.qq.com/s?__biz=MzU4NzU0MDIzOQ==&amp;mid=2247485166&amp;idx=1&amp;sn=3c7d87b4d97d0b9e96c178c70769d493&amp;chksm=fdeb348eca9cbd98ef37dc628b3f8e22d1b86f2969e5fa2527a631d5e04cc59f326bf2494a6a&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">网易考拉在服务化改造方面的实践</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzU4NzU0MDIzOQ==&amp;mid=2247485166&amp;idx=2&amp;sn=2b18fb22d69ecb50e5daf550ad076b3b&amp;chksm=fdeb348eca9cbd9814f82b3cdd8d6b4dff682d1b7a29d0515f08a70997e1f9e6bfaf37413ca5&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">微众银行的金融级消息服务平台建设实践和思考</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzU4NzU0MDIzOQ==&amp;mid=2247485392&amp;idx=4&amp;sn=e03c4c7b6d8bb9bbced7fc79615bb5a7&amp;chksm=fdeb35b0ca9cbca6a4bd49ded82c2c4186fbc957a17fb86c80aa4a39180fcf4fc0bed69f84e7&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">消息规模超千亿，同程艺龙的消息系统建设实践</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzU4NzU0MDIzOQ==&amp;mid=2247484792&amp;idx=3&amp;sn=6e05c4ccb48dd1ba69893ec39b753e1d&amp;chksm=fdeb3718ca9cbe0eb891f820d6cb041b127fe2511f601db46031c46c4881a1ab657d17e406f7&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">滴滴出行基于RocketMQ构建企业级消息队列服务的实践</a></li></ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos 0.8.0版本进行发布]]></title>
            <link>https://nacos.io/en/blog/nacos0.8</link>
            <guid>https://nacos.io/en/blog/nacos0.8</guid>
            <pubDate>Sun, 20 Jan 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos 0.8.0版本进行发布]]></description>
            <content:encoded><![CDATA[<p>阿里巴巴微服务开源项目?<a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Dubbo Nacos</a>? 于本周发布?<strong>v0.8.0</strong>?<strong>PRE-GA</strong>版本，终于初步完成了Road Map一个重要的里程碑版本（第一个可安全上生产的版本，特别感谢在前期勇于在生产上尝试Nacos的客户，社区会尽快寄出小礼品，表达对大家的感激之情），V0.8.0 版本主要在支持了登录、命名空间、Metrics监控（对接Prometheus）、通过Nacos-Sync 组件支持从传统的注册中心平滑的往Nacos服务数据迁移等特性，以更稳定和更高可用的姿态让用户在生产环境中支撑大家的微服务平台。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-登录">Nacos 登录<a href="#nacos-登录" class="hash-link" aria-label="Direct link to Nacos 登录" title="Direct link to Nacos 登录">​</a></h3><p>Nacos控制台支持登录、登出特性，以便更安全的上生产使用。<br><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2019/png/9687/1548047848570-c92c232f-13eb-41e3-a8af-0660e3a58912.png#align=left&amp;display=inline&amp;height=894&amp;linkTarget=_blank&amp;name=image.png&amp;originHeight=1430&amp;originWidth=2876&amp;size=195009&amp;width=1797" alt="image.png" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="命名空间">命名空间<a href="#命名空间" class="hash-link" aria-label="Direct link to 命名空间" title="Direct link to 命名空间">​</a></h3><p>Nacos自0.5.0版本支持命名空间以来，配置服务先支持了命名空间，服务发现模块则在这个0.8.0版本支持了多命名空间，使用服务发现的命名空间可以实现服务数据的逻辑隔离。使用服务发现模块的多命名空间与配置模块基本相同，在Nacos控制台上查看想要使用的命名空间ID，在客户构造时传入该命名空间ID：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Properties properties = new Properties();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">properties.put(PropertyKeyConst.NAMESPACE, "74a3dbb9-36cb-43f5-8d31-006acfd61caa");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">properties.put(PropertyKeyConst.SERVER_ADDR, "127.0.0.1:8848");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NamingService naming = NamingFactory.createNamingService(properties);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样通过这个NamingService实例读写的就都是命名空间74a3dbb9-36cb-43f5-8d31-006acfd61caa下的数据了。当然您也可以不指定命名空间ID，这样将会默认分配到public命名空间。发布完服务可以到Nacos控制台上查询服务信息：<br><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2019/png/9687/1548312345294-d4bd95df-7e6d-4a36-8827-6a7ac0a00985.png#align=left&amp;display=inline&amp;height=553&amp;linkTarget=_blank&amp;name=image.png&amp;originHeight=830&amp;originWidth=1904&amp;size=131287&amp;width=1269" alt="image.png" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="metrics监控">Metrics监控<a href="#metrics监控" class="hash-link" aria-label="Direct link to Metrics监控" title="Direct link to Metrics监控">​</a></h3><p>通过Metrics信息暴露，对接Prometheus加强Nacos实时监控，以便让用户对产品更有控制力。</p><p>Nacos 通过micrometer统计了运行时的核心指标：</p><ul><li>系统指标包括cpu load jvm等</li><li>业务指标包括配置数，域名数，长连接，QPS，RT等</li><li>异常指标记录了Nacos运行的内部异常micrometer提供了转化器能转化成多种metrics格式，Nacos目前支持常用的prometheus、elastic search和influxdb，后续可以根据具体情况进行调整。</li></ul><br><br>grafana具备强大的的数据可视化能力，能将采集的数据展示出来，支持多种数据源。同时可对重要指标配置告警规则，数据达到阈值时可以通知相关负责人。<br>Nacos官网提供了结合prometheus和grafana实现metrics监控<br><br><br>![](https://intranetproxy.alipay.com/skylark/lark/0/2019/png/53357/1548122164953-6011a9ee-a521-447c-a871-7ebcf10c2ce4.png#align=left&amp;display=inline&amp;height=417&amp;linkTarget=_blank&amp;originHeight=1584&amp;originWidth=2832&amp;size=0&amp;width=746)<p>具体的详情可以参考官网<a href="https://nacos.io/zh-cn/docs/monitor-guide.html" target="_blank" rel="noopener noreferrer">监控文档</a>。</p><h3></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-sync-支持服务平滑迁移">Nacos-Sync 支持服务平滑迁移<a href="#nacos-sync-支持服务平滑迁移" class="hash-link" aria-label="Direct link to Nacos-Sync 支持服务平滑迁移" title="Direct link to Nacos-Sync 支持服务平滑迁移">​</a></h3><p>提供Nacos-Sync同步工具支持用户做服务数据的平滑迁移迁移，支持用户从其他注册中心平滑迁移到Nacos上来，同时支持多个Region独立Nacos服务同步，目前Nacos-Sync支持的源注册中心主要包括ZooKeeper,Eureka等。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="使用场景">使用场景<a href="#使用场景" class="hash-link" aria-label="Direct link to 使用场景" title="Direct link to 使用场景">​</a></h4><ul><li>双向同步功能,支持Dubbo+Zookeeper服务平滑迁移到Dubbo+Nacos,享受Nacos更加优质的服务</li></ul><p><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2019/png/4232/1548136490076-13655b30-b0e4-4363-95dc-72b79a080fc0.png#align=left&amp;display=inline&amp;height=246&amp;linkTarget=_blank&amp;name=image.png&amp;originHeight=838&amp;originWidth=1728&amp;size=171454&amp;width=508" alt="image.png" class="img_ev3q"></p><ul><li>多个网络互通的Region之间服务共享,打破Region之间的服务调用限制</li></ul><p><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2019/png/4232/1548136895122-ba2be529-d959-4c9d-9fa4-74059bce1d18.png#align=left&amp;display=inline&amp;height=399&amp;linkTarget=_blank&amp;name=image.png&amp;originHeight=798&amp;originWidth=1136&amp;size=64731&amp;width=568" alt="image.png" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="支持的范围">支持的范围<a href="#支持的范围" class="hash-link" aria-label="Direct link to 支持的范围" title="Direct link to 支持的范围">​</a></h4><p>Nacos-Sync支持用户扩展不同注册中心服务同步，目前已支持的同步类型如下:</p><ul><li>Nacos数据同步到Nacos</li><li>Zookeeper数据同步到Nacos</li><li>Nacos数据同步到Zookeeper</li><li>Eureka数据同步到Nacos</li><li>Consul数据同步到Nacos</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="配置同步服务">配置同步服务<a href="#配置同步服务" class="hash-link" aria-label="Direct link to 配置同步服务" title="Direct link to 配置同步服务">​</a></h4><p>Nacos-Sync提供了控制台方便你配置同步的服务数据:</p><ul><li>同步任务管理页面</li></ul><p><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2019/png/4232/1548129423366-e1a37af4-3eb6-48f0-af76-84ec1f310ee2.png#align=left&amp;display=inline&amp;height=277&amp;linkTarget=_blank&amp;originHeight=1064&amp;originWidth=2866&amp;width=746" class="img_ev3q"></p><ul><li>注册中心管理页面</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="imagepng"><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2019/png/4232/1548129453620-f480a696-931b-4db4-b4c7-298ae7da029e.png#align=left&amp;display=inline&amp;height=562&amp;linkTarget=_blank&amp;name=image.png&amp;originHeight=1124&amp;originWidth=2876&amp;size=190668&amp;width=1438" alt="image.png" class="img_ev3q"><a href="#imagepng" class="hash-link" aria-label="Direct link to imagepng" title="Direct link to imagepng">​</a></h2><p>具体项目信息请参考<a href="https://github.com/nacos-group/nacos-sync" target="_blank" rel="noopener noreferrer">Nacos-Sync产品页</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="蓬勃发展的-nacos-社区">蓬勃发展的 Nacos 社区<a href="#蓬勃发展的-nacos-社区" class="hash-link" aria-label="Direct link to 蓬勃发展的 Nacos 社区" title="Direct link to 蓬勃发展的 Nacos 社区">​</a></h2><blockquote><p>DISS is cheap, show me your hand
比吐槽更重要的是搭把手，参与社区一起发展Nacos</p></blockquote><ul><li>作为用户关注和加入 Nacos 社区</li></ul><p>Nacos 社区正在蓬勃发展，截止到发文为止，Nacos 短短几个月已经有 9 个微信群，其中 7 个已满员，1个QQ群，1个钉钉群，关注 Nacos 的社区人数已经近5000人，在 Nacos 群里跟 “道（基）友” 切磋技术，交流经验，招聘交友，抢抢红包...不亦乐乎。</p><p>要加入 Nacos 微信社区，你可以通过扫下面的<strong>“超哥”</strong>“超哥”** 帮你拉入 “Nacos社区微信交流群”</p><p><img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2019/png/9687/1548047927520-89c34af8-899a-41b6-887c-9319461db519.png#align=left&amp;display=inline&amp;height=424&amp;linkTarget=_blank&amp;originHeight=1124&amp;originWidth=1984&amp;size=0&amp;width=748" class="img_ev3q"></p><ul><li>作为代码贡献者加入 Nacos 社区</li></ul><p>从Nacos用户发展而成贡献者顺理成章，而Nacos开发团队也确实在日趋壮大，从开始的只有4个代码contributor发展到目前的34个，在0.8.0 版本的开发中，社区同学贡献了很大的力量，在此特别感谢戚月同学设计登录UI，黄清昊同学贡献登录代码，王彦民同学贡献命名空间代码，张龙同学贡献nacos-sync代码，李晨同学贡献配置管理代码，明亦同学保证这个关键版本的测试质量，相信后续有跟多同学参与到Nacos社区的共建中。</p><p>而社区也正在计划在合适的时机上，将在Nacos官网 <a href="http://nacos.io/" target="_blank" rel="noopener noreferrer">nacos.io</a> 中添加团队介绍页，将大家正式公布于众，欢迎大家加入Nacos社区，贡献社区。用Apache的话说，<strong>“社区高于代码”!</strong></p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1542704700864-a9d54856-9bf6-4176-b449-c13fa02c5800.png#align=left&amp;display=inline&amp;height=387&amp;linkTarget=_blank&amp;originHeight=888&amp;originWidth=1716&amp;width=748" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="新人时刻---什么是nacos"><a href="https://yuque.alibaba-inc.com/nacos/opensource/dawygn#6gw6hq" target="_blank" rel="noopener noreferrer"></a>新人时刻 - "什么是Nacos？"<a href="#新人时刻---什么是nacos" class="hash-link" aria-label="Direct link to 新人时刻---什么是nacos" title="Direct link to 新人时刻---什么是nacos">​</a></h2><blockquote><p>还不知道什么是Nacos? 没关系，在github上star一下跟程序猿兄弟打个招呼吧!!</p></blockquote><p><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a> 是阿里巴巴于7月份新开源的项目，Nacos的主要愿景是期望通过提供易用的 <code>动态服务发现</code>、<code>服务配置管理</code>、<code>服务共享与管理</code> 的基础设施，帮助用户在云原生时代更好的构建、交付、管理自己的微服务平台。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1532436633419-08a42307-7fb7-4d51-9062-fecc3868613b.png#align=left&amp;display=inline&amp;height=355&amp;linkTarget=_blank&amp;originHeight=1014&amp;originWidth=2138&amp;width=748" class="img_ev3q"></p><p>github项目地址在 <a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">这里</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="更多与-nacos-相关的开源项目信息"><a href="https://yuque.alibaba-inc.com/nacos/opensource/dawygn#kn9iog" target="_blank" rel="noopener noreferrer"></a>更多与 Nacos 相关的开源项目信息<a href="#更多与-nacos-相关的开源项目信息" class="hash-link" aria-label="Direct link to 更多与-nacos-相关的开源项目信息" title="Direct link to 更多与-nacos-相关的开源项目信息">​</a></h2><ul><li><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a></li><li><a href="https://github.com/dubbo/dubbo-registry-nacos" target="_blank" rel="noopener noreferrer">Dubbo Registry Nacos</a></li><li><a href="https://github.com/nacos-group/nacos-coredns-plugin" target="_blank" rel="noopener noreferrer">Nacos DNS-F</a></li><li><a href="https://github.com/nacos-group/nacos-docker" target="_blank" rel="noopener noreferrer">Nacos Docker</a></li><li><a href="https://github.com/nacos-group/nacos-spring-project" target="_blank" rel="noopener noreferrer">Nacos Spring Project</a></li><li><a href="https://github.com/nacos-group/nacos-spring-boot-project" target="_blank" rel="noopener noreferrer">Nacos Spring Boot</a></li><li><a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba</a></li><li><a href="http://dubbo.io/" target="_blank" rel="noopener noreferrer">Dubbo</a></li><li><a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">Sentinel</a></li><li><a href="https://projects.spring.io/spring-cloud/" target="_blank" rel="noopener noreferrer">Spring Cloud</a></li><li><a href="https://github.com/Nepxion/Discovery" target="_blank" rel="noopener noreferrer">Nepxion Discovery</a></li><li><a href="https://github.com/SpringCloud/spring-cloud-gateway-nacos" target="_blank" rel="noopener noreferrer">Spring Cloud Gateway Nacos</a></li></ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[虎牙直播共建Nacos生态]]></title>
            <link>https://nacos.io/en/blog/huya-nacos</link>
            <guid>https://nacos.io/en/blog/huya-nacos</guid>
            <pubDate>Thu, 10 Jan 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[虎牙直播共建Nacos生态]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="https://img.alicdn.com/tfs/TB1i4ugBjDpK1RjSZFrXXa78VXa-1522-584.png" alt="huya" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="虎牙直播平台httpswwwhuyacom">虎牙直播平台(<a href="https://www.huya.com/" target="_blank" rel="noopener noreferrer">https://www.huya.com/</a>)<a href="#虎牙直播平台httpswwwhuyacom" class="hash-link" aria-label="Direct link to 虎牙直播平台httpswwwhuyacom" title="Direct link to 虎牙直播平台httpswwwhuyacom">​</a></h2><p>虎牙直播是中国一家以游戏直播为主的视频直播网站。网站以YY直播为名创建于2011年，隶属于欢聚时代，2014年11月24日更名为虎牙直播，开始独立运营。其海外版本为以东南亚为市场的Nimo TV。虎牙直播是国内最为资深的以游戏内容为核心的直播平台，其在游戏方面有丰富的独家资源，汇聚目前最为火爆的游戏，如英雄联盟、王者荣耀、球球大作战、守望先锋、炉石传说、绝地求生、绝地求生手游——刺激战场、全民突击等主题的直播内容。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="虎牙中间件团队介绍">虎牙中间件团队介绍<a href="#虎牙中间件团队介绍" class="hash-link" aria-label="Direct link to 虎牙中间件团队介绍" title="Direct link to 虎牙中间件团队介绍">​</a></h2><p>虎牙中间件团队主要负责虎牙服务注册发现与配置中心 ，负责均衡，中间件等平台相关的建设，致力于保障改进虎牙用户接入的请求成功率及请求耗时，为虎牙提供稳定可靠全球基础接入服务设施，服务间通信的基础设施。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="虎牙团队成功引入nacos到生产环境">虎牙团队成功引入Nacos到生产环境<a href="#虎牙团队成功引入nacos到生产环境" class="hash-link" aria-label="Direct link to 虎牙团队成功引入Nacos到生产环境" title="Direct link to 虎牙团队成功引入Nacos到生产环境">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-dns数据库高可用场景上落地">nacos dns数据库高可用场景上落地<a href="#nacos-dns数据库高可用场景上落地" class="hash-link" aria-label="Direct link to nacos dns数据库高可用场景上落地" title="Direct link to nacos dns数据库高可用场景上落地">​</a></h3><p>通过DNS-F和nacos实现基于域名的服务发现，数据库接入由ip方式改成域名接入，数据库切换在秒级完成，已在内部数十个业务系统上完成接入。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-cmdb方案落地">nacos cmdb方案落地<a href="#nacos-cmdb方案落地" class="hash-link" aria-label="Direct link to nacos cmdb方案落地" title="Direct link to nacos cmdb方案落地">​</a></h3><p>nacos通过支持spi扩展的方式， 支持虎牙将cmdb的数据导入到nacos中，  可以实现对注册实例打入来自cmdb标签，  实现基于cmdb标签的负载均衡功能，  赋予业务同机房调度， 同set调度，  基于自己定义的标签进行流量分发的能力。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tars服务框架融合nacos为注册中心">tars服务框架融合nacos为注册中心<a href="#tars服务框架融合nacos为注册中心" class="hash-link" aria-label="Direct link to tars服务框架融合nacos为注册中心" title="Direct link to tars服务框架融合nacos为注册中心">​</a></h3><p>通过nacos-sync这个中间件，将tars中的注册数据实时同步到nacos中，实现秒级同步tars中实例的变化， 同时提供高可用的集群方案；部署在国内外的nacos注册中心，满足业务就近注册服务，同时本地的服务会通过nacos-sync同步到其他集群，满足业务跨区域服务调用的需求。  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="负载均衡层解到nacos-config做配置管理">负载均衡层解到nacos config做配置管理<a href="#负载均衡层解到nacos-config做配置管理" class="hash-link" aria-label="Direct link to 负载均衡层解到nacos config做配置管理" title="Direct link to 负载均衡层解到nacos config做配置管理">​</a></h3><p>国内外流量接入层位于全球各地， 配置的推送服务遇到比较大的挑战。 nacos config通过部署3地的配置服务集群，国内外流量接入层可以就近拉取配置，解决使用国内单节点svn服务的的速度问题。同时通过使用集群方案和本地文件缓存机制保证配置服务的高可用， 解决之前svn的单点问题。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="未来计划">未来计划<a href="#未来计划" class="hash-link" aria-label="Direct link to 未来计划" title="Direct link to 未来计划">​</a></h3><p>虎牙后续会继续在nacos上持续投入，今后的内部service mesh，容器服务注册场景发力。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="虎牙中间件团队深入共建nacos">虎牙中间件团队深入共建Nacos<a href="#虎牙中间件团队深入共建nacos" class="hash-link" aria-label="Direct link to 虎牙中间件团队深入共建Nacos" title="Direct link to 虎牙中间件团队深入共建Nacos">​</a></h2><p>虎牙中间件团队也深入参与了Nacos生态的构建，核心成员张波、周建、李志鹏参与构建了包括Nacos的核心同步组件Nacos-sync、Nacos的DNS-F模块，把虎牙的业务模型和生产部署经验也共建到Nacos生态中,在过程当中，张波、周建、李志鹏成为了Nacos的核心Committer，是Nacos重要的社区成员。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos 有哪些典型的应用场景？—— 配置管理篇]]></title>
            <link>https://nacos.io/en/blog/5w1h-where</link>
            <guid>https://nacos.io/en/blog/5w1h-where</guid>
            <pubDate>Thu, 06 Dec 2018 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos 配置管理有哪些典型的应用场景？]]></description>
            <content:encoded><![CDATA[<blockquote><p>Authors: 何煦</p></blockquote><p><a href="/en/blog/5w1h-what">上篇</a>作为 Nacos 5W1H 系列文章的开篇，从“What” 讲述了 Nacos 配置管理能帮我们解决的问题：以简单、优雅、高效的方式管理配置，实现配置的动态变更，大大降低运维成本。</p><p>本文将围绕“Where”，讲述 Nacos 配置管理的三个典型的应用场景：</p><ul><li>数据库连接信息</li><li>限流阈值和降级开关</li><li>流量的动态调度</li></ul><h1>数据库连接信息</h1><p>曾经有朋友跟我聊过一个问题，“业务飞速发展，团队越来越大，人员流动也相对频繁起来，怎么才能更好的保证数据的安全性，不被泄露呢？”。他提到这样一个场景，公司创立初期，服务后端的代码都是他一行一行码出来的，当时只有他一个人，后端与数据库的连接配置信息也就直接放置在项目的配置文件中。他使用的是 Spring Boot 框架，配置信息就是存放在 <code>application.properties</code> 中，使用 Spring 的 profile 属性保证不同环境连接不同的数据库。如下所示：</p><p>生产环境：application-prod.properties</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring.datasource.url=生产环境的数据库连接地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.datasource.username=生产环境的数据库用户账号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.datasource.password=生产环境的数据库用户密码</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>开发环境：application-dev.properties</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spring.datasource.url=开发环境的数据库连接地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.datasource.username=开发环境的数据库用户账号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.datasource.password=开发环境的数据库用户密码</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试、预发环境也是类似。这种将数据库连接信息直接放置在配置文件中，跟着项目代码一起通过 Git 管理，的确是有蛮大的数据泄露的风险。试想，一个新来不久的小伙伴，他一当要投入研发工作，有 Git Pull 代码的权限之后，代表他可能就拥有了直接操作线上数据库的权限了。当时的我给他建议可以通过以下几个方面去降低数据风险：</p><ul><li>将数据库连接信息等敏感配置从项目中剥离；</li><li>数据库增加 IP 白名单连接限制；</li><li>最小权限原则：每个账号只配置所必需的权限，避免删表删库等高危操作；</li><li>定期修改数据库账号、密码。</li></ul><p>回想起来，我当时给的建议并没有完全解决他的问题，甚至还带来了其他一些问题。例如，上述的第一点，“将敏感配置从项目剥离”，剥离出来的敏感配置存放到哪里？怎么管理这些配置呢？也许，你会想到，存放到应用部署机器的环境变量或某个文件中。不，一样有风险，说不定哪天开发同学必须得登录上机器排查问题，就有泄露的风险，总之，得尽可能地做到在整个开发流程都不会有任何泄露的风险。应用中可能不只是连接一个数据源，分库分表的情况，不同数据存储（如 MySQL / Redis / Elasticsearch 等）的情况，还有，其他更多敏感配置项，配置数据的增多会给管理带来不便。</p><p>另外，“定期修改数据库账号、密码”，修改后我能怎么方便快捷的下发到所有应用程序中呢？既然是敏感配置，其变更也会带来不少的风险，我需要能先到小量的几台机器验证，保证对业务无影响，我再全部下发到其他所有的机器上去，是否还得有“灰度发布”的功能呢？账号密码修改下发后，应用出现异常，影响到业务了，我要怎么快速地回滚呢？是否还得有“版本控制”、“快速回滚”的功能呢？不是所有的开发同学都有权限能修改敏感配置信息，是否还需要有“权限管控”的功能？对敏感配置的任何操作都应该被记录，是否还需要有“变更审计”的功能呢？</p><p>现在，我有了更好的建议：使用 Nacos 配置管理模块，将敏感配置信息都存放到 Nacos 中。Nacos 配置管理，其中一个立身之本就是为敏感配置保驾护航。它提供上述场景所需的功能，通过命名空间区分不同环境（开发、测试、预发、生产），通过“版本控制”保证变更可追溯，通过“快速回滚”保证错误变更时影响最小，通过的“灰度发布”功能保障配置安全平稳地变更，还有更多更全面功能（权限管控、变更审计等）即将支持。</p><p>那么，怎么将敏感配置项目的配置文件中迁移到 Nacos 中呢？下面以 Spring Boot 连接 MySQL 为例：</p><ol><li>添加依赖</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;groupId&gt;com.alibaba.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;artifactId&gt;nacos-config-spring-boot-starter&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;version&gt;${latest.version}&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意 Spring Boot 1.x 使用 <code>nacos-config-spring-boot-starter</code> 0.1.x 版本，Spring Boot 2.x 使用 <code>nacos-config-spring-boot-starter</code> 0.2.x 版本。</p><ol start="2"><li>在 <code>application.properties</code> 中添加 Nacos 连接配置</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nacos.config.server-addr=127.0.0.1:8848</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里是简单的示例，在实际生产中，还需配置 Nacos 命名空间信息（区分环境）、鉴权信息（如 AccessKey、SecretKey 等，即将支持的权限访问控制）。而 Nacos 配置模块对应的阿里云产品 ACM，借助于 <a href="https://help.aliyun.com/document_detail/72013.html" target="_blank" rel="noopener noreferrer">ECS 实例 RAM 角色</a>，最终能到达连 AccessKey、SecretKey 都不需要填写的目的。</p><ol start="3"><li>添加 <code>@NacosPropertySource</code> 注解</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@NacosPropertySource(dataId = "mysql.properties")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SpringBootMySQLApplication {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SpringApplication.run(Application.class, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>在本地启动的 Nacos 控制台上新增 dataId 为 <code>mysql.properties</code> 的配置，配置内容为 MySQL 连接配置信息：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/96000/1543757963981-1a8a4a20-bb01-4b06-a17d-4bd27bb278b5.png" alt="image.png | left | 747x447" class="img_ev3q"></p><p>通过这四个简单的步骤，就将 MySQL 连接信息从原来的 <code>application.properties</code> 迁移到 Nacos 的，让 Nacos 将敏感配置管控起来，大大降低数据泄露的风险。同时，Nacos 配置管理提供的“统一管控”、“版本控制”、“快速回滚”等强大的功能也为其运维管理带来极大的便利。</p><p>完整示例代码请参看：<a href="https://github.com/nacos-group/nacos-examples/tree/master/nacos-spring-boot-example/nacos-spring-boot-config-mysql-example" target="_blank" rel="noopener noreferrer">https://github.com/nacos-group/nacos-examples/tree/master/nacos-spring-boot-example/nacos-spring-boot-config-mysql-example</a></p><h1>限流阈值和降级开关</h1><p>限流、降级，众所周知，是在开发高并发系统过程中需要考虑的两大关键点，是运行时保护系统的两大利器。限流阈值和降级开关，最终是抽象为一个个的配置项，要想实现运行时的动态调整阈值和开关的启停，将这些配置项存放到 Nacos 的配置模块中最适合不过了。</p><p>在今年 8 月的时候，阿里巴巴开源了 Sentinel，以流量为切入点，从流量控制、熔断降级、系统负载保护等多个维度保护服务的稳定性。在阿里巴巴内部，Nacos 跟 Sentinel 就是多年携手相伴，砥砺前行的好机油，为双 11 等各种大促立下了功劳，也为剁手党提供了良好的购物体验。</p><p>下面就以 Sentinel 流控为例，演示如果通过 Nacos 来做到运行时的动态控制流量：</p><ol><li>添加依赖</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;artifactId&gt;sentinel-core&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;version&gt;${latest.version}&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;artifactId&gt;sentinel-datasource-extension&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;version&gt;${latest.version}&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;artifactId&gt;sentinel-datasource-nacos&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;version&gt;${latest.version}&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;version&gt;${latest.version}&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>模拟并发请求</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">final class RunTask implements Runnable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void run() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (!stop) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Entry entry = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                entry = SphU.entry(resourceName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // token acquired, means pass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                pass.addAndGet(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } catch (BlockException e1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                block.incrementAndGet();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } catch (Exception e2) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // biz exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                total.incrementAndGet();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (entry != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    entry.exit();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Random random2 = new Random();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                TimeUnit.MILLISECONDS.sleep(random2.nextInt(50));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } catch (InterruptedException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // ignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>配置 Nacos 连接信息与 dataId 等，并将其设置为 Sentinel 的数据源</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class NacosDynamicFlowDemo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final String KEY = "TestResource";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        final String remoteAddress = "localhost";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        final String groupId = "DEFAULT_GROUP";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        final String dataId = "com.alibaba.nacos.demo.flow.rule";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ReadableDataSource&lt;String, List&lt;FlowRule&gt;&gt; flowRuleDataSource = new NacosDataSource&lt;&gt;(remoteAddress, groupId, dataId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            source -&gt; JSON.parseObject(source, new TypeReference&lt;List&lt;FlowRule&gt;&gt;() {}));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowRuleManager.register2Property(flowRuleDataSource.getProperty());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Assume we config: resource is `TestResource`, initial QPS threshold is 5.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FlowQpsRunner runner = new FlowQpsRunner(KEY, 1, 10000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        runner.simulateTraffic();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        runner.tick();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>在本地启动的 Nacos 控制台中新建 dataId 为 <code>com.alibaba.nacos.demo.flow.rule</code> 的流控配置</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/96000/1543757996381-9b766bd9-d400-4426-8c65-eb5d17fce5db.png" alt="image.png | left | 747x580" class="img_ev3q"></p><ol start="5"><li>运行 <code>NacosDynamicFlowDemo</code>，你会看到如下标准输出信息</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/96000/1543758470779-0a01e695-0ef9-4186-b737-190310eaf457.png" alt="image.png | left | 588x222" class="img_ev3q"></p><ol start="6"><li>再到 Nacos 控制台修改刚刚新建的流控配置，将限流阈值 <code>count</code> 的值修改为 <code>1.0</code>，完整的标准输出信息如下</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/96000/1543758536357-bdf7733b-aafc-482b-b0c7-27917434e643.png" alt="image.png | left | 592x392" class="img_ev3q"></p><p>以上示例演示了如何通过 Nacos + Sentinel 实现动态流量控制的能力，核心就是用到了 Nacos 配置模块“动态推送”的能力。原理是 <code>sentinel-datasource-nacos</code> 集成了 <code>nacos-client</code> ，其与 <code>nacos-server</code> 维持着连接，当用户在 Nacos 控制台进行配置变更时，<code>nacos-server</code> 会快速地将该配置的最新内容推送到 <code>nacos-client</code> 中，Sentinel 一拿到最新的流控配置，就转换了流控策略，如示例将流控阈值调整为 1.0，限制为更少的流量进入系统的业务处理流程。</p><p>完整示例代码请参看：<a href="https://github.com/nacos-group/nacos-examples/tree/master/nacos-sentinel-example" target="_blank" rel="noopener noreferrer">https://github.com/nacos-group/nacos-examples/tree/master/nacos-sentinel-example</a></p><h1>流量的动态调度</h1><p>业务发展壮大到一定的规模，单一的集群已经承载不了全部的用户请求，需要将用户的流量分流到不同的集群上。当然，更进一步的方案是：不同的集群位于不同的区域，这样，除了缓解业务处理的压力，也给系统带来容灾的能力。</p><p>比如，某电商系统有 1 亿用户量，将系统的流量按照用户的 ID 进行切分，ID 为 1-1000W 的用户请求分发到区域 A 的集群 a 上，ID 为 10001W-2000W 的用户请求流量分发到区域 B 的集群 b 上，以此类推，最终将所有用户的请求流量打散到 10 个不同区域的集群上，同时，每个集群冗余了一些系统资源。当区域 A 的机房发生不可抗的灾难（如地震）时，我们需要有动态调度流量的能力，最好能秒级得将流量从区域 A 调度到另外可用的区域的集群上。</p><p>这正是 Nacos 配置管理大有作为的地方，将用户 ID 的分片和对应的路由规则存放在 Nacos 的中，配合统一接入层等的组件，就能将流量打散到各个集群上，进而让系统能承载更大的流量，以更好的支撑业务的发展。另外，将其存放与 Nacos 中，也就具备了配置“动态化”的能力，一旦某区域出现基础设施无法及时恢复的问题时，只需在 Nacos 的控制台上修改 ID 分片的路由规则，就能将有问题的区域流量快速切换到其他可用的区域上，保障对业务几乎无损。Nacos 在阿里内部能做到秒级推送到十万级别机器上的推送效率。</p><h1>总结</h1><p>本文为 Nacos 5W1H 系列文章的第二篇，围绕“Where”，讲述了 Nacos 配置管理的几个典型的应用场景：数据库连接信息、限流阈值和降级开关、流量的动态调度。其实还有更多更大胆的应用场景，如“大数据实时计算算法调整”、“异地容灾多活”、“应用业务场景动态推送”等等，可以参看 <a href="https://help.aliyun.com/document_detail/59972.html" target="_blank" rel="noopener noreferrer">Nacos 的阿里云产品 ACM 的使用场景</a> 。Nacos 配置管理模块，将敏感配置收拢管控起来，极大降低数据泄露等风险，并且提供如“动态推送”、“版本控制”、“快速回滚”等功能，保障了敏感配置的变更安全平稳的执行。</p><p>在限流与降级的场景，通过一个示例，为大家演示了如何通过 Nacos + Sentinel 实现流量的动态控制，这也是 Nacos 配置管理的一个十分典型的应用场景。降级也一样，大促高峰期间将某个非关键的系统组件进行关闭，在过了高峰期后再开启，这个也是可以通过 Nacos 的“动态推送”的功能来实现。</p><p>总之，只要系统涉及到了“敏感的配置”、“动态的配置”，都应该考虑将配置放入到 Nacos 中，让 Nacos 管控起来。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1543892400157-f9dbf212-c835-44be-871c-73166b3b177b.png" alt="屏幕快照 2018-12-03 18.59.52.png | left" class="img_ev3q"></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[使用Nacos实现Spring Cloud Zuul的动态路由]]></title>
            <link>https://nacos.io/en/blog/dynamic-route-zuul-nacos</link>
            <guid>https://nacos.io/en/blog/dynamic-route-zuul-nacos</guid>
            <pubDate>Thu, 29 Nov 2018 00:00:00 GMT</pubDate>
            <description><![CDATA[使用Nacos实现Spring Cloud Zuul的动态路由]]></description>
            <content:encoded><![CDATA[<blockquote><p>authors:叶志远</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="一前言">一.前言<a href="#一前言" class="hash-link" aria-label="Direct link to 一.前言" title="Direct link to 一.前言">​</a></h3><p>Nacos是阿里巴巴开源的致力于服务发现与管理、动态配置管理，以及动态DNS服务的中间件，目前已发布至0.5.0版本，除了与Spring Cloud更加紧密结合以外，还丧心病狂地支持JDK11。如果您目前的项目碍于Eureka的性能，而又缺乏成本引进Consul，那么Nacos是您最好的选择。好了，回到正题，在上周许进搞了一个<a href="http://xujin.org/sc/gw/gw10/" target="_blank" rel="noopener noreferrer">使用Nacos实现Spring Cloud Gateway的动态路由</a>，让我们直观地感受到了Nacos的无缝接入如丝般顺滑，作为Spring Cloud中网关的始祖Zuul，自然也需要这一贴心赋能。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="二spring-cloud-zuul动态路由实现思路">二.Spring Cloud Zuul动态路由实现思路<a href="#二spring-cloud-zuul动态路由实现思路" class="hash-link" aria-label="Direct link to 二.Spring Cloud Zuul动态路由实现思路" title="Direct link to 二.Spring Cloud Zuul动态路由实现思路">​</a></h3><p>在社区书籍《重新定义Spring Cloud实战》中第8章4小节，详细剖析了Zuul的路由配置表加载以及刷新原理，其大致思想就是重写SimpleRouteLocator类的locateRoutes()方法，同时实现RefreshableRouteLocator接口，方法体引用父类的doRefresh()方法。在书中使用DB作为配置存放的仓库，如今有更为强大的Nacos，只需要将之前读取DB的逻辑换成读取Nacos即可。美中不足的是，由于Nacos还需进一步完善，目前对Spring Cloud中的事件支持还不是很完美，动态刷新只能依靠Zuul的内部逻辑。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="三具体实现">三.具体实现<a href="#三具体实现" class="hash-link" aria-label="Direct link to 三.具体实现" title="Direct link to 三.具体实现">​</a></h3><h5 class="anchor anchorWithStickyNavbar_LWe7" id="1在zuul-server中添加nacos的配置">1.在zuul-server中添加Nacos的配置<a href="#1在zuul-server中添加nacos的配置" class="hash-link" aria-label="Direct link to 1.在zuul-server中添加Nacos的配置" title="Direct link to 1.在zuul-server中添加Nacos的配置">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;version&gt;0.4.0&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/dependency&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="2读取nacos配置信息核心代码">2.读取Nacos配置信息核心代码<a href="#2读取nacos配置信息核心代码" class="hash-link" aria-label="Direct link to 2.读取Nacos配置信息核心代码" title="Direct link to 2.读取Nacos配置信息核心代码">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class PropertiesAssemble{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Map&lt;String, ZuulRoute&gt; getProperties() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, ZuulRoute&gt; routes = new LinkedHashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;ZuulRouteEntity&gt; results = listenerNacos("zuul-server","zuul_route");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (ZuulRouteEntity result : results) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (StringUtils.isBlank(result.getPath())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    /*|| org.apache.commons.lang3.StringUtils.isBlank(result.getUrl())*/) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ZuulRoute zuulRoute = new ZuulRoute();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                BeanUtils.copyProperties(result, zuulRoute);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            routes.put(zuulRoute.getPath(), zuulRoute);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return routes;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;ZuulRouteEntity&gt; listenerNacos (String dataId, String group) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Properties properties = new Properties();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            properties.put(PropertyKeyConst.SERVER_ADDR, "localhost:8848");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ConfigService configService = NacosFactory.createConfigService(properties);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String content = configService.getConfig(dataId, group, 5000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println("从Nacos返回的配置：" + content);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //注册Nacos配置更新监听器，用于监听触发</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            configService.addListener(dataId, group, new Listener()  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                public void receiveConfigInfo(String configInfo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                    System.out.println("Nacos更新了！");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                public Executor getExecutor() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                    return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return JSONObject.parseArray(content, ZuulRouteEntity.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (NacosException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            e.printStackTrace();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>目前的demo写得比较简单，直接将Nacos的默认地址与端口写了进来，Nacos对于配置的管理有两个坐标，一是dataId，二是group，本demo中笔者将其分别命名为"zuul-server","zuul_route"。</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="3zuul动态刷新路由实现">3.Zuul动态刷新路由实现<a href="#3zuul动态刷新路由实现" class="hash-link" aria-label="Direct link to 3.Zuul动态刷新路由实现" title="Direct link to 3.Zuul动态刷新路由实现">​</a></h5><p>这部分可以查看demo地址：<a href="https://github.com/SpringCloud/spring-cloud-zuul-nacos" target="_blank" rel="noopener noreferrer">https://github.com/SpringCloud/spring-cloud-zuul-nacos</a>，具体就不赘述。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="四演示">四.演示<a href="#四演示" class="hash-link" aria-label="Direct link to 四.演示" title="Direct link to 四.演示">​</a></h3><h5 class="anchor anchorWithStickyNavbar_LWe7" id="1从nacos-github地址pull源码配置环境">1.从Nacos github地址pull源码，配置环境<a href="#1从nacos-github地址pull源码配置环境" class="hash-link" aria-label="Direct link to 1.从Nacos github地址pull源码，配置环境" title="Direct link to 1.从Nacos github地址pull源码，配置环境">​</a></h5><p><img loading="lazy" src="https://img-blog.csdnimg.cn/20181129002717633.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JpY2tpeWVhdA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" class="img_ev3q">
这里需要在IDEA中添加启动参数-Dnacos.standalone=true
<img loading="lazy" src="https://img-blog.csdnimg.cn/20181129002856286.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JpY2tpeWVhdA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" class="img_ev3q"></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="2启动nacos配置zuul路由信息">2.启动Nacos，配置Zuul路由信息<a href="#2启动nacos配置zuul路由信息" class="hash-link" aria-label="Direct link to 2.启动Nacos，配置Zuul路由信息" title="Direct link to 2.启动Nacos，配置Zuul路由信息">​</a></h5><p>启动Nacos后，在浏览器输入<a href="http://localhost:8848/nacos/index.html" target="_blank" rel="noopener noreferrer">http://localhost:8848/nacos/index.html</a>便会跳转到如下页面：
<img loading="lazy" src="https://img-blog.csdnimg.cn/2018112900323177.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JpY2tpeWVhdA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" class="img_ev3q">
点击配置列表，单击右侧的+号图标，便可以新增一项配置，由于这里已经添加好了，就直接看信息：
<img loading="lazy" src="https://img-blog.csdnimg.cn/20181129003545464.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JpY2tpeWVhdA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" class="img_ev3q"></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="3启动zuul-server从nacos加载路由信息测试">3.启动zuul-server，从Nacos加载路由信息测试<a href="#3启动zuul-server从nacos加载路由信息测试" class="hash-link" aria-label="Direct link to 3.启动zuul-server，从Nacos加载路由信息测试" title="Direct link to 3.启动zuul-server，从Nacos加载路由信息测试">​</a></h5><p>启动Zuul后，console中出现如下信息：
<img loading="lazy" src="https://img-blog.csdnimg.cn/20181129003851880.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JpY2tpeWVhdA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" class="img_ev3q">
在浏览器输入<a href="http://localhost:5555/baidu" target="_blank" rel="noopener noreferrer">http://localhost:5555/baidu</a>,出现如下效果，直接跳转到目标地址：
<img loading="lazy" src="https://img-blog.csdnimg.cn/2018112900414387.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JpY2tpeWVhdA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" class="img_ev3q">
我们现在将Nacos中的配置修改一下，将<a href="http://github.com/Lovnx%E6%8D%A2%E6%88%90http://www.baidu.com%EF%BC%8C%E4%BF%AE%E6%94%B9%E5%90%8E%E7%9B%B4%E6%8E%A5%E5%8F%91%E5%B8%83%EF%BC%9A" target="_blank" rel="noopener noreferrer">http://github.com/Lovnx换成http://www.baidu.com，修改后直接发布：</a>
<img loading="lazy" src="https://img-blog.csdnimg.cn/20181129004408166.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JpY2tpeWVhdA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" class="img_ev3q">
我们会在console看到：
<img loading="lazy" src="https://img-blog.csdnimg.cn/20181129004524375.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JpY2tpeWVhdA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" class="img_ev3q">
在浏览器输入<a href="http://localhost:5555/baidu" target="_blank" rel="noopener noreferrer">http://localhost:5555/baidu</a>,出现如下效果：
<img loading="lazy" src="https://img-blog.csdnimg.cn/20181129004810756.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JpY2tpeWVhdA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-------------------demo源码"><a href="https://github.com/SpringCloud/spring-cloud-zuul-nacos" target="_blank" rel="noopener noreferrer">-------------------&gt;&gt;&gt;DEMO源码</a><a href="#-------------------demo源码" class="hash-link" aria-label="Direct link to -------------------demo源码" title="Direct link to -------------------demo源码">​</a></h2>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos 0.6版本发布，支持Dubbo生态并且支持Docker部署]]></title>
            <link>https://nacos.io/en/blog/nacos0.6</link>
            <guid>https://nacos.io/en/blog/nacos0.6</guid>
            <pubDate>Thu, 29 Nov 2018 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos 0.6版本发布，支持Dubbo生态并且支持Docker部署]]></description>
            <content:encoded><![CDATA[<blockquote><p>Authors: 马昕曦、张龙、邢学超</p></blockquote><p> Alibaba Microservices Open Source Project<a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Dubbo Nacos</a>released this week <strong>v0.6</strong> version, which mainly supports Dubbo's service registration and discovery and configuration management, supports docker deployment, provides an official docker image, optimizes the international framework of Nacos console, and optimizes Nacos's integration testing efficiency.</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/11189/1544689744102-fd00fec6-ca80-4c0c-9b0d-538f17279963.png" alt="image.png | left | 747x290" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="thousands-of-calls-come-out-dubbos-registration-center-and-configuration-center">Thousands of calls come out, Dubbo's registration center and configuration center<a href="#thousands-of-calls-come-out-dubbos-registration-center-and-configuration-center" class="hash-link" aria-label="Direct link to Thousands of calls come out, Dubbo's registration center and configuration center" title="Direct link to Thousands of calls come out, Dubbo's registration center and configuration center">​</a></h2><p><strong>Nacos</strong> Starting with the <strong>v0.6</strong> version, the <strong>Dubbo</strong> registration center and configuration center are supported. Also, as Alibaba's open source weight-level product, the two products are inextricably linked within the internal Alibaba Group.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dubbo-service-framework">Dubbo Service Framework<a href="#dubbo-service-framework" class="hash-link" aria-label="Direct link to Dubbo Service Framework" title="Direct link to Dubbo Service Framework">​</a></h3><p>As the rpc service framework, on the one hand, it pays attention to the extremely short delay rt, which ensures that the overall call is efficient, and on the other hand, guarantees a good user experience, ensuring user comfort and good scalability. Dubbo is very good in both aspects, and is widely used in the industry because of its good expansion. The popularity and popularity of Dubbo is evident through the 2w+ github warehouse star attention.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-and-dubbo-are-the-same-genes">Nacos and Dubbo are the same genes<a href="#nacos-and-dubbo-are-the-same-genes" class="hash-link" aria-label="Direct link to Nacos and Dubbo are the same genes" title="Direct link to Nacos and Dubbo are the same genes">​</a></h3><p>But there is such an efficient rpc service framework under Alibaba's technology system, but what is supporting Alibaba's huge service cluster? It is well known that Alibaba Group has a terrible cluster size. Every year, Alibaba Group's Tmall Double 11 Global Shopping Carnival will have a rid of the chin trading scale. In 2018, the Double 11 will carry 213.5 billion in sales. But as a technician, the biggest concern is the peak. If careful practitioners should see an indicator, in 2018 Tmall carried a peak of transaction creation of 491,000 pens per second. For example, Beijing Bird's Nest Stadium has a maximum carrying capacity of 91,000 people, and 49.1w transactions per second, which means that the full audience of the five Bird's Nest stadiums pushes the shopping cart and simultaneously clears the settlement of Tmall Taobao in one second. Taiwan, this pressure can be imagined. But behind the hosting of such a large-scale service cluster, and Alibaba Dubbo's internal use framework HSF, corresponding to ConfigServer, and this is one of Nacos' predecessors. The 0.6 version released by Nacos is the perfect integration with Dubbo. It also announces that Alibaba's experience in large-scale clusters will be shared with Nacos, Dubbo, Sentinel and other contributions to the open source community.</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/11189/1544696219150-b786e8fe-af7d-4e29-9c32-03b051c6db3d.png" alt="image.png | left | 747x413" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dubbo-fusion-nacos">Dubbo Fusion Nacos<a href="#dubbo-fusion-nacos" class="hash-link" aria-label="Direct link to Dubbo Fusion Nacos" title="Direct link to Dubbo Fusion Nacos">​</a></h3><p>Nacos is an important registry infrastructure in the Dubbo ecosystem, with <a href="https://github.com/dubbo/dubbo-registry-nacos" target="_blank" rel="noopener noreferrer">dubbo-registry-nacos</a> being the bridge for Dubbo's Fusion Nacos registry, based on Dubbo Powerful <a href="http://dubbo.apache.org/en-us/docs/dev/impls/registry.html" target="_blank" rel="noopener noreferrer">Registry SPI</a> and Nacos Naming services provide real-time service registration and discovery. Currently <a href="https://github.com/dubbo/dubbo-registry-nacos" target="_blank" rel="noopener noreferrer">dubbo-registry-nacos</a> is in the preview stage, the latest release is <code>0.0.2</code>, the latest Dubbo and Dubbo OPS have been tested, recommended Developers use the latest Dubbo <code>2.6.5</code> and Nacos <code>0.6.1</code> to ensure the best experience. If you are currently using ZooKeeper or Redis as your registry, the migration to Nacos is also very simple, with Zookeeper as an example:</p><ul><li>Scene 1: Externalization configuration</li></ul><p>Pre-adjustment configuration:</p><div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Zookeeper registry address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dubbo.registry.address = zookeeper://127.0.0.1:2181</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Adjusted configuration:</p><div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## Nacos registry address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dubbo.registry.address = nacos://127.0.0.1:8848</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Scenario 2: XML configuration driver</li></ul><p>Pre-adjustment configuration:</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Use Zookeeper Registration Center --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">dubbo:</span><span class="token tag" style="color:#00009f">registry</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">address</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">zookeeper://127.0.0.1:2181</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Adjusted configuration:</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Use Nacos Registration Center --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag namespace" style="color:#00009f;opacity:0.7">dubbo:</span><span class="token tag" style="color:#00009f">registry</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">address</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">nacos://127.0.0.1:8848</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once the adjustment is complete, make sure the Nacos Server is up and restart your Dubbo app, then you will see the registration information in the Nacos console Service List:</p><p><a href="https://cdn.nlark.com/lark/0/2018/png/11189/1544694815618-d316c463-701a-4095-a7d4-30bb0ec941b6.png" target="_blank" rel="noopener noreferrer">image-20181213174408269-4694248.png | left | 747x132</a></p><p>If you are interested in integrating Dubbo and Nacos, you may wish to visit the project homepage for more details at:</p><ul><li>Dubbo Nacos Registry: <a href="https://github.com/dubbo/dubbo-registry-nacos" target="_blank" rel="noopener noreferrer">https://github.com/dubbo/dubbo-registry-nacos</a></li><li>Apache Dubbo: <a href="https://github.com/apache/incubator-dubbo" target="_blank" rel="noopener noreferrer">https://github.com/apache/incubator-dubbo</a></li></ul><p>If you encounter any problems and have any suggestions during the process, please visit <!-- -->[https://github.com/dubbo/dubbo-registry-nacos/issues]<!-- -->(<a href="https://github.com/dubbo/dubbo" target="_blank" rel="noopener noreferrer">https://github.com/dubbo/dubbo</a> -registry-nacos/issues) for discussion.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="containers-are-popular-nacos-supports-docker-containerization">Containers are popular, Nacos supports Docker containerization<a href="#containers-are-popular-nacos-supports-docker-containerization" class="hash-link" aria-label="Direct link to Containers are popular, Nacos supports Docker containerization" title="Direct link to Containers are popular, Nacos supports Docker containerization">​</a></h2><p>Today, when containers are popular, support for containerization has become a necessity, and Docker has chosen as the container for most people. Nacos announced in v0.6.
Support for Docker deployments, and provide an official image, and will support k8s deployment in the next few releases.</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/11189/1544696801216-88a41d17-d101-4546-acfd-0aba38c6fa81.png" alt="image.png | left | 747x285" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-deploy-via-docker">How to deploy via Docker<a href="#how-to-deploy-via-docker" class="hash-link" aria-label="Direct link to How to deploy via Docker" title="Direct link to How to deploy via Docker">​</a></h3><p>Local needs to make sure that Docker has been followed. If it is not installed, please refer to <a href="https://docs.docker.com/install/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/install/</a>. After installation, you can quickly pull the image from the remote and pick up a stand-alone version of Nacos to experience it.
Simple and rude, run the following command:</p><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Docker run --name nacos-standalone -e MODE=standalone -p 8848:8848 nacos/nacos-server:latest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The operation test is as follows:</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/gif/11189/1544701054438-de9785c4-b9ab-46dc-a162-d22e1419a172.gif" alt="Peek 2018-12-13 11-43.gif | left | 747x407" class="img_ev3q"></p><p>Another application, <a href="https://docs.docker.com/compose/" target="_blank" rel="noopener noreferrer">docker-compose</a> orchestration, you can refer to the following command:</p><ol><li>git clone the project and go to the project root directory</li></ol><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Git clone https://github.com/nacos-group/nacos-docker.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cd nacos-docker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Start</li></ol><ul><li>Stand-alone start</li></ul><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Docker-compose -f example/standalone.yaml up</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Cluster boot</li></ul><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Docker-compose -f example/cluster-hostname.yaml up</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>At this point your Nacos is up and you can experience the Nacos feature by visiting <a href="http://localhost:8848/nacos/index.html" target="_blank" rel="noopener noreferrer">http://localhost:8848/nacos/index.html</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-management-function-experience">Configuration Management Function Experience<a href="#configuration-management-function-experience" class="hash-link" aria-label="Direct link to Configuration Management Function Experience" title="Direct link to Configuration Management Function Experience">​</a></h4><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/gif/11189/1544496461571-69f38431-6452-4ddd-8211-c2da28f2ebcf.gif" alt="Peek 2018-12-11 10-11.gif | left | 747x351" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="service-discovery-feature-experience">Service Discovery Feature Experience<a href="#service-discovery-feature-experience" class="hash-link" aria-label="Direct link to Service Discovery Feature Experience" title="Direct link to Service Discovery Feature Experience">​</a></h4><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/gif/11189/1544521437636-674de542-1873-426b-a2dd-da8265bc267f.gif" alt="Peek 2018-12-11 11-11.gif | left | 747x351" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-booming-nacos-community">The booming Nacos community<a href="#the-booming-nacos-community" class="hash-link" aria-label="Direct link to The booming Nacos community" title="Direct link to The booming Nacos community">​</a></h2><blockquote><p>DISS is cheap, show me your hand
More important than the spit is to take the handle and participate in the community to develop Nacos</p></blockquote><ul><li>Follow the user as a user and join the Nacos community</li></ul><p>The Nacos community is booming. As of the date of publication, Nacos has five WeChat groups in just a few months, four of which are full, one QQ group, one nail group, and nearly 3,000 people who care about Nacos. In the Nacos group, we will learn from the "Tao (base) friends", exchange experiences, recruit friends, grab red envelopes... and enjoy it.</p><p>To join the Nacos WeChat community, you can use the WeChat QR code of <strong>“超哥”</strong> below to let <strong>“超哥”</strong> help you pull in “Nacos Community WeChat Exchange Group”</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077965587-8f4e3100-bdd4-469a-9ea0-7af7061bc9ef.png" alt="Screen Shot 2018-06-27 at 13.39.09.png | left" class="img_ev3q"></p><ul><li>Join the Nacos community as a code contributor</li></ul><p>From the development of Nacos users to contributors, and the Nacos development team is indeed growing, from the beginning of only four code contributions to the current 24, with <strong>Alibaba</strong> other team members such as <strong>@小马哥</strong>, <strong>虎牙直播__</strong>@张波__ <strong>@周健</strong> Team et al, <!-- -->[nacos-docker-k8s]<!-- -->(<a href="https://github.com/nacos-group" target="_blank" rel="noopener noreferrer">https://github.com/nacos-group</a> /nacos-docker) Contributors <strong>@张龙</strong>, the main contributors to the front end are hungry <strong>@王彦民</strong>, the founder of Spring Cloud Chinese community <strong>@许进</strong> etc. The power of the Nacos community will grow stronger in the future.</p><p>The community is also planning to add a team introduction page to Nacos's official website <a href="http://nacos.io" target="_blank" rel="noopener noreferrer">nacos.io</a> at the right time, and everyone will be officially announced. Welcome everyone to join the Nacos community and contribute to the community. . In the words of Apache, <strong>"Community is higher than the code"!</strong></p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1542704700864-a9d54856-9bf6-4176-b449-c13fa02c5800.png" alt="屏幕快照 2018-11-20 17.04.45.png | left" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="newcomer-moments---what-is-nacos">Newcomer Moments - "What is Nacos?"<a href="#newcomer-moments---what-is-nacos" class="hash-link" aria-label="Direct link to Newcomer Moments - &quot;What is Nacos?&quot;" title="Direct link to Newcomer Moments - &quot;What is Nacos?&quot;">​</a></h2><blockquote><p>I don't know what Nacos is? It doesn't matter, star on the github and say hello to the program brothers!!</p></blockquote><p><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a> is Alibaba's new open source project in July. Nacos's main vision is to provide easy-to-use <code>Dynamic Service Discovery</code>, <code>Service Configuration Management</code>, The infrastructure of "Service Sharing and Management" helps users better build, deliver and manage their own microservices platforms in the cloud's native era.</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1532436633419-08a42307-7fb7-4d51-9062-fecc3868613b.png" alt="Screen Shot 2018-07-24 at 19.27.28.png | left" class="img_ev3q"></p><p>Github project address is <a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">here</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="more-open-source-project-information-related-to-nacos">More open source project information related to Nacos<a href="#more-open-source-project-information-related-to-nacos" class="hash-link" aria-label="Direct link to More open source project information related to Nacos" title="Direct link to More open source project information related to Nacos">​</a></h2><ul><li><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a></li><li><a href="https://github.com/dubbo/dubbo-registry-nacos" target="_blank" rel="noopener noreferrer">Dubbo Registry Nacos</a></li><li><a href="https://github.com/nacos-group/nacos-coredns-plugin" target="_blank" rel="noopener noreferrer">Nacos DNS-F</a></li><li><a href="https://github.com/nacos-group/nacos-docker" target="_blank" rel="noopener noreferrer">Nacos Docker</a></li><li><a href="https://github.com/nacos-group/nacos-spring-project" target="_blank" rel="noopener noreferrer">Nacos Spring Project</a></li><li><a href="https://github.com/nacos-group/nacos-spring-boot-project" target="_blank" rel="noopener noreferrer">Nacos Spring Boot</a></li><li><a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba</a></li><li><a href="http://dubbo.io" target="_blank" rel="noopener noreferrer">Dubbo</a></li><li><a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">Sentinel</a></li><li><a href="https://projects.spring.io/spring-cloud/" target="_blank" rel="noopener noreferrer">Spring Cloud</a></li><li><a href="https://github.com/Nepxion/Discovery" target="_blank" rel="noopener noreferrer">Nepxion Discovery</a></li><li><a href="https://github.com/SpringCloud/spring-cloud-gateway-nacos" target="_blank" rel="noopener noreferrer">Spring Cloud Gateway Nacos</a></li></ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos0.5发布，支持DNS-based Service Discovery，JAVA 11]]></title>
            <link>https://nacos.io/en/blog/nacos0.5</link>
            <guid>https://nacos.io/en/blog/nacos0.5</guid>
            <pubDate>Sun, 25 Nov 2018 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos0.5发布，支持DNS-based Service Discovery，JAVA 11]]></description>
            <content:encoded><![CDATA[<blockquote><p>Authors: 坤宇，敦谷</p></blockquote><p>阿里巴巴微服务开源项目<a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Dubbo Nacos</a>于本周发布 <strong>v0.5.0</strong> 版本，该版本主要在 DNS-based Service Discovery，支持 TTL，支持 Java 11，优化Nacos产品用户体验，与Spring Cloud Gateway的集成等方面做了演进。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="发布-dns-f支持-dns-based-service-discovery">发布 DNS-F，支持 DNS-based Service Discovery<a href="#发布-dns-f支持-dns-based-service-discovery" class="hash-link" aria-label="Direct link to 发布 DNS-F，支持 DNS-based Service Discovery" title="Direct link to 发布 DNS-F，支持 DNS-based Service Discovery">​</a></h2><p>为了进一步降低微服务多语言生态、异构系统、Kubernetes体系的服务注册与发现的实现成本，Nacos v0.5.0 发布了一款基于CoreDNS的 <strong>DNS-F</strong>客户端，通过 <strong>DNS-F</strong> 支持将注册在Nacos上的服务以DNS域名的方式暴露出接入点，让三方应用方便的查阅、发现与集成。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1542705469700-1e4ffc48-9632-4495-a8dd-c3dc8647b345.png" alt="屏幕快照 2018-11-20 17.17.38.png" class="img_ev3q"> </p><p><strong>DNS-F</strong> 不同于Nacos的 Client SDK/API 服务发现模式，<strong>DNS-F</strong> 提供独立于应用进程的Agent, 通过拦截并代理主机应用的域名解析请求，让Nacos处理服务发现对应域名的数据动态推送更新、健康检查、异常节点下线等、同时Nacos UI提供统一的服务发现域名管理视图 (UI域名管理部分，v0.5.0暂未开放)。</p><p>在Nacos的立项之初，提供动态的基于 DNS 协议的服务发现能力就是其核心的三大功能之一，之所以Nacos要提供DNS-SD，主要旨在帮助用户解决三个方面的问题:</p><ul><li><strong>为Kubernetes以及应用的服务发现提供统一解决方案</strong></li></ul><p>应用微服务体系（如Spring Cloud）+ Kubernetes已经逐渐成为新的组合，通过前者解决应用架构问题，通过后者解决微服务部署及运维的成本问题，但是在服务发现这一块，毫无疑问，Kubernetes体系内的服务发现方案无论是SkyDNS，KubeDNS还是CoreDNS，一直都是基于DNS的，但是像Spring Cloud则是基于像Eureka,zookeeper这样的服务发现方案，这种方案的异化和沟鸿给用户统一服务发现和服务管理方案带来了巨大的挑战。</p><p>Nacos DNS-F 目前开源提供的版本，是在CoreDNS的基础上提供了Nacos的plugin <a href="https://github.com/nacos-group/nacos-coredns-plugin" target="_blank" rel="noopener noreferrer">nacos-coredns-plugin</a>, 这样初步打通了CoreDNS与Nacos服务, 这种实现方式为未来Nacos进一步打通Kubernetes集群内部的服务发现与应用服务发现（如Spring Cloud)提供了通路，为Nacos在未来帮助应用以统一的视图管理Kubernetes内部及应用自身的服务及域名提供了基础，从而帮助用户简化基于kubernetes体系的微服务平台的构建与管理。</p><ul><li><strong>帮助用户消除耦合到厂商私有服务发现API上的风险</strong></li></ul><p>很不幸的说，到目前为止，服务发现迄今仍然没有标准协议，市面上的服务发现的解决方案有很多，仅在Java Spring生态中，就有zookeeper，consul，eureka，nacos等解决方案可以用，更不用说在其它的语言和框架中了，Nacos通过提供 <strong>DNS-F</strong>，可以让用户更容易地实现以DNS协议为基础的服务发现（即<strong>DNS-SD</strong>），而DNS协议是一个成熟的标准协议，基于DNS做服务发现，不仅可以有效的帮助用户消除耦合到厂商私有服务发现API上的风险，方便未来的迁移，也有利于服务提供方以更标准的和易理解的方式暴露自己的服务，从而更易于被不同的应用方发现和集成。</p><ul><li><strong>支持异构系统及多语言生态的服务发现</strong></li></ul><p>在一个中大型企业中，传统企业架构要升级为云原生微服务架构，遗留系统和异构系统的服务注册与发现无疑是必须首要解决的问题。另外采用微服务架构的一大承诺收益点也在于每个微服务本身可以独立选择更合适的语言栈，但是到目前为止没有个一个服务发现产品能提供各种语言客户端SDK的100%的完全覆盖，以zookeeper为例子，zookeeper质量比较好的客户端仅有java和c的客户端，那么非java和c两个语言体系的服务和系统就很难通过zookeeper来注册与发现，而DNS天然是各种语言都支持的，一般使用DNS做服务发现对应用的侵入非常的小，非常适合遗留应用或者异构应用往新的微服务平台上的迁移。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="阿里巴巴基于dns-f的dns-sd生产实践">阿里巴巴基于DNS-F的DNS-SD生产实践<a href="#阿里巴巴基于dns-f的dns-sd生产实践" class="hash-link" aria-label="Direct link to 阿里巴巴基于DNS-F的DNS-SD生产实践" title="Direct link to 阿里巴巴基于DNS-F的DNS-SD生产实践">​</a></h3><p>以阿里巴巴为例，基于<strong>DNS-F</strong>模式的服务发现已经是阿里巴巴生产环境中的最重要服务发现方式之一，不同于外界对于阿里巴巴的印象，在像阿里妈妈，高德，优酷，搜索等这样的业务中，存在大量的重要的非Java语言体系的业务系统提供的服务，而基于DNS-F的DNS-SD解决方案，则在发现，打通和勾连这些异构服务的过程中起到了举足轻重的作用。</p><p>距离阿里巴巴内部发布的第一个python版本的<strong>DNS-F</strong>客户端已经过去<strong>5</strong>个年头，python版本的<strong>DNS-F</strong>客户端在生产上的整体装机使用量，对所有VIPServer各语言客户端的占比已经超过 <strong>1/3</strong>,可见其在内部应用之广泛，而不用绑定在私有的VIPServer API上, 业务从LVS/VIP，SLB等网关式(Server-based SD)服务发现方案迁移过来时对业务侵入小，也是众多业务线愿意优先考虑<strong>DNS-F</strong>客户端的首要原因。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dns-协议需要继续演进">DNS 协议需要继续演进<a href="#dns-协议需要继续演进" class="hash-link" aria-label="Direct link to DNS 协议需要继续演进" title="Direct link to DNS 协议需要继续演进">​</a></h3><p>DNS协议本身是为www而生，并非为服务发现而生，所以在协议上，用在服务发现场景下DNS依然有不少的小瑕疵需要在未来从协议层面解决，比如DNS缓存TTL收敛的问题，比如操作系统以及各语言对SRV Record字段的支持问题,DNS包大小限制的问题等等，但随着Kubernetes以及微服务体系在各行业的深入应用，可以说DNS协议已经有为服务发现场景做进一步向前演进的必要，这方面阿里巴巴&amp;<strong>Nacos</strong>会做持续的探索和推进。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="支持-java-11">支持 Java 11<a href="#支持-java-11" class="hash-link" aria-label="Direct link to 支持 Java 11" title="Direct link to 支持 Java 11">​</a></h2><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1542708832647-def4c40d-273c-4515-8ee9-27fd9add5b03.png" alt="屏幕快照 2018-11-20 18.13.36.png" class="img_ev3q"> </p><p>9月25日，Oracle 官方宣布 Java 11正式发布，不同于Java 9以及10，这是继 Java 8 之后的首个长期支持版本，Java 11 在诸如 ZGC，TLS 1.3，新的算法密钥协议，Lambda局部变量语法支持，Standardize HTTP Client API等不少方面做了改进，确实值得关注。</p><p>关于 Nacos 支持 Java 11, 这里有一个有趣的花絮,本来Nacos没有计划在近期的版本支持Java 11,因为Nacos团队考虑到 Java 8 依然是生产上的主流(参见<a href="https://res.cloudinary.com/snyk/image/upload/v1539774333/blog/jvm-ecosystem-report-2018.pdf" target="_blank" rel="noopener noreferrer">JVM生态报告</a>, 报告显示 <strong>79%</strong> 的 Java 开发者使用 Java 8 作为生产环境的主要平台), 但是Spring Cloud 大神 <strong>@Josh Long</strong> 在准备尝试和给全世界演示 Nacos 的时候，居然在 Java 11 上跑不起来，于是他毅然的给Nacos提了个 issue <a href="https://github.com/alibaba/nacos/issues/214" target="_blank" rel="noopener noreferrer">Please support Java 11</a>.</p><blockquote><p>划重点~ <strong>github上给Nacos提issue是实现你的需求和想法的最佳手段!</strong></p></blockquote><p>Nacos支持Java 11, 主要是指2个方面的支持</p><ul><li>Nacos 支持运行在Java 11上</li><li>将Nacos源码开发及构建环境升级到Java 11</li></ul><p>现在Nacos的状态是2方面都已经支持 Java 11。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用nacos实现spring-cloud-gateway的动态路由">使用Nacos实现Spring Cloud Gateway的动态路由<a href="#使用nacos实现spring-cloud-gateway的动态路由" class="hash-link" aria-label="Direct link to 使用Nacos实现Spring Cloud Gateway的动态路由" title="Direct link to 使用Nacos实现Spring Cloud Gateway的动态路由">​</a></h2><p>要实现微服务架构，微服务网关必不可少，Nacos 社区目前正在努力跟 Spring Cloud 的微服务网关做更多的打通与集成，Spring Cloud 中文社区创建者,《重新定义Spring Cloud实战》的作者 <strong>@许进</strong> 与近期贡献了如何基于Spring Cloud Gateway与Nacos实现动态路由能力的示例，<a href="https://github.com/SpringCloud/spring-cloud-gateway-nacos" target="_blank" rel="noopener noreferrer">github 地址在这里</a>，毫无疑问，Spring Cloud Gateway作为所有请求流量的入口，在实际生产环境中为了保证高可靠和高可用，尽量避免重启,需要实现Spring Cloud Gateway 动态路由配置，等到这块足够成熟，会将其包含在Nacos的官方推荐实现中。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ttl--health-status-aggregation">TTL &amp; Health Status Aggregation<a href="#ttl--health-status-aggregation" class="hash-link" aria-label="Direct link to TTL &amp; Health Status Aggregation" title="Direct link to TTL &amp; Health Status Aggregation">​</a></h2><p>在Nacos之前的几个版本中，用户往往会在使用过程中产生疑惑，为什么注册的实例已经下线(宕掉)了，但是依然可以在Nacos控制台上看到实例的信息。这源于SpringCloud以及Dubbo等服务体系中，Eureka或者Zookeeper都有自动注销实例的能力，而且将自动注销作为注册中心的默认行为。但其实当服务的实例下线(宕掉)之后，注册中心有两种可能的行为，一个是将这个实例从服务下的实例列表中剔除出去，一个是保留该实例，只将实例状态置为不健康。Eureka和Zookeeper等注册中心，其实也支持持久化的实例注册，而Nacos只是将这种持久化的注册设成了默认的行为。</p><p>Nacos的服务发现模块，是基于内部的VIPServer演化而来。在VIPServer的主要场景中，服务是以域名的方式通过控制台注册到VIPServer的，并且VIPServer非常注重服务级别的元数据信息的定义带来的灵活“软负载”流量调度的能力，所以首要选择的是服务及实例的元数据的持久性存储，弱化了服务的提供端持续向VIPServer服务端发送心跳的能力，所以前期并没有将VIPServer 上报和汇聚实例健康状态的功能放出来。之前版本的服务实例的健康检查，必须由VIPServer服务端来主动发起来完成。但是如Nacos开源之初规划的那样，Nacos会同时支持两种模式</p><blockquote><p>对于复杂的云环境和网络拓扑环境中（如 VPC、边缘网络等）服务的健康检查，Nacos 提供了心跳上报模式和服务端主动探测2种健康检查模式。</p></blockquote><p>所以随着Nacos 0.5.0 版本的发布，我们很高兴的宣布，Nacos已经正式支持基于TTL的服务实例自动注销功能。这个功能一部分是响应社区关于TTL功能的需求，更重要的一部分，这也是Nacos服务发现自然演进的一个方向。</p><p>从 0.5.0 版本开始，用户通过客户端SDK注册的实例，将默认开启TTL功能，实例会默认每5秒向服务端发送一次心跳，如果Nacos服务端15秒内没有收到实例的心跳，则会将实例置为不健康，如果30秒没有收到心跳，则会将直接将实例删除。Nacos的TTL功能，补充了Nacos作为注册中心在处理实例下线的另一种行为，通过灵活可动态配置的参数，用户还可以根据实际的应用场景任意切换使用这两种行为中的一种。</p><p>Nacos的TTL功能虽然还处在实验性质，主要有以下特色：</p><ul><li><strong>进一步无缝融入SpringCloud生态和Dubbo生态</strong></li></ul><p>Nacos在最初的规划中，就已经计划能够帮助存量用户做无缝平滑迁移。而无缝平滑迁移除了注册中心的功能的完整性，体验、性能、一些重要的认知也能够从老注册中心接续过来。例如Eureka作为Spring Cloud里的主流注册中心，其默认行为就是会在没有收到实例心跳90秒后，将实例自动注销。而 Dubbo 里用的比较多的Zookeeper，也会使用临时节点，依托于Session超时时间来实现TTL功能。这这两种场景中，服务实例的注册基本都是通过服务提供端(Provider)使用注册中心客户端来完成的。Nacos目前已经提供了Spring Cloud体系的服务发现的完整解决方案，同时对Dubbo的适配和支持也会在最近的版本中释放出来。</p><ul><li><strong>服务级别"元数据(metadata)"不会自动注销</strong></li></ul><p>Nacos支持服务、集群和实例多级别的元数据信息，与服务实例可以被自动注销相对的，服务本身的元数据信息不能随着服务的下线而丢失,因为这些元数据通常是在创建服务时有人为设定上去的（例如负载均衡策略，权重规则，保护阈值等）。这意味着同一个服务的实例的上上下下，再注册上来的时候，应该依然保有服务原来设定的相关的元数据信息。</p><p>在Eureka或者Consul中，由于并不支持服务级别设定任何元信息，因此当实例都临时下线时，整个服务也就查询不到任何存在过的痕迹了。而服务级别的元信息作为Nacos的一个非常重要的特色功能，未来会基于此开放一系列流量控制类的特色功能，都决定了Nacos服务本身的元数据信息不能随着服务的下线而丢失，另一方面，在客户端注册实例时，不允许提交服务级别的元信息，这样也保证了单个实例的注册或者注销不会影响服务级别的配置。我们提供了控制台来对服务元数据进行便捷的创建和编辑。</p><ul><li><strong>将HSF的注册中心ConfigServer融入Nacos</strong></li></ul><p>在阿里巴巴集团内部，著名的HSF的注册中心ConfigServer支持的就是长连接注册模式(renew&amp;TTL)，因此当长连接断开时，自然而然的就会将实例注销掉。为了支持未来将HSF一些优秀的特性迁移和输出到Dubbo上，Nacos会逐渐将ConfigServer的核心能力融入到Nacos当中，而TTL则也是这个事情的基础。</p><p>而同时，Nacos非常看中产品在云上的适用性，在公有云上，因为用户往往注册到注册中心的IP是一个VPC的外部IP，因为公有云安全策略的限制，注册中心一般是不允许主动发起到VPC内的连接来做健康检查的，只能通过客户端上报心跳的模式来检查健康状态，也只有在客户端上报的模式下，才能启用自动注销功能。Nacos此次的TTL功能，很好的衔接了公有云和内部ConfigServer输出的需求，为后续的融合做好了初步的准备。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="spring-cloud-for-alibaba-with-nacos">Spring Cloud for Alibaba with Nacos<a href="#spring-cloud-for-alibaba-with-nacos" class="hash-link" aria-label="Direct link to Spring Cloud for Alibaba with Nacos" title="Direct link to Spring Cloud for Alibaba with Nacos">​</a></h2><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1542704490654-b70dcbb2-7bfe-433a-9497-303ba817f860.png" alt="屏幕快照 2018-11-20 16.19.27.png" class="img_ev3q"> </p><p>就像 SpringOne Platform 2018 大会上 Spring 开发者 @Roy Clarkson 和 @Ollie Hughes 在 <strong>《Cloud-Native Java with Spring Cloud Services》</strong> (<a href="https://www.youtube.com/watch?v=0Yh-cebFkN4&amp;index=108&amp;list=PLAdzTan_eSPQsR_aqYBQxpYTEQZnjhTN6" target="_blank" rel="noopener noreferrer">YouTube视频地址</a>) 演讲中阐述的那样，采用微服务设计模式，首要的就是选择 “External Configuration” “Service Registry” “Circuite Breaker” 的实现，而 Spring Cloud for Alibaba 这个项目则旨在通过将阿里巴巴在服务化以及阿里云上基于Aliware支撑各行业的微服务产品打包在一个stack里，给你提供开发支撑大规模微服务应用系统的一站式解决方案, 正如项目所述:</p><blockquote><p>“The Spring Cloud Alibaba project, consisting of Alibaba’s open-source components and several Alibaba Cloud products, aims to implement and expose well known Spring Framework patterns and abstractions to bring the benefits of Spring Boot and Spring Cloud to Java developers using Alibaba products.”</p></blockquote><p>随着 <a href="https://spring.io/blog/2018/10/30/spring-cloud-for-alibaba-0-2-0-released" target="_blank" rel="noopener noreferrer">Spring Cloud for Alibaba 0.2.0 的发布</a>，Nacos Configuration, Nacos Service Discovery 和 Sentinel Circuite Breaker 都已一网而聚之。</p><p>想了解如何在Spring Cloud中快速开始使用 Nacos 做配置中心和服务发现，可以点击<a href="https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html" target="_blank" rel="noopener noreferrer">这里</a>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="持续优化用户体验">持续优化用户体验<a href="#持续优化用户体验" class="hash-link" aria-label="Direct link to 持续优化用户体验" title="Direct link to 持续优化用户体验">​</a></h2><p>正如Nacos团队在开源立项之初发下的宏愿，Nacos希望通过未来团队的持续努力，能给Nacos贴上希望的标签，而追求产品的<strong>极致易用性</strong>永远是Nacos团队的核心关注点之一，Nacos 0.5.0 版本就社区近期反馈较多的的一些体验问题做了积极的修复和优化，这其中包括前端UI的优化，启动状态信息展示的优化,性能调优等等，</p><p><a href="https://github.com/alibaba/nacos/issues/177" target="_blank" rel="noopener noreferrer">#177</a> Console supports registering new empty service and delete empty service.
<a href="https://github.com/alibaba/nacos/issues/222" target="_blank" rel="noopener noreferrer">#222</a> print more nacos server start status info in start.log.
<a href="https://github.com/alibaba/nacos/issues/251" target="_blank" rel="noopener noreferrer">#251</a> Console Editor Optimization.
<a href="https://github.com/alibaba/nacos/issues/254" target="_blank" rel="noopener noreferrer">#254</a> DataId and group are required in historical version and listener query.
<a href="https://github.com/alibaba/nacos/issues/258" target="_blank" rel="noopener noreferrer">#258</a> Remove the Balloon of DataId/Group.</p><p>更多的优化和release信息见 <a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">nacos github</a></p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1542708581826-76439cb4-9cb8-49d1-af0d-790bdd2249bd.png" alt="屏幕快照 2018-11-20 18.09.08.png" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="蓬勃发展的-nacos-社区">蓬勃发展的 Nacos 社区<a href="#蓬勃发展的-nacos-社区" class="hash-link" aria-label="Direct link to 蓬勃发展的 Nacos 社区" title="Direct link to 蓬勃发展的 Nacos 社区">​</a></h2><blockquote><p>DISS is cheap, show me your hand
比吐槽更重要的是搭把手，参与社区一起发展Nacos</p></blockquote><ul><li>作为用户关注和加入 Nacos 社区</li></ul><p>Nacos 社区正在蓬勃发展，截止到发文为止，Nacos 短短几个月已经有5个微信群，其中4个已满员，1个QQ群，1个钉钉群，关注 Nacos 的社区人数已经近3000人，在 Nacos 群里跟 “道（基）友” 切磋技术，交流经验，招聘交友，抢抢红包...不亦乐乎。</p><p>要加入 Nacos 微信社区，你可以通过扫下面的<strong>“超哥”</strong>的微信二维码，让<strong>“超哥”</strong> 帮你拉入 “Nacos社区微信交流群”</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077965587-8f4e3100-bdd4-469a-9ea0-7af7061bc9ef.png" alt="Screen Shot 2018-06-27 at 13.39.09.png | left" class="img_ev3q"></p><ul><li>作为代码贡献者加入 Nacos 社区</li></ul><p>从Nacos用户发展而成贡献者顺理成章，而Nacos开发团队也确实在日趋壮大，从开始的只有4个代码contributor发展到目前的24个，随着<strong>阿里巴巴</strong>其他团队成员如 <strong>@小马哥</strong> 等人，<strong>虎牙直播</strong>的 <strong>@张波</strong> <strong>@周健</strong> 团队等人，<a href="https://github.com/nacos-group/nacos-docker" target="_blank" rel="noopener noreferrer">nacos-docker-k8s</a> 贡献者 <strong>@张龙</strong>，前端的主要贡献者饿了么 <strong>@王彦民</strong>，Spring Cloud中文社区创立者 <strong>@许进</strong> 等的陆续加入，相信未来Nacos社区的力量未来会越来越强大。</p><p>而社区也正在计划在合适的时机上，将在Nacos官网 <a href="http://nacos.io" target="_blank" rel="noopener noreferrer">nacos.io</a> 中添加团队介绍页，将大家正式公布于众，欢迎大家加入Nacos社区，贡献社区。用Apache的话说，<strong>“社区高于代码”!</strong> </p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1542704700864-a9d54856-9bf6-4176-b449-c13fa02c5800.png" alt="屏幕快照 2018-11-20 17.04.45.png" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="新人时刻---什么是nacos">新人时刻 - "什么是Nacos？"<a href="#新人时刻---什么是nacos" class="hash-link" aria-label="Direct link to 新人时刻 - &quot;什么是Nacos？&quot;" title="Direct link to 新人时刻 - &quot;什么是Nacos？&quot;">​</a></h2><blockquote><p>还不知道什么是Nacos? 没关系，在github上star一下跟程序猿兄弟打个招呼吧!!</p></blockquote><p><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a> 是阿里巴巴于7月份新开源的项目，Nacos的主要愿景是期望通过提供易用的 <code>动态服务发现</code>、<code>服务配置管理</code>、<code>服务共享与管理</code> 的基础设施，帮助用户在云原生时代更好的构建、交付、管理自己的微服务平台。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1532436633419-08a42307-7fb7-4d51-9062-fecc3868613b.png" alt="Screen Shot 2018-07-24 at 19.27.28.png" class="img_ev3q"> </p><p>github项目地址在 <a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">这里</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="更多与-nacos-相关的开源项目信息">更多与 Nacos 相关的开源项目信息<a href="#更多与-nacos-相关的开源项目信息" class="hash-link" aria-label="Direct link to 更多与 Nacos 相关的开源项目信息" title="Direct link to 更多与 Nacos 相关的开源项目信息">​</a></h2><ul><li><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a></li><li><a href="https://github.com/nacos-group/nacos-coredns-plugin" target="_blank" rel="noopener noreferrer">Nacos DNS-F</a></li><li><a href="https://github.com/nacos-group/nacos-docker" target="_blank" rel="noopener noreferrer">Nacos Docker</a></li><li><a href="https://github.com/nacos-group/nacos-spring-project" target="_blank" rel="noopener noreferrer">Nacos Spring Project</a></li><li><a href="https://github.com/nacos-group/nacos-spring-boot-project" target="_blank" rel="noopener noreferrer">Nacos Spring Boot</a></li><li><a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba</a></li><li><a href="http://dubbo.io" target="_blank" rel="noopener noreferrer">Dubbo</a></li><li><a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">Sentinel</a></li><li><a href="https://projects.spring.io/spring-cloud/" target="_blank" rel="noopener noreferrer">Spring Cloud</a></li><li><a href="https://github.com/Nepxion/Discovery" target="_blank" rel="noopener noreferrer">Nepxion Discovery</a></li><li><a href="https://github.com/SpringCloud/spring-cloud-gateway-nacos" target="_blank" rel="noopener noreferrer">Spring Cloud Gateway Nacos</a></li></ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos 0.1.0 版本Review 活动设计]]></title>
            <link>https://nacos.io/en/blog/nacos</link>
            <guid>https://nacos.io/en/blog/nacos</guid>
            <pubDate>Thu, 15 Nov 2018 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos 0.1.0 版本Review 活动设计]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="i-活动任务列表">I. 活动任务列表<a href="#i-活动任务列表" class="hash-link" aria-label="Direct link to I. 活动任务列表" title="Direct link to I. 活动任务列表">​</a></h2><ul><li>阅读官网文案，找官网bug, 给中、英文官网提建设性建议</li><li>阅读中英文档，找文档bug, 给中、英文档改善提建议（尤其是关注英文翻译不好的地方，因为英文都是我们程序员自己撸的）</li><li>尝试下代码 -&gt;编译打包 -&gt; 启动Nacos server -&gt; 停止Nacos server流程，提出改进意见</li><li>尝试配置以及启动多节点 Nacos 集群模式任务，提改进意见</li><li>尝试使用Nacos Java SDK, 给Java SDK提改进建议</li><li>尝试使用Nacos Open API，给OpenAPI提改进建议</li><li>尝试根据《如何贡献Nacos文档 TODO》试一下 贡献流程，给贡献者流程提建议</li><li>给Nacos提需求、发展计划、想法和要求等</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ii-活动参与方式">II. 活动参与方式<a href="#ii-活动参与方式" class="hash-link" aria-label="Direct link to II. 活动参与方式" title="Direct link to II. 活动参与方式">​</a></h2><ul><li><p>扫描 “超哥” 微信2微码，让超哥帮助加入 “Nacos社区交流群”</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/11189/1532004866850-5e03b901-6d76-4380-b7bf-66e227808bdc.png" alt="微信二维码" class="img_ev3q"> </p></li><li><p>选择I 中的一个或者多个体验任务</p></li><li><p>发现问题或者BUG之后，按照III中的《问题Report方式》，发一个相应的 github issue, 并指派给 @ github账号<a href="https://github.com/xuechaos" target="_blank" rel="noopener noreferrer">xuechaos</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="iii-问题report方式">III. 问题Report方式<a href="#iii-问题report方式" class="hash-link" aria-label="Direct link to III. 问题Report方式" title="Direct link to III. 问题Report方式">​</a></h2><ul><li>流程说明 TODO</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="iv-奖励方式">IV. 奖励方式<a href="#iv-奖励方式" class="hash-link" aria-label="Direct link to IV. 奖励方式" title="Direct link to IV. 奖励方式">​</a></h2><ul><li>我们正在为参与并作出突出贡献的小伙伴定制一些小礼品，会考虑快递给过程中有突出贡献的小伙伴</li><li>礼物虽轻，但希望能表达对你们的帮助的感激之情的万一</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="v-其它说明">V. 其它说明<a href="#v-其它说明" class="hash-link" aria-label="Direct link to V. 其它说明" title="Direct link to V. 其它说明">​</a></h2><ul><li>我们不确定每个建议最后都会被采用，但是我们尽量会跟您沟通我们基于何种考虑，您的建议我们最后没有采用</li><li>尽量通过邮件列表或者report issue的方式，而不是在微信群里report问题，以便将我们的沟通过程文档化和更容易沉淀</li></ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos 进入CNCF landscape]]></title>
            <link>https://nacos.io/en/blog/cncf</link>
            <guid>https://nacos.io/en/blog/cncf</guid>
            <pubDate>Sun, 28 Oct 2018 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos 进入CNCF landscape]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-被cncf-纳入landscape大图">Nacos 被CNCF 纳入landscape大图。<a href="#nacos-被cncf-纳入landscape大图" class="hash-link" aria-label="Direct link to Nacos 被CNCF 纳入landscape大图。" title="Direct link to Nacos 被CNCF 纳入landscape大图。">​</a></h2><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/11189/1540738282849-61e2022a-46a9-4d81-ae16-6d6f0515450b.png" alt="image.png | left | 747x408" class="img_ev3q"></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[What problems does Nacos help us solve? —— Configuration Management]]></title>
            <link>https://nacos.io/en/blog/5w1h-what</link>
            <guid>https://nacos.io/en/blog/5w1h-what</guid>
            <pubDate>Wed, 17 Oct 2018 00:00:00 GMT</pubDate>
            <description><![CDATA[What problems can Nacos configuration management help us solve?]]></description>
            <content:encoded><![CDATA[<blockquote><p>Authors: He Xu</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2><p><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a> is Alibaba's open source project in July 2018 this year,As its name, Naming and Configuration Service ,Focus on service discovery and configuration management。This series of articles,We will fully analyze Nacos from 5W1H（What、Where、When、Who、Why、How）,I hope it will be helpful to developers when selecting open source solutions for service discovery and configuration management。</p><p>This article serves as the beginning of the Nacos series,Start with "What"。When we started to pay attention to an open source project,Usually the first two questions that come to mind are:</p><ul><li>What is it？</li><li>What problem does it help us to solve?</li></ul><p>What is it？</p><p>Nacos is a dynamic service discovery, configuration management and service management platform that makes it easier to build Cloud Native applications.</p><p>What problem does it help us to solve?</p><p>This article will first focus on its "configuration management" function to answer。"Configuration",As a buddy with the code,Accompanied by the entire life cycle of the application,Of course we are also very familiar with it,Think about how many forms of configuration generally exist?</p><ul><li>Hard-Code</li><li>Configuration file</li><li>Database configuration table</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="hard-code">Hard-Code<a href="#hard-code" class="hash-link" aria-label="Direct link to Hard-Code" title="Direct link to Hard-Code">​</a></h2><p>Configuration items exist in the form of class fields.
E.g:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class AppConfig {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int connectTimeoutInMills = 5000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int getConnectTimeoutInMills() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return connectTimeoutInMills;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setConnectTimeoutInMills(int connectTimeoutInMills) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.connectTimeoutInMills = connectTimeoutInMills;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are three main problems with this approach:</p><p>If the configuration needs to be modified dynamically,The current application is required to expose the interface for managing the configuration item,As for the Controller's API interface, or JMX, it can be done.</p><p>In addition, configuration changes occur in memory and are not persisted.Therefore, restart the application after modifying the configuration, and the configuration will change back to the default value in the code,This is harmful, I have encountered.</p><p>Last question,When you have multiple machines,Need to modify a configuration,Every one has to be revised,The cost is very high.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-file">Configuration file<a href="#configuration-file" class="hash-link" aria-label="Direct link to Configuration file" title="Direct link to Configuration file">​</a></h2><p>In Spring,properties or ymal or other custom configuration files, such as "conf" suffix：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># application.properties</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">connectTimeoutInMills=5000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Compared to the "hard-code" form,It solves the second problem,Persistent configuration.However, the other two issues are not resolved,Operation and maintenance costs are still high.</p><p>Dynamic configuration changes,It can be through a similar "hard-code" way to expose the management interface,At this time, there will be one more step in the code to persist the logic of the new configuration to the file. Or, simple and rude,Log in to the machine directly to modify the configuration file,And then restart the app,Let the configuration take effect. Of course, you can also add a timing task to the code,For example, read the content of the configuration file every 10s, so that the latest configuration can take effect in the application in time, so that the "heavier" operation and maintenance operation of restarting the application is eliminated.</p><p>By adding "persistent logic" and "timed tasks", the form of "configuration files" is a small step forward than "hard-code".</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="database-configuration-table">Database configuration table<a href="#database-configuration-table" class="hash-link" aria-label="Direct link to Database configuration table" title="Direct link to Database configuration table">​</a></h2><p>Database can be a relational database such as MySQL or a non-relational database such as Redis. The data table is as follows：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">config</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">bigint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AUTO_INCREMENT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">key</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'配置项'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">value</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'配置内容'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">updated_time</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">timestamp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CURRENT_TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">UPDATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CURRENT_TIMESTAMP</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">created_time</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">timestamp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CURRENT_TIMESTAMP</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">UNIQUE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">idx_key</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">key</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ENGINE</span><span class="token operator" style="color:#393A34">=</span><span class="token keyword" style="color:#00009f">InnoDB</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CHARSET</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">utf8 </span><span class="token keyword" style="color:#00009f">COMMENT</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'配置信息'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">config</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">key</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">value</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">updated_time</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">created_time</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'connectTimeoutInMills'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'5000'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CURRENT_TIMESTAMP</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CURRENT_TIMESTAMP</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Compared with the first two, it takes the configuration a step further, separates the configuration from the application, and centrally manages it, which can greatly reduce the operation and maintenance cost.</p><p>So, how can it solve the problem of dynamically updating the configuration? As far as I know, there are two ways。</p><p>One,Same as before,Solve by exposing management interface,Of course,Also need to increase the logic of persistence,But before it was to write files, now it is to write the latest configuration to the database. However, the program also needs to periodically read the latest configuration task from the database, so that only by calling the management configuration interface of one of the machines, the latest configuration can be distributed to all the machines in the entire application cluster. Really achieve the purpose of reducing operation and maintenance costs.</p><p>Second,Modify the database directly, and read the latest configuration content from the database through timed tasks in the program.</p><p>The form of "Database configuration table" solves the main problem, but it is not elegant enough and brings some "cumbersome".</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-configuration-management">Nacos configuration management<a href="#nacos-configuration-management" class="hash-link" aria-label="Direct link to Nacos configuration management" title="Direct link to Nacos configuration management">​</a></h2><p>Nacos truly separates the configuration from the application, manages it in a unified way, and elegantly solves the problems of dynamic changes, persistence, operation and maintenance costs of the configuration.</p><p>The application itself does not need to add a management configuration interface, nor does it need to implement configuration persistence by itself, and it does not need to introduce "timed tasks" in order to reduce operation and maintenance costs. Nacos The provided configuration management function gathers all the logic related to the configuration, and provides a simple and easy-to-use SDK, so that the configuration of the application can be easily managed by Nacos.</p><p>If you are using Nacos in Spring, you only need three steps:</p><ol><li>Add dependency</li></ol><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;artifactId&gt;nacos-spring-context&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;version&gt;${latest.version}&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Add <code>@EnableNacosConfig</code> annotation,Enable Nacos Spring's configuration management service。In the following example, we use <code>@NacosPropertySource</code> to load the configuration source with <code>dataId</code> as <code>example</code> and enable automatic update:</li></ol><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableNacosConfig(globalProperties = @NacosProperties(serverAddr = "127.0.0.1:8848"))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@NacosPropertySource(dataId = "example", autoRefreshed = true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class NacosConfiguration {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Set the attribute value through Spring's <code>@Value</code> annotation.</li></ol><p>Note: You need to have the <code>Setter</code> method at the same time to automatically update when the configuration changes.</p><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class AppConfig {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Value("${connectTimeoutInMills:5000}")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int connectTimeoutInMills;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int getConnectTimeoutInMills() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return connectTimeoutInMills;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setConnectTimeoutInMills(int connectTimeoutInMills) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.connectTimeoutInMills = connectTimeoutInMills;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above three steps have almost no code intrusion to the application itself,1 dependency 2 annotations,With just a few lines, the configuration is managed through Nacos.</p><p>About the dynamic update of the configuration,For users of Nacos Spring, it is just a boolean value of "autoRefreshed" that is set in their own application。Then when you need to modify the configuration, call Nacos to modify the configuration interface, or use the Nacos console to modify. After the configuration is changed, Nacos will push the latest configuration to all the machines of the application, which is simple and efficient.</p><p>Think about it before, in order to realize this function, how much wrong code was written, and how much tedious operation and maintenance work was done. It would be great if you had met Nacos earlier!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2><p>This article serves as the beginning of the Nacos 5W1H series,"What" tells the problem that Nacos configuration management can help us solve: manage configuration in a simple, elegant, and efficient way, realize dynamic configuration changes, greatly reduce operation and maintenance costs, and let developers leave work earlier.</p><p>Of course, Nacos configuration management is not only the above-mentioned functions, but also such as "gray release", "version management", "fast rollback", "monitor query", "push trajectory", "authority control", "Encrypted storage of sensitive configuration (eg, database connection configuration)" etc.. Some of these have been implemented in open source in Nacos, and some are provided in the free product of Alibaba Cloud <a href="https://cn.aliyun.com/product/acm" target="_blank" rel="noopener noreferrer">ACM</a> of Nacos configuration management. Of course, the follow-up will be slow Slowly open source to Nacos, so stay tuned.</p><p>This series of articles,Will continue to tell everyone about Nacos bit by bit,It's not just about "What problem can Nacos help us solve?",There will also be an in-depth source code analysis "How is Nacos simple and powerful?"。At the same time, if the guys are interested, we will also give you gossip about Nacos' history of barnyard officials, about the history of Nacos in Ali, about the meaning of the Nacos service port, etc.. In short, one sentence: I have a story, and I also have a good wine, what else can you ask for?</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos服务发现控制台预览]]></title>
            <link>https://nacos.io/en/blog/discovery-console</link>
            <guid>https://nacos.io/en/blog/discovery-console</guid>
            <pubDate>Tue, 02 Oct 2018 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos服务发现控制台预览]]></description>
            <content:encoded><![CDATA[<p>Nacos是阿里巴巴中间件部门最近开源的一款用于服务发现和配置管理的产品。在既0.1版本发布基本功能和0.2版本发布与Spring生态结合的功能后，0.3版本将释放全新的控制台界面。配置管理功能相关的控制台，将会由阿里云商业产品ACM控制台改造而来，而服务发现的控制台界面，则将以首次露面的姿态，开放给开源社区。本文就将服务发现控制台相关的界面UI初版设计公布，欢迎大家参与讨论，希望通过大家的批评和建议，将服务发现控制台这块的功能和界面，设计的更加美观和易用。</p><p>服务发现控制台的主要功能是服务列表的展示和搜索，以及服务配置、集群配置、实例配置的查询和更新。在0.3版本中，主要会有两个页面：服务列表和服务详情。</p><h1>服务列表</h1><p>服务列表页面主要展示已经在Nacos注册的服务列表，以及服务的基本信息，服务的基本信息有：服务的名称、服务下集群的数目、服务下实例的数目、服务的健康程度以及进入服务详情的按钮。同时右上角还有一个支持根据服务名搜索服务的搜索框和搜索按钮。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15356/1538701093629-9880a456-8a37-4663-bd88-853441dab3f4.png" alt="图1 服务列表页面" class="img_ev3q"></p><h1>服务详情</h1><p>在服务列表页面点击“detail”按钮，就会进入服务详情页面。服务详情页面展示的是一个服务的所有关键信息，包括服务的配置和元数据、集群列表和示例列表，以及一些操作的按钮。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15356/1538701093629-9880a456-8a37-4663-bd88-853441dab3f4.png" alt="图2 服务详情页面" class="img_ev3q"></p><p>在该页面的上方，是服务的配置和元信息，目前包含服务名、保护阈值、健康检查模式以及元数据metadata。右上方是编辑服务按钮，点击后会有对话框弹出，可以对服务的配置进行编辑。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15356/1538701150783-fa6d58cf-01f4-430c-a5d0-6278c9590404.png" alt="图2 服务详情页面" class="img_ev3q"></p><p>服务详情的下方，是集群列表和集群下的实例列表。每个集群会显示一个集群名，和相应的查看&amp;更新集群详情按钮。点击该按钮后，会是一个更新集群的对话框。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15356/1538701200952-f9dcb51e-100e-4501-a3db-d665dfaf7188.png" alt="图4 更新集群（TCP健康检查）" class="img_ev3q"></p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15356/1538701223427-284aaf1c-1cd3-412e-9f22-d5baae2cee25.png" alt="图5 更新集群（HTTP健康检查）" class="img_ev3q"></p><p>图4和图5分别展示了对集群更新的两种对话框展示，两者的区别是选择了不同的健康检查方式。TCP健康检查方式可以配置检查的端口；HTTP健康检查方式可以配置检查的端口、检查的路径和HTTP头部信息。同时还可以配置是否采用实例的端口进行健康检查，如果配置为true，则健康检查将使用实例注册的端口进行通信。该对话框还可以编辑集群的元信息。</p><p>每个集群下面都会有实例列表，实例列表将会分页展示该集群下注册的所有实例，展示的信息有IP、端口、权重、是否健康、元信息和对应的编辑及下线按钮。下线按钮点击后，该实例将不会返回给订阅端，无论该实例是否健康。“下线”文本会改成“上线”，用于对应的实例上线操作。点击编辑按钮，则会进入编辑实例对话框。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15356/1538701250740-ffb38cd0-a15d-4425-a2ca-48c5d0d2698e.png" alt="图6 编辑实例对话框" class="img_ev3q"></p><p>编辑实例对话框，可以编辑的信息有实例的权重、是否上下线和元信息。</p><p>0.3版本的服务发现页面，基本就是这样，欢迎大家的反馈。服务注册客户端也可以编辑服务、集群、实例元信息，这些可能会和控制台的编辑相冲突，目前的机制是，不管是控制台更新和客户端更新，都将被Nacos服务端所接受，这点也欢迎大家给出自己的看法。最后也预祝大家国庆放假愉快！</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Nacos 计划发布v0.2版本，进一步融合Dubbo和SpringCloud生态]]></title>
            <link>https://nacos.io/en/blog/chengdu-dubbo</link>
            <guid>https://nacos.io/en/blog/chengdu-dubbo</guid>
            <pubDate>Fri, 21 Sep 2018 00:00:00 GMT</pubDate>
            <description><![CDATA[Nacos 计划发布v0.2版本，进一步融合Dubbo和SpringCloud生态]]></description>
            <content:encoded><![CDATA[<p>在近期的Aliware Open Source 成都站的活动上，阿里巴巴高级工程师邢学超（于怀）分享了Nacos v0.2的规划和进度，并对Nacos v0.3的控制台进行了预览。Nacos v0.2将进一步融入Duboo和Spring Cloud生态，帮助开发者更好的在微服务场景下使用服务发现和动态配置管理。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/11189/1537795153259-cc2c60c2-d7cb-431a-8858-cbd71b1c89e9.png" alt="undefined" class="img_ev3q"> </p><p>嘉宾介绍：邢学超（于怀），Nacos开源项目主要推动者，负责阿里巴巴内部 configserver、skywalker和taokeeper产品的架构和研发，爱好代码、篮球、吉他和摇滚，还记得超哥给盲人小朋友写的那首超温暖的歌么？</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1nacos开源介绍">1.&nbsp;Nacos开源介绍<a href="#1nacos开源介绍" class="hash-link" aria-label="Direct link to 1.&nbsp;Nacos开源介绍" title="Direct link to 1.&nbsp;Nacos开源介绍">​</a></h2><p>Nacos是一个更易于帮助构建云原生应用的动态服务发现、配置和服务管理平台，脱胎于承载整个阿里巴巴集团的软负载产品，并于今年7月对外开源。开源以来，获得了来自社区的积极反馈，star数突破&nbsp;1k 。</p><p>Nacos旨在将阿里巴巴在建设共享服务体系中使用的服务发现、配置及服务管理平台贡献给开源社区，通过打造Dubbo + Nacos的经典组合进一步释放Dubbo在云原生及Service Mesh时代中，在大规模微服务治理、流量治理、服务集成与服务共享等服务平台能力建设上的威力，同时Nacos关注对主流开源社区，如Spring Cloud和Kubernetes云原生体系的无缝对接与支持。该项目预计在7月中旬开放首个测试预览版本，并计划在0.8版本上，达到生产可用的状态。此外，Nacos支持注册中心和配置中心的分离部署，也关注上云的saas化部署，实现云下到云上的平滑迁移。</p><p>Github项目主页：
<a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos</a>
Nacos官网：
<a href="http://nacos.io/" target="_blank" rel="noopener noreferrer">http://nacos.io/</a>&nbsp;</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-nacos-v02进度和规划">2. Nacos v0.2进度和规划<a href="#2-nacos-v02进度和规划" class="hash-link" aria-label="Direct link to 2. Nacos v0.2进度和规划" title="Direct link to 2. Nacos v0.2进度和规划">​</a></h2><p>Nacos +&nbsp;Dubbo， 双中心重构，释放威力
Dubbo2.7将对注册中心和配置中心进行重构。注册中心将只用于Endpoint的同步，进一步减轻注册中心的存储压力，提高地址同步效率，同时缓解当前由于URL冗余在大规模推送时造成的Consumer端内存计算压力。配置中心将解决当前配置和地址信息耦合的问题，通过抽象动态配置层，让开发者可以对接微服务场景下更常用的、更专业的配置中心。这使得Nacos和Dubbo的完美融合成为可能，进一步释放Dubbo在服务治理、流量治理、服务运营和管理等方面的威力。</p><p>Nacos + Spring Cloud，多层融入，无缝贴合
Nacos在技术社区已经启动Nacos + Spring Cloud的工程，可无缝支持Spring Cloud，为Spring Cloud用户提供更简便的配置中心和注册中心的解决方案，使用Nacos不用再仅仅为服务和配置就需要在生产上hold住 Eureka，Spring Cloud Config Server，Git，Consul 起码四个开源产品。</p><p>Nacos v0.2，全方位注解，实现平滑迁移
在 Java 生态系统中，以 Spring Boot 和 Spring Cloud 为代表的微服务框架，引入了全新的编程模型，包括：
o	注解驱动（Annotation-Driven）
o	外部化配置（External Configuration）
o	自动装配（Auto-Configure）</p><p>Nacos将在v0.2支持原生Spring、Spring Boot、Spring Cloud中关于服务发现、配置管理的原生配置，适配Spring Boot、Spring Cloud标准，此外Nacos还是支持以下注解。
<img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/11189/1537795187129-bf48b9b1-3560-4081-99fc-b9c99497525b.png" alt="undefined" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-nacos-代码演示--v03控制台预览">3. Nacos 代码演示 &amp; v0.3控制台预览<a href="#3-nacos-代码演示--v03控制台预览" class="hash-link" aria-label="Direct link to 3. Nacos 代码演示 &amp; v0.3控制台预览" title="Direct link to 3. Nacos 代码演示 &amp; v0.3控制台预览">​</a></h2><p>在分享中，于怀现场演示了如何快速运行一个Nacos应用、调用Nacos API、如何使用注解来运行Nacos。</p><p>同时，Nacos v0.3加入了控制台的功能，控制台分为两个内容，并会融合在一起：</p><ol><li>服务发现模块，包括服务上下线管理、服务权重、服务打标、服务健康信息和服务元信息的展现;</li><li>配置模块，提供配置列表、监听查询、推送轨迹等功能。</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/11189/1537795211701-dc18d18c-99a6-40e0-824f-6519d8f8b434.png" alt="undefined" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-nacos-社区介绍和招募计划">4. Nacos 社区介绍和招募计划<a href="#4-nacos-社区介绍和招募计划" class="hash-link" aria-label="Direct link to 4. Nacos 社区介绍和招募计划" title="Direct link to 4. Nacos 社区介绍和招募计划">​</a></h2><p>Nacos强调社区化的发展与社区的多样性，采取PMC和Committer机制来管理社区，鼓励热情、注重细节、积极参与社区活动、对项目感兴趣的开发者参与到开源项目中来，希望在第一年就吸收至少超过5名来自其它公司的PMC，至少10名的外部Committer，依托于社区将产品做得更好，并计划在19年年初和CNCF基金会或apache基金会沟通捐赠适宜，社区贡献者会随之进入基金会体系。</p><p>画外音：我们准备了40个Nacos限量版纪念品，用于奖励参与“Nacos有奖活动”的开发者。
活动链接：
<a href="https://nacos.io/zh-cn/docs/activity.html" target="_blank" rel="noopener noreferrer">https://nacos.io/zh-cn/docs/activity.html</a></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Consul与kubernetes整合公告[翻译]]]></title>
            <link>https://nacos.io/en/blog/consul-k8s</link>
            <guid>https://nacos.io/en/blog/consul-k8s</guid>
            <pubDate>Sun, 02 Sep 2018 00:00:00 GMT</pubDate>
            <description><![CDATA[Consul与kubernetes整合公告[翻译]]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="导读">导读<a href="#导读" class="hash-link" aria-label="Direct link to 导读" title="Direct link to 导读">​</a></h2><blockquote><p>Consul是目前业界比较火的服务发现与配置产品，它率先将服务发现和配置管理等分布式服务当中使用到的基础服务进行整合，对外提供分布式及高可用的服务。Consul目前有开源版本和商业化版本同时演进，这也是国内可以借鉴的一种开源策略。同时，Consul对于新技术趋势的跟进和整合，也是值得我们学习和参考的。</p><p>本文翻译了Consul对于Kubernetes的整合所发布的公告文章（<a href="https://www.hashicorp.com/blog/consul-plus-kubernetes" target="_blank" rel="noopener noreferrer">原文地址</a>）。Consul通过支持Service Mesh，并提供对Kubernetes的无缝支持，与目前最受社区热捧的产品进行绑定，并通过功能预告的形式，来达到对产品宣传效果的最大化。</p><p>与Consul产品对应的，阿里巴巴在近期开源了其服务发现与配置管理产品<a href="https://nacos.io" target="_blank" rel="noopener noreferrer">Nacos</a>。Nacos是阿里巴巴集团内部VIPServer、ConfigServer和Diamond三个支撑双十一的重要中间件产品整合而来。Nacos主要关注产品的极致易用以及与云原生的深度整合，主要支持服务发现、配置管理等功能。很快，Nacos也会与Service Mesh进行整合，同时在集团内部和开源进行发布，利用阿里巴巴丰富的场景和开源社区的力量，将Nacos打造成云原生生态中不可或缺的基础产品。</p></blockquote><p>我们很高兴地宣布HashiCorp Consul与Kubernetes深度整合的多项功能。 这篇文章将分享将在未来几周内发布的一系列初步功能。</p><p>这些功能包括用于在Kubernetes上安装Consul的官方Helm Chart，与Consul自动同步Kubernetes服务（反之亦然），外部Consul Agent自动加入Kubernetes中的集群，用于Connect自动保护pod的注入器，以及对Envoy的支持。</p><p>除了与Kubernetes本地集成之外，这些功能还有助于解决多个Kubernetes集群之间以及Kubernetes服务与非Kubernetes服务交互多项重要跨集群挑战。 我们很高兴与您分享这项工作。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="功能点">功能点<a href="#功能点" class="hash-link" aria-label="Direct link to 功能点" title="Direct link to 功能点">​</a></h2><p>以下是将在未来几周内公布和发布的功能列表。后续公告博客将详细介绍每个项目，每个项目都将链接到该公告帖子。</p><ul><li><strong>Helm Chart</strong>。用于在Kubernetes上安装，配置和升级Consul的官方Helm Chart。此Helm Chart还将支持Kubernetes的其他功能的自动安装和配置，例如目录同步。</li><li><strong>Kubernetes自动加入</strong>。Consul的云自动加入功能将更新，以支持发现和加入基于Kubernetes的Agent代理。这将使外部Consul Agent加入在Kubernetes中运行的Consul集群。</li><li><strong>服务目录同步：从K8S到Consul</strong>。适当的Kubernetes服务将自动同步到Consul目录，使非Kubernetes服务能够发现并连接到Kubernetes中运行的服务。</li><li><strong>服务目录同步：从Consul到K8S</strong>。Consul服务将同步到Kubernetes服务，以便应用程序可以使用Kubernetes本地服务发现来发现和连接在Kubernetes之外运行的服务。</li><li><strong>Connect自动注入</strong>。部署在Kubernetes中的Pod可以配置为自动使用Connect通过TLS进行安全通信。</li><li>支持<strong>Envoy Proxy</strong>。配置为使用Connect自动注入的Pod可以使用Envoy Proxy进行第4层通信，通过Connect进行保护。 Envoy也将用于非Kubernetes的Connect部署。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="与kubernetes整合">与Kubernetes整合<a href="#与kubernetes整合" class="hash-link" aria-label="Direct link to 与Kubernetes整合" title="Direct link to 与Kubernetes整合">​</a></h2><p>我们目前正在与Kubernetes在多个产品上进行密切整合。通过使我们的产品更易于运行以及集成和增强Kubernetes功能，我们看到了解决纯Kubernetes用户挑战的机会。</p><p>这种集成的核心原则是增强现有功能而不是替换。服务、ConfigMaps及Secrets等功能是Kubernetes核心工作流程的一部分。更高级别的工具和扩展利用这些核心原语。因此，我们也在整合和增强这些核心原语。例如，Consul目录同步将Consul目录中的外部服务转换为一级的Kubernetes服务资源。然后，在Kubernetes中运行的应用程序可以发现并连接到非Kubernetes服务。</p><p>除了使我们的产品在Kubernetes中更易用和更自然之外，这些集成还允许用户在与非Kubernetes工作负载共享的环境中更好地工作。 虽然新用户很容易在纯Kubernetes环境中启动，但大多数部署必须与在云计算环境中运行的外部服务，本地数据中心等进行交互。 像Consul这样的HashiCorp产品专为这些异构环境而设计。 通过实现更自然的Kubernetes体验，非Kubernetes应用程序与Kubernetes应用程序交互变得同样自然。</p><h1>下一步</h1><p>我们很高兴地宣布第一批HashiCorp Consul和Kubernetes的功能。 这些功能使得在Kubernetes上运行Consul，与非Kubernetes服务进行交互，在Kubernetes内外进行安全通信等等更加容易。 这些功能中的每一项都将在未来几周内全面公布和发布，从下周的Helm Chart开始。</p><p>Terraform和Vault也与Kubernetes紧密集成。 Terraform Kubernetes提供商现在拥有一名专职工程师，并且在未来几个月内应该会迅速改进。 Vault正在开发新的集成，也将很快公布。</p><p>如果您对Kubernetes，我们的工具以及改进这些集成感兴趣，请加入我们！ 我们有一些针对Kubernetes集成的生态系统工程师岗位需求。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[微服务架构中基于DNS的服务注册与发现]]></title>
            <link>https://nacos.io/en/blog/dns-sd</link>
            <guid>https://nacos.io/en/blog/dns-sd</guid>
            <pubDate>Sat, 02 Jun 2018 00:00:00 GMT</pubDate>
            <description><![CDATA[微服务架构中基于DNS的服务注册与发现]]></description>
            <content:encoded><![CDATA[<p>当前，微服务架构已经成为企业尤其是互联网企业技术选型的一个重要参考。微服务架构中涉及到很多模块，本文将重点介绍微服务架构的服务注册与发现以及如何基于DNS做服务发现。最后，简单介绍下阿里巴巴内部是如何基于DNS做服务发现的。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="服务注册与发现">服务注册与发现<a href="#服务注册与发现" class="hash-link" aria-label="Direct link to 服务注册与发现" title="Direct link to 服务注册与发现">​</a></h2><p>微服务体系中，服务注册与服务发现是两个最核心的模块。服务A调用服务B时，需要通过服务发现模块找到服务B的IP和端口列表，而服务B的实例在启动时需要把提供服务的IP和端口注册到服务注册中心。一个典型的结构如下图：</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/7601/1525185623334-8fbf69bb-00df-4202-a951-c1ee9caace88.png" alt="image.png | left | 733x470" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="服务注册">服务注册<a href="#服务注册" class="hash-link" aria-label="Direct link to 服务注册" title="Direct link to 服务注册">​</a></h3><p>目前，流行的注册中心比较多，常见的有zookeeper、ectd、consul、eureka等。服务注册通常有三种：自注册、第三方注册、注册中心主动同步。</p><ul><li>自注册
自注册，顾名思义，就是服务提供方在启动服务时自己把提供服务的IP和端口发送到注册中心，并通过心跳方式维持健康状态；服务下线时，自己把相应的数据删除。典型的像使用eureka客户端发布微服务。</li><li>第三方注册
第三方注册是指，存在一个第三方的系统负责在服务启动或停止时向注册中心增加或删除服务数据。典型的用法是devops系统或容器调度系统主动调注册中心接口注册服务；</li><li>注册中心主动同步
与第三方注册方式类似，主动注册方式是指注册中心和调度或发布系统打通，主动同步最新的服务IP列表；一个例子是kubernetes体系中，coredns订阅api server数据。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="服务发现">服务发现<a href="#服务发现" class="hash-link" aria-label="Direct link to 服务发现" title="Direct link to 服务发现">​</a></h3><p>在真正发起服务调用前，调用方需要从注册中心拿到相应服务可用的IP和端口列表，即服务发现。服务发现从对应用的侵入性上可以分为两大类：</p><ul><li>SDK-Based
这类的服务发现方式，需要调用方依赖相应的SDK，显式调用SDK代码才可以实现服务调用，即对业务有侵入性，典型例子如eureka、zookeeper等。</li><li>DNS-Based
DNS本身是一种域名解析系统，可以满足简单的服务发现场景，如双方约定好端口、序列化协议等等。但是，这远远不能满足真正的微服务场景需求。近几年，基于dns的服务发现渐渐被业界提了出来。后面将重点介绍基于DNS的服务发现及阿里巴巴的实践。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="基于dns的服务发现">基于DNS的服务发现<a href="#基于dns的服务发现" class="hash-link" aria-label="Direct link to 基于DNS的服务发现" title="Direct link to 基于DNS的服务发现">​</a></h2><p>DNS协议是目前最为通用的协议之一，几乎所有操作系统都会有DNS客户端实现。所以，其天然具有跨语言特性。这也是快速接入微服务体系最快的一个方式。要基于DNS做服务发现，首先注册中心的数据应该可以以DNS的数据格式暴露出来。让任何系统的DNS 客户端都可以通过DNS协议获取服务列表。</p><p>基于DNS的服务发现方式，大致可以归结两类：</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="独立dns服务器">独立DNS服务器<a href="#独立dns服务器" class="hash-link" aria-label="Direct link to 独立DNS服务器" title="Direct link to 独立DNS服务器">​</a></h3><p>独立DNS Server模式的基本架构如下图：</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/7601/1525185653048-094f815d-47af-409e-ac21-6662e20e76f4.png" alt="image.png | left | 747x469" class="img_ev3q"></p><p>如上图所示，这种架构中，需要独立的DNS服务器。DNS服务器从注册中心获取所有已注册的服务及对应的IP端口列表。调用方Service A 通过DNS查询某个服务下的IP列表，然后发起调用。</p><p>这种类型的服务发现方式优缺点分别如下：</p><ul><li>优点<ul><li>集中的DNS服务器，便于升级维护</li></ul></li><li>缺点<ul><li>对DNS服务器性能要求高</li><li>这种情况下一般需要LVS设备为DNS服务器集群做请求转发，存在单点问题</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dns-filter">DNS Filter<a href="#dns-filter" class="hash-link" aria-label="Direct link to DNS Filter" title="Direct link to DNS Filter">​</a></h3><p>DNS Filter模式我们定义为把DNS服务器集成到服务调用方机器或容器里，如下图所示：</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/7601/1525185676597-acaebac3-2b65-48a3-bdbf-7d27af7f1038.png" alt="image.png | left | 747x469" class="img_ev3q"></p><p>这种模式中，首先要保证ServiceA的DNS查询都被拦截到本机的DNS服务器上（127.0.0.1:53），在获取到服务的IP列表后发起调用。由于这种方式把DNS服务器前置到实际调用的机器上，所以它解决了独立DNS服务器模式的单点问题，完全P2P的模式。但由于需要在应用机器上安装DNS服务器，其维护和升级成本较前者高一些。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="阿里基于dns的服务发现实践">阿里基于DNS的服务发现实践<a href="#阿里基于dns的服务发现实践" class="hash-link" aria-label="Direct link to 阿里基于DNS的服务发现实践" title="Direct link to 阿里基于DNS的服务发现实践">​</a></h3><p>阿里巴巴早在2014年就开始了基于DNS做服务发现的尝试了，现在已经形成了较为成熟的模式。阿里内部以VIPServer作为注册中心，并开发了DNS Filter，部署在应用容器内。目前已经有超过20w个机器或容器上安装了DNS Filter，支持了几乎所有REST服务发现。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="注册中心-vipserver">注册中心 VIPServer<a href="#注册中心-vipserver" class="hash-link" aria-label="Direct link to 注册中心 VIPServer" title="Direct link to 注册中心 VIPServer">​</a></h4><p>VIPServer是阿里中间件软负载团队自研的服务注册中心，按照第一章的分类，VIPServer同时支持三种模式的服务注册，并且均有相当规模的应用。除此之外，VIPServer具备如下特性：</p><ul><li>主动与被动健康检查
VIPServer同时支持主动与被动健康检查。主动健康检查是指VIPserver服务端主动定期发送健康检查探测包，探测服务提供方是否可以正常提供服务。用户可以配置多种健康检查方式，自定义探测端口和探测URL（HTTP）。主动探测的好处在于服务提供方不用做任何改动即可快融入微服务架构。被动健康检查则是指服务提供方主动注册自己的IP、端口和服务名等信息，并通过心跳方式保持活性。</li><li>多种负载均衡策略
同时，VIPServer支持多种负载均衡策略，包括权重、同机房、同地域、同环境等等，是阿里异地多活项目的核心系统之一。后面会有专门的文章介绍如何基于VIPServer实现异地多活，这里不再赘述。</li><li>多重容灾保护策略
VIPServer提供了多种容灾保护策略，可以有效减少人为或者底层系统（网络等）异常带来的影响。这些容灾保护包括：<ul><li>客户端缓存，即使VIPServer服务端挂掉也不影响应用的正常调用；</li><li>服务端保护阈值，有效防止应用因压力过大而发生雪崩；</li><li>客户端容灾目录，提供人工干预服务IP列表的能力；</li><li>客户端空列表保护，有效防止人为误删IP列表操作或VIPServer服务端异常</li></ul></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="dns-f客户端">DNS-F客户端<a href="#dns-f客户端" class="hash-link" aria-label="Direct link to DNS-F客户端" title="Direct link to DNS-F客户端">​</a></h4><p>出于性能的考虑，我们采用了第二种DNS Filter的服务发现模式。为此，我们单独开发了DNS-F客户端，DNS-F客户端跟应用部署在同一个主机或容器内。其工作原理如下图所示：</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/7601/1525185700084-16f2c073-0c2b-49c0-b85b-ce2ca1163326.png" alt="image.png | left | 716x392" class="img_ev3q"></p><ul><li>首先，应用ServiceA通过DNS查询获取到ServiceB的可用IP列表</li><li>DNS-F会拦截到ServiceA的查询请求，判断自己是否该查询的答案，如果有（服务已在VIPServer中注册）则直接返回IP列表；</li><li>如果查询的服务在VIPServer中没有注册，DNS-F把DNS查询转发给系统的nameserver，由真正的DNS系统解析；</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2><p>本文介绍了微服务架构中如何基于DNS做服务发现。首先，介绍了服务法注册与发现的概念、服务注册与发现的几种方式及其优缺点；然后，介绍基于DNS的服务发现的两种方式及其优缺点；最后，介绍了阿里巴巴基于DNS做服务发现的实践，主要是基于自研的软负载系统VIPServer。基于DNS的服务发现要解决的问题远不止本文描述的这些，敬请期待后续系列文章（：。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[支持Dubbo生态发展，阿里巴巴启动新的开源项目 Nacos]]></title>
            <link>https://nacos.io/en/blog/nacos-is-coming</link>
            <guid>https://nacos.io/en/blog/nacos-is-coming</guid>
            <pubDate>Fri, 01 Jun 2018 00:00:00 GMT</pubDate>
            <description><![CDATA[支持Dubbo生态发展，阿里巴巴启动新的开源项目 Nacos]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="贡献dubbo生态阿里nacos开源计划">贡献Dubbo生态，阿里Nacos开源计划<a href="#贡献dubbo生态阿里nacos开源计划" class="hash-link" aria-label="Direct link to 贡献Dubbo生态，阿里Nacos开源计划" title="Direct link to 贡献Dubbo生态，阿里Nacos开源计划">​</a></h2><p>在上周六的Aliware技术行上海站Dubbo开发者沙龙上，阿里巴巴高级技术专家郭平(坤宇)宣布了阿里巴巴的一个新开源计划，阿里巴巴计划在7月份开启一个名叫Nacos的新开源项目, 在活动演讲中，坤宇介绍了这个开源项目的初衷，他表示 “将通过Nacos项目将阿里巴巴在建设共享服务体系中使用的服务发现、配置及服务管理平台贡献给开源社区，通过打造Dubbo + Nacos的经典组合进一步释放Dubbo在云原生及Service Mesh时代中，在大规模微服务治理、流量治理、服务集成与服务共享等服务平台能力建设上的威力，同时Nacos会非常关注对主流开源社区，如Spring Cloud和Kubernetes云原生体系的无缝对接与支持”。该项目预计在7月中旬之前开放首个测试预览版本，并计划在未来6~8个月release的0.8版本开始达到生产可用的状态。</p><p>活动的 <a href="http://www.itdks.com/dakashuo/playback/2307" target="_blank" rel="noopener noreferrer">视频回放</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是-nacos-nɑkəʊs">什么是 Nacos /nɑ:kəʊs/?<a href="#什么是-nacos-nɑkəʊs" class="hash-link" aria-label="Direct link to 什么是 Nacos /nɑ:kəʊs/?" title="Direct link to 什么是 Nacos /nɑ:kəʊs/?">​</a></h2><p>Nacos 是阿里巴巴的新开源项目，其核心定位是 “一个更易于帮助构建云原生应用的动态服务发现、配置和服务管理平台”。</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530083408486-b4698533-8e69-4e0a-9f3a-fdb1cdfbd290.png" alt="Screen Shot 2018-06-27 at 15.09.35.png" class="img_ev3q"> </p><p>Nacos 有三大主要功能:</p><ul><li>服务发现与服务管理</li></ul><p>在采用以“服务(Service)”为中心的诸如微服务及云原生方式的现代应用架构时，动态服务发现至关重要。 Nacos同时支持基于DNS和基于RPC（如Dubbo/gRPC）的服务发现，并为您提供服务的实时的健康检查以防止将请求发送给不健康的主机，基于Nacos您也可以更方便的实现服务断路器。Nacos提供的强大的服务的元数据管理，路由及流量管理策略也能够帮助您更好的构建更强壮的微服务平台。</p><ul><li>动态配置管理</li></ul><p>动态配置服务允许您在所有环境中以集中和动态的方式管理所有应用程序或服务的配置。动态配置消除了配置更新时重新部署应用程序和服务的需要。可以更方便的帮助您实现无状态服务，更轻松地实现按需弹性扩展服务实例。</p><ul><li>动态DNS服务</li></ul><p>支持权重路由的动态DNS服务使您可以更轻松地在数据中心内的生产环境中实施中间层负载平衡，灵活的路由策略，流量控制和简单的DNS解析服务，帮助您更容易的实现DNS-based服务发现。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="为什么开源-nacos">为什么开源 Nacos<a href="#为什么开源-nacos" class="hash-link" aria-label="Direct link to 为什么开源 Nacos" title="Direct link to 为什么开源 Nacos">​</a></h2><p>阿里巴巴为什么选择这么一个时间点开源Nacos，其背后的思考是什么，坤宇也给出了详细的解读，在演讲中，坤宇表示主意基于以下几点:</p><ul><li><strong>围绕着Service为中心的分布式基础设施正在变的越来越重要</strong></li></ul><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077340492-513a25c0-51d0-494f-b39d-6f615d7e3915.png" alt="Screen Shot 2018-06-27 at 13.28.09.png" class="img_ev3q"> </p><p>世界正在变的更快，创新和市场竞争的节奏正在变得愈发剧烈，如何超快速实现业务增长成为商业竞争的主旋律，几乎一夜之间共享单车就火遍全国，不到几年滴滴就改变了我们的打车方式，腾讯三班倒实现全民“吃鸡”，现在企业估值在从0到100亿所需的时间越来越短，而企业的平均寿命从标普的数据来看却从上世纪60年代的60年下降到了今天的15年，一切都表示创新和竞争的速度和烈度在加强。</p><p>另一方面技术基础设施的敏捷和有效性在商业成功的要素上占据的比重越来越大，云计算在资源和服务交付模式上的变革，带来了效率的革命性提升，带来了更敏捷的基础设施（创业不用再买机器并找机房托管，从以前的半年准备周期到现在在云上的小时级创建全套服务），而在应用架构层面，微服务架构模式带来的灵活性、韧劲，快速组合和聚合原子服务从而创新，给业务快速创新和试错提供了条件，已经被越来越多的应用平台证明其有效性，技术基础设施的更敏捷，给商业的敏捷和商业的竞争优势提供了基础。</p><p>在今天，无论是云计算，微服务还是围绕Kubernetes为中心的云原生，都在强调以“服务”为内核的应用架构模式，如果说15年前我们在讨论“一切皆是对象”构建单体系统，那么今天我们就是在谈论“一切皆是服务”，10年前淘宝服务化改造顺应了这种趋势，8年前微服务架构思想也顺应了这个趋势，今天面向“服务”的各种分布式基础设施正在变得越来越重要，站在阿里巴巴10年的服务化发展经验上看，在大规模服务发现和服务治理和服务共享领域现有的开源解决方案是不是都已经非常完美了呢？根据阿里巴巴服务化走过的这些年的生产经验来看，我们觉得并没有。</p><ul><li><strong>阿里巴巴在 "共享服务体系" 建设上的经验可以在各个行业大规模复用</strong></li></ul><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077414293-3d22cd01-6e3c-49d1-82ea-ad2f8d443cf9.png" alt="Screen Shot 2018-06-27 at 13.29.52.png" class="img_ev3q"> </p><p>阿里巴巴中台理念和体系，与云原生在精神的“道”上完全契合，即“厚技术平台，薄应用” 支持业务的快速创新与试错，从而赢得市场，中台体系倡导双引擎架构，略过“大数据”不谈，但看业务中台，就是一个大的以“服务”为中心的共享服务平台，在线服务沉淀业务数据，同步到大数据平台计算和挖掘，大数据平台则通过数据回馈，指导业务及服务的创新，支成可沉淀和可共享“服务”体系的服务注册与服务治理平台是这个体系的关键要素之一。</p><ul><li><strong>“服务治理，服务沉淀、服务共享和服务的可持续发展”是“共享服务体系”的核心价值主张</strong></li></ul><p>支持创新从小苗长成参天大树，服务平台不断演进，这一切需要一个强大的服务平台和服务基础设施的支撑。</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077444757-d36f344d-d3ae-4df0-808f-8500b4320e8d.png" alt="Screen Shot 2018-06-27 at 13.30.25.png" class="img_ev3q"> </p><ul><li><strong>阿里巴巴将通过Dubbo + Nacos以及一系列开源项目打造服务发现、服务及流量管理、服务共享平台</strong></li></ul><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077476468-4ce30dd9-0da7-414a-875d-acc151739c1d.png" alt="Screen Shot 2018-06-27 at 13.30.58.png" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-与-主流开源生态的关系">Nacos 与 主流开源生态的关系<a href="#nacos-与-主流开源生态的关系" class="hash-link" aria-label="Direct link to Nacos 与 主流开源生态的关系" title="Direct link to Nacos 与 主流开源生态的关系">​</a></h2><p>Nacos 不会是个封闭的体系，除了对于阿里开源生态体系如Dubbo等自身的支持，也非常强调融入其它的开源生态，这里就包括Java的微服务生态体系Spring Cloud，Kubernetes/CNCF云原生生态体系，正如Nacos的未来全景图展示的那样</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077509217-d4fec359-8a41-4c51-a986-c44e06d16950.png" alt="Screen Shot 2018-06-27 at 13.31.30.png" class="img_ev3q"> </p><ul><li>Dubbo + Nacos， 专为Dubbo而生的注册中心与配置中心</li></ul><p>在阿里巴巴生产环境上，Dubbo和Nacos天然就是长在一起的，因为Nacos的缺失，传统的注册中心解决方案让Dubbo在服务治理、流量治理、服务运营和管理等方面的威力被限制和削弱了，Nacos的开源和开放会在采用Dubbo的用户环境中释放这些威力</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077613925-04d767fd-ec95-4fe2-8249-ce8650fbe372.png" alt="Screen Shot 2018-06-27 at 13.31.57.png" class="img_ev3q"> </p><ul><li>Nacos 会完全兼容Spring Cloud</li></ul><p>Nacos会无缝支持Spring Cloud，为Spring Cloud用户其提供更简便的配置中心和注册中心的解决方案，使用Nacos不用再仅仅为服务和配置就需要在生产上hold住 Eureka，Spring Cloud Config Server，Git，RabbitMQ/Kafka 起码四个开源产品。</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077646935-7ca8a74d-59e5-4e01-865e-06fd5631e623.png" alt="Screen Shot 2018-06-27 at 13.33.40.png" class="img_ev3q"> </p><ul><li>Nacos 支持Kubernetes DNS-based Service Discovery</li></ul><p>在演讲中坤宇也表示，阿里巴巴这么多年在VIPServer DNS-based Service Discovery上的实践证明，在云原生时代，应用会更关注与基础设施的解耦合、多语言乃至多云的诉求，服务发现的未来一定是基于标准的DNS协议做，而不是像Eureka或者像ZooKeeper这样的私有API或者协议做, 同时在云上，在服务发现场景中，注册中心更关注的是可用性而不是数据一致性，所以Nacos会首推DNS-based Servcie Discovery，并优先关注可用性，而这也正是Nacos可以无缝融合进Kubernetes服务发现体系的原因所在</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077691493-4dae9605-6886-4307-bc9d-16ba1cceb7ac.png" alt="Screen Shot 2018-06-27 at 13.34.18.png" class="img_ev3q"> </p><ul><li>Nacos 会填补Spring Cloud 体系与 Kubernetes 体系的鸿沟
</li></ul><p>未来会有越来越多java生态的用户会选择 Kubernetes+Spring Cloud 组合，但不幸的是，在服务发现和配置管理的解决方案上，这2个体系都采用了完全不同的方案，这给同时采用2个体系的用户在注册中心和配置中心的需求上带来了非常大的不必要的复杂性。Nacos会尝试填补2者的鸿沟，以便在2套体系下可以采用同一套服务发现和配置管理的解决方案，这将大大的简化使用和维护的成本。</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077731231-85a58c0e-ff5c-45a1-9bc8-b989e2b09d55.png" alt="Screen Shot 2018-06-27 at 13.35.05.png" class="img_ev3q"> </p><ul><li>Nacos 与 Service Mesh</li></ul><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077754298-39bbbdd0-c7af-434a-b189-8fd7ac958b43.png" alt="Screen Shot 2018-06-27 at 13.35.38.png" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-部分特性预览">Nacos 部分特性预览<a href="#nacos-部分特性预览" class="hash-link" aria-label="Direct link to Nacos 部分特性预览" title="Direct link to Nacos 部分特性预览">​</a></h2><p>同时在会上，坤宇对Nacos 1.0版本的部分特性给大家做了预览</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077784470-27f0e268-8d1f-443a-b1a5-3d59e15ab8f4.png" alt="Screen Shot 2018-06-27 at 13.36.06.png" class="img_ev3q"> </p><p>每个产品都有自己的风格和标签，坤宇在演讲中表示，团队会通过持续的贡献和努力，希望未来给Nacos贴上四个方面的标签</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077851626-25444089-c027-4b89-a606-2e693b4e052d.png" alt="Screen Shot 2018-06-27 at 13.37.10.png" class="img_ev3q"> </p><p>在部署形态上，Nacos会支持多种部署形态，包括注册中心与配置中心的分离部署，同时在阿里云上提供Nacos的SaaS化部署服务，感兴趣的可以直接在阿里云上开通账户免费体验Nacos服务，在开源与商业化版本差别上，商业化的ACM以及EDAS ANS更强调与阿里云其它云服务以及其它Aliware PaaS的商业产品的集成体验以及提供商业服务。</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077875162-26cfa0e2-3da0-473e-98b9-190aa6d6d97a.png" alt="Screen Shot 2018-06-27 at 13.36.37.png" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-的主要产品里程碑及计划">Nacos 的主要产品里程碑及计划<a href="#nacos-的主要产品里程碑及计划" class="hash-link" aria-label="Direct link to Nacos 的主要产品里程碑及计划" title="Direct link to Nacos 的主要产品里程碑及计划">​</a></h2><blockquote><p>罗马不是一天建成的，吾将上下而求索 </p></blockquote><p>因为Nacos是脱胎于阿里巴巴的生产代码，整体体系非常庞杂，在代码梳理、重构和剥离与内部的耦合上是一个渐进的过程，所以@坤宇特别提醒社区在Nacos 0.8达到生产可用状态前，不建议用于生产，不过可以在开发和测试环境尝试使用，在0.8版本开始，大家可以放心的用于生产环境，Nacos整体研发计划是在未来6-8个月将达到生产可用的状态，未来会很快启动将Nacos贡献给开源基金会进一步社区化发展。</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077912860-52c7fea4-5285-45a0-a3b8-73ba010c53da.png" alt="Screen Shot 2018-06-27 at 13.38.13.png" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-与相关开源产品的对比">Nacos 与相关开源产品的对比<a href="#nacos-与相关开源产品的对比" class="hash-link" aria-label="Direct link to Nacos 与相关开源产品的对比" title="Direct link to Nacos 与相关开源产品的对比">​</a></h2><blockquote><p>君子和而不同</p></blockquote><p>如上面对整体业务及技术形式的判断，我们可以看到 Nacos 与同类竞品的主要不同主要在于理念，@坤宇介绍说，严格来说这些市面上的产品并不与Nacos完全对标，只是与Nacos里面的服务发现部分对标，Nacos的未来更看重在这些产品的基础上构建服务平台的能力，而不仅仅是在基础的服务发现能力上。</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077938157-00e6b34f-9a16-498c-9b89-cc48f6d6bb73.png" alt="Screen Shot 2018-06-27 at 13.38.41.png" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="社区化发展欢迎加入并贡献社区">社区化发展，欢迎加入并贡献社区<a href="#社区化发展欢迎加入并贡献社区" class="hash-link" aria-label="Direct link to 社区化发展，欢迎加入并贡献社区" title="Direct link to 社区化发展，欢迎加入并贡献社区">​</a></h2><blockquote><p>DISS is cheap, show me your hand
比吐槽更重要的是搭把手，参与社区一起发展Nacos</p></blockquote><p>与阿里巴巴早期的开源不同，阿里巴巴新一轮的开源包括RocketMQ，Pouch Container，Dubbo, Nacos等开源产品更强调社区化的发展与社区的多样性，鼓励更多的公司和更多的开发者参与到开源项目中来，依托于社区将产品做得更好，同时一开始就会关注国际化，与国外同类产品的直面竞争。</p><p>Nacos初步计划，在第一年就吸收至少超过5名来自其它公司的PMC,至少10名的外部Committer, 而且Nacos处在项目开源的初期，有大把的空间让有想法、有热情、有能力的开发者参与进来，Nacos本身在很多方面都急需要社区的帮助，这里面就急需包括前端及UI建设，Spring Cloud、Kubernetes、Service Mesh体系融合与集成，多语言客户端等各方面的技术领导者的参与，如果您对Nacos这个开源项目感兴趣，欢迎加入Nacos社区。你可以通过扫“超哥”的微信二维码，让“超哥” 帮你加入 “Nacos社区交流群” </p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530077965587-8f4e3100-bdd4-469a-9ea0-7af7061bc9ef.png" alt="Screen Shot 2018-06-27 at 13.39.09.png" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="感谢所有未来给我们帮助的朋友">感谢所有未来给我们帮助的朋友<a href="#感谢所有未来给我们帮助的朋友" class="hash-link" aria-label="Direct link to 感谢所有未来给我们帮助的朋友" title="Direct link to 感谢所有未来给我们帮助的朋友">​</a></h2><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/15914/1530078016801-65ce72c1-c135-42b6-8076-a046f7829ba7.png" alt="Screen Shot 2018-06-27 at 13.39.40.png" class="img_ev3q"> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2><ul><li><a href="https://yq.aliyun.com/articles/601745" target="_blank" rel="noopener noreferrer">阿里巴巴为什么不用 ZooKeeper 做服务发现？</a></li><li><a href="https://yq.aliyun.com/articles/226238?spm=5176.163362.847322.3.5a8925397in790" target="_blank" rel="noopener noreferrer">现代应用架构中的配置管理面临的挑战和应对之道</a></li><li><a href="http://jm.taobao.org/2016/06/02/zhangwensong-and-load-balance/" target="_blank" rel="noopener noreferrer">章文嵩博士和他背后的负载均衡帝国</a></li><li><a href="https://blog.csdn.net/heyc861221/article/details/80126013" target="_blank" rel="noopener noreferrer">VIPServer：阿里智能地址映射及环境管理系统详解</a></li></ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[阿里巴巴服务注册中心产品ConfigServer 10年技术发展回顾]]></title>
            <link>https://nacos.io/en/blog/alibaba-configserver</link>
            <guid>https://nacos.io/en/blog/alibaba-configserver</guid>
            <pubDate>Sun, 20 May 2018 00:00:00 GMT</pubDate>
            <description><![CDATA[阿里巴巴服务注册中心产品ConfigServer 10年技术发展回顾]]></description>
            <content:encoded><![CDATA[<p>作者：阿里巴巴高级技术专家，许真恩(慕义)</p><p>文章概要：本文简单描述了Eureka1.0存在的架构问题，Eureka2.0设想的架构。详细回顾了阿里巴巴的服务注册中心ConfigServer产品从2008年建设元年至今经历的关键架构演进。通过这个文章你会对基于AP模式的注册中心在技术发展过程中将会碰到的问题有所感知。</p><h1>Eureka1.0架构存在的问题</h1><p>Eureka作为Netflix公司力推和SpringCloud微服务标配的注册中心开源解决方案，其Eureka 2.0 (Discontinued)的消息在社区引起了不小的骚动；其实早在2015年社区就已经放出了2.0架构的升级设想，但是3年的时间过去，等到的确是Discontinued的消息，虽然2.0的代码在github的主页上也已经放出，但是告诫用户要自行承担当中的使用风险。我想不会有人真的把2.0直接投入到生产中使用。</p><p>对于为什么要做Eureka2.0，其官方的wiki中的Why Eureka 2.0和Eureka 2.0 Improvements做了如下的说明</p><ul><li>Only support homogenous client views: Eureka servers only expects the client to always get the entire registry and does not allow to get specific applications/VIP addresses. This imposes a memory limitation on all clients registering with Eureka, even if they need a very small subset of the Eureka’s registry.</li><li>Only supports scheduled updates: Eureka client follows a poll model to fetch updates from the server routinely. This imposes an overhead on the client of doing a scheduled call to the server, even if there are no changes and also delays the updates by the poll interval.</li><li>Replication algorithm limits scalability: Eureka follows a broadcast replication model i.e. all the servers replicate data and heartbeats to all the peers. This is simple and effective for the data set that eureka contains however replication is implemented by relaying all the HTTP calls that a server receives as is to all the peers. This limits scalability as every node has to withstand the entire write load on eureka.</li></ul><p>Although Eureka 2.0 provides a more richer feature set, the above limitations are the major driving factors for the changes proposed in this version.
Based on the above motivations, Eureka 2.0 achieves the following improvements:</p><ul><li>Interest based subscription model for registry data: A client of Eureka is able to select a part of the instance registry in which it is interested in and the eureka server only sends information about that part of the registry. Eg: A client can say I am only interested in application “WebFarm” and then the server will only send information about WebFarm instances. Eureka server provides various selection criterions and a way to update this interest set dynamically.</li><li>Push model from the server for any changes to the interest set: Instead of the current pull model from the client, Eureka servers pushes updates for changes to the interest set, to the client.</li><li>Optimized replication: As Eureka 1.0, Eureka 2.0 also follows a broadcast replication model i.e. every node replicates data to all other nodes. However, the replication algorithm is much more optimized eliminating the need of sending heartbeats for every instance in the registry. This drastically reduce the replication traffic and achieves much higher scalability.</li><li>Auto-scaled Eureka servers: Eureka 2.0 divides the read (discovery of data) and write (registration) concerns into separate clusters. Since, the write load is predictable (proportional to the number of instances in a region), the write cluster is pre-scaled. On the other hand, read load is unpredictable (proportional to subscriptions from clients) and hence the read farm is auto-scaled.</li><li>Audit log: Eureka 2.0 provides an elaborate audit log for any change done to the registry. This helps Eureka owners as well as users to get insight into debugging the state of individual application instances as exists in Eureka. The audit log by default is persisted to a log file, but different persistent storages can be plugged-in.</li><li>Dashboard: Eureka 2.0 provides a rich dashboard (as opposed to very rudimentary dashboard of Eureka 1.0) with insights into Eureka internals with respect to registry views, server health, subscription state, audit log, etc.</li></ul><p>&nbsp;简单翻译总结，也就是Eureka1.0的架构主要存在如下的不足：</p><ul><li>订阅端拿到的是服务的全量的地址：这个对于客户端的内存是一个比较大的消耗，特别在多数据中心部署的情况下，某个数据中心的订阅端往往只需要同数据中心的服务提供端即可。</li><li>pull模式：客户端采用周期性向服务端主动pull服务数据的模式（也就是客户端轮训的方式），这个方式存在实时性不足以及无谓的拉取性能消耗的问题。</li><li>一致性协议：Eureka集群的多副本的一致性协议采用类似“异步多写”的AP协议，每一个server都会把本地接收到的写请求（register/heartbeat/unregister/update）发送给组成集群的其他所有的机器（Eureka称之为peer），特别是hearbeat报文是周期性持续不断的在client-&gt;server-&gt;all peers之间传送；这样的一致性算法，导致了如下问题<ul><li>每一台Server都需要存储全量的服务数据，Server的内存明显会成为瓶颈。</li><li>当订阅者却来越多的时候，需要扩容Eureka集群来提高读的能力，但是扩容的同时会导致每台server需要承担更多的写请求，扩容的效果不明显。</li><li>组成Eureka集群的所有server都需要采用相同的物理配置，并且只能通过不断的提高配置来容纳更多的服务数据</li></ul></li></ul><p>Eureka2.0主要就是为了解决上述问题而提出的，主要包含了如下的改进和增强</p><ul><li>数据推送从pull走向push模式，并且实现更小粒度的服务地址按需订阅的功能。</li><li>读写分离：写集群相对稳定，无需经常扩容；读集群可以按需扩容以提高数据推送能力。</li><li>新增审计日志的功能和功能更丰富的Dashboard。</li></ul><p>Eureka1.0版本存在的问题以及Eureka2.0架构设想和阿里巴巴内部的同类产品ConfigServer所经历的阶段非常相似（甚至Eureka2.0如果真的落地后存在的问题，阿里巴巴早已经发现并且已经解决），下面我带着你来回顾一下我们所经历过的。</p><h1>阿里巴巴服务注册中心ConfigServer技术发现路线</h1><p>阿里巴巴早在2008就开始了服务化的进程，在那个时候就就已经自研出服务发现解决方案（内部产品名叫ConfigServer）。</p><p>当2012年9月1号Eureka放出第一个1.1.2版本的时候，我们把ConfigServer和Eureka进行了深度的对比，希望能够从Eureka找到一些借鉴来解决当时的ConfigServer发展过程中碰到的问题（后面会提到）；然而事与愿违，我们已经发现Eureka1.x架构存在比较严重的扩展性和实时性的问题（正如上面所描述的），这些问题ConfigServer当时的版本也大同小异的存在，我们在2012年底对ConfigServer的架构进行了升级来解决这些问题。</p><p>当2015年Eureka社区放出2.0架构升级的声音的时候，我们同样第一时间查看了2.0的目标架构设计，我们惊奇的发现Eureka的这个新的架构同2012年底ConfigServer的架构非常相似，当时一方面感慨“英雄所见略同”，另一方也有些失望，因为ConfigServer2012年的架构早就无法满足阿里巴巴内部的发展诉求了。</p><p>下面我从头回顾一下，阿里巴巴的ConfigServer的技术发展过程中的几个里程碑事件。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2008年无configserver的时代">2008年，无ConfigServer的时代<a href="#2008年无configserver的时代" class="hash-link" aria-label="Direct link to 2008年，无ConfigServer的时代" title="Direct link to 2008年，无ConfigServer的时代">​</a></h2><p>借助用硬件负载设备F5提供的vip功能，服务提供方只提供vip和域名信息，调用方通过域名方式调用，所有请求和流量都走F5设备。</p><p>遇到的问题：</p><ul><li>负载不均衡：对于长连接场景，F5不能提供较好的负载均衡能力。如服务提供方发布的场景，最后一批发布的机器，基本上不能被分配到流量。需要在发布完成后，PE手工去断开所有连接，重新触发连接级别的负载均衡。</li><li>流量瓶颈：所有的请求都走F5设备，共享资源，流量很容易会打满网卡，会造成应用之间的相互影响。</li><li>单点故障：F5设备故障之后，所有远程调用会被终止，导致大面积瘫痪。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2008年configserver单机版v10">2008年，ConfigServer单机版V1.0<a href="#2008年configserver单机版v10" class="hash-link" aria-label="Direct link to 2008年，ConfigServer单机版V1.0" title="Direct link to 2008年，ConfigServer单机版V1.0">​</a></h2><p>单机版定义和实现了服务发现的关键的模型设计（包括服务发布，服务订阅，健康检查，数据变更主动推送，这个模型至今仍然适用），应用通过内嵌SDK的方式接入实现服务的发布和订阅；这个版本很重要的一个设计决策就是服务数据变更到底是pull还是push的模式，我们从最初就确定必须采用push的模式来保证数据变更时的推送实时性（Eureka1.x的架构采用的是pull的模式）</p><p>当时，HSF和Notify就是采用单机版的ConfigServer来完成服务的发现和topic的发现。单机版的ConfigServer和HSF、Notify配合，采用服务发现的技术，让请求通过端到端的方式流动，避免产生流量瓶颈和单点故障。ConfigServer可以动态的将服务地址推送到客户端，服务调用者可以知道所有提供此服务的机器，每个请求都可以通过随机或者轮询的方式选择服务端，做到请求级别的负载均衡。这个版本已经能很好的解决F5设备不能解决的三个问题。</p><p>但是单机版本的问题也非常明显，不具备良好的容灾性；</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2009年初configserver单机版v15">2009年初，ConfigServer单机版V1.5<a href="#2009年初configserver单机版v15" class="hash-link" aria-label="Direct link to 2009年初，ConfigServer单机版V1.5" title="Direct link to 2009年初，ConfigServer单机版V1.5">​</a></h2><p>单机版的ConfigServer所面临的问题就是当ConfigServer在发布/升级的时候，如果应用刚好也在发布，这个时候会导致订阅客户端拿不到服务地址的数据，影响服务的调用；所以当时我们在SDK中加入了本地的磁盘缓存的功能，应用在拿到服务端推送的数据的时候，会先写入本地磁盘，然后再更新内存数据；当应用重启的时候，优先从本地磁盘获取服务数据；通过这样的方式解耦了ConfigServer和应用发布的互相依赖；这个方式沿用至今。（我很惊讶，Eureka1.x的版本至今仍然没有实现客户端磁盘缓存的功能，难道Eureka集群可以保持100%的SLA吗？）</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2009年7月configserver集群版本v20">2009年7月，ConfigServer集群版本V2.0<a href="#2009年7月configserver集群版本v20" class="hash-link" aria-label="Direct link to 2009年7月，ConfigServer集群版本V2.0" title="Direct link to 2009年7月，ConfigServer集群版本V2.0">​</a></h2><p>ConfigServer的集群版本跟普通的应用有一些区别：普通的应用通过服务拆分后，已经属于无状态型，本身已经具备良好的可扩展性，单机变集群只是代码多部署几台；ConfigServer是有状态的，内存中的服务信息就是数据状态，如果要支持集群部署，这些数据要不做分片，要不做全量同步；由于分片的方案并没有真正解决数据高可用的问题（分片方案还需要考虑对应的failover方案），同时复杂度较高；所以当时我们选择了单机存储全量服务数据全量的方案。为了简化数据同步的逻辑，服务端使用客户端模式同步：服务端收到客户端请求后，通过客户端的方式将此请求转发给集群中的其他的ConfigServer，做到同步的效果，每一台ConfigServer都有全量的服务数据。</p><p>这个架构同Eureka1.x的架构惊人的相似，所以很明显的Eureka1.x存在的问题我们也存在；当时的缓解的办法是我们的ConfigServer集群全部采用高配物理来部署。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2010年底configserver集群版v25">2010年底，ConfigServer集群版V2.5<a href="#2010年底configserver集群版v25" class="hash-link" aria-label="Direct link to 2010年底，ConfigServer集群版V2.5" title="Direct link to 2010年底，ConfigServer集群版V2.5">​</a></h2><p>基于客户端模式在集群间同步服务数据的方案渐渐无以为继了，特别是每次应用在发布的时候产生了大量的服务发布和数据推送，服务器的网卡经常被打满，同时cmsgc也非常频繁；我们对数据同步的方案进行了升级，去除了基于客户端的同步模式，采用了批量的基于长连接级别的数据同步+周期性的renew的方案来保证数据的一致性（这个同步方案当时还申请了国家专利）；这个版本还对cpu和内存做了重点优化，包括同步任务的合并，推送任务的合并，推送数据的压缩，优化数据结构等；</p><p>这个版本是ConfigServer历史上一个比较稳定的里程碑版本。</p><p>但是随着2009年天猫独创的双十一大促活动横空出世，服务数量剧增，应用发布时候ConfigServer集群又开始了大面积的抖动，还是体现在内存和网卡的吃紧，甚至渐渐到了fullgc的边缘；为了提高数据推送能力，需要对集群进行扩容，但是扩容的同时又会导致每台服务器的写能力下降，我们的架构到了“按下葫芦浮起瓢”的瓶颈。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2012年底configserver集群版v30">2012年底，ConfigServer集群版V3.0<a href="#2012年底configserver集群版v30" class="hash-link" aria-label="Direct link to 2012年底，ConfigServer集群版V3.0" title="Direct link to 2012年底，ConfigServer集群版V3.0">​</a></h2><p>在2011年双十一之前我们完成了V3架构的落地，类似Eureka2.0所设计的读写分离的方案，我们把ConfigServer集群拆分成session和data两个集群，客户端分片的把服务数据注册到session集群中，session集群会把数据异步的写到data集群，data集群完成服务数据的聚合后，把压缩好的服务数据推送到session层缓存下来，客户端可以直接从session层订阅到所需要的服务数据；这个分层架构中，session是分片存储部分的服务数据的（我们设计了failover方案），data存储的是全量服务数据（天生具备failover能力）；</p><p>data集群相对比较稳定，不需要经常扩容；session集群可以根据数据推送的需求很方便的扩容（这个思路和Eureka2.0所描述的思路是一致的）；session的扩容不会给data集群带来压力的增加。session集群我们采用低配的虚拟机即可满足需求，data由于存储是全量的数据我们仍然采用了相对高配的物理机（但是同V2.5相比，对物理机的性能要求已经答复下降）</p><p>这个版本也是ConfigServer历史上一个划时代的稳定的大版本。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2014年configserver集群版v35">2014年，ConfigServer集群版V3.5<a href="#2014年configserver集群版v35" class="hash-link" aria-label="Direct link to 2014年，ConfigServer集群版V3.5" title="Direct link to 2014年，ConfigServer集群版V3.5">​</a></h2><p>2013年，阿里巴巴开始落地了异地多活方案，从一个IDC渐渐往多个IDC跨越，随之而来的对流量的精细化管控要求越来越高（比如服务的同机房调用，服务流量的调拨以支持灰度能力等），基于这个背景ConfigServer引入了服务元数据的概念，支持对服务和IP进行元数据的打标来满足各种各样的服务分组诉求。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2017年configserver集群版v40">2017年，ConfigServer集群版V4.0<a href="#2017年configserver集群版v40" class="hash-link" aria-label="Direct link to 2017年，ConfigServer集群版V4.0" title="Direct link to 2017年，ConfigServer集群版V4.0">​</a></h2><p>V3版本可见的一个架构的问题就是data集群是存储全量的服务数据的，这个随着服务数的与日俱增一定会走到升级物理机配置也无法解决问题的情况（我们当时已经在生产使用了G1的垃圾回收算法），所以我们继续对架构进行升级，基于V3的架构进行升级其实并不复杂；session层的设计保持不变，我们把data进行分片，每一个分片同样按照集群的方式部署以支持failover的能力；</p><table><thead><tr><th></th><th>ConfigServer</th><th>Eureka</th></tr></thead><tbody><tr><td>2008年</td><td>V1.0：单机版，定义了服务发现的领域模型</td><td></td></tr><tr><td>2009年初</td><td>V1.5：应用和ConfigServer集群发布解耦</td><td></td></tr><tr><td>2009年7月</td><td>V2.0：基于客户端模式同步数据，支持集群部署</td><td></td></tr><tr><td>2010年底</td><td>V2.5：优化集群间数据同步模式，申请国家专利。</td><td></td></tr><tr><td>2012年9月1号</td><td></td><td>Eureka1.0正式开源</td></tr><tr><td>2012年底</td><td>V3.0：支持session和data分层部署</td><td></td></tr><tr><td>2014年</td><td>V3.5：支持异地多活等细分场景</td><td></td></tr><tr><td>2015年</td><td></td><td>Eureka2.0架构升级方案公布</td></tr><tr><td>2017年</td><td>V4.0：支持data分片能力</td><td></td></tr><tr><td>2018年7月</td><td></td><td>Eureka2.0架构升级宣布停止</td></tr></tbody></table><h1>Nacos</h1><p>作为同属于AP类型的注册中心，Eureka和ConfigServer发展过程中所面临的诸多问题有很大的相似性，但是阿里巴巴这些年业务的跨越式发展，每年翻番的服务规模，不断的给ConfigServer的技术架构演进带来更高的要求和挑战，我们有更多的机会在生产环境发现和解决一个个问题的过程中，做架构的一代代升级。我们正在计划通过开源的手段把我们这些年在生产环境上的实践经验通过Nacos(<a href="http://nacos.io" target="_blank" rel="noopener noreferrer">链接</a>)产品贡献给社区，一方面能够助力和满足同行们在微服务落地过程当中对工业级注册中心的诉求，另一方面也希望通过开源社区及开源生态的协同发展给ConfigServer带来更多的可能性。</p><p>炎炎夏日，在Eureka 2.0 (Discontinued) 即将结束的时候，在同样的云原生时代，Nacos却正在迎来新生，技术演进和变迁的趣味莫过于此。</p><p>Nacos将努力继承Eureka未竟的遗志，扛着AP系注册中心的旗帜继续前行，不同的是Nacos更关注DNS-based Service Discovery以及与Kubernetes体系的融会贯通。</p><p>我们看不透未来，却仍将与同行们一起上下求索，砥砺前行。</p><p>最后附上Nacos的架构图。</p><p><img loading="lazy" src="https://cdn.yuque.com/lark/0/2018/png/12425/1530856061648-7180b97f-b61d-4127-924e-a0743b9e9d5a.png" alt="屏幕快照 2018-06-28 下午4.58.59.png | center | 748x544" class="img_ev3q"></p>]]></content:encoded>
        </item>
    </channel>
</rss>