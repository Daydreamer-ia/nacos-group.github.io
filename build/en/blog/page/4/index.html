<!doctype html>
<html lang="en-US" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Blog | Nacos</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://nacos.io/en/img/nacos_colorful.png"><meta data-rh="true" name="twitter:image" content="https://nacos.io/en/img/nacos_colorful.png"><meta data-rh="true" property="og:url" content="https://nacos.io/en/blog/page/4"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="Nacos"><meta data-rh="true" property="og:title" content="Blog | Nacos"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="https://img.alicdn.com/tfs/TB1hgJpHAPoK1RjSZKbXXX1IXXa-64-64.png"><link data-rh="true" rel="canonical" href="https://nacos.io/en/blog/page/4"><link data-rh="true" rel="alternate" href="https://nacos.io/en/blog/page/4" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://nacos.io/zh-cn/blog/page/4" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://nacos.io/blog/page/4" hreflang="default"><link data-rh="true" rel="alternate" href="https://nacos.io/blog/page/4" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/en/blog/rss.xml" title="Nacos RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/blog/atom.xml" title="Nacos Atom Feed">




<link rel="stylesheet" href="//g.alicdn.com/mamba/assets/0.0.19/mse-arc-ui.min.css">
<script src="//g.alicdn.com/mamba/assets/0.0.19/mse-arc-ui.min.js"></script>
<script src="//g.alicdn.com/alilog/mlog/aplus_v2.js" id="beacon-aplus" exparams="clog=o&amp;aplus&amp;sidx=aplusSidx&amp;ckx=aplusCkx"></script>
<script src="//g.alicdn.com/aes/??tracker/1.0.34/index.js,tracker-plugin-pv/2.4.5/index.js,tracker-plugin-event/1.2.5/index.js,tracker-plugin-jserror/1.0.13/index.js,tracker-plugin-api/1.1.14/index.js,tracker-plugin-perf/1.1.8/index.js,tracker-plugin-eventTiming/1.0.4/index.js"></script>
<script src="https://www.googletagmanager.com/gtag/js?id=G-YHS75WKFBR" async></script><link rel="stylesheet" href="/en/assets/css/styles.45670f1e.css">
<link rel="preload" href="/en/assets/js/runtime~main.989215be.js" as="script">
<link rel="preload" href="/en/assets/js/main.a44af4a6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/nacos_colorful.png" alt="Nacos Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/en/img/nacos_colorful.png" alt="Nacos Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/en/">Home</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" docid="/what-is-nacos" href="/en/docs/v2/what-is-nacos">2.X</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/docs/next/v2/what-is-nacos">User Docs</a></li><li><a class="dropdown__link" href="/en/docs/v2/what-is-nacos">2.X</a></li><li><a class="dropdown__link" href="/en/docs/1.X/v2/what-is-nacos">1.X</a></li></ul></div><a href="https://cn.aliyun.com/product/aliware/mse?spm=nacos-website.topbar.0.0.0" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">NACOS IN CLOUD<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://developer.aliyun.com/ebook/36?spm=a2c6h.20345107.ebook-index.18.152c2984fsi5ST" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">E-BOOK-NACOS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/blog">BLOG</a><a class="navbar__item navbar__link" href="/en/community">COMMUNITY</a><a href="http://console.nacos.io/nacos/index.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">DEMO-CONSOLE<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_DSK9"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>En</a><ul class="dropdown__menu"><li><a href="/en/blog/page/4" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-US">En</a></li><li><a href="/zh-cn/blog/page/4" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-CN">中</a></li></ul></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All Posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/1.4.0-release">Nacos 1.4.0 + Go SDK 1.0.1 Release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.0.1-release">Nacos 2.0.1 + 1.4.2 Release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.0.3-release">Nacos 2.0.3 Release, continue to improve stability.</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.1.0-release">Nacos 2.1.0版本发布，支持鉴权及加解密插件</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.1.1-release">2.1.1-release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.2.0-release">2.2.0-release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.2.1-release">2.2.1-release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2.2.2-release">2.2.2-release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/212-and-220beta-release">212-and-220beta-release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/5w1h-what">What problems does Nacos help us solve? —— Configuration Management</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/5w1h-where">Nacos 有哪些典型的应用场景？—— 配置管理篇</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/access control design">Nacos权限控制设计方案</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/address-server">Nacos环境隔离</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/alibaba-configserver">阿里巴巴服务注册中心产品ConfigServer 10年技术发展回顾</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/announcement-token-secret-key">announcement-token-secret-key</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/apisix">Apache APISIX Realizes Service Discovery Based on Nacos</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/chengdu-dubbo">Nacos 计划发布v0.2版本，进一步融合Dubbo和SpringCloud生态</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/cmdb">Nacos打通CMDB实现就近访问</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/cncf">Nacos 进入CNCF landscape</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/consul-k8s">Consul与kubernetes整合公告[翻译]</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/csharp-0.5.0">v0.5.0 of Nacos-sdk-csharp was released! Capabilities aligned with Java SDK！</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/discovery-console">Nacos服务发现控制台预览</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/dns-sd">微服务架构中基于DNS的服务注册与发现</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/download">download page</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/dynamic-route-zuul-nacos">dynamic-route-zuul-nacos</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/eureka2">eureka2</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/feeling-of-ASoC-2019">参与开源，Offer拿到手软 -- 来自一名2019阿里巴巴编程之夏同学的亲述</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/higress">higress</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/huya-nacos">虎牙直播共建Nacos生态</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/huya-practice">虎牙直播在微服务改造方面的实践和总结</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/iscas2021">Nacos ISCAS 2021 start to apply</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/iscas2022">Nacos开源之夏，贡献社区赢取12000奖金</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/iscas2023">iscas2023</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos 1.1.0">Nacos 1.1.0发布，支持灰度配置和地址服务器模式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos 1.1.4">Nacos 1.1.4发布，业界率先支持Istio MCP协议</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos 1.2.0 guide">Nacos 1.2.0 权限控制介绍和使用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-1.3.0-design">Nacos 1.3.0 new kernel construction process</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-2nd-anniversary">Nacos 两周年献礼，Nacos 1.3.2 + Go SDK 1.0.0发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-confd">nacos-confd</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-distro-mechanism">nacos-distro-mechanism</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-is-coming">支持Dubbo生态发展，阿里巴巴启动新的开源项目 Nacos</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-reigster-mechanism">nacos-reigster-mechanism</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos-roadmap">Nacos Roadmap：Nacos GA后会有哪些大动作？</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos">Nacos 0.1.0 版本Review 活动设计</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos0.5">Nacos0.5发布，支持DNS-based Service Discovery，JAVA 11</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos0.6">Nacos 0.6版本发布，支持Dubbo生态并且支持Docker部署</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos0.8">Nacos 0.8.0版本进行发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos0.9-intro">Nacos 0.9.0版本进行发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos0.9.0">Nacos 0.9.0版本进行发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos1.0.0">Nacos 发布 1.0.0 版本，可大规模投入到生产环境中</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/nacos3.0-is-coming">我们总结了3大使用建议，并首次公开 Nacos3.0 规划图 | Nacos 开源4周年</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/namespace-endpoint-best-practices">Namespace,endpoint 最佳实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/performance-compare">Performance comparison between Nacos 2.0 upgrading or not.</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/pilot mcp">Pilot MCP协议介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/springboot-0.2.10">springboot-0.2.10</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/up-to-2w-star">up-to-2w-star</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/use-nacos-with-rainbond">Install the HA Nacos cluster in Rainbond with one-click</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/xiaomi-scale">xiaomi-scale</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2021/08/01/mdx-blog-post">mdx-blog-post</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2019/05/29/long-blog-post">long-blog-post</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2019/05/28/first-blog-post">first-blog-post</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Nacos ISCAS 2021 start to apply"><meta itemprop="keywords" content="ISCAS2021"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/iscas2021">Nacos ISCAS 2021 start to apply</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T11:47:41.000Z" itemprop="datePublished">October 10, 2023</time> · <!-- -->5 min read</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="关于nacos">关于Nacos<a href="#关于nacos" class="hash-link" aria-label="Direct link to 关于Nacos" title="Direct link to 关于Nacos">​</a></h2><p>Nacos（/nɑ:kəʊs/）是Dynamic <u>Na</u>ming and <u>Co</u>nfiguration <u>S</u>ervice的首字母简称，是一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。它孵化于阿里巴巴，成长于十年双十一的洪峰考验，沉淀了简单易用、稳定可靠、性能卓越的核心竞争力。
<img loading="lazy" alt="image.png" src="/en/assets/images/features-b3ef3792c7e7919ffae4df3ba4bc860d.png" width="680" height="259" class="img_ev3q"></p><p>Nacos经过数年的社区共建，支持诸如Java、Go、Python等主流语言、支持如Dubbo和Spring Cloud Alibaba等主流服务框架和配置管理框架、同时还支持对接了如Istio，CoreDNS等云原生组件，是目前使用最广泛的微服务框架基础设施。
<img loading="lazy" alt="image.png" src="/en/assets/images/ecology-e71e0177f31a7e7353199e2804e7019d.png" width="680" height="295" class="img_ev3q"></p><p>Nacos开源后快速成为国内首选，被互联网、视频、直播、金融领域公司广泛使用，支撑这国计民生的核心业务系统。
<img loading="lazy" alt="image.png" src="/en/assets/images/whouse-1ef86c86fcfcd53ed84d325a86b803a1.png" width="680" height="270" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="为什么选择nacos">为什么选择Nacos<a href="#为什么选择nacos" class="hash-link" aria-label="Direct link to 为什么选择Nacos" title="Direct link to 为什么选择Nacos">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="社区开放活跃">社区开放活跃<a href="#社区开放活跃" class="hash-link" aria-label="Direct link to 社区开放活跃" title="Direct link to 社区开放活跃">​</a></h3><p>Nacos在github上有17.6k stars 和 6.9k fork；社区共有28位核心Committer，其中一半来自于阿里巴巴，一半来自于社区各行各业。
​</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="产品功能强大">产品功能强大<a href="#产品功能强大" class="hash-link" aria-label="Direct link to 产品功能强大" title="Direct link to 产品功能强大">​</a></h3><p>Nacos 提供服务发现和服务健康监测、提供动态配置服务、提供动态 DNS 服务、提供服务及其元数据管理等核心能力，具备简单易用、特性丰富、超高性能、超大容量、高可用等优势。
​</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="生态联系紧密">生态联系紧密<a href="#生态联系紧密" class="hash-link" aria-label="Direct link to 生态联系紧密" title="Direct link to 生态联系紧密">​</a></h3><p>Nacos支持主流的微服务框架和应用框架，支持云原生生态。选择Nacos能够更容易嵌入和学习整个微服务体系及云原生体系。
​</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="参与nacos社区">参与Nacos社区<a href="#参与nacos社区" class="hash-link" aria-label="Direct link to 参与Nacos社区" title="Direct link to 参与Nacos社区">​</a></h2><p>Nacos主要通过官方网站和Github来进行社区参与，参与内容不仅限于代码提交，还包括文档、翻译、测试、文章分享、社区治理等等。</p><ul><li>Nacos官方网站：<a href="https://nacos.io/zh-cn/index.html" target="_blank" rel="noopener noreferrer">https://nacos.io</a></li><li>Nacos项目地址：<a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos</a></li><li>Nacos生态地址：<a href="https://github.com/nacos-group" target="_blank" rel="noopener noreferrer">https://github.com/nacos-group</a></li></ul><p>Nacos采用Apache 2.0 Lisence作为开源许可证，同时也赞同其<code>社区高于代码</code>的理念，并按照自己的方式践行。通过与生态伙伴积极共建能力、广泛接受来自各类用户的诉求和贡献、参与两届编程之夏活动，为Nacos社区带来和超过200位贡献者和十分合理的Committer构成。我们欢迎更多希望参与开源，从开源中提升技术、分享思考的同学加入到Nacos社区中。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="暑期2021">暑期2021<a href="#暑期2021" class="hash-link" aria-label="Direct link to 暑期2021" title="Direct link to 暑期2021">​</a></h2><p>Nacos--暑期2021项目已上线，项目申请报名已于5.24日开启，感兴趣的同学可以前往官网查看项目详情，先行了解和沟通并报名参与～。
​
Nacos社区为同学们准备了数个难度不一的题目，可以帮同学们快速了解微服务生态中配置中心和服务管理的相关内容：</p><ul><li>为Nacos Python SDK适配新版本gRPC接口（难度：简单）</li><li>添加配置加解密的插件SPI，并新增一类简单的加解密实现（难度：中等）</li><li>添加鉴权的插件SPI，并将当前的默认鉴权实现转化为插件化实现（难度：中等）</li><li>添加新的可观测性系统（难度：中等）</li><li>构建内嵌的反脆弱体系插件（难度：困难）</li></ul><p>更多详细内容可进入，Nacos官网、Nacos github或ISCAS官网中了解：
​</p><p>Nacos官方网址：<a href="https://nacos.io/zh-cn/index.html" target="_blank" rel="noopener noreferrer">https://nacos.io</a></p><p>Nacos社区相关内容：<a href="https://github.com/alibaba/nacos/issues/5693" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos/issues/5693</a></p><p>ISCAS相关内容：<a href="https://summer.iscas.ac.cn/#/org/orgdetail/nacos?lang=en" target="_blank" rel="noopener noreferrer">https://summer.iscas.ac.cn/#/org/orgdetail/nacos?lang=en</a></p><p>ISCAS学生指南：<a href="https://summer.iscas.ac.cn/help/" target="_blank" rel="noopener noreferrer">https://summer.iscas.ac.cn/help/</a></p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="欢迎在校同学们参与Nacos开源之夏，社区导师手把手让**你的代码被社会广泛复用，来赚取最高12000奖金，可**推荐入职/实习你心意公司，**又拿钱又成长又有价值**，你还等什么呢？报名马上截止，快来参与Nacos开源之夏。"><meta itemprop="keywords" content="Nacos,开源之夏，summerCode"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/iscas2022">Nacos开源之夏，贡献社区赢取12000奖金</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T11:47:41.000Z" itemprop="datePublished">October 10, 2023</time> · <!-- -->7 min read</div></header><div class="markdown" itemprop="articleBody"><p>欢迎在校同学们参与Nacos开源之夏，社区导师手把手让<strong>你的代码被社会广泛复用，来赚取最高12000奖金，可</strong>推荐入职/实习你心意公司，<strong>又拿钱又成长又有价值</strong>，你还等什么呢？报名马上截止，快来参与Nacos开源之夏。</p><h1>开源之夏是什么？</h1><p>开源之夏是由“开源软件供应链点亮计划”发起并长期支持的一项暑期开源活动，旨在鼓励<strong>在校学生</strong>积极参与开源软件的开发维护，促进优秀开源软件社区的蓬勃发展，培养和发掘更多优秀的开发者。
活动联合国内外各大开源社区，针对重要开源软件的开发与维护提供项目任务，并面向全球高校学生开放报名。
学生可在本活动中自主选择感兴趣的项目任务进行申请，并在中选后获得该开源项目资深维护者（社区导师）亲自指导的机会，完成项目并贡献给社区后，参与学生还将获得开源之夏<strong>活动奖金</strong>和结项证书。</p><h1>Nacos&amp;开源之夏2022</h1><p>Nacos被评为2021Github年度<strong>全国社区活跃度第六</strong>，Nacos开源产品定位是更易于构建云原生应用的动态服务发现、配置管理和服务管理平台，用云原生方式解决分布式领域核心问题。
自2018年孵化并开源以来，共收获<strong>21.8K的star</strong>数，<strong>9.5K的Fork</strong>数，在开源中国发布的 2021 年度 OSC 中国开源项目评选中，Nacos 被评为<strong>云原生领域人气指数 Top5 </strong>的项目，发布电子书《Nacos 架构与原理》阅读量近<strong>10W+</strong>，现已被大量微服务架构的软件公司选型作为其服务注册与发现中心。目前在国内服务注册中心及配置管理领域中<strong>市场占有率排名第一</strong>。
此次Nacos社区开放的题目中包含了Nacos第三代架构的部分核心功能模块，将直接参与社区的核心功能，欢迎进入Nacos开源之夏参与Nacos3.0的建设，为未来五年开源微服务发展奠定基础。</p><h1>参与Nacos开源之夏条件</h1><ul><li>本活动面向年满 18 周岁在校学生。</li><li>暑期即将毕业的学生，只要在申请时学生证处在有效期内，就可以提交申请。</li><li>海外学生可提供录取通知书、学生卡、在读证明等文件用于证明学生身份。</li></ul><h1>参与Nacos开源之夏，你能获得什么？</h1><ol><li><strong>【你的代码被社会广泛复用】</strong>你的代码可能会运行在上万家企业核心业务逻辑中，帮助企业解决问题。</li><li><strong>【赢得最高12000奖金】</strong>奖金总额根据项目难度分为进阶 12000 元、基础 8000 元（注：奖金数额为税前人民币金额）</li><li><strong>【社区核心人员辅导快速成长】</strong>只要你报名被选中，每个题目的导师会精心手把手教你融入社区，帮助你完成题目的设计以及最终的落地。</li><li><strong>【推荐入职/实习】</strong>在本次编程之夏项目中表现优秀同学，可推荐入职/实习 你心意的公司工作。</li><li><strong>【额外获得社区礼包】</strong>所有参与本次编程之夏项目的同学，均可获得Nacos社区大礼包。</li></ol><p><strong>百分百有奖品拿哦</strong>，现在唯一的问题是时间不多了，赶紧上车报名，截止报名时间是6月4日，6个核心题目，快点来报名参与Nacos编程之夏吧。</p><h1>报名方式</h1><p>点开Nacos开源之夏的<a href="https://summer-ospp.ac.cn/#/org/orgdetail/ab188e59-fab8-468f-bc89-bdc2bd8b5e64/" target="_blank" rel="noopener noreferrer">链接</a> 选择你喜欢的题目，Nacos社区围绕Nacos第三代架构精心计划了题目包含 “服务网格生态”、“多数据源建设”、“CoreDNS支持”、“K8S元数据同步”、“Nacos2.X建设”等技术方向展开。进行报名。
具体流程请参考<a href="https://summer-ospp.ac.cn/#/org/orgdetail/ab188e59-fab8-468f-bc89-bdc2bd8b5e64/" target="_blank" rel="noopener noreferrer">学生指南</a>访问可能会比较慢，请多等一下）
请注意找导师沟通截止流程时间，优先更导师沟通，能帮助你更好的了解题目。
想要报名的同学，请用钉钉扫码加入Nacos开源之夏2022钉钉群，方便大家交流题目内容。
<img loading="lazy" src="https://intranetproxy.alipay.com/skylark/lark/0/2022/png/11189/1652672158622-1a7de1a7-71da-4e80-aae9-13c6e5da821a.png#clientId=u35054081-9c85-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=617&amp;id=u3760c18e&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1632&amp;originWidth=1180&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=567452&amp;status=done&amp;style=none&amp;taskId=uef4eb68f-7e3e-4666-9a58-75d730e5cee&amp;title=&amp;width=446" alt="image.png" class="img_ev3q"></p><h1>参考资料</h1><p>Nacos Github：<a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos</a>
Nacos 官网：<a href="http://nacos.io" target="_blank" rel="noopener noreferrer">http://nacos.io</a>
为了让同学们更好地了解Nacos，我们提供了<a href="https://www.yuque.com/nacos/ebook" target="_blank" rel="noopener noreferrer">电子书</a>供大家阅读学习
对于微服务分布式事务有兴趣的同学，可以尝试填报<a href="https://mp.weixin.qq.com/s?__biz=Mzg2MTI2NDk2OQ==&amp;tempkey=MTE2NV9GNy9EWjczbFo5MkFoUCtXNWxnSEVlOXVicGREUHdDQXRVSW5NcTIwSWlhdE5BN2ltQUdBZWJNY050dzBaYXNKY0tBY1NEQ0VVbXpDNE9FMmg0eDBjUlZ0YWtlQ2lyZ2xrZEFfa0drQVFnaXRNUnYwSmZtMHZTTG0wRWdieTJwd3E2dlpTNE5EQzd0V0xiMlhEcjZSMl91WXB5by1Eb3ViX1VSektnfn4%3D&amp;chksm=4e188949796f005f87426542ac16c92bcdbb1248e8e9037afce0578920abd2dbf50d70553d5f&amp;mpshare=1&amp;srcid=0516E1M5ZS8oOWMl6bsdw8y0&amp;sharer_sharetime=1652684375116&amp;sharer_shareid=8056836193d95a1bb0631fa63ab5cc6a&amp;from=singlemessage&amp;scene=1&amp;subscene=10000&amp;clicktime=1652684382&amp;enterid=1652684382&amp;sessionid=0&amp;ascene=1&amp;realreporttime=1652684382988&amp;forceh5=1&amp;devicetype=android-30&amp;version=280016f8&amp;nettype=WIFI&amp;abtest_cookie=AAACAA%3D%3D&amp;lang=zh_CN&amp;exportkey=Af09sJIUNjyWxPx5MSjG0ws%3D&amp;pass_ticket=Ya0UtGtqSRfT4xcALdBO4s67oKTP%2FA3goUGjkSf4jSEBSJD%2FW0YVQqHwZQ5v0D%2FY&amp;wx_header=3" target="_blank" rel="noopener noreferrer">Seata开源之夏</a> 参与开源之夏
 </p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Placeholder. DO NOT DELETE."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/iscas2023">iscas2023</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T11:47:41.000Z" itemprop="datePublished">October 10, 2023</time> · <!-- -->One min read</div></header><div class="markdown" itemprop="articleBody"><p>Placeholder. DO NOT DELETE.</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Nacos 是阿里巴巴开源的配置中心和服务发现产品，开源距今已经超过一年的时间。本次1.1.0的发布，带来了许多重量级的特性更新，包括灰度配置等社区呼声很高的特性，下面会介绍1.1.0版本发布的新特性和每个特性的使用方式。"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/nacos 1.1.0">Nacos 1.1.0发布，支持灰度配置和地址服务器模式</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T11:47:41.000Z" itemprop="datePublished">October 10, 2023</time> · <!-- -->15 min read</div></header><div class="markdown" itemprop="articleBody"><p>Nacos 是阿里巴巴开源的配置中心和服务发现产品，开源距今已经超过一年的时间。本次1.1.0的发布，带来了许多重量级的特性更新，包括灰度配置等社区呼声很高的特性，下面会介绍1.1.0版本发布的新特性和每个特性的使用方式。</p><a name="CQSXH"></a>## 升级指南<a name="6l7mA"></a>#### Server端 0.8.0及以上版本：<ol><li>解压安装包后替换{nacos.home}/target/nacos-server.jar</li><li>删除{nacos.home}/plugins/cmdb/及{nacos.home}/plugins/health/下的所有文件</li><li>逐台重启Nacos Server即可</li></ol><p>0.8.0以下版本，先升级到1.0.0版本。</p><a name="yfczA"></a>#### Client端 请使用最新的1.1.1版本，修复了1.1.0版本的一个客户端版本显示问题。<a name="CfMxA"></a>## 新增特性<ul><li>灰度配置</li><li>配置导入导出及配置同步 </li><li>地址服务器模块</li><li>服务订阅者列表</li><li>自定义实例心跳周期</li><li>Config监听器优化</li><li>Nacos Go SDK发布</li></ul><a name="LYY0I"></a>### 灰度配置 @yanlinly @loadchange<p>灰度配置指的是指定部分客户端IP进行新配置的下发，其余客户端配置保持不变，用以验证新配置对客户端的影响，保证配置的平稳发布。灰度配置是生产环境中一个比较重要的功能，对于保证生产环境的稳定性非常重要。在1.1.0中，Nacos支持了以IP为粒度的灰度配置，具体使用步骤如下：</p><ol><li>在配置列表页面，点击某个配置的“编辑配置”按钮：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562579955002-bc2de409-26a4-43b7-8cdb-4bc83653ce8a.png#align=left&amp;display=inline&amp;height=262&amp;name=image.png&amp;originHeight=524&amp;originWidth=2506&amp;size=183572&amp;status=done&amp;width=1253" alt="image.png" class="img_ev3q"></p><ol start="2"><li>勾选“Beta发布”，在文本框里填入要下发配置配置的IP，多个IP用逗号分隔：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562580241038-085504e7-b63a-42ec-9304-08256ae3beba.png#align=left&amp;display=inline&amp;height=429&amp;name=image.png&amp;originHeight=858&amp;originWidth=1766&amp;size=148534&amp;status=done&amp;width=883" alt="image.png" class="img_ev3q"></p><ol start="3"><li>修改配置内容，点击“发布Beta”按钮，即可完成灰度配置的发布：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562580334216-78ac746b-e0de-4c33-b67d-bde89ef13f55.png#align=left&amp;display=inline&amp;height=527&amp;name=image.png&amp;originHeight=1054&amp;originWidth=2506&amp;size=179061&amp;status=done&amp;width=1253" alt="image.png" class="img_ev3q"></p><ol start="4"><li>点击“发布Beta”后，“发布Beta”按钮变灰，此时可以选择“停止Beta”或者“发布”。“停止Beta”表示取消停止灰度发布，当前灰度发布配置的IP列表和配置内容都会删除，页面回到正常发布的样式。“发布”表示将灰度配置在所有客户端生效，之前的配置也会被覆盖，同时页面回到正常发布的样式：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562595148249-e64b0585-525d-450d-a87c-6e3fd194351c.png#align=left&amp;display=inline&amp;height=489&amp;name=image.png&amp;originHeight=978&amp;originWidth=2512&amp;size=184032&amp;status=done&amp;width=1256" alt="image.png" class="img_ev3q"></p><a name="1t0AL"></a>### 配置导入导出及配置同步 @KeRan213539<p>配置管理的另一个常见需求是能够将一个集群的配置同步到另外一个集群，或者从一个命名空间同步到另外一个命名空间。来自社区的贡献者KeRan213539贡献这个非常实用的功能，具体使用步骤如下：</p><ol><li>导出查询结果。可以根据查询条件，将当期查询出的所有结果打包为一个文件：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562596769546-89546d16-a764-488c-8f87-b1d038a207d2.png#align=left&amp;display=inline&amp;height=415&amp;name=image.png&amp;originHeight=830&amp;originWidth=2526&amp;size=368179&amp;status=done&amp;width=1263" alt="image.png" class="img_ev3q"></p><ol start="2"><li>导出选中的配置：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562597197759-8cefeff9-13f6-4ef1-8c84-570efcd268e0.png#align=left&amp;display=inline&amp;height=367&amp;name=image.png&amp;originHeight=734&amp;originWidth=2506&amp;size=412720&amp;status=done&amp;width=1253" alt="image.png" class="img_ev3q"></p><ol start="3"><li>导入配置，可以选择相同配置的处理策略。</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562597316659-9b4e673b-e74a-47ca-b4f6-a95ed63aebfb.png#align=left&amp;display=inline&amp;height=443&amp;name=image.png&amp;originHeight=886&amp;originWidth=2500&amp;size=472512&amp;status=done&amp;width=1250" alt="image.png" class="img_ev3q"></p><p>当发现有相同的配置时，会有相应的提示：<br><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562597345803-2cb1c6b2-aed5-41af-9e18-c43fd2fc3822.png#align=left&amp;display=inline&amp;height=478&amp;name=image.png&amp;originHeight=956&amp;originWidth=2370&amp;size=427447&amp;status=done&amp;width=1185" alt="image.png" class="img_ev3q"></p><p>同时如果导入的配置文件格式不符合要求，也会有相应的提示：<br><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562597543119-019c1e1d-0712-4d1e-9f53-bc8e01156290.png#align=left&amp;display=inline&amp;height=398&amp;name=image.png&amp;originHeight=796&amp;originWidth=2508&amp;size=411258&amp;status=done&amp;width=1254" alt="image.png" class="img_ev3q"></p><ol start="4"><li>配置同步，选取想要同步的配置，点击“克隆”，然后再选择要同步的目标命名空间，就可以将配置同步到对应的命名空间：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562597665286-c5427451-62e6-4a47-b819-644d9709d089.png#align=left&amp;display=inline&amp;height=470&amp;name=image.png&amp;originHeight=940&amp;originWidth=2516&amp;size=499705&amp;status=done&amp;width=1258" alt="image.png" class="img_ev3q"></p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562597707334-4766ffef-cf8e-4791-a634-0857ac3eb40a.png#align=left&amp;display=inline&amp;height=466&amp;name=image.png&amp;originHeight=932&amp;originWidth=2536&amp;size=427102&amp;status=done&amp;width=1268" alt="image.png" class="img_ev3q"></p><ol start="5"><li>导入导出文件格式说明。均为zip压缩包，压缩包内有多个目录，目录名为配置的group，目录下有具体的文件，文件名为配置的dataId，每个文件的内容为配置具体的内容：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562654528090-ab113140-c7d9-4eda-8a67-051a9f13f591.png#align=left&amp;display=inline&amp;height=75&amp;name=image.png&amp;originHeight=81&amp;originWidth=635&amp;size=34863&amp;status=done&amp;width=591" alt="image.png" class="img_ev3q"></p><a name="a9Rf1"></a>### 地址服务器模块 @pbting<p>1.1.0的安装包列表里多了一个nacos-address-server-1.1.0。这个安装包的作用是作为地址服务器模块，单独部署。关于地址服务器的介绍可以参考Nacos官网<a href="https://nacos.io/en-us/blog/address-server.html" target="_blank" rel="noopener noreferrer">地址服务器文章</a>，这里只做一个简单的说明。</p><p>一般中间件产品，客户端寻址服务端的方式都是在客户端配置服务端的地址列表，这样有一个缺点是当服务端的地址发生变动时，客户端无法实时的感知到，也无法动态调整访问的服务端集群。而在阿里巴巴的一种比较常见的客户端寻址服务端的方式是地址服务器。简单的说就是部署单独的地址服务器，地址服务器提供接口，获取相关中间件产品服务端集群的地址。由于地址服务器功能比较单一，因此稳定性比较容易保证。客户端只需要配置地址服务器的域名，通过地址服务器获取想要访问的中间件的集群地址，这样既保证能够感知中间件集群的动态变化，也能够为客户端配置更灵活的集群访问策略。</p><p>下面介绍地址服务器模块的使用。</p><ol><li>部署地址服务器</li><li>将安装包列表里的nacos-address-server.tar.gz或者nacos-address-server.zip解压。</li><li>单机模式启动：执行 sh bin/startup.sh -m standalone -s nacos-address 以 standalone 的方式启动 address server。</li><li>集群模式启动：在 conf 目录下 将 cluster.conf.example 重名名为 cluster.conf，然后加入其它 server 的节点。加完后，执行 sh bin/startup.sh -s nacos-address 即可。</li><li>配置地址服务器域名：将部署好的地址服务器集群IP挂载到一个域名下，我们假设为address.nacos.com</li><li>在地址服务器上配置Nacos集群的地址列表：</li></ol><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Add IP to nacos cluster:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -X POST &#x27;$ADDRESS_SERVER:8080/nacos/v1/as/nodes?ips=1.1.1.1:8848,2.2.2.2:8848,3.3.3.3:8848&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Remove IP from nacos cluster:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -X DELETE &#x27;$ADDRESS_SERVER:8080/nacos/v1/as/nodes?ips=1.1.1.1:8848,2.2.2.2:8848,3.3.3.3:8848&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>客户端配置endpoint为该地址服务器集群域名：在构造Nacos客户端时，除了可以通过指定serverAddr来访问Nacos集群外，还可以配置endpoint属性，将这个属性的值设为address.nacos.com，这样就可以达到和配置serverAddr相同的效果。</li><li>通过源码构建地址服务器安装包，在Nacos工程根目录下执行：</li></ol><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mvn -Prelease-address clean install -Dmaven.test.skip=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>安装包会生成在distribution/target目录下。</p><a name="6COIS"></a>### 服务订阅者列表 @nicholas2015<p>服务订阅者列表是1.1.0增加的另外一个功能，就是可以在控制台上查看一个服务的消费者，执行步骤如下：</p><ol><li>在服务列表页面，找到想要查询订阅者的服务：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562640498681-5ab822e5-e293-4c17-9abe-63d541cb8058.png#align=left&amp;display=inline&amp;height=266&amp;name=image.png&amp;originHeight=532&amp;originWidth=2504&amp;size=149955&amp;status=done&amp;width=1252" alt="image.png" class="img_ev3q"></p><ol start="2"><li>进入订阅者列表页面，在“服务名称”输入框输入想要查询的服务名，在“分组名称”输入框输入服务的分组名（默认为DEFAULAT_GROUP），点击“查询”后，得到订阅者的信息，包括IP和端口、客户端版本和应用名。</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562640552803-6fa89abd-a5c0-4ecd-90ce-cd9e6eacab1c.png#align=left&amp;display=inline&amp;height=280&amp;name=image.png&amp;originHeight=560&amp;originWidth=2492&amp;size=120344&amp;status=done&amp;width=1246" alt="image.png" class="img_ev3q"></p><a name="Gw6wo"></a>### 服务自定义心跳周期 @lanCao<p>之前的版本中，客户端注册服务时，不能自定义上报心跳的周期以及客户端下线时自动删除实例的间隔。在1.1.0中，我们支持了这个特性，应用可以在注册时，通过设置实例的metadata，来指定心跳周期、健康检查过期时间及删除实例时间。具体举例如下：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">String serviceName = randomDomainName();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Instance instance = new Instance();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance.setIp(&quot;1.1.1.1&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance.setPort(9999);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Map&lt;String, String&gt; metadata = new HashMap&lt;String, String&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 设置心跳的周期，单位为秒，这里将心跳间隔设置为3秒：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.put(PreservedMetadataKeys.HEART_BEAT_INTERVAL, &quot;3000&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 设置心跳超时时间，单位为秒，这里将心跳超时时间设为6秒，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 即服务端6秒收不到客户端心跳，会将该客户端注册的实例设为不健康：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.put(PreservedMetadataKeys.HEART_BEAT_TIMEOUT, &quot;6000&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 设置实例删除的超时时间，单位为秒，这里将实例删除超时时间设为9秒，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 即服务端9秒收不到客户端心跳，会将该客户端注册的实例删除：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata.put(PreservedMetadataKeys.IP_DELETE_TIMEOUT, &quot;9000&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance.setMetadata(metadata);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">naming.registerInstance(serviceName, instance);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="QFEGE"></a>### Config 监听器的优化 @chuntaojun<br>当存在程序启动之初，如果用户通过`ConfigService.getConfig`获取配置的同时，又注册了监听器，那么会存在监听器再次通知用户刚刚获取的配置信息。因此在`version 1.1.0`版本中，增加了新的接口以及一个系统参数（使用户无需修改现有代码） ```java String getConfigAndSignListener(String dataId, String group, long timeoutMs, Listener listener) throws NacosException; ```<p>该方法在获取配置后，随即注册一个监听器，避免监听器通知用户刚刚才拉取的配置信息<br><code>nacos.enableRemoteSyncConfig=true | false</code><br>设置该系统参数，将在监听器注册时主动去向远端拉取当前最新的配置信息，但是存在一定的网络开销，因此建议用户采取接口的方式</p><a name="unUgM"></a>### Nacos Go SDK @lzp0412 @peggypig @atlanssia<p>Nacos上周还发布了Go语言的SDK，目前发布了0.1.0-beta版本，仓库地址是：<a href="https://github.com/nacos-group/nacos-sdk-go" target="_blank" rel="noopener noreferrer">https://github.com/nacos-group/nacos-sdk-go</a>。Nacos Go SDK是单独的仓库，由Nacos Committer参与维护，在代码上不属于Nacos 1.1.0。在此也非常欢迎社区的Go语言高手，参与Nacos Go SDK的演进。</p><a name="0LhDq"></a>## 如何共建<p>为了实现这一目标，你需要积极参与Nacos社区。如果您在文档中发现拼写错误，在代码中发现错误，或想要新功能或想要提供建议，您可以<a href="https://github.com/alibaba/Nacos/issues/new" target="_blank" rel="noopener noreferrer">在GitHub上创建一个issues</a>。</p><p>如果您想开始着手，可以选择github仓库中有以下标签的issues。</p><ul><li><a href="https://github.com/alibaba/nacos/labels/good%20first%20issue" target="_blank" rel="noopener noreferrer">good first issue</a>：对于新手来说是非常好的入门issues。</li><li><a href="https://github.com/alibaba/nacos/labels/contribution%20%E6%AC%A2%E8%BF%8E" target="_blank" rel="noopener noreferrer">contribution welcome</a>：非常需要解决的问题和非常重要的模块，但目前缺少贡献者，欢迎贡献者来贡献。</li></ul><a name="7ddae8a4"></a>## 蓬勃发展的 Nacos 社区<blockquote><p>DISS is cheap, show me your hand
比吐槽更重要的是搭把手，参与社区一起发展Nacos</p></blockquote><ul><li>作为用户关注和加入 Nacos 社区</li></ul><p>Nacos 社区正在蓬勃发展，截止到发文为止，Nacos 已经有 9 个微信群，其中 7 个已满员，1个QQ群，1个钉钉群，关注 Nacos 的社区人数已经近5000人，在 Nacos 群里跟 “道（基）友” 切磋技术，交流经验，招聘交友，抢抢红包...不亦乐乎。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1560397428130-a878b99a-665f-413d-9e69-ec36b13f731f.png#align=left&amp;display=inline&amp;height=431&amp;name=image.png&amp;originHeight=420&amp;originWidth=698&amp;size=144746&amp;status=done&amp;width=716" alt="image.png" class="img_ev3q"></p><ul><li>作为代码贡献者加入 Nacos 社区</li></ul><p>为了能够与代码贡献者更方便的交流，我们组建了钉钉群“Nacos社区核心贡献小组（<strong>23335652</strong>）”，这个群里都是都是对Nacos贡献非常感兴趣的小伙伴，如果你也想成为Nacos贡献者，甚至成为Committer，欢迎加入这个群和群里的小伙伴一起切磋！</p><p>在Nacos官网 <a href="http://nacos.io/" target="_blank" rel="noopener noreferrer">nacos.io</a> 中，已经添加<a href="https://nacos.io/zh-cn/docs/nacos-dev.html" target="_blank" rel="noopener noreferrer">团队介绍页</a>，里面包括Nacos的开发者角色定义及职责划分，同时包含了Nacos的开发者们介绍和靓照哦，欢迎大家加入Nacos社区，贡献社区。用Apache的话说，<strong>“社区高于代码”!</strong></p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1542704700864-a9d54856-9bf6-4176-b449-c13fa02c5800.png#align=left&amp;display=inline&amp;height=387&amp;linkTarget=_blank&amp;originHeight=888&amp;originWidth=1716&amp;width=748#align=left&amp;display=inline&amp;height=386&amp;originHeight=888&amp;originWidth=1716&amp;status=done&amp;width=746" class="img_ev3q"></p><a name="2461e1c0"></a>## 新人时刻 - &quot;什么是Nacos？&quot;<blockquote><p>还不知道什么是Nacos? 没关系，在github上star一下跟程序猿兄弟打个招呼吧!!</p></blockquote><p><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a> 是阿里巴巴于2018年7月份新开源的项目，Nacos的主要愿景是期望通过提供易用的 <code>动态服务发现</code>、<code>服务配置管理</code>、<code>服务共享与管理</code> 的基础设施，帮助用户在云原生时代更好的构建、交付、管理自己的微服务平台。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1562644065145-5f315c7d-b48a-453d-9718-20fb9121dd14.png#align=left&amp;display=inline&amp;height=374&amp;name=image.png&amp;originHeight=748&amp;originWidth=1722&amp;size=456424&amp;status=done&amp;width=861" alt="image.png" class="img_ev3q"></p><p>github项目地址在 <a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">这里</a></p><a name="f26dbb6d"></a>## 更多与 Nacos 相关的开源项目信息<ul><li><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a></li><li><a href="https://github.com/dubbo/dubbo-registry-nacos" target="_blank" rel="noopener noreferrer">Dubbo Registry Nacos</a></li><li><a href="https://github.com/nacos-group/nacos-coredns-plugin" target="_blank" rel="noopener noreferrer">Nacos DNS-F</a></li><li><a href="https://github.com/nacos-group/nacos-docker" target="_blank" rel="noopener noreferrer">Nacos Docker</a></li><li><a href="https://github.com/nacos-group/nacos-spring-project" target="_blank" rel="noopener noreferrer">Nacos Spring Project</a></li><li><a href="https://github.com/nacos-group/nacos-spring-boot-project" target="_blank" rel="noopener noreferrer">Nacos Spring Boot</a></li><li><a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba</a></li><li><a href="http://dubbo.io/" target="_blank" rel="noopener noreferrer">Dubbo</a></li><li><a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">Sentinel</a></li><li><a href="https://projects.spring.io/spring-cloud/" target="_blank" rel="noopener noreferrer">Spring Cloud</a></li><li><a href="https://github.com/Nepxion/Discovery" target="_blank" rel="noopener noreferrer">Nepxion Discovery</a></li><li><a href="https://github.com/SpringCloud/spring-cloud-gateway-nacos" target="_blank" rel="noopener noreferrer">Spring Cloud Gateway Nacos</a></li></ul></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Nacos是阿里巴巴开源的服务发现与配置管理项目，本次发布的1.1.4版本，主要带来的是与Istio的对接功能，使用的是Istio最新的MCP协议。本文将介绍包括这个功能在内的新版本发布的功能。"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/nacos 1.1.4">Nacos 1.1.4发布，业界率先支持Istio MCP协议</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T11:47:41.000Z" itemprop="datePublished">October 10, 2023</time> · <!-- -->8 min read</div></header><div class="markdown" itemprop="articleBody"><p>Nacos是阿里巴巴开源的服务发现与配置管理项目，本次发布的1.1.4版本，主要带来的是与Istio的对接功能，使用的是Istio最新的MCP协议。本文将介绍包括这个功能在内的新版本发布的功能。</p><a name="GdnN0"></a>## 升级指南<a name="SXacG"></a>#### 服务端 0.8.0及以上版本：<ol><li>解压安装包后替换{nacos.home}/target/nacos-server.jar</li><li>逐台重启Nacos Server即可</li></ol><p>0.8.0以下版本，先升级到1.0.0版本。</p><a name="CNPhB"></a>#### 客户端 替换pom依赖即可。<a name="07ZzZ"></a>## 支持Istio MCP协议 这是本次版本最大的更新，主要是实现了Nacos服务数据往Istio下发的功能，也是目前业界所有注册中心里面第一个由官方提供的MCP协议对接版本。Pilot最新的设计中，是使用MCP协议来与所有后端的数据源进行交互的。这样做的好处是可以解耦所有扩展组件的代码，Pilot保持轻量的逻辑，在代码质量、组件稳定性及扩展性方面都大幅提升。我们可以看一下Pilot官方提供的Pilot设计图（地址：[https://docs.google.com/document/d/1S5ygkxR1alNI8cWGG4O4iV8zp8dA6Oc23zQCvFxr83U/edit#heading=h.k34grc1as8vr](https://docs.google.com/document/d/1S5ygkxR1alNI8cWGG4O4iV8zp8dA6Oc23zQCvFxr83U/edit#heading=h.k34grc1as8vr)）：<br>![image.png](https://cdn.nlark.com/yuque/0/2019/png/333810/1572940023007-e19f92da-a5a1-41f0-b37e-db8a678ad57f.png#align=left&amp;display=inline&amp;height=455&amp;name=image.png&amp;originHeight=659&amp;originWidth=1080&amp;search=&amp;size=360963&amp;status=done&amp;width=746)<br>图1 Pilot的最新设计概念图<p>虽然在设计图中，Pilot后端的MCP Server已经有了Consul、Eureka等，但是这些项目目前都没有官方支持的MCP Server。Nacos是目前首个官方支持Istio MCP协议的项目。</p><p>关于MCP协议的设计，可以参考Istio的<a href="https://github.com/istio/api/tree/master/mcp" target="_blank" rel="noopener noreferrer">文档</a>。Nacos实现的MCP Server，目前使用的是单个服务编号，全量服务推送的模式，因为目前Pilot还不支持增量的服务数据推送（Nacos 1.1.4发布之后，Pilot已经支持了endpoint级别的增量推送，Nacos也会在下个版本支持）。实现的逻辑就是启动一个gRPC Server来进行MCP数据的传输，代码可以参考：<a href="https://github.com/alibaba/nacos/tree/develop/istio" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos/tree/develop/istio</a>。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1572940023014-089f4517-840c-4f6e-ae29-2c308926d069.png#align=left&amp;display=inline&amp;height=365&amp;name=image.png&amp;originHeight=730&amp;originWidth=1372&amp;search=&amp;size=300144&amp;status=done&amp;width=686" alt="image.png" class="img_ev3q"><br>图2 Nacos MCP Server架构</p><p>使用Nacos MCP Server的方式如下：</p><ol><li>下载最新的Nacos 1.1.4安装包，解压；</li><li>配置application.properties，然后重启Nacos；</li></ol><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nacos.istio.mcp.server.enabled=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意：如果Nacos是集群部署，则只需要配置一台Server启动MCP Server即可，因为每台Nacos Server的数        据都是全量的。同时Nacos MCP Server使用的端口是18848，请注意端口是否冲突；</p><ol start="3"><li>配置Pilot使用Nacos MCP Server：</li></ol><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">configSources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- address: x.x.x.x:18848</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>重启Pilot；</li></ol><a name="srliR"></a>## 自定义实例ID 在之前的版本中，Instance类的instanceId字段，是用来作为唯一标识这个instance的属性，它的值默认是不能由客户端来指定的。在1.1.4版本中，我们支持了允许客户端自定义ID以及一个新增加的instanceId生成算法：一个服务内唯一的整数，这个整数可以用来作为实例在服务内的唯一索引。这个功能由vettal-wu贡献，非常感谢。<p>这个整形instanceId的使用方式为在注册时配置instance的metadata，指定使用该id生成算法，样例代码如下：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Instance instance = new Instance();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance.setIp(&quot;1.1.1.1&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance.setPort(80);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 必须设置ephemeral=false，来保证服务端使用的是严格的一致性协议，否则可能会导致生成的instance id冲突：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance.setEhpemeral(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance.setMetadata(new HashMap&lt;String, String&gt;());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instance.getMetadata().put(PreservedMetadataKeys.INSTANCE_ID_GENERATOR, Constants.SNOWFLAKE_INSTANCE_ID_GENERATOR);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Nacos在这个版本也有一些关于代码质量上的优化更新，具体可以参考1.1.4版本issue列表：<a href="https://github.com/alibaba/nacos/issues?q=is%3Aissue+milestone%3A1.1.4" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos/issues?q=is%3Aissue+milestone%3A1.1.4</a>。</p><a name="B7djZ"></a>## 如何共建<p>为了实现这一目标，你需要积极参与Nacos社区。如果您在文档中发现拼写错误，在代码中发现错误，或想要新功能或想要提供建议，您可以<a href="https://github.com/alibaba/Nacos/issues/new" target="_blank" rel="noopener noreferrer">在GitHub上创建一个issues</a>。</p><p>如果您想开始着手，可以选择github仓库中有以下标签的issues。</p><ul><li><a href="https://github.com/alibaba/nacos/labels/good%20first%20issue" target="_blank" rel="noopener noreferrer">good first issue</a>：对于新手来说是非常好的入门issues。</li><li><a href="https://github.com/alibaba/nacos/labels/contribution%20%E6%AC%A2%E8%BF%8E" target="_blank" rel="noopener noreferrer">contribution welcome</a>：非常需要解决的问题和非常重要的模块，但目前缺少贡献者，欢迎贡献者来贡献。</li></ul><a name="7ddae8a4"></a>## 蓬勃发展的 Nacos 社区<blockquote><p>DISS is cheap, show me your hand
比吐槽更重要的是搭把手，参与社区一起发展Nacos</p></blockquote><ul><li>作为用户关注和加入 Nacos 社区</li></ul><p>Nacos 社区正在蓬勃发展，截止到发文为止，Nacos 短短几个月已经有 9 个微信群，其中 7 个已满员，1个QQ群，1个钉钉群，关注 Nacos 的社区人数已经近5000人，在 Nacos 群里跟 “道（基）友” 切磋技术，交流经验，招聘交友，抢抢红包...不亦乐乎。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1572940023025-5e1cf910-5e80-4353-8b47-d0565a65bbda.png#align=left&amp;display=inline&amp;height=998&amp;name=image.png&amp;originHeight=998&amp;originWidth=1786&amp;search=&amp;size=298649&amp;status=done&amp;width=1786" alt="image.png" class="img_ev3q"></p><ul><li>作为代码贡献者加入 Nacos 社区</li></ul><p>从Nacos用户发展而成贡献者顺理成章，而Nacos开发团队也确实在日趋壮大，从开始的只有4个代码contributor发展到目前的40多个，1.1.4版本中，参与Nacos仓库贡献的开发者有：stackisok,loadchange, ly641921791, EZLippi, rushsky518, universefeeler, nkorange, vettal-wu, beldon等。</p><p><img loading="lazy" src="https://cdn.nlark.com/lark/0/2018/png/15914/1542704700864-a9d54856-9bf6-4176-b449-c13fa02c5800.png#align=left&amp;display=inline&amp;height=387&amp;linkTarget=_blank&amp;originHeight=888&amp;originWidth=1716&amp;width=748#align=left&amp;display=inline&amp;height=386&amp;originHeight=888&amp;originWidth=1716&amp;search=&amp;status=done&amp;width=746" class="img_ev3q"></p><a name="2461e1c0"></a>## 新人时刻 - &quot;什么是Nacos？&quot;<blockquote><p>还不知道什么是Nacos? 没关系，在github上star一下跟程序猿兄弟打个招呼吧!!</p></blockquote><p><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a> 是阿里巴巴于2018年7月份新开源的项目，Nacos的主要愿景是期望通过提供易用的 <code>动态服务发现</code>、<code>服务配置管理</code>、<code>服务共享与管理</code> 的基础设施，帮助用户在云原生时代更好的构建、交付、管理自己的微服务平台。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1572940023011-845b558c-5af1-4e75-8f6e-4aee37cdbb44.png#align=left&amp;display=inline&amp;height=332&amp;name=image.png&amp;originHeight=664&amp;originWidth=1614&amp;search=&amp;size=282270&amp;status=done&amp;width=807" alt="image.png" class="img_ev3q"></p><p>github项目地址在 <a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">这里</a></p><a name="f26dbb6d"></a>## 更多与 Nacos 相关的开源项目信息<ul><li><a href="https://github.com/alibaba/nacos" target="_blank" rel="noopener noreferrer">Nacos</a></li><li><a href="https://github.com/dubbo/dubbo-registry-nacos" target="_blank" rel="noopener noreferrer">Dubbo Registry Nacos</a></li><li><a href="https://github.com/nacos-group/nacos-coredns-plugin" target="_blank" rel="noopener noreferrer">Nacos DNS-F</a></li><li><a href="https://github.com/nacos-group/nacos-docker" target="_blank" rel="noopener noreferrer">Nacos Docker</a></li><li><a href="https://github.com/nacos-group/nacos-spring-project" target="_blank" rel="noopener noreferrer">Nacos Spring Project</a></li><li><a href="https://github.com/nacos-group/nacos-spring-boot-project" target="_blank" rel="noopener noreferrer">Nacos Spring Boot</a></li><li><a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba</a></li><li><a href="http://dubbo.io/" target="_blank" rel="noopener noreferrer">Dubbo</a></li><li><a href="https://github.com/alibaba/Sentinel" target="_blank" rel="noopener noreferrer">Sentinel</a></li><li><a href="https://projects.spring.io/spring-cloud/" target="_blank" rel="noopener noreferrer">Spring Cloud</a></li><li><a href="https://github.com/Nepxion/Discovery" target="_blank" rel="noopener noreferrer">Nepxion Discovery</a></li><li><a href="https://github.com/SpringCloud/spring-cloud-gateway-nacos" target="_blank" rel="noopener noreferrer">Spring Cloud Gateway Nacos</a></li></ul><a name="aswNK"></a>## 下期预告 Nacos的下个版本是1.2.0版本，将会支持社区广泛关注的权限控制功能，敬请期待。</div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="方案背景"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/nacos 1.2.0 guide">Nacos 1.2.0 权限控制介绍和使用</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T11:47:41.000Z" itemprop="datePublished">October 10, 2023</time> · <!-- -->12 min read</div></header><div class="markdown" itemprop="articleBody"><a name="bc2d5709"></a># Nacos权限控制设计方案<a name="If4qS"></a>## 方案背景 Nacos自开源依赖，权限控制一直需求比较强烈，这也反应了用户需求将Nacos部署到生产环境的需求。最新发布的Nacos 1.2.0版本已经支持了服务发现和配置管理的权限控制，保障用户安全上生产。本文主要介绍Nacos权限控制的设计方案和使用指南。<a name="YBdcs"></a>### 什么是权限控制？ 在分布式服务调用时，需要对未知的或者不受信任的请求来源的请求进行识别和拒绝。权限控制一般分为两个阶段：身份识别（Authentication）和权限识别（Authorization）。身份认证主要确定访问者的身份，权限识别则判断这个访问者是否有对应资源的权限。<p>在Nacos的场景中，配置管理的权限控制指的是设置某个配置能否被某个用户读写，这个比较好理解，没有权限的用户旧无法读取或者写入对应的配置。服务发现的权限控制指的是用户是否有权限进行某个服务的注册或者订阅，这里需要注意的是服务发现的权限控制只能够控制用户是否可以从Nacos获取到服务的地址或者在Nacos上修改服务的地址。但是如果已经获取到了服务的地址，Nacos无法在服务真正调用时进行权限控制，这个时候的权限控制需要由服务框架来完成。</p><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1576216016307-2da56934-917f-46ec-b3eb-a221bc91a9e0.png#align=left&amp;display=inline&amp;height=240&amp;name=image.png&amp;originHeight=480&amp;originWidth=1904&amp;size=271408&amp;status=done&amp;style=none&amp;width=952#align=left&amp;display=inline&amp;height=480&amp;originHeight=480&amp;originWidth=1904&amp;status=done&amp;style=none&amp;width=1904" alt="image.png" class="img_ev3q"></p><a name="TvavD"></a>### 常见实现方式<a name="xDBnq"></a>#### 认证（Authentication）<ul><li>用户名+密码</li><li>Cookie（只适用于浏览器）</li><li>Session</li><li>Token（JWT，Oauth，LDAP，SAML，OpenID）</li><li>AK/SK<a name="vqrqi"></a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="鉴权authorization">鉴权（Authorization）<a href="#鉴权authorization" class="hash-link" aria-label="Direct link to 鉴权（Authorization）" title="Direct link to 鉴权（Authorization）">​</a></h4><ul><li>ACL： 规定<strong>资源</strong>可以被哪些<strong>主体</strong>进行哪些操作；</li><li>DAC： 规定<strong>资源</strong>可以被哪些<strong>主体</strong>进行哪些操作 同时，<strong>主体</strong>可以将<strong>资源</strong>的权限，授予其他<strong>主体</strong>；</li><li>MAC：a. 规定<strong>资源</strong>可以被哪些类别的<strong>主体</strong>进行哪些<strong>操作</strong> b. 规定<strong>主体</strong>可以对哪些等级的<strong>资源</strong>进行哪些<strong>操作</strong> 当一个<strong>操作</strong>，同时满足a与b时，允许<strong>操作</strong>；</li><li>RBAC： a. 规定<strong>角色</strong>可以对哪些<strong>资源</strong>进行哪些<strong>操作</strong> b. 规定<strong>主体</strong>拥有哪些<strong>角色</strong>当一个操作，同时满足a与b时，允许<strong>操作</strong>；</li><li>ABAC： 规定哪些<strong>属性</strong>的<strong>主体</strong>可以对哪些<strong>属性</strong>的<strong>资源</strong>在哪些<strong>属性</strong>的情况下进行哪些<strong>操作</strong>。</li></ul><a name="liyG7"></a>## 方案详情 Nacos的权限控制，目标是能够满足用户基本的鉴权需求，同时能够保持扩展性，可以支持去对接用户自带的用户管理系统或者鉴权系统，包括后面和K8S生态以及Service Mesh生态能够无缝的融合。基于这样的考虑，目前Nacos权限控制的设计是自带一个基本的实现，然后可以支持用户扩展。具体的设计如下。<a name="H0kp9"></a>### 模块设计 整体的模块设计是尽量将鉴权的逻辑抽象出来，不在服务发现模块或者配置管理模块添加相关的逻辑。通过配置文件可以选择当前使用的鉴权系统。Nacos自带的认证系统使用JWT Token，自带的鉴权系统使用的是RBAC。<p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1576219027093-45345003-c583-46ec-a161-01b5f4b3ff47.png#align=left&amp;display=inline&amp;height=450&amp;name=image.png&amp;originHeight=900&amp;originWidth=1744&amp;size=699757&amp;status=done&amp;style=none&amp;width=872#align=left&amp;display=inline&amp;height=900&amp;originHeight=900&amp;originWidth=1744&amp;status=done&amp;style=none&amp;width=1744" alt="image.png" class="img_ev3q"></p><a name="jeLdT"></a>### 认证算法 对于用户来说，不管是在控制台还是在客户端，都是上传用户名和密码来获取一个token，然后后续的每一次到Nacos的请求都会带上这个token来表明身份。这个token会有一个失效时间，对于控制台来说，只需要直接提示用户重新登录即可，对于客户端则需要有一个定期到Nacos刷新token的逻辑。<p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1576219050917-51013ce2-49f3-4a86-b5f9-bd07fc88f8e8.png#align=left&amp;display=inline&amp;height=368&amp;name=image.png&amp;originHeight=736&amp;originWidth=1718&amp;size=575605&amp;status=done&amp;style=none&amp;width=859#align=left&amp;display=inline&amp;height=736&amp;originHeight=736&amp;originWidth=1718&amp;status=done&amp;style=none&amp;width=1718" alt="image.png" class="img_ev3q"></p><a name="vSB1T"></a>### 鉴权算法 Nacos自带的鉴权系统使用的是RBAC模型，可以在网上查询相关的资料。<a name="RZZGa"></a>#### 数据模型 鉴权的数据模型也是基于标准的RBAC来设计的，分为用户、角色和权限三部分。用户就是由用户名和密码组成的用户信息，角色则是一个逻辑上的用户组，Nacos启动时会自带一个全局管理员的角色，只有这个全局管理员的角色可以进行添加用户、添加角色、添加授权等操作，保证安全性。而权限则是由资源+动作来组成。<p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2019/png/333810/1576736418792-936a9d1a-5095-47fc-9f87-230abed38384.png#align=left&amp;display=inline&amp;height=451&amp;name=image.png&amp;originHeight=902&amp;originWidth=1834&amp;size=438246&amp;status=done&amp;style=none&amp;width=917#align=left&amp;display=inline&amp;height=902&amp;originHeight=902&amp;originWidth=1834&amp;status=done&amp;style=none&amp;width=1834" alt="image.png" class="img_ev3q"></p><a name="0bd4753c"></a>### 接口设计 以下接口涉及到登录和鉴权的所有逻辑，这些接口除了登录接口，其他接口都只能由全局管理员来调用。<a name="7d94de1c"></a>#### 用户管理<ul><li>创建用户：POST<br>
/nacos/v1/auth/users?username=xx&amp;password=yy</li><li>删除用户：DELETE /nacos/v1/auth/users?username=xx&amp;password=yy</li><li>更新用户：PUT /nacos/v1/auth/users?username=xx&amp;oldPassword=yy&amp;newPassword=zz</li><li>登录：POST<br>
/nacos/v1/auth/users/login?username=xxx&amp;password=yyy</li></ul><a name="3f856ec2"></a>#### 角色管理<ul><li>创建角色/绑定用户到角色：POST /nacos/v1/auth/roles?role=xx&amp;username=yy</li><li>删除某个用户的角色：DELETE /nacos/v1/auth/roles?role=xx&amp;username=yy</li><li>获取用户的所有角色：GET /nacos/v1/auth/roles?username=xxx</li></ul><a name="23bbdd59"></a>#### 权限管理<ul><li>给角色添加权限：POST /nacos/v1/auth/permissions?role=xxx&amp;resource=yyy&amp;action=zzz</li><li>从角色删除权限：DELETE /nacos/v1/auth/permissions?role=xxx&amp;resource=yyy&amp;action=zzz</li><li>获取某个角色的权限：GET /nacos/v1/auth/permissions?role=xxx</li></ul><a name="4Hil5"></a># Nacos权限控制实战<a name="TWc9w"></a>## 安装Nacos 1.2.0<ol><li>部署包准备。可以直接下载安装包：<a href="https://github.com/alibaba/nacos/releases/tag/1.2.0" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/nacos/releases/tag/1.2.0</a>，也可以将Nacos master分支clone下来进行源码编译：</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mvn -Prelease-nacos -Dmaven.test.skip</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true clean </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -U</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>安装包解压，然后使用distribution/nacos-mysql.sql进行数据库初始化，主要是新增了users, roles, permissions三张表，standalone模式使用distribution/schema.sql进行初始化。</li><li>Server端打开权限控制开关。修改con/application.properties内容：</li></ol><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nacos.core.auth.enabled=</span><span class="token boolean" style="color:#36acaa">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个开关采用了热加载模式，无需重启Server即可生效。因此当权限控制功能使用有异常时，可以直接回滚到不鉴权的模式。</p><p><strong>注意：</strong> Nacos 1.2.0里登录和鉴权是绑定关系，而由于这个开关的默认值为false，因此默认启动时，是没有登录界面的，这点请读者注意。</p><a name="xBJZi"></a>## 使用权限控制<ol><li>使用管理员账号登录Nacos控制台（如果页面提示错误，可以清空浏览器缓存刷新页面）：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333810/1580890674563-4d235fd9-983c-4b03-b45c-b1e164152ac7.png#align=left&amp;display=inline&amp;height=470&amp;name=image.png&amp;originHeight=940&amp;originWidth=2870&amp;size=274455&amp;status=done&amp;style=none&amp;width=1435#align=left&amp;display=inline&amp;height=940&amp;originHeight=940&amp;originWidth=2870&amp;status=done&amp;style=none&amp;width=2870" alt="image.png" class="img_ev3q"></p><p>可以看到，左侧边栏增加了一个父菜单和三个子菜单，分别用于权限控制里的用户创建、角色创建以及权限管         理。这个菜单栏只会在管理员登录的时候显示，也就意味着只有管理员才能进行权限的管理和分配。</p><ol start="2"><li>管理用户。点击“用户列表”，进入用户管理页面，可以进行用户的创建、修改和删除：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333810/1580890674569-a729854e-a72d-4b3b-bc4c-53f9df831f3e.png#align=left&amp;display=inline&amp;height=573&amp;name=image.png&amp;originHeight=1146&amp;originWidth=2872&amp;size=349203&amp;status=done&amp;style=none&amp;width=1436#align=left&amp;display=inline&amp;height=1146&amp;originHeight=1146&amp;originWidth=2872&amp;status=done&amp;style=none&amp;width=2872" alt="image.png" class="img_ev3q"></p><ol start="3"><li>管理角色。因为Nacos的自带的权限是基于角色来进行分配的，因此需要给创建好的用户绑定一些角色：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333810/1580890674603-f69520a1-f53e-4eb7-9186-f2963e7b3d65.png#align=left&amp;display=inline&amp;height=545&amp;name=image.png&amp;originHeight=1090&amp;originWidth=2874&amp;size=346611&amp;status=done&amp;style=none&amp;width=1437#align=left&amp;display=inline&amp;height=1090&amp;originHeight=1090&amp;originWidth=2874&amp;status=done&amp;style=none&amp;width=2874" alt="image.png" class="img_ev3q"></p><ol start="4"><li>管理权限。角色创建好以后，就可以给这个角色赋予特定的权限了：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333810/1580890674580-e22945e1-be3a-46bd-b8f3-11b38eee0786.png#align=left&amp;display=inline&amp;height=581&amp;name=image.png&amp;originHeight=1162&amp;originWidth=2876&amp;size=368264&amp;status=done&amp;style=none&amp;width=1438#align=left&amp;display=inline&amp;height=1162&amp;originHeight=1162&amp;originWidth=2876&amp;status=done&amp;style=none&amp;width=2876" alt="image.png" class="img_ev3q"></p><p>在“添加资源”对话框里，可以选择绑定的角色，命名空间资源以及对应的动作类型，例如在上图中，我们给角色role1绑定命名空间test的读写权限。然后又因为刚刚我们是将user1绑定到了role1上，那么user1这个用户就可以对test这个命名空间的资源进行读写操作了。</p><ol start="5"><li>使用user1登录控制台。点击控制台右上角，退出admin账号，然后用刚才创建的user1进行登录：</li></ol><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333810/1580890674574-ca6eee1f-b749-4275-897d-ab9fba0ebf80.png#align=left&amp;display=inline&amp;height=449&amp;name=image.png&amp;originHeight=898&amp;originWidth=2874&amp;size=340563&amp;status=done&amp;style=none&amp;width=1437#align=left&amp;display=inline&amp;height=898&amp;originHeight=898&amp;originWidth=2874&amp;status=done&amp;style=none&amp;width=2874" alt="image.png" class="img_ev3q"></p><p>如上图所示，首先是左侧的权限管理菜单消失了，因为当前用户不是管理员。其次是会弹出一个鉴权失败的提示框。不用担心，这个提示框意思是user1没有public命名空间的读权限，所以会弹出，但是不影响我们将命名空间切换到test：<br><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333810/1580890674621-bc16b2ad-4a9e-4ebc-83e8-fa41f4a0cba4.png#align=left&amp;display=inline&amp;height=536&amp;name=image.png&amp;originHeight=1072&amp;originWidth=2876&amp;size=554716&amp;status=done&amp;style=none&amp;width=1438#align=left&amp;display=inline&amp;height=1072&amp;originHeight=1072&amp;originWidth=2876&amp;status=done&amp;style=none&amp;width=2876" alt="image.png" class="img_ev3q"></p><p>如上图所示，我们可以看到test命名空间的配置数据了，下面我们再来介绍客户端的使用。</p><ol start="6"><li>首先依赖最新的nacos 1.2.0客户端，然后在初始化时添加如下代码：</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Properties properties = new Properties();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">properties.put(PropertyKeyConst.NAMESPACE, &quot;99a791cf-41c4-4535-9e93-b0141652bad0&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">properties.put(PropertyKeyConst.SERVER_ADDR, &quot;127.0.0.1:8848&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 配置用户名：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">properties.put(PropertyKeyConst.USERNAME, &quot;user1&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 配置密码：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">properties.put(PropertyKeyConst.PASSWORD, &quot;pwd1&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ConfigService iconfig = NacosFactory.createConfigService(properties);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="7"><li>使用客户端进行正常的读写配置操作。</li></ol><a name="8eF0X"></a># 我们在招人 阿里巴巴云原生基础技术中台是隶属于阿里云基础产品事业部的核心研发团队，致力于打造稳定、标准、先进的云原生应用基础平台，推动行业面向云原生技术升级与革命。在这里，你将与来自云计算、大数据领域的顶尖技术专家亲密合作，在全球独一无二的场景和规模中从事Kubernetes、Service Mesh、Serverless、Open Application Model（OAM）、Cloud Native Microservices、OpenMessaging、Event Streaming等云原生生态核心基础技术及Apache Dubbo、Apache RocketMQ、Nacos、Arthas等顶级开源项目的研发和落地工作。在标杆级的平台上，既服务阿里巴巴全球经济体，更服务全世界的开发者用户。目前在招聘技术专家岗位，详情可参考：[http://www.posterhr.com/html/CkgpBwD6f?from=timeline&amp;isappinstalled=0](http://www.posterhr.com/html/CkgpBwD6f?from=timeline&amp;isappinstalled=0)（可以直接投递，也可以将简历直接发送到dungu.zpf#alibaba-inc.com。#替换为@）</div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Nacos 1.3.0 new kernel construction process"><meta itemprop="keywords" content="nacos1.3.0,kernel"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/nacos-1.3.0-design">Nacos 1.3.0 new kernel construction process</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T11:47:41.000Z" itemprop="datePublished">October 10, 2023</time> · <!-- -->26 min read</div></header><div class="markdown" itemprop="articleBody"><a name="0YIG0"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="summarize">Summarize<a href="#summarize" class="hash-link" aria-label="Direct link to Summarize" title="Direct link to Summarize">​</a></h2><p>This 1.3.0 is implanted to a great extent, involving the modification of two large modules and the addition of a core module</p><ol><li>nacos-core module modification<ol><li>nacos</li><li>nacos internal event mechanism</li><li>nacos consistency protocol layer</li></ol></li><li>nacos-config module modification<ol><li>Add embedded distributed data storage components</li><li>Separation of embedded storage and external storage</li><li>Simple operation and maintenance of embedded storage</li></ol></li><li>Add nacos-consistency module<ol><li>Unified abstraction for AP protocol and CP protocol</li></ol></li></ol><a name="rnkDY"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="system-parameters-changes">System parameters changes<a href="#system-parameters-changes" class="hash-link" aria-label="Direct link to System parameters changes" title="Direct link to System parameters changes">​</a></h2><a name="1Gmg9"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="updates">Updates<a href="#updates" class="hash-link" aria-label="Direct link to Updates" title="Direct link to Updates">​</a></h3><table><thead><tr><th align="center"><strong>core</strong></th><th>nacos.watch-file.max-dirs</th><th>JVM parameter</th><th>Maximum number of monitored directories</th></tr></thead><tbody><tr><td align="center"></td><td>nacos.core.notify.ring-buffer-size</td><td>JVM parameter</td><td>Quick notification of the maximum length of the queue</td></tr><tr><td align="center"></td><td>nacos.core.notify.share-buffer-size</td><td>JVM parameter</td><td>The maximum length of the slow notification queue</td></tr><tr><td align="center"></td><td>nacos.core.member.fail-access-cnt</td><td>JVM parameter.properties</td><td>Maximum number of failed visits to cluster member nodes</td></tr><tr><td align="center"></td><td>nacos.core.address-server.retry</td><td>JVM parameter、application.properties</td><td>Address server addressing mode, first start request retry times</td></tr></tbody></table><br><a name="kxo8O"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-future-overall-logical-architecture-of-nacos-and-its-components">The future overall logical architecture of Nacos and its components<a href="#the-future-overall-logical-architecture-of-nacos-and-its-components" class="hash-link" aria-label="Direct link to The future overall logical architecture of Nacos and its components" title="Direct link to The future overall logical architecture of Nacos and its components">​</a></h2><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333972/1587129046320-5a286f38-8db4-4e76-9b42-8bd859f51a60.png#align=left&amp;display=inline&amp;height=1184&amp;margin=%5Bobject%20Object%5D&amp;name=1561217775318-6e408805-18bb-4242-b4e9-83c5b929b469.png&amp;originHeight=1184&amp;originWidth=1608&amp;size=279074&amp;status=done&amp;style=none&amp;width=1608" alt="1561217775318-6e408805-18bb-4242-b4e9-83c5b929b469.png" class="img_ev3q"></p><a name="Hyc6u"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-cluster-member-node-addressing-mode">Nacos cluster member node addressing mode<a href="#nacos-cluster-member-node-addressing-mode" class="hash-link" aria-label="Direct link to Nacos cluster member node addressing mode" title="Direct link to Nacos cluster member node addressing mode">​</a></h2><p>Before 1.3.0, nacos&#x27; naming module and config module had their own member list management tasks. In order to unify the replacement mode of nacos assigning the next member list, the implementation of merge management is replaced from the named module and the config module, unified to the addressing module of the core module, and the command line parameters are added at the same time -Dnacos.member.list **To set the list listed by nacos, this parameter can be called an alternative to the cluster.conf file. The current nacos addressing mode categories are as follows</p><ol><li>In stand-alone mode: StandaloneMemberLookup</li><li>Play mode<ol><li>The cluster.conf file exists: FileConfigMemberLookup</li><li>The cluster.conf file does not exist or -Dnacos.member.list is not set: AddressServerMemberLookup</li></ol></li></ol><p>If you want to specify an addressing mode, set this parameter：<strong>nacos.core.member.lookup.type=<!-- -->[file,address-server]</strong></p><p>The logical diagram is as follows
<img loading="lazy" src="https://cdn.nlark.com/yuque/__puml/e209a677aa8b5ffce23589e987ee5129.svg#lake_card_v2=eyJjb2RlIjoiQHN0YXJ0dW1sXG5cbigqKSAtLT4gXCJMb29rdXBGYWN0b3J5LmluaXQoKVwiXG5cbmlmIFwic3RhbmRhbG9uZSBtb2RlXCIgdGhlblxuICAtLT5bdHJ1ZV0gXCJyZXR1cm4gU3RhbmRhbG9uZU1lbWJlckxvb2t1cFwiXG4gIC0tPiBMb29rdXAucnVuKClcbmVsc2VcbiBpZiBcImNsdXN0ZXIuY29uZiBleGlzdHNcIiB0aGVuXG4gICAgLS0-W3RydWVdIFwicmV0dXJuIEZpbGVDb25maWdNZW1iZXJMb29rdXBcIlxuICAgIC0tPiBMb29rdXAucnVuKClcbiBlbHNlXG4gICAgLT5bZmFsc2VdIFwicmV0dXJuIEFkZHJlc3NTZXJ2ZXJNZW1iZXJMb29rdXBcIlxuICAgIC0tPiBMb29rdXAucnVuKClcbiBlbmRpZlxuZW5kaWZcblxuLS0-ICgqKVxuXG5AZW5kdW1sIiwidHlwZSI6InB1bWwiLCJpZCI6IlplWGtkIiwidXJsIjoiaHR0cHM6Ly9jZG4ubmxhcmsuY29tL3l1cXVlL19fcHVtbC9lMjA5YTY3N2FhOGI1ZmZjZTIzNTg5ZTk4N2VlNTEyOS5zdmciLCJjYXJkIjoiZGlhZ3JhbSJ9" class="img_ev3q"></p><a name="wqkMp"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="addressing-mode-details">Addressing mode details<a href="#addressing-mode-details" class="hash-link" aria-label="Direct link to Addressing mode details" title="Direct link to Addressing mode details">​</a></h3><p>Next, I introduce two other addressing modes in addition to the addressing mode in stand-alone mode<br></p><a name="egl3H"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fileconfigmemberlookup">FileConfigMemberLookup<a href="#fileconfigmemberlookup" class="hash-link" aria-label="Direct link to FileConfigMemberLookup" title="Direct link to FileConfigMemberLookup">​</a></h4><p>This addressing mode is managed based on the cluster.conf file, and each node will read the list of member nodes in the cluster.conf file under their respective ${nacos.home}/conf and then form a cluster. And after reading the cluster.conf file under ${nacos.home}/conf for the first time, it will automatically register a directory listener with the operating system&#x27;s <em><strong>inotify</strong></em> mechanism to monitor ${nacos.home}/ All file changes in the conf directory (note that only files will be monitored here, and file changes in subdirectories cannot be monitored)<br>When you need to expand or shrink the cluster nodes, you need to manually modify the content of the member node list of cluster.conf under ${nacos.home}/conf for each node.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">private FileWatcher watcher = new FileWatcher() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public void onChange(FileChangeEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            readClusterConfFromDisk();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public boolean interest(String context) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return StringUtils.contains(context, &quot;cluster.conf&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void start() throws NacosException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    readClusterConfFromDisk();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (memberManager.getServerList().isEmpty()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throw new NacosException(NacosException.SERVER_ERROR,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;Failed to initialize the member node, is empty&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Use the inotify mechanism to monitor file changes and automatically</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // trigger the reading of cluster.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        WatchFileCenter.registerWatcher(ApplicationUtils.getConfFilePath(), watcher);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catch (Throwable e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Loggers.CLUSTER.error(&quot;An exception occurred in the launch file monitor : {}&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The first time you directly read the node list information in the cluster.conf file, then register a directory listener with WatchFileCenter, and automatically trigger <em><strong>readClusterConfFromDisk()</strong></em> to re-read cluster.conf when the cluster.conf file changes file<br><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333972/1591014354207-49c1e934-2aa5-465a-8a2b-0b09902814f8.png#align=left&amp;display=inline&amp;height=531&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=531&amp;originWidth=1169&amp;size=105696&amp;status=done&amp;style=none&amp;width=1169" alt="image.png" class="img_ev3q"></p><a name="yFTCl"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="addressservermemberlookup">AddressServerMemberLookup<a href="#addressservermemberlookup" class="hash-link" aria-label="Direct link to AddressServerMemberLookup" title="Direct link to AddressServerMemberLookup">​</a></h4><p>This addressing mode is based on an additional web server to manage cluster.conf. Each node periodically requests the content of the cluster.conf file from the web server, and then implements addressing between cluster nodes and expansion and contraction. <br>When you need to expand or shrink the cluster, you only need to modify the cluster.conf file, and then each node will automatically get the latest cluster.conf file content when it requests the address server.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void start() throws NacosException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (start.compareAndSet(false, true)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.maxFailCount = Integer.parseInt(ApplicationUtils.getProperty(&quot;maxHealthCheckFailCount&quot;, &quot;12&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        initAddressSys();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        run();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private void initAddressSys() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String envDomainName = System.getenv(&quot;address_server_domain&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (StringUtils.isBlank(envDomainName)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        domainName = System.getProperty(&quot;address.server.domain&quot;, &quot;jmenv.tbsite.net&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        domainName = envDomainName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String envAddressPort = System.getenv(&quot;address_server_port&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (StringUtils.isBlank(envAddressPort)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addressPort = System.getProperty(&quot;address.server.port&quot;, &quot;8080&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addressPort = envAddressPort;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addressUrl = System.getProperty(&quot;address.server.url&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ApplicationUtils.getContextPath() + &quot;/&quot; + &quot;serverlist&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addressServerUrl = &quot;http://&quot; + domainName + &quot;:&quot; + addressPort + addressUrl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    envIdUrl = &quot;http://&quot; + domainName + &quot;:&quot; + addressPort + &quot;/env&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Loggers.CORE.info(&quot;ServerListService address-server port:&quot; + addressPort);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Loggers.CORE.info(&quot;ADDRESS_SERVER_URL:&quot; + addressServerUrl);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SuppressWarnings(&quot;PMD.UndefineMagicConstantRule&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private void run() throws NacosException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // With the address server, you need to perform a synchronous member node pull at startup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Repeat three times, successfully jump out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean success = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Throwable ex = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int maxRetry = ApplicationUtils.getProperty(&quot;nacos.core.address-server.retry&quot;, Integer.class, 5);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (int i = 0; i &lt; maxRetry; i ++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            syncFromAddressUrl();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            success = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Throwable e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ex = e;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Loggers.CLUSTER.error(&quot;[serverlist] exception, error : {}&quot;, ExceptionUtil.getAllExceptionMsg(ex));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!success) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throw new NacosException(NacosException.SERVER_ERROR, ex);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GlobalExecutor.scheduleByCommon(new AddressServerSyncTask(), 5_000L);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>During initialization, it will take the initiative to synchronize the current cluster member list information with the address server, and if it fails, retry, the maximum number of retries can be controlled by setting <em><strong>nacos.core.address-server.retry</strong></em>, The default is 5 times, and then after success, a scheduled task will be created to synchronize the cluster member node information to the address server<br><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333972/1591014362972-004f5338-af0d-4d0d-b769-4f3d5118c08a.png#align=left&amp;display=inline&amp;height=846&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=846&amp;originWidth=1149&amp;size=188886&amp;status=done&amp;style=none&amp;width=1149" alt="image.png" class="img_ev3q"></p><a name="sgOTI"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-node-management-and-addressing-modes-are-combined">How node management and addressing modes are combined<a href="#how-node-management-and-addressing-modes-are-combined" class="hash-link" aria-label="Direct link to How node management and addressing modes are combined" title="Direct link to How node management and addressing modes are combined">​</a></h3><p><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333972/1591014400580-39b83aa0-c548-4241-a49e-0d72abda2a95.png#align=left&amp;display=inline&amp;height=715&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=715&amp;originWidth=1189&amp;size=131826&amp;status=done&amp;style=none&amp;width=1189" alt="image.png" class="img_ev3q"><br>After MemberLookup starts, it will perform addressing tasks according to different addressing modes, will collect cluster node list information, call memberChange, trigger cluster node changes, and then publish node change events</p><a name="idHpC"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-consensus-protocol-protocol-layer-abstraction">Nacos consensus protocol protocol layer abstraction<a href="#nacos-consensus-protocol-protocol-layer-abstraction" class="hash-link" aria-label="Direct link to Nacos consensus protocol protocol layer abstraction" title="Direct link to Nacos consensus protocol protocol layer abstraction">​</a></h2><p>From the overall architecture of nacos in the future, it can be seen that the consistency protocol layer will be the core module of nacos, and will serve each functional module built on the core module, or the service and core module itself. The consistency protocol needs to choose between availability and consistency because of the existence of partition fault tolerance, so there are two major types of consistency: final consistency and strong consistency. In nacos, both types of consistency protocols are possible. For example, the naming module uses AP and CP for data management of service instances, respectively. For the config module, it will involve the use of CP. At the same time, there are the following functional demand points</p><ol><li>At present, the persistence service uses a variant version of raft, and the business and the raft protocol are coupled. Therefore, it needs to be decoupled and decoupled. At the same time, a standard Java version of Raft is selected for implementation.</li><li>For small and medium-sized users, the configuration is basically not super much. An independent mysql is relatively heavy and requires a light-weight storage solution. It also supports 2.0 not dependent on mysql and 3.0 dependent on mysql configurability</li><li>Due to CP or AP, there are many implementations, how to make a good abstraction of the consistency protocol layer, so that in the future can quickly achieve the specific implementation of the underlying consistency protocol replacement, such as the Raft protocol, the current selection of nacos It is JRaft, it is not excluded that in the future nacos will implement a standard raft protocol or Paxos protocol by itself</li><li>Since there are multiple function modules working independently in Nacos, there can be no influence between each function module. For example, when the A module processes the request too slowly or an exception occurs, it cannot affect the normal operation of the B module, that is, each function module is in use. How to isolate the data processing of each module when using a consistent protocol?</li></ol><p>According to the consensus protocol and the above functional requirements, this time an abstract consensus protocol layer and related interfaces were made</p><a name="3w8xM"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="consensus-agreement-abstraction">Consensus agreement abstraction<a href="#consensus-agreement-abstraction" class="hash-link" aria-label="Direct link to Consensus agreement abstraction" title="Direct link to Consensus agreement abstraction">​</a></h3><a name="p7zRo"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="consistencyprotocol">ConsistencyProtocol<a href="#consistencyprotocol" class="hash-link" aria-label="Direct link to ConsistencyProtocol" title="Direct link to ConsistencyProtocol">​</a></h4><p>The so-called consistency is the characteristic of whether multiple copies can maintain consistency, and the essence of the copy is data, and the operation of the data is either acquisition or modification. At the same time, the consensus protocol is actually for distributed situations, and this necessarily involves multiple nodes. Therefore, there is a need for a corresponding interface to be able to adjust the coordination protocol of the collaborative work node. What if we want to observe the operation of the consistency agreement? For example, the Raft protocol, we want to know who is the leader in the current cluster, the term of office, and who are the member nodes in the current cluster? Therefore, it is also necessary to provide a consistent protocol metadata acquisition. <br>In summary, the general design of ConsistencyProtcol can come out</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface ConsistencyProtocol&lt;T extends Config, P extends LogProcessor&gt; extends CommandOperations {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Consistency protocol initialization: perform initialization operations based on the incoming Config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 一致性协议初始化，根据 Config 实现类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param config {@link Config}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void init(T config);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Add a log handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param processors {@link LogProcessor}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void addLogProcessors(Collection&lt;P&gt; processors);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Copy of metadata information for this consensus protocol</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 该一致性协议的元数据信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return metaData {@link ProtocolMetaData}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ProtocolMetaData protocolMetaData();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Obtain data according to the request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param request request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return data {@link Response}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @throws Exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Response getData(GetRequest request) throws Exception;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Get data asynchronously</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param request request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return data {@link CompletableFuture&lt;Response&gt;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CompletableFuture&lt;Response&gt; aGetData(GetRequest request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Data operation, returning submission results synchronously</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 同步数据提交，在 Datum 中已携带相应的数据操作信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param data {@link Log}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return submit operation result {@link Response}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @throws Exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Response submit(Log data) throws Exception;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Data submission operation, returning submission results asynchronously</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 异步数据提交，在 Datum 中已携带相应的数据操作信息，返回一个Future，自行操作，提交发生的异常会在CompleteFuture中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param data {@link Log}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return {@link CompletableFuture&lt;Response&gt;} submit result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @throws Exception when submit throw Exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CompletableFuture&lt;Response&gt; submitAsync(Log data);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * New member list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 新的成员节点列表，一致性协议自行处理相应的成员节点是加入还是离开</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param addresses [ip:port, ip:port, ...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void memberChange(Set&lt;String&gt; addresses);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Consistency agreement service shut down</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 一致性协议服务关闭</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For the CP protocol, due to the concept of Leader, it is necessary to provide a method for obtaining who is the current Leader of the CP protocol.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface CPProtocol&lt;C extends Config&gt; extends ConsistencyProtocol&lt;C&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Returns whether this node is a leader node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param group business module info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return is leader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @throws Exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean isLeader(String group) throws Exception;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="oJFpB"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="data-operation-request-submission-objectloggetrequest">Data operation request submission object：Log、GetRequest<a href="#data-operation-request-submission-objectloggetrequest" class="hash-link" aria-label="Direct link to Data operation request submission object：Log、GetRequest" title="Direct link to Data operation request submission object：Log、GetRequest">​</a></h4><p>As mentioned above, the consistency protocol is actually for data operations. Data operations are basically divided into two categories: data query and data modification, and at the same time, data isolation between different functional modules must be satisfied. Therefore, the data modification operations and data query operations are explained separately here.</p><ol><li>Data modification<ol><li>Data modification operation, you must know which functional module this request belongs to</li><li>For data modification operations, you must first know what kind of modification operation this data modification operation is for, so that the function module can perform corresponding logical operations for the real data modification operation</li><li>For data modification operations, you must know what the modified data is, that is, the request body. In order to make the consistency protocol layer more general, here for the data structure of the request body, the byte[] array is selected</li><li>The type of data, because we serialize the real data into a byte[] array, in order to be able to serialize normally, we may also need to record what the type of this data is</li><li>The information summary or identification information of this request</li><li>The additional information for this request is used to expand the data to be transmitted in the future</li></ol></li></ol><p>In summary, it can be concluded that the design of the Log object is as follows</p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message Log {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Function module grouping information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string group = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Abstract or logo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string key = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Specific request data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bytes data = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // type of data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string type = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // More specific data manipulation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string operation = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // extra information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    map&lt;string, string&gt; extendInfo = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Data query<ol><li>For data query operations, you must know which function module initiated the request</li><li>What are the conditions for data query? In order to be compatible with data query operations of various storage structures, here byte[] is used for storage</li><li>The additional information for this request is used to expand the data to be transmitted in the future</li></ol></li></ol><p>In summary, the design of the GetRequest object is as follows</p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">message GetRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Function module grouping information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string group = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Specific request data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bytes data = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // extra information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    map&lt;string, string&gt; extendInfo = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="vBig4"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="function-modules-use-consistency-protocollogprocessor">Function modules use consistency protocol：LogProcessor<a href="#function-modules-use-consistency-protocollogprocessor" class="hash-link" aria-label="Direct link to Function modules use consistency protocol：LogProcessor" title="Direct link to Function modules use consistency protocol：LogProcessor">​</a></h4><p>After the data operation is submitted through the consistency protocol, each node needs to process the Log or GetRequest object. Therefore, we need to abstract a Log and GetRequest object Processor. Different functional modules implement the processor. ConsistencyProtocol will internally According to the group attributes of Log and GetRequest, the Log and GetRequest objects are routed to a specific Processor. Of course, the Processor also needs to indicate which functional module it belongs to.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public abstract class LogProcessor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * get data by key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param request request {@link GetRequest}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return target type data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public abstract Response onRequest(GetRequest request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Process Submitted Log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param log {@link Log}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return {@link boolean}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public abstract Response onApply(Log log);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Irremediable errors that need to trigger business price cuts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param error {@link Throwable}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onError(Throwable error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * In order for the state machine that handles the transaction to be able to route</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * the Log to the correct LogProcessor, the LogProcessor needs to have an identity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return Business unique identification name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public abstract String group();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For the CP protocol, such as the Raft protocol, there is a snapshot design, so we need to separately extend a method for the CP protocol</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public abstract class LogProcessor4CP extends LogProcessor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Discovery snapshot handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * It is up to LogProcessor to decide which SnapshotOperate should be loaded and saved by itself</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return {@link List &lt;SnapshotOperate&gt;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public List&lt;SnapshotOperation&gt; loadSnapshotOperate() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Collections.emptyList();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="zbsAE"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h4><p>As can be seen from the above points, ConsistencyProtocol is the use interface exposed to the upper layer functional modules. Each ConsistencyProtocol has a backend implemented by a specific consistency protocol. Because Backend cannot be well compatible with nacos existing architecture design, so The additional LogProcessor is designed to solve this problem.<br><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333972/1591015048030-8a4bff4a-20ed-46dd-a7f7-98655b22946f.png#align=left&amp;display=inline&amp;height=591&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=591&amp;originWidth=886&amp;size=93327&amp;status=done&amp;style=none&amp;width=886" alt="image.png" class="img_ev3q"><br>同At the time, because the backend inside the consistency protocol layer needs to implement the isolation processing of the data of different business modules, and this piece of logic is implemented by the request object and the group attribute of the LogProcessor<br><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333972/1591015155835-a897262e-8e57-409c-bf94-d57bf765c80b.png#align=left&amp;display=inline&amp;height=591&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=591&amp;originWidth=910&amp;size=118083&amp;status=done&amp;style=none&amp;width=910" alt="image.png" class="img_ev3q"></p><a name="C1yU6"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="consistent-protocol-layer-workflow">Consistent protocol layer workflow<a href="#consistent-protocol-layer-workflow" class="hash-link" aria-label="Direct link to Consistent protocol layer workflow" title="Direct link to Consistent protocol layer workflow">​</a></h3><p>We can take a look at a sequence diagram, the general workflow of the consistency protocol layer
<img loading="lazy" src="https://cdn.nlark.com/yuque/__puml/30b7e270e7aef8bb63136aaffbe5bfbf.svg#lake_card_v2=eyJjb2RlIjoiQHN0YXJ0dW1sXG5cbnBhcnRpY2lwYW50IFwiTWVtYmVyTWFuYWdlclwiIGFzIE5hY29zQ2x1c3RlclxucGFydGljaXBhbnQgXCJCdXNpbmVzc01vZHVsZVwiIGFzIEJpelxucGFydGljaXBhbnQgXCJDb25zaXN0ZW5jeVByb3RvY29sXCIgYXMgUHJvdG9jb2xcbnBhcnRpY2lwYW50IFwiQ0FQQmFja2VuZFwiIGFzIEJhY2tlbmRcbnBhcnRpY2lwYW50IFwiQ29uZmlnXCIgYXMgQ29uZmlnXG5wYXJ0aWNpcGFudCBcIkxvZ1Byb2Nlc3NvclwiIGFzIFByb2Nlc3NvclxucGFydGljaXBhbnQgXCJMb2dcIiBhcyBMb2dcblxuYWN0aXZhdGUgTmFjb3NDbHVzdGVyXG5OYWNvc0NsdXN0ZXIgLT4gTmFjb3NDbHVzdGVyOiBpbml0KCkg5Yid5aeL5YyWTmFjb3Ppm4bnvqRcblxuTmFjb3NDbHVzdGVyIC0-IENvbmZpZzog6I635Y-WQ29uZmln5a-56LGhXG5hY3RpdmF0ZSBDb25maWdcbkNvbmZpZyAtPiBDb25maWc6IOaUtumbhkxvZ1Byb2Nlc3NvcueahOS_oeaBr1xuQ29uZmlnIC0-IE5hY29zQ2x1c3RlclxuZGVhY3RpdmF0ZSBDb25maWdcblxuXG5OYWNvc0NsdXN0ZXIgLT4gUHJvdG9jb2w6IOiOt-WPluaJgOaciUNvbnNpc3RlbmN5UHJvdG9jb2zlrp7njrBcbmFjdGl2YXRlIFByb3RvY29sXG5cbk5hY29zQ2x1c3RlciAtPiBQcm90b2NvbDogaW5pdChDb25maWcpIOaWueazleaJp-ihjFxuXG5kZWFjdGl2YXRlIFByb3RvY29sXG5kZWFjdGl2YXRlIE5hY29zQ2x1c3RlclxuXG5cbkJpeiAtPiBMb2c6IOWIm-W7uuS4gOS4quS6i-WKoeWvueixoVxuYWN0aXZhdGUgQml6XG5hY3RpdmF0ZSBMb2dcblxuXG5Mb2cgLT4gTG9nOiDorr7nva5kYXRhXG5Mb2cgLT4gTG9nOiDorr7nva5rZXlcbkxvZyAtPiBMb2c6IOiuvue9rmNsYXNzTmFtZVxuTG9nIC0-IExvZzog6K6-572uZXh0ZW5kSW5mb1xuTG9nIC0-IEJpelxuZGVhY3RpdmF0ZSBMb2dcblxuQml6IC0-IFByb3RvY29sOiBzdWJtaXQoTG9nKSDosIPnlKjkuIDoh7TmgKfljY_orq7ov5vooYzkuovliqHmj5DkuqRcbmFjdGl2YXRlIFByb3RvY29sXG5cblByb3RvY29sIC0-IEJhY2tlbmQ6IOWGhemDqOS4gOiHtOaAp-WNj-iuruW3peS9nFxuYWN0aXZhdGUgQmFja2VuZFxuXG5CYWNrZW5kIC0-IFByb3RvY29sOiDov5Tlm57lt6XkvZzlpITnkIbnu5PmnpxcbmRlYWN0aXZhdGUgQmFja2VuZFxuXG5Qcm90b2NvbCAtPiBQcm9jZXNzb3I6IOWwhkxvZ-WIhuWPkeWIsOWvueW6lOeahFByb2Nlc3Nvcu-8jOiwg-eUqCBvbkFwcGx5IOaWueazlVxuYWN0aXZhdGUgUHJvdG9jb2xcbmRlYWN0aXZhdGUgUHJvdG9jb2xcblxuUHJvY2Vzc29yIC0-IEJpejog5LqL5Yqh5o-Q5Lqk57uT5p6cXG5cbmRlYWN0aXZhdGUgUHJvY2Vzc29yXG5kZWFjdGl2YXRlIEJpelxuXG5AZW5kdW1sIiwidHlwZSI6InB1bWwiLCJtYXJnaW4iOnRydWUsImlkIjoiNFZpMkwiLCJ1cmwiOiJodHRwczovL2Nkbi5ubGFyay5jb20veXVxdWUvX19wdW1sLzMwYjdlMjcwZTdhZWY4YmI2MzEzNmFhZmZiZTViZmJmLnN2ZyIsImNhcmQiOiJkaWFncmFtIn0=" class="img_ev3q"></p><a name="xtBNU"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-implementation-option-of-cp-protocol-in-nacos-consistency-protocol-layerjraft">The implementation option of CP protocol in Nacos consistency protocol layer——JRaft<a href="#the-implementation-option-of-cp-protocol-in-nacos-consistency-protocol-layerjraft" class="hash-link" aria-label="Direct link to The implementation option of CP protocol in Nacos consistency protocol layer——JRaft" title="Direct link to The implementation option of CP protocol in Nacos consistency protocol layer——JRaft">​</a></h3><p>After the consistency protocol layer is abstracted, the rest is the choice of concrete consistency protocol implementation. Here we have chosen Ant Financial&#x27;s open source JRaft, so how can we use JRaf as a backend of the CP protocol? The following simple flow chart describes the initialization process when JRaft is used as a Backend of the CP protocol</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * A concrete implementation of CP protocol: JRaft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;pre&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                                           ┌──────────────────────┐               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                                           │                      │               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *            ┌──────────────────────┐       │                      ▼               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *            │   ProtocolManager    │       │        ┌───────────────────────────┐ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *            └──────────────────────┘       │        │for p in [LogProcessor4CP] │ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        │                  │        └───────────────────────────┘ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        ▼                  │                      │               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *      ┌──────────────────────────────────┐ │                      ▼               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *      │    discovery LogProcessor4CP     │ │             ┌─────────────────┐      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *      └──────────────────────────────────┘ │             │  get p.group()  │      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        │                  │             └─────────────────┘      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        ▼                  │                      │               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                 ┌─────────────┐           │                      │               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                 │ RaftConfig  │           │                      ▼               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                 └─────────────┘           │      ┌──────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        │                  │      │  create raft group service   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        ▼                  │      └──────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *              ┌──────────────────┐         │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *              │  JRaftProtocol   │         │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *              └──────────────────┘         │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        │                  │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                     init()                │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        │                  │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        ▼                  │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *               ┌─────────────────┐         │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *               │   JRaftServer   │         │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *               └─────────────────┘         │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        │                  │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        │                  │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        ▼                  │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *             ┌────────────────────┐        │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *             │JRaftServer.start() │        │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *             └────────────────────┘        │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        │                  │                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *                        └──────────────────┘                                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * &lt;/pre&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author &lt;a href=&quot;mailto:liaochuntao@live.com&quot;&gt;liaochuntao&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>JRaftProtocol is a concrete implementation of a ConsistencyProtocol when JRaft is used as the backend of the CP protocol. It has a JRaftServer member attribute inside. JRaftServer distributes various API operations of JRaft, such as data operation submission, data query, and member node changes. , Leader node query, etc.</p><p><em><strong>Note: The data generated during JRaft operation is in the ${nacos.home}/data/protocol/raft file directory. Different business modules have different file groupings. If the node crashes or shuts down abnormally, clear the files in the directory and restart the node</strong></em></p><p>Since JRaft implements the concept of raft group, it is possible to use the design of raft group to create a raft group for each function module. Here is part of the code, which shows how to embed LogProcessor in the state machine and create a Raft Group for each LogPrcessor</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">synchronized void createMultiRaftGroup(Collection&lt;LogProcessor4CP&gt; processors) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // There is no reason why the LogProcessor cannot be processed because of the synchronization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!this.isStarted) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.processors.addAll(processors);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final String parentPath = Paths</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .get(ApplicationUtils.getNacosHome(), &quot;data/protocol/raft&quot;).toString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (LogProcessor4CP processor : processors) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        final String groupName = processor.group();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (multiRaftGroup.containsKey(groupName)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new DuplicateRaftGroupException(groupName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Ensure that each Raft Group has its own configuration and NodeOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Configuration configuration = conf.copy();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        NodeOptions copy = nodeOptions.copy();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JRaftUtils.initDirectory(parentPath, groupName, copy);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Here, the LogProcessor is passed into StateMachine, and when the StateMachine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // triggers onApply, the onApply of the LogProcessor is actually called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        NacosStateMachine machine = new NacosStateMachine(this, processor);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        copy.setFsm(machine);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        copy.setInitialConf(configuration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Set snapshot interval, default 1800 seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int doSnapshotInterval = ConvertUtils.toInt(raftConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            .getVal(RaftSysConstants.RAFT_SNAPSHOT_INTERVAL_SECS),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    RaftSysConstants.DEFAULT_RAFT_SNAPSHOT_INTERVAL_SECS);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // If the business module does not implement a snapshot processor, cancel the snapshot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        doSnapshotInterval = CollectionUtils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .isEmpty(processor.loadSnapshotOperate()) ? 0 : doSnapshotInterval;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        copy.setSnapshotIntervalSecs(doSnapshotInterval);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Loggers.RAFT.info(&quot;create raft group : {}&quot;, groupName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RaftGroupService raftGroupService = new RaftGroupService(groupName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    localPeerId, copy, rpcServer, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Because RpcServer has been started before, it is not allowed to start again here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Node node = raftGroupService.start(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        machine.setNode(node);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RouteTable.getInstance().updateConfiguration(groupName, configuration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RaftExecutor.executeByCommon(() -&gt; registerSelfToCluster(groupName, localPeerId, configuration));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Turn on the leader auto refresh for this group</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Random random = new Random();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        long period = nodeOptions.getElectionTimeoutMs() + random.nextInt(5 * 1000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RaftExecutor.scheduleRaftMemberRefreshJob(() -&gt; refreshRouteTable(groupName),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    nodeOptions.getElectionTimeoutMs(), period, TimeUnit.MILLISECONDS);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        multiRaftGroup.put(groupName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    new RaftGroupTuple(node, processor, raftGroupService, machine));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="4czvB"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="qa-why-do-you-want-to-create-multiple-raft-groups">Q&amp;A: Why do you want to create multiple raft groups<a href="#qa-why-do-you-want-to-create-multiple-raft-groups" class="hash-link" aria-label="Direct link to Q&amp;A: Why do you want to create multiple raft groups" title="Direct link to Q&amp;A: Why do you want to create multiple raft groups">​</a></h4><p>Some people may have doubts. Since the LogProcessor has been designed before, you can use a Raft Group. When the state machine is appl, you can route to different LogProcessors according to the Log group attribute. Each function module creates a Raft group, will it consume a lot of resources? <br>As mentioned before, we hope that the modules that work independently do not affect each other. For example, the A module processing Log may cause the application speed to be slow because of the Block operation, or an exception may occur halfway. For the Raft protocol , When the log apply fails, the state machine will not be able to continue to move forward, because if you continue to move forward, due to the previous step of the apply failure, all subsequent applications may fail, which will cause the data of this node and other nodes Data is never consistent. If we put all the modules that work independently in the same raft group, that is, a state machine, for the data processing request processing, the above-mentioned problems will inevitably occur, and a module will be uncontrollable in the apply log. Factors will affect the normal operation of other modules.</p><a name="2GyRw"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="jraft-operation-and-maintenance">JRaft operation and maintenance<a href="#jraft-operation-and-maintenance" class="hash-link" aria-label="Direct link to JRaft operation and maintenance" title="Direct link to JRaft operation and maintenance">​</a></h3><p>In order to allow users to perform simple operation and maintenance of JRaft, such as leader switching, resetting the current Raft cluster members, triggering a node to perform Snapshot operations, etc., a simple HTTP interface is provided for operation, and the interface has certain Limit, that is, only one operation instruction can be executed at a time</p><p>1、Switch the leader node of a certain Raft Group</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /nacos/v1/core/ops/raft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;groupId&quot;: &quot;xxx&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;command&quot;: &quot;transferLeader&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;value&quot;: &quot;ip:{raft_port} or ip:{raft_port},ip:{raft_port},ip:{raft_port}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="Fs7VE"></a><p>2、Reset a Raft Group cluster member</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /nacos/v1/core/ops/raft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;groupId&quot;: &quot;xxx&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;command&quot;: &quot;resetRaftCluster&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;value&quot;: &quot;ip:{raft_port},ip:{raft_port},ip:{raft_port},ip:{raft_port}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that this operation is a high-risk operation. This operation and maintenance command can only be used when the n/2 + 1 node of the Raft cluster fails to meet the requirements of more than half of the vote after the crash. It is used to quickly reorganize the remaining nodes to the Raft cluster to provide external Service, but this operation will greatly cause the loss of data<br></p><a name="VfG5T"></a><p>3、Trigger a Raft Group to perform a snapshot operation</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /nacos/v1/core/ops/raft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;groupId&quot;: &quot;xxx&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;command&quot;: &quot;doSnapshot&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;value&quot;: &quot;ip:{raft_port}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="m9LfI"></a><p>4、Remove a member of a Raft Group</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /nacos/v1/core/ops/raft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;groupId&quot;: &quot;xxx&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;command&quot;: &quot;removePeer&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;value&quot;: &quot;ip:{raft_port}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="ev3MW"></a><p>5、Remove multiple members of a Raft Group in batches</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /nacos/v1/core/ops/raft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;groupId&quot;: &quot;xxx&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;command&quot;: &quot;removePeers&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;value&quot;: &quot;ip:{raft_port},ip:{raft_port},ip:{raft_port},...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="GzMuP"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="jraft-protocol-related-configuration-parameters">JRaft protocol related configuration parameters<a href="#jraft-protocol-related-configuration-parameters" class="hash-link" aria-label="Direct link to JRaft protocol related configuration parameters" title="Direct link to JRaft protocol related configuration parameters">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">### Sets the Raft cluster election timeout, default value is 5 second</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos.core.protocol.raft.data.election_timeout_ms=5000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### Sets the amount of time the Raft snapshot will execute periodically, default is 30 minute</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos.core.protocol.raft.data.snapshot_interval_secs=30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### Requested retries, default value is 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos.core.protocol.raft.data.request_failoverRetries=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### raft internal worker threads</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos.core.protocol.raft.data.core_thread_num=8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### Number of threads required for raft business request processing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos.core.protocol.raft.data.cli_service_thread_num=4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### raft linear read strategy, defaults to index</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos.core.protocol.raft.data.read_index_type=ReadOnlySafe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### rpc request timeout, default 5 seconds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nacos.core.protocol.raft.data.rpc_request_timeout_ms=5000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="linear-reading-parameter-analysis">Linear reading parameter analysis<a href="#linear-reading-parameter-analysis" class="hash-link" aria-label="Direct link to Linear reading parameter analysis" title="Direct link to Linear reading parameter analysis">​</a></h4><ol><li><strong>ReadOnlySafe</strong><ol><li>In this linear read mode, every time a Follower makes a read request, it needs to synchronize with the Leader to submit the site information, and the Leader needs to initiate a lightweight RPC request to prove that it is the Leader to more than half of the Follower, which is equivalent to a Follower read, at least 1 + (n/2) + 1 RPC request is required.</li></ol></li><li><strong>ReadOnlyLeaseBased</strong><ol><li>In this linear read mode, each time the Follower makes a read request, the Leader only needs to determine whether its Leader lease has expired. If it does not expire, it can directly reply that the Follower is the Leader, but the mechanism has strict requirements on the machine clock. For clock synchronization, consider using this linear read mode.</li></ol></li></ol><a name="WiLDa"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-embedded-distributed-id">Nacos embedded distributed ID<a href="#nacos-embedded-distributed-id" class="hash-link" aria-label="Direct link to Nacos embedded distributed ID" title="Direct link to Nacos embedded distributed ID">​</a></h2><p>The distributed ID embedded in nacos is Snakeflower, the dataCenterId defaults to 1, and the value of workerId is calculated as follows</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">InetAddress address;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address = InetAddress.getLocalHost();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> catch (final UnknownHostException e) </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    throw new IllegalStateException(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &quot;Cannot get LocalHost InetAddress</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> please check your network</span><span class="token tag" style="color:#00009f">!</span><span class="token plain">&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> ipAddressByteArray = address.getAddress();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">workerId = (((ipAddressByteArray</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ipAddressByteArray.length </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> &amp; 0B11)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &lt;&lt; Byte.SIZE) + (ipAddressByteArray</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ipAddressByteArray.length </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &amp; 0xFF));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you need to manually specify dataCenterId and workerId, add command line parameters in application.properties or startup</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">### set the dataCenterID manually</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># nacos.core.snowflake.data-center=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### set the WorkerID manually</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># nacos.core.snowflake.worker-id=</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="ZLp5w"></a><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-embedded-lightweight-derby-based-distributed-relational-storage">Nacos embedded lightweight Derby-based distributed relational storage<a href="#nacos-embedded-lightweight-derby-based-distributed-relational-storage" class="hash-link" aria-label="Direct link to Nacos embedded lightweight Derby-based distributed relational storage" title="Direct link to Nacos embedded lightweight Derby-based distributed relational storage">​</a></h2><a name="1B5KV"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="background">Background<a href="#background" class="hash-link" aria-label="Direct link to Background" title="Direct link to Background">​</a></h3><ol><li>If the number of configuration files is small, the cost of supporting a highly available database cluster in the cluster mode is too large, and it is expected to have a lightweight distributed relational storage to solve</li><li>Some metadata information storage inside nacos, such as user information, namespace information</li><li>Source of ideas:<a href="https://github.com/rqlite/rqlite" target="_blank" rel="noopener noreferrer">https://github.com/rqlite/rqlite</a></li></ol><a name="Du2qc"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="design-ideas">Design ideas<a href="#design-ideas" class="hash-link" aria-label="Direct link to Design ideas" title="Direct link to Design ideas">​</a></h3><a name="NzxHa"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="aims">aims<a href="#aims" class="hash-link" aria-label="Direct link to aims" title="Direct link to aims">​</a></h4><p>The design goal is to expect nacos to have two data storage modes, one is the current way, the data is stored in an external data source (relational database); the second way is the embedded storage data source (Apache Derby). Users can use the command line parameter configuration to freely use these two data storage modes<br><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333972/1591015542106-f14d2579-229f-4bfb-a432-e40854e65d6d.png#align=left&amp;display=inline&amp;height=903&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=903&amp;originWidth=1514&amp;size=237497&amp;status=done&amp;style=none&amp;width=1514" alt="image.png" class="img_ev3q"></p><a name="LqUtU"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="overall">overall<a href="#overall" class="hash-link" aria-label="Direct link to overall" title="Direct link to overall">​</a></h4><p>Save the SQL context involved in a request operation in order. Then synchronize the SQL context involved in this request through the consensus protocol layer, and then each node parses it and executes it again in a database session in sequence.<br><img loading="lazy" src="https://cdn.nlark.com/yuque/0/2020/png/333972/1587204104465-2270480a-de25-4c84-a11b-6edd2de99e66.png#align=left&amp;display=inline&amp;height=814&amp;margin=%5Bobject%20Object%5D&amp;name=%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6%20%281%29.png&amp;originHeight=814&amp;originWidth=1149&amp;size=130886&amp;status=done&amp;style=none&amp;width=1149" alt="未命名文件 (1).png" class="img_ev3q"></p><a name="yxFYn"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="related-data-bearing-objects">Related data bearing objects<a href="#related-data-bearing-objects" class="hash-link" aria-label="Direct link to Related data bearing objects" title="Direct link to Related data bearing objects">​</a></h4><p>The DML statements of the database are select, insert, update, and delete. According to the nature of SQL statements for data operations, they can be divided into two categories: query and update. The select statement corresponds to data query, and the insert, update, and delete statements correspond to Data modification. At the same time, when performing database operations, in order to avoid SQL injection, PreparedStatement is used, so SQL statements + parameters are required, so two Request objects about database operations can be obtained</p><ol><li>SelectRequest</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class SelectRequest implements Serializable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final long serialVersionUID = 2212052574976898602L;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Query category, because currently using JdbcTemplate, query a single, multiple queries, whether to use RowMapper into an object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private byte queryType;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // sql语句</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // select * from config_info where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String sql;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Object[] args;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String className;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>ModifyRequest</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ModifyRequest implements Serializable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final long serialVersionUID = 4548851816596520564L;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int executeNo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String sql;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Object[] args;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="moKl7"></a><h4 class="anchor anchorWithStickyNavbar_LWe7" id="configure-publishing">Configure publishing<a href="#configure-publishing" class="hash-link" aria-label="Direct link to Configure publishing" title="Direct link to Configure publishing">​</a></h4><p>The configuration release operation involves three transactions:</p><ol><li>config_info saves configuration information</li><li>config_tags_relation saves the association relationship between configuration and tags</li><li>his_config_info saves a history of configuration operations</li></ol><p>These three transactions are all configured and released under this big transaction. If we say that we perform a Raft protocol submission for each transaction operation, assume that 1, 2 transactions are successfully applied after being submitted through Raft, and the third transaction is in Raft. Apply fails after submission, then for the big transaction released by this configuration, it needs to be rolled back as a whole, otherwise it will violate the atomicity, then it may be necessary to say that the transaction rollback operation is again Raft submitted, then the overall complexity Rise, and directly introduce the management of distributed transactions, so in order to avoid this problem, we integrate the SQL contexts involved in these three transactions into a large SQL context, and submit the Raft protocol to this large SQL context. It ensures that the three sub-transactions successfully solve the atomicity problem in the same database session. At the same time, because the Raft protocol processes the transaction log serially, it is equivalent to adjusting the transaction isolation level of the database to serialization.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public void addConfigInfo(final String srcIp,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            final String srcUser, final ConfigInfo configInfo, final Timestamp time,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            final Map&lt;String, Object&gt; configAdvanceInfo, final boolean notify) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        final String tenantTmp = StringUtils.isBlank(configInfo.getTenant()) ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    StringUtils.EMPTY :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    configInfo.getTenant();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        configInfo.setTenant(tenantTmp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Obtain the database primary key through the snowflake ID algorithm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        long configId = idGeneratorManager.nextId(RESOURCE_CONFIG_INFO_ID);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        long hisId = idGeneratorManager.nextId(RESOURCE_CONFIG_HISTORY_ID);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addConfigInfoAtomic(configId, srcIp, srcUser, configInfo, time,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    configAdvanceInfo);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String configTags = configAdvanceInfo == null ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    null :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    (String) configAdvanceInfo.get(&quot;config_tags&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addConfigTagsRelation(configId, configTags, configInfo.getDataId(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    configInfo.getGroup(), configInfo.getTenant());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        insertConfigHistoryAtomic(hisId, configInfo, srcIp, srcUser, time, &quot;I&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        EmbeddedStorageContextUtils.onModifyConfigInfo(configInfo, srcIp, time);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        databaseOperate.blockUpdate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        EmbeddedStorageContextUtils.cleanAllContext();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public long addConfigInfoAtomic(final long id, final String srcIp,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            final String srcUser, final ConfigInfo configInfo, final Timestamp time,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;String, Object&gt; configAdvanceInfo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 参数处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final String sql =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;INSERT INTO config_info(id, data_id, group_id, tenant_id, app_name, content, md5, src_ip, src_user, gmt_create,&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        + &quot;gmt_modified, c_desc, c_use, effect, type, c_schema) VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final Object[] args = new Object[] { id, configInfo.getDataId(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                configInfo.getGroup(), tenantTmp, appNameTmp, configInfo.getContent(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                md5Tmp, srcIp, srcUser, time, time, desc, use, effect, type, schema, };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SqlContextUtils.addSqlContext(sql, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void addConfigTagRelationAtomic(long configId, String tagName, String dataId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String group, String tenant) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final String sql =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;INSERT INTO config_tags_relation(id,tag_name,tag_type,data_id,group_id,tenant_id) &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        + &quot;VALUES(?,?,?,?,?,?)&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final Object[] args = new Object[] { configId, tagName, null, dataId, group,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                tenant };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SqlContextUtils.addSqlContext(sql, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void insertConfigHistoryAtomic(long configHistoryId, ConfigInfo configInfo,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String srcIp, String srcUser, final Timestamp time, String ops) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 参数处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final String sql =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;INSERT INTO his_config_info (id,data_id,group_id,tenant_id,app_name,content,md5,&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        + &quot;src_ip,src_user,gmt_modified,op_type) VALUES(?,?,?,?,?,?,?,?,?,?,?)&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final Object[] args = new Object[] { configHistoryId, configInfo.getDataId(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                configInfo.getGroup(), tenantTmp, appNameTmp, configInfo.getContent(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                md5Tmp, srcIp, srcUser, time, ops };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SqlContextUtils.addSqlContext(sql, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Temporarily saves all insert, update, and delete statements under</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * a transaction in the order in which they occur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author &lt;a href=&quot;mailto:liaochuntao@live.com&quot;&gt;liaochuntao&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SqlContextUtils {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final ThreadLocal&lt;ArrayList&lt;ModifyRequest&gt;&gt; SQL_CONTEXT =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ThreadLocal.withInitial(ArrayList::new);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void addSqlContext(String sql, Object... args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ArrayList&lt;ModifyRequest&gt; requests = SQL_CONTEXT.get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ModifyRequest context = new ModifyRequest();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        context.setExecuteNo(requests.size());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        context.setSql(sql);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        context.setArgs(args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        requests.add(context);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SQL_CONTEXT.set(requests);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static List&lt;ModifyRequest&gt; getCurrentSqlContext() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return SQL_CONTEXT.get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void cleanCurrentSqlContext() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SQL_CONTEXT.remove();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A more intuitive understanding through a timing diagram
<img loading="lazy" src="https://cdn.nlark.com/yuque/__puml/618e8997395fbc74433ac4a60f67b6b4.svg#lake_card_v2=eyJjb2RlIjoiQHN0YXJ0dW1sXG5cbmF1dG9udW1iZXJcblxuYWN0b3IgXCJVc2VyXCIgYXMgVXNlclxuXG5wYXJ0aWNpcGFudCBcIkNvbmZpZ1NlcnZpY2VcIiBhcyBTZXJ2aWNlXG5wYXJ0aWNpcGFudCBcIlBlcnNpc3RlbmNlU2VydmljZVwiIGFzIFJlcG9zaXRvcnlcbnBhcnRpY2lwYW50IFwiRGVyYnlcIiBhcyBEQlxucGFydGljaXBhbnQgXCJTUUxDb250ZXh0VXRpbHNcIiBhcyBTUUxDb250ZXh0XG5wYXJ0aWNpcGFudCBcIkxvZ1Byb2Nlc3NvclwiIGFzIFByb2Nlc3NvclxucGFydGljaXBhbnQgXCJDb25zaXN0ZW5jeVByb3RvY29sXCIgYXMgUHJvdG9jb2xcbnBhcnRpY2lwYW50IFwiTG9nXCIgYXMgTG9nXG5cbmFjdGl2YXRlIFVzZXJcblxuVXNlciAtPiBTZXJ2aWNlOiDlj5HotbfphY3nva7lj5HluIPor7fmsYJcbmFjdGl2YXRlIFNlcnZpY2VcblxuU2VydmljZSAtPiBSZXBvc2l0b3J5OiDphY3nva7lj5HluINcbmFjdGl2YXRlIFJlcG9zaXRvcnlcblxuUmVwb3NpdG9yeSAtPiBTUUxDb250ZXh0OiDmi6bmiKrlvZPliY1TUUzkuIrkuIvmlodcbmFjdGl2YXRlIFNRTENvbnRleHRcblxuUmVwb3NpdG9yeSAtPiBSZXBvc2l0b3J5OiBjb21taXQg5pON5L2cXG5cblNRTENvbnRleHQgLT4gUmVwb3NpdG9yeTog5b2T5YmN6K-35rGC5raJ5Y-K55qE5omA5pyJU1FM5LiK5LiL5paHXG5cbmRlYWN0aXZhdGUgU1FMQ29udGV4dFxuXG5SZXBvc2l0b3J5IC0-IExvZzog5p6E5bu66K-35rGC5L2TXG5cbmFjdGl2YXRlIExvZ1xuZGVhY3RpdmF0ZSBMb2dcblxuUmVwb3NpdG9yeSAtPiBQcm90b2NvbDogc3VibWl0KCkg6L-b6KGM6K-35rGC5o-Q5LqkXG5hY3RpdmF0ZSBQcm90b2NvbFxuZGVhY3RpdmF0ZSBSZXBvc2l0b3J5XG5cblByb3RvY29sIC0-IFByb2Nlc3Nvcjogb25BcHBseSgpIOaWueazle-8jOeKtuaAgeacuuWkjeWItkxvZ1xuYWN0aXZhdGUgUHJvY2Vzc29yXG5cblByb2Nlc3NvciAtPiBSZXBvc2l0b3J5OiDmiafooYzmiYDmnInnmoRTUUzkuIrkuIvmlodcbmFjdGl2YXRlIFJlcG9zaXRvcnlcblxuUmVwb3NpdG9yeSAtPiBEQjog5pWw5o2u6JC95bqTXG5hY3RpdmF0ZSBEQlxuXG5EQiAtPiBSZXBvc2l0b3J5OiDnu5PmnZ_lubbov5Tlm57nu5PmnpxcbmRlYWN0aXZhdGUgREJcblxuUmVwb3NpdG9yeSAtPiBQcm9jZXNzb3I6IOi_lOWbnkxvZ0Z1dHVyZeW5tuiuvue9ruacrOasoeaJp-ihjOeahOe7k-aenFxuZGVhY3RpdmF0ZSBSZXBvc2l0b3J5XG5cblByb2Nlc3NvciAtPiBQcm90b2NvbDog6L-U5ZueTG9nRnV0dXJlXG5kZWFjdGl2YXRlIFByb2Nlc3NvclxuXG5Qcm90b2NvbCAtPiBTZXJ2aWNlOiDmnKzmrKHor7fmsYLnmoTnu5PmnpxcbmRlYWN0aXZhdGUgUHJvdG9jb2xcblxuU2VydmljZSAtPiBVc2VyXG5kZWFjdGl2YXRlIFNlcnZpY2VcbmRlYWN0aXZhdGUgVXNlclxuXG5AZW5kdW1sIiwidHlwZSI6InB1bWwiLCJtYXJnaW4iOnRydWUsImlkIjoiVnQxNzciLCJ1cmwiOiJodHRwczovL2Nkbi5ubGFyay5jb20veXVxdWUvX19wdW1sLzYxOGU4OTk3Mzk1ZmJjNzQ0MzNhYzRhNjBmNjdiNmI0LnN2ZyIsImNhcmQiOiJkaWFncmFtIn0=" class="img_ev3q"></p><a name="AAJTE"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-use-new-features">How to use new features<a href="#how-to-use-new-features" class="hash-link" aria-label="Direct link to How to use new features" title="Direct link to How to use new features">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./startup.sh -p embedded</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Whether to enable the embedded distributed relational storage activity diagram
<img loading="lazy" src="https://cdn.nlark.com/yuque/__puml/1fd656ba3b39fe5de8fea78efdf98dd1.svg#lake_card_v2=eyJjb2RlIjoiQHN0YXJ0dW1sXG5cbigqKSAtLT4gXCJDb25maWcuc3RhcnQoKVwiXG5cbmlmIFwi5Y2V5py65qih5byPXCIgdGhlblxuICAtcmlnaHQtPlt0cnVlXSBcInJldHVybiDpu5jorqTljZXmnLrlrZjlgqjooYzkuLpcIlxuICAtLT4gKCopXG5lbHNlXG4gaWYgXCLlt7LphY3nva7lpJbnva7lrZjlgqhcIiB0aGVuXG4gICAgLS0-W3RydWVdIFwicmV0dXJuIOWklue9ruaVsOaNruWtmOWCqOihjOS4ulwiXG4gICAgLS0-ICgqKVxuIGVsc2VcbiAgICBpZiBcIuW8gOWQr-WGheW1jOWtmOWCqFwiIHRoZW5cbiAgICAgICAgLS0-W3RydWVdIFwicmV0dXJuIOi9u-mHj-WGheW1jOWIhuW4g-W8j-WtmOWCqOihjOS4ulwiXG4gICAgICAgIC0tPiAoKilcbiAgICBlbHNlXG4gICAgICAgIC0-W2ZhbHNlXSBcInJldHVybiDpu5jorqTlpJbnva7mlbDmja7lrZjlgqjooYzkuLpcIlxuICAgICAgICAtLT4gKCopXG5cdFx0ZW5kaWZcbiBlbmRpZlxuZW5kaWZcblxuQGVuZHVtbCIsInR5cGUiOiJwdW1sIiwibWFyZ2luIjp0cnVlLCJpZCI6IkNNN1VDIiwidXJsIjoiaHR0cHM6Ly9jZG4ubmxhcmsuY29tL3l1cXVlL19fcHVtbC8xZmQ2NTZiYTNiMzlmZTVkZThmZWE3OGVmZGY5OGRkMS5zdmciLCJjYXJkIjoiZGlhZ3JhbSJ9" class="img_ev3q"></p><a name="9UAXN"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="new-features-related-operation-and-maintenance-operations">New features related operation and maintenance operations<a href="#new-features-related-operation-and-maintenance-operations" class="hash-link" aria-label="Direct link to New features related operation and maintenance operations" title="Direct link to New features related operation and maintenance operations">​</a></h3><p>Directly query the data stored in each node&#x27;s derby</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /nacos/v1/cs/ops/derby?sql=select * from config_info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return List&lt;Map&lt;String, Object&gt;&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="YcqO2"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="insufficient">insufficient<a href="#insufficient" class="hash-link" aria-label="Direct link to insufficient" title="Direct link to insufficient">​</a></h3><ol><li>Build a distributed data operation synchronization layer on the upper layer of the database, there are restrictions on the operation of the database, such as the first insert operation, then the select operation, and finally the update operation, which is interspersed with query statements in the data modification statement The order of operations is not supported</li><li>Limiting the performance of the database, due to the indirect adjustment of the database transaction isolation level to serialization, the concurrency ability is artificially reduced</li></ol><a name="7dul8"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="future-evolution">Future evolution<a href="#future-evolution" class="hash-link" aria-label="Direct link to Future evolution" title="Direct link to Future evolution">​</a></h3><p>Apache Derby official will try to realize the synchronous replication operation of BingLog based on Raft, and realize the database synchronization capability from the bottom</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Nacos 两周年献礼，Nacos 1.3.2 + Go SDK 1.0.0发布"><meta itemprop="keywords" content="开源,1.3.2,Go 1.0.0"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/nacos-2nd-anniversary">Nacos 两周年献礼，Nacos 1.3.2 + Go SDK 1.0.0发布</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T11:47:41.000Z" itemprop="datePublished">October 10, 2023</time> · <!-- -->4 min read</div></header><div class="markdown" itemprop="articleBody"><p>Nacos自2018年8月5日开源以来，在社区两年的共同努力之下，获得了13400+ stars，发布了30个版本，吸引了 125 位优秀贡献者，积累了上百家企业案例的成绩。在Nacos开源两周年之际，社区同时发布Nacos 1.3.2版本和Go SDK 的1.0.0版本，为Nacos庆生。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-132">Nacos 1.3.2<a href="#nacos-132" class="hash-link" aria-label="Direct link to Nacos 1.3.2" title="Direct link to Nacos 1.3.2">​</a></h2><p>Nacos 1.3.2版本在1.3.1的基础上，继续重构和优化内核功能，主要改进如下：</p><ol><li>重构并统一 nacos-client 中http客户端的内容，增加拓展性和可读性</li><li>回滚在 nacos-client 1.3.1对apache http的使用，以减少依赖冲突和不可控的日志输出</li><li>重构Nacos中的事件通知模块，提高性能和可读性</li><li>修复Nacos服务端在Windows环境下启动失败的问题</li><li>修复Nacos控制台的部分问题</li><li>修复部分文档的描述错误</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nacos-go-sdk-100">Nacos Go SDK 1.0.0<a href="#nacos-go-sdk-100" class="hash-link" aria-label="Direct link to Nacos Go SDK 1.0.0" title="Direct link to Nacos Go SDK 1.0.0">​</a></h2><p>Nacos-sdk-go的v1.0.0版本主要的改进如下：</p><ol><li>支持一个连接监听多个配置</li><li>支持取消配置监听功能</li><li>日志功能重新实现，支持日志轮转和日志实现替换</li><li>提升了实例选择的性能</li><li>文档和示例的完善</li><li>Nacos与dubbo-go、sentinel-golang等go语言微服务生态集成</li></ol><p>随着Go SDK 1.0.0正式版的发布，意味着Nacos在支持所有主流开发语言上更进了一步。目前，社区已经有Java、Golang、Python、Nodejs的语言支持。C++和C#的SDK也通过编程之夏稳步推进中，相信很快就可以和大家见面。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="后期规划">后期规划<a href="#后期规划" class="hash-link" aria-label="Direct link to 后期规划" title="Direct link to 后期规划">​</a></h2><p>在新的一年中，Nacos将会继续成长、聚焦 Nacos 内核构建，打造一个更稳定、更安全、更高效的微服务引擎
目前核心规划是：</p><ul><li>下沉并统一一致性模型</li><li>下沉并优化鉴权模型</li><li>升级连接通道，提升交互效率</li><li>升级服务数据模型，提升服务端运行效率</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="致谢">致谢<a href="#致谢" class="hash-link" aria-label="Direct link to 致谢" title="Direct link to 致谢">​</a></h2><p>随着视频、直播及线上教育行业大规模发展，Nacos在 虎牙、爱奇艺、芒果、Zoom、掌门、KK直播 等高速发展的企业中落地，有此成就，离不开社区贡献者和用户们的共同努力。</p><p>在此，感谢所有参与社区共建，为Nacos提供代码，设计以及讨论的贡献者和用户。</p><p>同时欢迎更多的个人及企业，参与到Nacos的共建中，让Nacos变得更加高效、稳定。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="结尾">结尾<a href="#结尾" class="hash-link" aria-label="Direct link to 结尾" title="Direct link to 结尾">​</a></h2><p>Nacos 致力于帮助您发现、配置和管理微服务。Nacos 提供了一组简单易用的特性集，帮助您快速实现动态服务发现、服务配置、服务元数据及流量管理。</p><p>Nacos 帮助您更敏捷和容易地构建、交付和管理微服务平台。 Nacos 是构建以“服务”为中心的现代应用架构 (例如微服务范式、云原生范式) 的服务基础设施。</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="为什么要支持confd，老的应用配置管理模式是启动时读取配置文件，然后重新读取配置文件需要应用重启。一般的配置管理系统都是代码侵入性的，应用接入配置管理系统都需要使用对应的SDK来查询和监听数据的变更。对于一些已经成熟的系统来说，接入SDK来实现动态配置管理是很难实现的，Nacos通过引入配置管理工具confd可以实现系统的配置变更做到无代码侵入性。"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/nacos-confd">nacos-confd</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T11:47:41.000Z" itemprop="datePublished">October 10, 2023</time> · <!-- -->6 min read</div></header><div class="markdown" itemprop="articleBody"><p>为什么要支持confd，老的应用配置管理模式是启动时读取配置文件，然后重新读取配置文件需要应用重启。一般的配置管理系统都是代码侵入性的，应用接入配置管理系统都需要使用对应的SDK来查询和监听数据的变更。对于一些已经成熟的系统来说，接入SDK来实现动态配置管理是很难实现的，Nacos通过引入配置管理工具confd可以实现系统的配置变更做到无代码侵入性。</p><p>confd是一个轻量级的配置管理工具，可以通过查询后端存储系统来实现第三方系统的动态配置管理，如Nginx、Tomcat、HAproxy、Docker配置等。confd目前支持的后端有etcd、ZooKeeper等，Nacos
1.1版本通过对confd定制支持Nacos作为后端存储。</p><p>confd能够查询和监听后端系统的数据变更，结合配置模版引擎动态更新本地配置文件，保持和后端系统的数据一致，并且能够执行命令或者脚本实现系统的reload或者重启。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="安装confd插件">安装confd插件<a href="#安装confd插件" class="hash-link" aria-label="Direct link to 安装confd插件" title="Direct link to 安装confd插件">​</a></h2><p>confd的安装可以通过源码安装方式，confd基于Go语言编写，其编译安装依赖Go，首先需要确保本地安装了Go，版本不低于v1.10
创建confd目录，下载confd源码，编译生成可执行文件</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p $GOPATH/src/github.com/kelseyhightower</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd $GOPATH/src/github.com/kelseyhightower</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://github.com/nacos-group/nacos-confd/archive/v0.19.1.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -xvf v0.19.1.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv nacos-confd-0.19.1 confd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd confd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>复制confd文件到bin目录下，启动confd</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo cp bin/confd /usr/local/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">confd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="confd结合nacos实现nginx配置管理示例">confd结合Nacos实现nginx配置管理示例<a href="#confd结合nacos实现nginx配置管理示例" class="hash-link" aria-label="Direct link to confd结合Nacos实现nginx配置管理示例" title="Direct link to confd结合Nacos实现nginx配置管理示例">​</a></h2><p>本文介绍使用Nacos结合confd实现Nginx配置管理，为简单起见以Nginx的黑名单功能为演示示例，Nacos使用官网部署的服务，域名为console.nacos.io。Nginx的安装可以参考网上文章</p><p><img loading="lazy" src="https://img.alicdn.com/tfs/TB1X_KhdUz1gK0jSZLeXXb9kVXa-720-405.jpg" alt="image" class="img_ev3q"></p><ul><li>1.创建confd所需目录</li></ul><p>confd配置文件默认在/etc/confd中，可以通过参数-confdir指定。目录中包含两个子目录，分别是：conf.d templates</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /etc/confd/{conf.d,templates}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>2.创建confd配置文件</li></ul><p>confd会先读取conf.d目录中的配置文件(toml格式)，然后根据文件指定的模板路径去渲染模板。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/confd/conf.d/nginx.toml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>内容为如下，其中nginx.conf.tmpl文件为confd的模版文件，keys为模版渲染成配置文件所需的配置内容，/usr/local/nginx/conf/nginx.conf为生成的配置文件</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[template]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">src = &quot; nginx.conf.tmpl&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dest =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;/usr/local/nginx/conf/nginx.conf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keys = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;/nginx/conf&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">check_cmd = &quot;/usr/local/nginx/sbin/nginx -t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-c {{.src}}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reload_cmd = &quot;/usr/local/nginx/sbin/nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-s reload&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>3.创建模版文件</li></ul><p>拷贝Nginx原始的配置，增加对应的渲染内容</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cp /usr/local/nginx/conf/nginx.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/confd/templates/nginx.conf.tmpl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/confd/templates/nginx.conf.tmpl</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>增加内容为:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">···</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{{$data := json (getv &quot;/nginx/conf&quot;)}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{{range $data.blackList}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deny {{.}};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{{end}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">···</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>4.在Nacos上创建所需的配置文件</li></ul><p>在public命名空间创建dataId为nginx.conf的配置文件，group使用默认的DEFAULT_GROUP即可，配置内容为json格式</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;blackList&quot;:[&quot;10.0.1.104&quot;,&quot;10.0.1.103&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://img.alicdn.com/tfs/TB1PSKwdKP2gK0jSZFoXXauIVXa-1986-1024.png" alt="image" class="img_ev3q"></p><ul><li>5.启动confd</li></ul><p>启动confd，从Nacos获取配置文件，渲染Nginx配置文件。backend设置成nacos，node指定访问的Nacos服务地址，watch让confd支持动态监听</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">confd -backend nacos -node http://console.nacos.io:80 -watch</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>6.查看Nginx配置文件，验证Nginx启动</li></ul><p>查看生成的/usr/local/nginx/conf/nginx.conf配置文件是否存在如下内容</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deny 10.0.1.104;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deny 10.0.1.103;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>curl命令访问Nginx，验证是否返回正常。http响应状态码为200说明访问Nginx正常</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl http://$IP:8080/ -i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 200 OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>7.查看本机Ip，加到Nacos配置文件黑名单中</li></ul><p>假设本机的Ip为30.5.125.107，将本机的Ip加入到Nginx黑名单</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;blackList&quot;:[&quot;10.0.1.104&quot;,&quot;10.0.1.103&quot;,&quot;30.5.125.107&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>8.查看Nginx配置文件，验证黑名单是否生效</li></ul><p>查看生成的/usr/local/nginx/conf/nginx.conf配置文件是否存在如下内容</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deny 10.0.1.104;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deny 10.0.1.103;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deny 30.5.125.107;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>curl命令访问Nginx，访问应该被拒绝，返回403</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl http://$IP:8080/ -i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 403 Forbidden</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2><p>本文介绍了使用Nacos结合confd来做自动化管理，confd作为轻量级的配置管理工具可以做到对第三方系统无代码侵入性。本文只是简单使用Nginx的黑名单功能来演示Nacos+confd的使用方式，当然Nginx还具有限流、反向代理等功能以及其他的系统比如Naproxy、Tomcat、Docker等也同样可以使用Nacos+confd做管理，大家可以到Nacos<a href="https://nacos.io" target="_blank" rel="noopener noreferrer">官网</a>贡献相应的demo或者方案。</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Placeholder. DO NOT DELETE."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/nacos-distro-mechanism">nacos-distro-mechanism</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-10T11:47:41.000Z" itemprop="datePublished">October 10, 2023</time> · <!-- -->One min read</div></header><div class="markdown" itemprop="articleBody"><p>Placeholder. DO NOT DELETE.</p></div></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/blog/page/3"><div class="pagination-nav__label">Newer Entries</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/blog/page/5"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div></div>
<script src="/en/assets/js/runtime~main.989215be.js"></script>
<script src="/en/assets/js/main.a44af4a6.js"></script>
</body>
</html>