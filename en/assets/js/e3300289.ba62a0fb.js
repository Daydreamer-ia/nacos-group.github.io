"use strict";(self.webpackChunkNacos=self.webpackChunkNacos||[]).push([[8535],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>g});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(n),m=r,g=u["".concat(l,".").concat(m)]||u[m]||d[m]||o;return n?a.createElement(g,i(i({ref:t},p),{},{components:n})):a.createElement(g,i({ref:t},p))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},4504:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var a=n(87462),r=(n(67294),n(3905));const o={title:"NacosSync migration user guide",keywords:["NacosSync","migration","user guide"],description:"NacosSync migration user manual"},i="NacosSync migration user guide",s={unversionedId:"nacos-sync-use",id:"nacos-sync-use",title:"NacosSync migration user guide",description:"NacosSync migration user manual",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/nacos-sync-use.md",sourceDirName:".",slug:"/nacos-sync-use",permalink:"/en/docs/next/nacos-sync-use",draft:!1,tags:[],version:"current",frontMatter:{title:"NacosSync migration user guide",keywords:["NacosSync","migration","user guide"],description:"NacosSync migration user manual"}},l={},c=[{value:"Guide purposes",id:"guide-purposes",level:2},{value:"Preparatory work",id:"preparatory-work",level:2},{value:"Get the installation package",id:"get-the-installation-package",level:2},{value:"Initialize the database",id:"initialize-the-database",level:2},{value:"Database configuration",id:"database-configuration",level:2},{value:"Start server",id:"start-server",level:2},{value:"Check system status",id:"check-system-status",level:2},{value:"Console",id:"console",level:2},{value:"Starting migration",id:"starting-migration",level:2},{value:"Migration information",id:"migration-information",level:3},{value:"Add the registry cluster information",id:"add-the-registry-cluster-information",level:3},{value:"Add the synchronization task",id:"add-the-synchronization-task",level:3},{value:"Dubbo clients to connect to Nacos registry",id:"dubbo-clients-to-connect-to-nacos-registry",level:3},{value:"Dubbo Consumer client migration",id:"dubbo-consumer-client-migration",level:4},{value:"Dubbo Provider migration",id:"dubbo-provider-migration",level:4},{value:"New deployment structure",id:"new-deployment-structure",level:3},{value:"Attention",id:"attention",level:3}],p={toc:c},u="wrapper";function d(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"nacossync-migration-user-guide"},"NacosSync migration user guide"),(0,r.kt)("h2",{id:"guide-purposes"},"Guide purposes"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Start NacosSync service"),(0,r.kt)("li",{parentName:"ul"},"By a simple example, demonstrates how to register to the Zookeeper Dubbo client migrated to Nacos.")),(0,r.kt)("h2",{id:"preparatory-work"},"Preparatory work"),(0,r.kt)("p",null,"Before you start the service, you need to install the following services:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"64bit OS: Linux/Unix/Mac/Windows supported, Linux/Unix/Mac recommended."),(0,r.kt)("li",{parentName:"ul"},"64bit JDK 1.8+:\xa0",(0,r.kt)("a",{parentName:"li",href:"http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html"},"downloads"),",\xa0",(0,r.kt)("a",{parentName:"li",href:"https://docs.oracle.com/cd/E19182-01/820-7851/inst_cli_jdk_javahome_t/"},"JAVA_HOME settings"),"."),(0,r.kt)("li",{parentName:"ul"},"Maven 3.2.x+:\xa0",(0,r.kt)("a",{parentName:"li",href:"https://maven.apache.org/download.cgi"},"downloads"),",\xa0",(0,r.kt)("a",{parentName:"li",href:"https://maven.apache.org/settings.html"},"settings"),"."),(0,r.kt)("li",{parentName:"ul"},"MySql 5.6.+")),(0,r.kt)("h2",{id:"get-the-installation-package"},"Get the installation package"),(0,r.kt)("p",null,"There are two ways to obtain NacosSync installation package:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Direct download NacosSync binary installation package:",(0,r.kt)("a",{parentName:"li",href:"https://github.com/nacos-group/nacos-sync/releases"},"nacosSync.${version}.zip")),(0,r.kt)("li",{parentName:"ul"},"Download NacosSync source to build from the Github")),(0,r.kt)("p",null,"Package:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-basic"},"cd nacosSync/\nmvn clean package -U\n")),(0,r.kt)("p",null,"The path of the target file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-basic"},"nacos-sync/nacossync-distribution/target/nacosSync.${version}.zip\n")),(0,r.kt)("p",null,"Unpack the installation package, project file directory structure:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-basic"},"nacosSync\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 NOTICE\n\u251c\u2500\u2500 bin\n\u2502\xa0\xa0 \u251c\u2500\u2500 nacosSync.sql\n\u2502\xa0\xa0 \u251c\u2500\u2500 shutdown.sh\n\u2502\xa0\xa0 \u2514\u2500\u2500 startup.sh\n\u251c\u2500\u2500 conf\n\u2502\xa0\xa0 \u251c\u2500\u2500 application.properties\n\u2502\xa0\xa0 \u2514\u2500\u2500 logback-spring.xml\n\u251c\u2500\u2500 logs\n\u2514\u2500\u2500 nacosSync-server.${version}.jar\n")),(0,r.kt)("h2",{id:"initialize-the-database"},"Initialize the database"),(0,r.kt)("p",null,"The system default configuration database is Mysql, can also support other relational database.\n1.The database construction, the default database name for \"nacos_Sync\".\n2.The database table don't need to create separately, using the hibernate automatically by default build table function.\n3.If you do not support automatic table, you can use the system's own build table SQL script, the script in the bin directory."),(0,r.kt)("h2",{id:"database-configuration"},"Database configuration"),(0,r.kt)("p",null,"Database configuration file on ",(0,r.kt)("inlineCode",{parentName:"p"},"conf/application.properties"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-basic"},"spring.datasource.url=jdbc:mysql://127.0.0.1:3306/nacos_sync?characterEncoding=utf8\nspring.datasource.username=root\nspring.datasource.password=root\n")),(0,r.kt)("h2",{id:"start-server"},"Start server"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ nacosSync/bin:\nsh startup.sh  restart\n")),(0,r.kt)("h2",{id:"check-system-status"},"Check system status"),(0,r.kt)("p",null,"1.Check system log"),(0,r.kt)("p",null,"The path of the log in ",(0,r.kt)("inlineCode",{parentName:"p"},"nacosSync/logs/nacosSync.log"),", check whether there are abnormal information."),(0,r.kt)("p",null,"2.Check system port"),(0,r.kt)("p",null,"Port is the default system ",(0,r.kt)("inlineCode",{parentName:"p"},"8081"),", you can define your own ",(0,r.kt)("inlineCode",{parentName:"p"},"application.properties"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$netstat -ano|grep 8081\ntcp        0      0 0.0.0.0:8081                0.0.0.0:*                   LISTEN      off (0.00/0/0)\n")),(0,r.kt)("h2",{id:"console"},"Console"),(0,r.kt)("p",null,"Access path:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"http://127.0.0.1:8081/#/serviceSync\n")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://img.alicdn.com/tfs/TB1EKbkJ3HqK1RjSZFEXXcGMXXa-2866-606.png",alt:"image.png"})),(0,r.kt)("p",null,"If there is no problem, check NacosSync has begun, normal NacosSync deployment structure:",(0,r.kt)("img",{parentName:"p",src:"https://img.alicdn.com/tfs/TB107nfJ9zqK1RjSZFjXXblCFXa-1412-342.png",alt:"image.png"})),(0,r.kt)("h2",{id:"starting-migration"},"Starting migration"),(0,r.kt)("h3",{id:"migration-information"},"Migration information"),(0,r.kt)("p",null,"Dubbo service deployment information:",(0,r.kt)("img",{parentName:"p",src:"https://img.alicdn.com/tfs/TB1Ci_eJ4TpK1RjSZR0XXbEwXXa-938-700.png",alt:"image.png"})),(0,r.kt)("p",null,"The migration of services:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Service Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Version"),(0,r.kt)("th",{parentName:"tr",align:null},"Group Name"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"com.alibaba.nacos.api.DemoService"),(0,r.kt)("td",{parentName:"tr",align:null},"1.0.0"),(0,r.kt)("td",{parentName:"tr",align:null},"zk")))),(0,r.kt)("h3",{id:"add-the-registry-cluster-information"},"Add the registry cluster information"),(0,r.kt)("p",null,'1.Click on the "cluster configuration" button in the left navigation bar, a new cluster, first add a Zookeeper cluster, select the cluster type for ZK.\n',(0,r.kt)("img",{parentName:"p",src:"https://img.alicdn.com/tfs/TB1oJDnJ7voK1RjSZFwXXciCFXa-2870-1130.png",alt:"image.png"})),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Note: the cluster name can customize, but once confirmed, cannot be modified, otherwise increase task based on the cluster, after NacosSync restart, success will not resume.")),(0,r.kt)("p",null,"2.The same steps, increase NacosSync cluster.\n",(0,r.kt)("img",{parentName:"p",src:"https://img.alicdn.com/tfs/TB1HQPhJVzqK1RjSZFCXXbbxVXa-2846-1042.png",alt:"image.png"})),(0,r.kt)("p",null,"3.After the completion of the add, can inquire on the list:\n",(0,r.kt)("img",{parentName:"p",src:"https://img.alicdn.com/tfs/TB1AX6fJVYqK1RjSZLeXXbXppXa-2864-824.png",alt:"image.png"})),(0,r.kt)("h3",{id:"add-the-synchronization-task"},"Add the synchronization task"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Add a sync task, from Zookeeper cluster synchronization to Nacos cluster, synchronous granularity is service, it is called a Zookeeper cluster source cluster, Nacos cluster called target cluster.\n",(0,r.kt)("img",{parentName:"li",src:"https://img.alicdn.com/tfs/TB1tF_fJVYqK1RjSZLeXXbXppXa-2838-1138.png",alt:"imagesd.png"}))),(0,r.kt)("p",null,"Add finished, can be in service sync list, view has add synchronization task:\n",(0,r.kt)("img",{parentName:"p",src:"https://img.alicdn.com/tfs/TB1l6uJJ9zqK1RjSZPcXXbTepXa-2824-570.png",alt:"image.png"})),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The synchronization is completed, check whether the data synchronization to success Nacos cluster, can query through the Nacos console.\n",(0,r.kt)("img",{parentName:"p",src:"https://img.alicdn.com/tfs/TB1tPneJ4TpK1RjSZR0XXbEwXXa-2872-828.png",alt:"image.png"}))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"At the moment, the data has been successfully from Zookeeper cluster synchronization to Nacos cluster, the deployment structure is as follows:\n",(0,r.kt)("img",{parentName:"p",src:"https://img.alicdn.com/tfs/TB14kriJ6TpK1RjSZKPXXa3UpXa-1724-772.png",alt:"image.png"})))),(0,r.kt)("h3",{id:"dubbo-clients-to-connect-to-nacos-registry"},"Dubbo clients to connect to Nacos registry"),(0,r.kt)("h4",{id:"dubbo-consumer-client-migration"},"Dubbo Consumer client migration"),(0,r.kt)("p",null,"Dubbo has supported Nacos registry, support version 2.5 +, need to add a Nacos registry of Dubbo extensions depends on:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-basic"},"<dependency>\n      <groupId>com.alibaba</groupId>\n      <artifactId>dubbo-registry-nacos</artifactId>\n            <version>0.0.2</version>\n</dependency>\n")),(0,r.kt)("p",null,"Increase Nacos client depends on:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-basic"},"<dependency>\n        <groupId>com.alibaba.nacos</groupId>\n        <artifactId>nacos-client</artifactId>\n        <version>0.6.2</version>\n</dependency>\n")),(0,r.kt)("p",null,"Configuration Dubbo Consumer Dubbo profile ",(0,r.kt)("inlineCode",{parentName:"p"},"Consumer. The yaml"),", let the client can find Nacos cluster."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-basic"},"spring:\n  application:\nname: dubbo-consumer\ndemo:\n  service:\n    version: 1.0.0\n    group: zk\ndubbo:\n  registry:\n    address: nacos://127.0.0.1:8848\n")),(0,r.kt)("p",null,"Don't need to modify the code, configuration after the update, you can restart your application into law."),(0,r.kt)("p",null,"Consumer release is completed, the deployment of the structure is as follows:\n",(0,r.kt)("img",{parentName:"p",src:"https://img.alicdn.com/tfs/TB181fkJ3HqK1RjSZFEXXcGMXXa-1734-878.png",alt:"image.png"})),(0,r.kt)("h4",{id:"dubbo-provider-migration"},"Dubbo Provider migration"),(0,r.kt)("p",null,"Before you upgrade the Provider, you need to ensure that the Provider of services, are already configured in NacosSync, synchronous way from Nacos synchronization to Zookeeper, because the Provider connected to Nacos upgrade, you need to make sure that the old Dubbo Consumer client can subscribe to the Provider's address in the Zookeeper, now, we add a sync task:\n",(0,r.kt)("img",{parentName:"p",src:"https://img.alicdn.com/tfs/TB1pdDnJ7voK1RjSZFwXXciCFXa-2872-1060.png",alt:"image.png"})),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://img.alicdn.com/tfs/TB19Ey_J6DpK1RjSZFrXXa78VXa-2842-660.png",alt:"image.png"})),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Note: Nacos synchronization to the Zookeeper service, do not need to fill in the version number, you in choosing the source cluster, the version number of the input box automatically hidden.")),(0,r.kt)("p",null,"Sync task is completed, you can upgrade the Provider, upgrade the Provider method, reference to upgrade the Consumer steps."),(0,r.kt)("h3",{id:"new-deployment-structure"},"New deployment structure"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In the process of upgrading, there will be new and old versions of the client at the same time, the deployment structure is as follows:")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://img.alicdn.com/tfs/TB14Y_iJ3HqK1RjSZFPXXcwapXa-1728-838.png",alt:"image.png"})),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"All client migration is completed, the deployment structure is as follows:")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://img.alicdn.com/tfs/TB1Cg2dJYvpK1RjSZPiXXbmwXXa-1466-864.png",alt:"image.png"})),(0,r.kt)("p",null,"Now, the Zookeeper cluster, NacosSync cluster can get offline."),(0,r.kt)("h3",{id:"attention"},"Attention"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Synchronization task after adding, you need to ensure that the service is successful sync to the target cluster, can through the console the target cluster."),(0,r.kt)("li",{parentName:"ul"},"NacosSync support high availability cluster pattern deployment, you only need to put the database can be configured to the same."),(0,r.kt)("li",{parentName:"ul"},"Comb if not clear subscription and published service, suggested can do services are two-way synchronous."),(0,r.kt)("li",{parentName:"ul"},"Dubbo client currently does not support Nacos weighting function, if you are using the weight function, need to reconsider the plan.")))}d.isMDXComponent=!0}}]);